parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"g5IB":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"VOc0":[function(require,module,exports) {
var global = arguments[3];
var process = require("process");
var t=arguments[3],e=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Sha1=exports.RANDOM_FACTOR=exports.MAX_VALUE_MILLIS=exports.FirebaseError=exports.ErrorFactory=exports.Deferred=exports.DecodeBase64StringError=exports.CONSTANTS=void 0,exports.areCookiesEnabled=V,exports.assertionError=exports.assert=void 0,exports.async=ft,exports.base64urlEncodeWithoutPadding=exports.base64Encode=exports.base64Decode=exports.base64=void 0,exports.calculateBackoffMillis=Ct,exports.contains=Y,exports.createMockUserToken=O,exports.createSubscribe=ht,exports.decode=void 0,exports.deepCopy=l,exports.deepEqual=rt,exports.deepExtend=p,exports.errorPrefix=bt,exports.extractQuerystring=at,exports.getExperimentalSetting=exports.getDefaults=exports.getDefaultEmulatorHostnameAndPort=exports.getDefaultEmulatorHost=exports.getDefaultAppConfig=void 0,exports.getGlobal=b,exports.getModularInstance=Tt,exports.getUA=C,exports.isAdmin=void 0,exports.isBrowser=T,exports.isBrowserExtension=N,exports.isElectron=j,exports.isEmpty=tt,exports.isIE=B,exports.isIndexedDBAvailable=L,exports.isMobileCordova=D,exports.isNode=w,exports.isNodeSdk=I,exports.isReactNative=M,exports.isSafari=P,exports.isUWP=k,exports.issuedAtTime=exports.isValidTimestamp=exports.isValidFormat=void 0,exports.jsonEval=H,exports.map=et,exports.ordinal=Dt,exports.promiseWithTimeout=nt,exports.querystring=st,exports.querystringDecode=it,exports.safeGet=Z,exports.stringToByteArray=exports.stringLength=void 0,exports.stringify=J,exports.validateArgCount=exports.uuidv4=void 0,exports.validateCallback=_t,exports.validateContextObject=gt,exports.validateIndexedDBOpenable=R,exports.validateNamespace=xt;const r={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};exports.CONSTANTS=r;const o=function(t,e){if(!t)throw n(e)};exports.assert=o;const n=function(t){return new Error("Firebase Database ("+r.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};exports.assertionError=n;const s=function(t){const e=[];let r=0;for(let o=0;o<t.length;o++){let n=t.charCodeAt(o);n<128?e[r++]=n:n<2048?(e[r++]=n>>6|192,e[r++]=63&n|128):55296==(64512&n)&&o+1<t.length&&56320==(64512&t.charCodeAt(o+1))?(n=65536+((1023&n)<<10)+(1023&t.charCodeAt(++o)),e[r++]=n>>18|240,e[r++]=n>>12&63|128,e[r++]=n>>6&63|128,e[r++]=63&n|128):(e[r++]=n>>12|224,e[r++]=n>>6&63|128,e[r++]=63&n|128)}return e},i=function(t){const e=[];let r=0,o=0;for(;r<t.length;){const n=t[r++];if(n<128)e[o++]=String.fromCharCode(n);else if(n>191&&n<224){const s=t[r++];e[o++]=String.fromCharCode((31&n)<<6|63&s)}else if(n>239&&n<365){const s=((7&n)<<18|(63&t[r++])<<12|(63&t[r++])<<6|63&t[r++])-65536;e[o++]=String.fromCharCode(55296+(s>>10)),e[o++]=String.fromCharCode(56320+(1023&s))}else{const s=t[r++],i=t[r++];e[o++]=String.fromCharCode((15&n)<<12|(63&s)<<6|63&i)}}return e.join("")},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let n=0;n<t.length;n+=3){const e=t[n],s=n+1<t.length,i=s?t[n+1]:0,a=n+2<t.length,c=a?t[n+2]:0,h=e>>2,u=(3&e)<<4|i>>4;let f=(15&i)<<2|c>>6,l=63&c;a||(l=64,s||(f=64)),o.push(r[h],r[u],r[f],r[l])}return o.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(s(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):i(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let n=0;n<t.length;){const e=r[t.charAt(n++)],s=n<t.length?r[t.charAt(n)]:0,i=++n<t.length?r[t.charAt(n)]:64,a=++n<t.length?r[t.charAt(n)]:64;if(++n,null==e||null==s||null==i||null==a)throw new c;const h=e<<2|s>>4;if(o.push(h),64!==i){const t=s<<4&240|i>>2;if(o.push(t),64!==a){const t=i<<6&192|a;o.push(t)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};exports.base64=a;class c extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}exports.DecodeBase64StringError=c;const h=function(t){const e=s(t);return a.encodeByteArray(e,!0)};exports.base64Encode=h;const u=function(t){return h(t).replace(/\./g,"")};exports.base64urlEncodeWithoutPadding=u;const f=function(t){try{return a.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function l(t){return p(void 0,t)}function p(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(const r in e)e.hasOwnProperty(r)&&d(r)&&(t[r]=p(t[r],e[r]));return t}function d(t){return"__proto__"!==t}function b(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("Unable to locate global object.")}exports.base64Decode=f;const x=()=>b().__FIREBASE_DEFAULTS__,_=()=>{if(void 0===e||void 0===e.env)return},g=()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(r){return}const e=t&&f(t[1]);return e&&JSON.parse(e)},y=()=>{try{return x()||_()||g()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}};exports.getDefaults=y;const v=t=>{var e,r;return null===(r=null===(e=y())||void 0===e?void 0:e.emulatorHosts)||void 0===r?void 0:r[t]};exports.getDefaultEmulatorHost=v;const E=t=>{const e=v(t);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(r+1),10);return"["===e[0]?[e.substring(1,r-1),o]:[e.substring(0,r),o]};exports.getDefaultEmulatorHostnameAndPort=E;const m=()=>{var t;return null===(t=y())||void 0===t?void 0:t.config};exports.getDefaultAppConfig=m;const S=t=>{var e;return null===(e=y())||void 0===e?void 0:e[`_${t}`]};exports.getExperimentalSetting=S;class A{constructor(){this.reject=(()=>{}),this.resolve=(()=>{}),this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),"function"==typeof t&&(this.promise.catch(()=>{}),1===t.length?t(e):t(e,r))}}}function O(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r=e||"demo-project",o=t.iat||0,n=t.sub||t.user_id;if(!n)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:o,exp:o+3600,auth_time:o,sub:n,user_id:n,firebase:{sign_in_provider:"custom",identities:{}}},t);return[u(JSON.stringify({alg:"none",type:"JWT"})),u(JSON.stringify(s)),""].join(".")}function C(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function D(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(C())}function w(){var e;const r=null===(e=y())||void 0===e?void 0:e.forceEnvironment;if("node"===r)return!0;if("browser"===r)return!1;try{return"[object process]"===Object.prototype.toString.call(t.process)}catch(o){return!1}}function T(){return"object"==typeof self&&self.self===self}function N(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function M(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function j(){return C().indexOf("Electron/")>=0}function B(){const t=C();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function k(){return C().indexOf("MSAppHost/")>=0}function I(){return!0===r.NODE_CLIENT||!0===r.NODE_ADMIN}function P(){return!w()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function L(){try{return"object"==typeof indexedDB}catch(t){return!1}}function R(){return new Promise((t,e)=>{try{let o=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=(()=>{s.result.close(),o||self.indexedDB.deleteDatabase(n),t(!0)}),s.onupgradeneeded=(()=>{o=!1}),s.onerror=(()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")})}catch(r){e(r)}})}function V(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}exports.Deferred=A;const F="FirebaseError";class U extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=F,Object.setPrototypeOf(this,U.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,W.prototype.create)}}exports.FirebaseError=U;class W{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){const r=e[0]||{},o=`${this.service}/${t}`,n=this.errors[t],s=n?$(n,r):"Error",i=`${this.serviceName}: ${s} (${o}).`;return new U(o,i,r)}}function $(t,e){return t.replace(z,(t,r)=>{const o=e[r];return null!=o?String(o):`<${r}?>`})}exports.ErrorFactory=W;const z=/\{\$([^}]+)}/g;function H(t){return JSON.parse(t)}function J(t){return JSON.stringify(t)}const q=function(t){let e={},r={},o={},n="";try{const i=t.split(".");e=H(f(i[0])||""),r=H(f(i[1])||""),n=i[2],o=r.d||{},delete r.d}catch(s){}return{header:e,claims:r,data:o,signature:n}};exports.decode=q;const G=function(t){const e=q(t).claims,r=Math.floor((new Date).getTime()/1e3);let o=0,n=0;return"object"==typeof e&&(e.hasOwnProperty("nbf")?o=e.nbf:e.hasOwnProperty("iat")&&(o=e.iat),n=e.hasOwnProperty("exp")?e.exp:o+86400),!!r&&!!o&&!!n&&r>=o&&r<=n};exports.isValidTimestamp=G;const K=function(t){const e=q(t).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null};exports.issuedAtTime=K;const X=function(t){const e=q(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")};exports.isValidFormat=X;const Q=function(t){const e=q(t).claims;return"object"==typeof e&&!0===e.admin};function Y(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Z(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function tt(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function et(t,e,r){const o={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(o[n]=e.call(r,t[n],n,t));return o}function rt(t,e){if(t===e)return!0;const r=Object.keys(t),o=Object.keys(e);for(const n of r){if(!o.includes(n))return!1;const r=t[n],s=e[n];if(ot(r)&&ot(s)){if(!rt(r,s))return!1}else if(r!==s)return!1}for(const n of o)if(!r.includes(n))return!1;return!0}function ot(t){return null!==t&&"object"==typeof t}function nt(t,e=2e3){const r=new A;return setTimeout(()=>r.reject("timeout!"),e),t.then(r.resolve,r.reject),r.promise}function st(t){const e=[];for(const[r,o]of Object.entries(t))Array.isArray(o)?o.forEach(t=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(t))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function it(t){const e={};return t.replace(/^\?/,"").split("&").forEach(t=>{if(t){const[r,o]=t.split("=");e[decodeURIComponent(r)]=decodeURIComponent(o)}}),e}function at(t){const e=t.indexOf("?");if(!e)return"";const r=t.indexOf("#",e);return t.substring(e,r>0?r:void 0)}exports.isAdmin=Q;class ct{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const r=this.W_;if("string"==typeof t)for(let u=0;u<16;u++)r[u]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let u=0;u<16;u++)r[u]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let u=16;u<80;u++){const t=r[u-3]^r[u-8]^r[u-14]^r[u-16];r[u]=4294967295&(t<<1|t>>>31)}let o,n,s=this.chain_[0],i=this.chain_[1],a=this.chain_[2],c=this.chain_[3],h=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(o=c^i&(a^c),n=1518500249):(o=i^a^c,n=1859775393):u<60?(o=i&a|c&(i|a),n=2400959708):(o=i^a^c,n=3395469782);const t=(s<<5|s>>>27)+o+h+n+r[u]&4294967295;h=c,c=a,a=4294967295&(i<<30|i>>>2),i=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295}update(t,e){if(null==t)return;void 0===e&&(e=t.length);const r=e-this.blockSize;let o=0;const n=this.buf_;let s=this.inbuf_;for(;o<e;){if(0===s)for(;o<=r;)this.compress_(t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(n[s]=t.charCodeAt(o),++o,++s===this.blockSize){this.compress_(n),s=0;break}}else for(;o<e;)if(n[s]=t[o],++o,++s===this.blockSize){this.compress_(n),s=0;break}}this.inbuf_=s,this.total_+=e}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let o=this.blockSize-1;o>=56;o--)this.buf_[o]=255&e,e/=256;this.compress_(this.buf_);let r=0;for(let o=0;o<5;o++)for(let e=24;e>=0;e-=8)t[r]=this.chain_[o]>>e&255,++r;return t}}function ht(t,e){const r=new ut(t,e);return r.subscribe.bind(r)}exports.Sha1=ct;class ut{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(t=>{this.error(t)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,r){let o;if(void 0===t&&void 0===e&&void 0===r)throw new Error("Missing Observer.");void 0===(o=lt(t,["next","error","complete"])?t:{next:t,error:e,complete:r}).next&&(o.next=pt),void 0===o.error&&(o.error=pt),void 0===o.complete&&(o.complete=pt);const n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?o.error(this.finalError):o.complete()}catch(t){}}),this.observers.push(o),n}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(r){"undefined"!=typeof console&&console.error&&console.error(r)}})}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ft(t,e){return(...r)=>{Promise.resolve(!0).then(()=>{t(...r)}).catch(t=>{e&&e(t)})}}function lt(t,e){if("object"!=typeof t||null===t)return!1;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}function pt(){}const dt=function(t,e,r,o){let n;if(o<e?n="at least "+e:o>r&&(n=0===r?"none":"no more than "+r),n){throw new Error(t+" failed: Was called with "+o+(1===o?" argument.":" arguments.")+" Expects "+n+".")}};function bt(t,e){return`${t} failed: ${e} argument `}function xt(t,e,r){if((!r||e)&&"string"!=typeof e)throw new Error(bt(t,"namespace")+"must be a valid firebase namespace.")}function _t(t,e,r,o){if((!o||r)&&"function"!=typeof r)throw new Error(bt(t,e)+"must be a valid function.")}function gt(t,e,r,o){if((!o||r)&&("object"!=typeof r||null===r))throw new Error(bt(t,e)+"must be a valid context object.")}exports.validateArgCount=dt;const yt=function(t){const e=[];let r=0;for(let n=0;n<t.length;n++){let s=t.charCodeAt(n);if(s>=55296&&s<=56319){const e=s-55296;o(++n<t.length,"Surrogate pair missing trail surrogate."),s=65536+(e<<10)+(t.charCodeAt(n)-56320)}s<128?e[r++]=s:s<2048?(e[r++]=s>>6|192,e[r++]=63&s|128):s<65536?(e[r++]=s>>12|224,e[r++]=s>>6&63|128,e[r++]=63&s|128):(e[r++]=s>>18|240,e[r++]=s>>12&63|128,e[r++]=s>>6&63|128,e[r++]=63&s|128)}return e};exports.stringToByteArray=yt;const vt=function(t){let e=0;for(let r=0;r<t.length;r++){const o=t.charCodeAt(r);o<128?e++:o<2048?e+=2:o>=55296&&o<=56319?(e+=4,r++):e+=3}return e};exports.stringLength=vt;const Et=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})};exports.uuidv4=Et;const mt=1e3,St=2,At=144e5;exports.MAX_VALUE_MILLIS=At;const Ot=.5;function Ct(t,e=mt,r=St){const o=e*Math.pow(r,t),n=Math.round(Ot*o*(Math.random()-.5)*2);return Math.min(At,o+n)}function Dt(t){return Number.isFinite(t)?t+wt(t):`${t}`}function wt(t){const e=(t=Math.abs(t))%100;if(e>=10&&e<=20)return"th";const r=t%10;return 1===r?"st":2===r?"nd":3===r?"rd":"th"}function Tt(t){return t&&t._delegate?t._delegate:t}exports.RANDOM_FACTOR=Ot;
},{"process":"g5IB"}],"bXWY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Provider=exports.ComponentContainer=exports.Component=void 0;var t=require("@firebase/util");class e{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}exports.Component=e;const n="[DEFAULT]";class i{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const e=new t.Deferred;if(this.instancesDeferred.set(n,e),this.isInitialized(n)||this.shouldAutoInitialize())try{const t=this.getOrInitializeService({instanceIdentifier:n});t&&e.resolve(t)}catch(i){}}return this.instancesDeferred.get(n).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(r(t))try{this.getOrInitializeService({instanceIdentifier:n})}catch(e){}for(const[t,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:i});n.resolve(t)}catch(e){}}}}clearInstance(t=n){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...t.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return null!=this.component}isInitialized(t=n){return this.instances.has(t)}getOptions(t=n){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[s,r]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&r.resolve(i)}return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch(i){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:s(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(i){}return n||null}normalizeInstanceIdentifier(t=n){return this.component?this.component.multipleInstances?t:n:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function s(t){return t===n?void 0:t}function r(t){return"EAGER"===t.instantiationMode}exports.Provider=i;class o{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new i(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}exports.ComponentContainer=o;
},{"@firebase/util":"VOc0"}],"uNCT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=exports.LogLevel=void 0,exports.setLogLevel=i,exports.setUserLogHandler=g;const e=[];var r;exports.LogLevel=r,function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(exports.LogLevel=r={}));const t={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},o=r.INFO,l={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},s=(e,r,...t)=>{if(r<e.logLevel)return;const o=(new Date).toISOString(),s=l[r];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${r})`);console[s](`[${o}]  ${e.name}:`,...t)};class n{constructor(r){this.name=r,this._logLevel=o,this._logHandler=s,this._userLogHandler=null,e.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?t[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}function i(r){e.forEach(e=>{e.setLogLevel(r)})}function g(o,l){for(const s of e){let e=null;l&&l.level&&(e=t[l.level]),s.userLogHandler=null===o?null:(t,l,...s)=>{const n=s.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(r){return null}}).filter(e=>e).join(" ");l>=(null!=e?e:t.logLevel)&&o({level:r[l].toLowerCase(),message:n,args:s,type:t.name})}}}exports.Logger=n;
},{}],"yLTS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.i=exports.a=void 0,exports.r=v,exports.u=void 0,exports.w=I;const e=(e,t)=>t.some(t=>e instanceof t);let t,r;function n(){return t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function o(){return r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}exports.i=e;const s=new WeakMap,i=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap;function p(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{t(I(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&s.set(t,e)}).catch(()=>{}),u.set(t,e),t}function f(e){if(i.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});i.set(e,t)}exports.a=u;let d={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return i.get(e);if("objectStoreNames"===t)return e.objectStoreNames||a.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return I(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function v(e){d=e(d)}function D(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?o().includes(e)?function(...t){return e.apply(B(this),t),I(s.get(this))}:function(...t){return I(e.apply(B(this),t))}:function(t,...r){const n=e.call(B(this),t,...r);return a.set(n,t.sort?t.sort():[t]),I(n)}}function m(t){return"function"==typeof t?D(t):(t instanceof IDBTransaction&&f(t),e(t,n())?new Proxy(t,d):t)}function I(e){if(e instanceof IDBRequest)return p(e);if(c.has(e))return c.get(e);const t=m(e);return t!==e&&(c.set(e,t),u.set(t,e)),t}const B=e=>u.get(e);exports.u=B;
},{}],"ZUep":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.deleteDB=n,exports.openDB=t,Object.defineProperty(exports,"unwrap",{enumerable:!0,get:function(){return e.u}}),Object.defineProperty(exports,"wrap",{enumerable:!0,get:function(){return e.w}});var e=require("./wrap-idb-value.js");function t(t,n,{blocked:r,upgrade:o,blocking:i,terminated:s}={}){const d=indexedDB.open(t,n),a=(0,e.w)(d);return o&&d.addEventListener("upgradeneeded",t=>{o((0,e.w)(d.result),t.oldVersion,t.newVersion,(0,e.w)(d.transaction),t)}),r&&d.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}function n(t,{blocked:n}={}){const r=indexedDB.deleteDatabase(t);return n&&r.addEventListener("blocked",e=>n(e.oldVersion,e)),(0,e.w)(r).then(()=>void 0)}const r=["get","getKey","getAll","getAllKeys","count"],o=["put","add","delete","clear"],i=new Map;function s(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(i.get(t))return i.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,d=o.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!d&&!r.includes(n))return;const a=async function(e,...t){const r=this.transaction(e,d?"readwrite":"readonly");let o=r.store;return s&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),d&&r.done]))[0]};return i.set(t,a),a}(0,e.r)(e=>({...e,get:(t,n,r)=>s(t,n)||e.get(t,n,r),has:(t,n)=>!!s(t,n)||e.has(t,n)}));
},{"./wrap-idb-value.js":"yLTS"}],"qn02":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"FirebaseError",{enumerable:!0,get:function(){return a.FirebaseError}}),exports._DEFAULT_ENTRY_NAME=exports.SDK_VERSION=void 0,exports._addComponent=L,exports._addOrOverwriteComponent=M,exports._apps=void 0,exports._clearComponents=V,exports._components=void 0,exports._getProvider=U,exports._registerComponent=T,exports._removeServiceInstance=R,exports.deleteApp=Q,exports.getApp=Y,exports.getApps=G,exports.initializeApp=W,exports.onLog=Z,exports.registerVersion=X,exports.setLogLevel=ee;var e=require("@firebase/component"),t=require("@firebase/logger"),a=require("@firebase/util"),r=require("idb");class n{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(i(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}function i(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}const s="@firebase/app",o="0.9.11",c=new t.Logger("@firebase/app"),p="@firebase/app-compat",h="@firebase/analytics-compat",l="@firebase/analytics",f="@firebase/app-check-compat",d="@firebase/app-check",b="@firebase/auth",g="@firebase/auth-compat",u="@firebase/database",m="@firebase/database-compat",w="@firebase/functions",_="@firebase/functions-compat",v="@firebase/installations",D="@firebase/installations-compat",C="@firebase/messaging",E="@firebase/messaging-compat",y="@firebase/performance",x="@firebase/performance-compat",I="@firebase/remote-config",S="@firebase/remote-config-compat",P="@firebase/storage",O="@firebase/storage-compat",A="@firebase/firestore",$="@firebase/firestore-compat",N="firebase",j="9.22.1",k="[DEFAULT]";exports._DEFAULT_ENTRY_NAME=k;const F={[s]:"fire-core",[p]:"fire-core-compat",[l]:"fire-analytics",[h]:"fire-analytics-compat",[d]:"fire-app-check",[f]:"fire-app-check-compat",[b]:"fire-auth",[g]:"fire-auth-compat",[u]:"fire-rtdb",[m]:"fire-rtdb-compat",[w]:"fire-fn",[_]:"fire-fn-compat",[v]:"fire-iid",[D]:"fire-iid-compat",[C]:"fire-fcm",[E]:"fire-fcm-compat",[y]:"fire-perf",[x]:"fire-perf-compat",[I]:"fire-rc",[S]:"fire-rc-compat",[P]:"fire-gcs",[O]:"fire-gcs-compat",[A]:"fire-fst",[$]:"fire-fst-compat","fire-js":"fire-js",[N]:"fire-js-all"},B=new Map;exports._apps=B;const H=new Map;function L(e,t){try{e.container.addComponent(t)}catch(a){c.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,a)}}function M(e,t){e.container.addOrOverwriteComponent(t)}function T(e){const t=e.name;if(H.has(t))return c.debug(`There were multiple attempts to register component ${t}.`),!1;H.set(t,e);for(const a of B.values())L(a,e);return!0}function U(e,t){const a=e.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),e.container.getProvider(t)}function R(e,t,a=k){U(e,t).clearInstance(a)}function V(){H.clear()}exports._components=H;const q={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},z=new a.ErrorFactory("app","Firebase",q);class J{constructor(t,a,r){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},a),this._name=a.name,this._automaticDataCollectionEnabled=a.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new e.Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw z.create("app-deleted",{appName:this._name})}}const K=j;function W(t,r={}){let n=t;if("object"!=typeof r){r={name:r}}const i=Object.assign({name:k,automaticDataCollectionEnabled:!1},r),s=i.name;if("string"!=typeof s||!s)throw z.create("bad-app-name",{appName:String(s)});if(n||(n=(0,a.getDefaultAppConfig)()),!n)throw z.create("no-options");const o=B.get(s);if(o){if((0,a.deepEqual)(n,o.options)&&(0,a.deepEqual)(i,o.config))return o;throw z.create("duplicate-app",{appName:s})}const c=new e.ComponentContainer(s);for(const e of H.values())c.addComponent(e);const p=new J(n,i,c);return B.set(s,p),p}function Y(e=k){const t=B.get(e);if(!t&&e===k&&(0,a.getDefaultAppConfig)())return W();if(!t)throw z.create("no-app",{appName:e});return t}function G(){return Array.from(B.values())}async function Q(e){const t=e.name;B.has(t)&&(B.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function X(t,a,r){var n;let i=null!==(n=F[t])&&void 0!==n?n:t;r&&(i+=`-${r}`);const s=i.match(/\s|\//),o=a.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${a}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${a}" contains illegal characters (whitespace or "/")`),void c.warn(e.join(" "))}T(new e.Component(`${i}-version`,()=>({library:i,version:a}),"VERSION"))}function Z(e,a){if(null!==e&&"function"!=typeof e)throw z.create("invalid-log-argument");(0,t.setUserLogHandler)(e,a)}function ee(e){(0,t.setLogLevel)(e)}exports.SDK_VERSION="9.22.1";const te="firebase-heartbeat-database",ae=1,re="firebase-heartbeat-store";let ne=null;function ie(){return ne||(ne=(0,r.openDB)(te,ae,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(re)}}}).catch(e=>{throw z.create("idb-open",{originalErrorMessage:e.message})})),ne}async function se(e){try{const r=await ie();return await r.transaction(re).objectStore(re).get(ce(e))}catch(t){if(t instanceof a.FirebaseError)c.warn(t.message);else{const e=z.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});c.warn(e.message)}}}async function oe(e,t){try{const n=(await ie()).transaction(re,"readwrite"),i=n.objectStore(re);await i.put(t,ce(e)),await n.done}catch(r){if(r instanceof a.FirebaseError)c.warn(r.message);else{const e=z.create("idb-set",{originalErrorMessage:null==r?void 0:r.message});c.warn(e.message)}}}function ce(e){return`${e.name}!${e.options.appId}`}const pe=1024,he=2592e6;class le{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new be(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=fe();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some(e=>e.date===t))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=he}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=fe(),{heartbeatsToSend:t,unsentEntries:r}=de(this._heartbeatsCache.heartbeats),n=(0,a.base64urlEncodeWithoutPadding)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}}function fe(){return(new Date).toISOString().substring(0,10)}function de(e,t=pe){const a=[];let r=e.slice();for(const n of e){const e=a.find(e=>e.agent===n.agent);if(e){if(e.dates.push(n.date),ge(a)>t){e.dates.pop();break}}else if(a.push({agent:n.agent,dates:[n.date]}),ge(a)>t){a.pop();break}r=r.slice(1)}return{heartbeatsToSend:a,unsentEntries:r}}class be{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,a.isIndexedDBAvailable)()&&(0,a.validateIndexedDBOpenable)().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){return await se(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return oe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return oe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}}}function ge(e){return(0,a.base64urlEncodeWithoutPadding)(JSON.stringify({version:2,heartbeats:e})).length}function ue(t){T(new e.Component("platform-logger",e=>new n(e),"PRIVATE")),T(new e.Component("heartbeat",e=>new le(e),"PRIVATE")),X(s,o,t),X(s,o,"esm2017"),X("fire-js","")}ue("");
},{"@firebase/component":"bXWY","@firebase/logger":"uNCT","@firebase/util":"VOc0","idb":"ZUep"}],"wvte":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStatEventTarget=exports.default=exports.createWebChannelTransport=exports.XhrIo=exports.WebChannel=exports.Stat=exports.Md5=exports.Integer=exports.FetchXmlHttpFactory=exports.EventType=exports.Event=exports.ErrorCode=void 0;var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},i={};exports.default=i;var n,r=r||{},s=e||self;function o(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function h(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t){return Object.prototype.hasOwnProperty.call(t,l)&&t[l]||(t[l]=++u)}var l="closure_uid_"+(1e9*Math.random()>>>0),u=0;function c(t,e,i){return t.call.apply(t.bind,arguments)}function f(t,e,i){if(!t)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,n),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function g(t,e,i){return(g=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?c:f).apply(null,arguments)}function p(t,e){var i=Array.prototype.slice.call(arguments,1);return function(){var e=i.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function d(t,e){function i(){}i.prototype=e.prototype,t.$=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.ac=function(t,i,n){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return e.prototype[i].apply(t,r)}}function y(){this.s=this.s,this.o=this.o}var v=0;y.prototype.s=!1,y.prototype.sa=function(){this.s||(this.s=!0,this.N(),0==v)||a(this)},y.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const m=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let i=0;i<t.length;i++)if(i in t&&t[i]===e)return i;return-1};function b(t){const e=t.length;if(0<e){const i=Array(e);for(let n=0;n<e;n++)i[n]=t[n];return i}return[]}function w(t,e){for(let i=1;i<arguments.length;i++){const e=arguments[i];if(o(e)){const i=t.length||0,n=e.length||0;t.length=i+n;for(let r=0;r<n;r++)t[i+r]=e[r]}else t.push(e)}}function T(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var S=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{s.addEventListener("test",()=>{},e),s.removeEventListener("test",()=>{},e)}catch(i){}return t}();function E(t){return/^[\s\xa0]*$/.test(t)}function x(){var t=s.navigator;return t&&(t=t.userAgent)?t:""}function j(t){return-1!=x().indexOf(t)}function C(t){return C[" "](t),t}function A(t,e){var i=pn;return Object.prototype.hasOwnProperty.call(i,t)?i[t]:i[t]=e(t)}C[" "]=function(){};var I,M,R=j("Opera"),O=j("Trident")||j("MSIE"),P=j("Edge"),k=P||O,_=j("Gecko")&&!(-1!=x().toLowerCase().indexOf("webkit")&&!j("Edge"))&&!(j("Trident")||j("MSIE"))&&!j("Edge"),D=-1!=x().toLowerCase().indexOf("webkit")&&!j("Edge");function L(){var t=s.document;return t?t.documentMode:void 0}t:{var H="",X=function(){var t=x();return _?/rv:([^\);]+)(\)|;)/.exec(t):P?/Edge\/([\d\.]+)/.exec(t):O?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t):D?/WebKit\/(\S+)/.exec(t):R?/(?:Version)[ \/]?(\S+)/.exec(t):void 0}();if(X&&(H=X?X[1]:""),O){var N=L();if(null!=N&&N>parseFloat(H)){I=String(N);break t}}I=H}if(s.document&&O){var F=L();M=F||(parseInt(I,10)||void 0)}else M=void 0;var B=M;function U(t,e){if(T.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var i=this.type=t.type,n=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(_){t:{try{C(e.nodeName);var r=!0;break t}catch(s){}r=!1}r||(e=null)}}else"mouseover"==i?e=t.fromElement:"mouseout"==i&&(e=t.toElement);this.relatedTarget=e,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:K[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&U.$.h.call(this)}}d(U,T);var K={2:"touch",3:"pen",4:"mouse"};U.prototype.h=function(){U.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Y="closure_listenable_"+(1e6*Math.random()|0),G=0;function J(t,e,i,n,r){this.listener=t,this.proxy=null,this.src=e,this.type=i,this.capture=!!n,this.la=r,this.key=++G,this.fa=this.ia=!1}function W(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function z(t,e,i){for(const n in t)e.call(i,t[n],n,t)}function q(t,e){for(const i in t)e.call(void 0,t[i],i,t)}function V(t){const e={};for(const i in t)e[i]=t[i];return e}const $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Z(t,e){let i,n;for(let r=1;r<arguments.length;r++){for(i in n=arguments[r])t[i]=n[i];for(let e=0;e<$.length;e++)i=$[e],Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}}function Q(t){this.src=t,this.g={},this.h=0}function tt(t,e){var i=e.type;if(i in t.g){var n,r=t.g[i],s=m(r,e);(n=0<=s)&&Array.prototype.splice.call(r,s,1),n&&(W(e),0==t.g[i].length&&(delete t.g[i],t.h--))}}function et(t,e,i,n){for(var r=0;r<t.length;++r){var s=t[r];if(!s.fa&&s.listener==e&&s.capture==!!i&&s.la==n)return r}return-1}Q.prototype.add=function(t,e,i,n,r){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=et(t,e,n,r);return-1<o?(e=t[o],i||(e.ia=!1)):((e=new J(e,this.src,s,!!n,r)).ia=i,t.push(e)),e};var it="closure_lm_"+(1e6*Math.random()|0),nt={};function rt(t,e,i,n,r){if(n&&n.once)return ht(t,e,i,n,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)rt(t,e[s],i,n,r);return null}return i=pt(i),t&&t[Y]?t.O(e,i,h(n)?!!n.capture:!!n,r):st(t,e,i,!1,n,r)}function st(t,e,i,n,r,s){if(!e)throw Error("Invalid event type");var o=h(r)?!!r.capture:!!r,a=ft(t);if(a||(t[it]=a=new Q(t)),(i=a.add(e,i,n,o,s)).proxy)return i;if(n=ot(),i.proxy=n,n.src=t,n.listener=i,t.addEventListener)S||(r=o),void 0===r&&(r=!1),t.addEventListener(e.toString(),n,r);else if(t.attachEvent)t.attachEvent(ut(e.toString()),n);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(n)}return i}function ot(){const t=ct;return function e(i){return t.call(e.src,e.listener,i)}}function ht(t,e,i,n,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)ht(t,e[s],i,n,r);return null}return i=pt(i),t&&t[Y]?t.P(e,i,h(n)?!!n.capture:!!n,r):st(t,e,i,!0,n,r)}function at(t,e,i,n,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)at(t,e[s],i,n,r);else n=h(n)?!!n.capture:!!n,i=pt(i),t&&t[Y]?(t=t.i,(e=String(e).toString())in t.g&&(-1<(i=et(s=t.g[e],i,n,r))&&(W(s[i]),Array.prototype.splice.call(s,i,1),0==s.length&&(delete t.g[e],t.h--)))):t&&(t=ft(t))&&(e=t.g[e.toString()],t=-1,e&&(t=et(e,i,n,r)),(i=-1<t?e[t]:null)&&lt(i))}function lt(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[Y])tt(e.i,t);else{var i=t.type,n=t.proxy;e.removeEventListener?e.removeEventListener(i,n,t.capture):e.detachEvent?e.detachEvent(ut(i),n):e.addListener&&e.removeListener&&e.removeListener(n),(i=ft(e))?(tt(i,t),0==i.h&&(i.src=null,e[it]=null)):W(t)}}}function ut(t){return t in nt?nt[t]:nt[t]="on"+t}function ct(t,e){if(t.fa)t=!0;else{e=new U(e,this);var i=t.listener,n=t.la||t.src;t.ia&&lt(t),t=i.call(n,e)}return t}function ft(t){return(t=t[it])instanceof Q?t:null}var gt="__closure_events_fn_"+(1e9*Math.random()>>>0);function pt(t){return"function"==typeof t?t:(t[gt]||(t[gt]=function(e){return t.handleEvent(e)}),t[gt])}function dt(){y.call(this),this.i=new Q(this),this.S=this,this.J=null}function yt(t,e){var i,n=t.J;if(n)for(i=[];n;n=n.J)i.push(n);if(t=t.S,n=e.type||e,"string"==typeof e)e=new T(e,t);else if(e instanceof T)e.target=e.target||t;else{var r=e;Z(e=new T(n,t),r)}if(r=!0,i)for(var s=i.length-1;0<=s;s--){var o=e.g=i[s];r=vt(o,n,!0,e)&&r}if(r=vt(o=e.g=t,n,!0,e)&&r,r=vt(o,n,!1,e)&&r,i)for(s=0;s<i.length;s++)r=vt(o=e.g=i[s],n,!1,e)&&r}function vt(t,e,i,n){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==i){var h=o.listener,a=o.la||o.src;o.ia&&tt(t.i,o),r=!1!==h.call(a,n)&&r}}return r&&!n.defaultPrevented}d(dt,y),dt.prototype[Y]=!0,dt.prototype.removeEventListener=function(t,e,i,n){at(this,t,e,i,n)},dt.prototype.N=function(){if(dt.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var i=e.g[t],n=0;n<i.length;n++)W(i[n]);delete e.g[t],e.h--}}this.J=null},dt.prototype.O=function(t,e,i,n){return this.i.add(String(t),e,!1,i,n)},dt.prototype.P=function(t,e,i,n){return this.i.add(String(t),e,!0,i,n)};var mt=s.JSON.stringify;class bt{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}function wt(){var t=It;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class Tt{constructor(){this.h=this.g=null}add(t,e){const i=St.get();i.set(t,e),this.h?this.h.next=i:this.g=i,this.h=i}}var St=new bt(()=>new Et,t=>t.reset());class Et{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function xt(t){var e=1;t=t.split(":");const i=[];for(;0<e&&t.length;)i.push(t.shift()),e--;return t.length&&i.push(t.join(":")),i}function jt(t){s.setTimeout(()=>{throw t},0)}let Ct,At=!1,It=new Tt,Mt=()=>{const t=s.Promise.resolve(void 0);Ct=(()=>{t.then(Rt)})};var Rt=()=>{for(var t;t=wt();){try{t.h.call(t.g)}catch(i){jt(i)}var e=St;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}At=!1};function Ot(t,e){dt.call(this),this.h=t||1,this.g=e||s,this.j=g(this.qb,this),this.l=Date.now()}function Pt(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function kt(t,e,i){if("function"==typeof t)i&&(t=g(t,i));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=g(t.handleEvent,t)}return 2147483647<Number(e)?-1:s.setTimeout(t,e||0)}function _t(t){t.g=kt(()=>{t.g=null,t.i&&(t.i=!1,_t(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}d(Ot,dt),(n=Ot.prototype).ga=!1,n.T=null,n.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),yt(this,"tick"),this.ga&&(Pt(this),this.start()))}},n.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},n.N=function(){Ot.$.N.call(this),Pt(this),delete this.g};class Dt extends y{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:_t(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Lt(t){y.call(this),this.h=t,this.g={}}d(Lt,y);var Ht=[];function Xt(t,e,i,n){Array.isArray(i)||(i&&(Ht[0]=i.toString()),i=Ht);for(var r=0;r<i.length;r++){var s=rt(e,i[r],n||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function Nt(t){z(t.g,function(t,e){this.g.hasOwnProperty(e)&&lt(t)},t),t.g={}}function Ft(){this.g=!0}function Bt(t,e,i,n,r,s){t.info(function(){if(t.g)if(s)for(var o="",h=s.split("&"),a=0;a<h.length;a++){var l=h[a].split("=");if(1<l.length){var u=l[0];l=l[1];var c=u.split("_");o=2<=c.length&&"type"==c[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+n+") [attempt "+r+"]: "+e+"\n"+i+"\n"+o})}function Ut(t,e,i,n,r,s,o){t.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+r+"]: "+e+"\n"+i+"\n"+s+" "+o})}function Kt(t,e,i,n){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+Gt(t,i)+(n?" "+n:"")})}function Yt(t,e){t.info(function(){return"TIMEOUT: "+e})}function Gt(t,e){if(!t.g)return e;if(!e)return null;try{var i=JSON.parse(e);if(i)for(t=0;t<i.length;t++)if(Array.isArray(i[t])){var n=i[t];if(!(2>n.length)){var r=n[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return mt(i)}catch(h){return e}}Lt.prototype.N=function(){Lt.$.N.call(this),Nt(this)},Lt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ft.prototype.Ea=function(){this.g=!1},Ft.prototype.info=function(){};var Jt={},Wt=null;function zt(){return Wt=Wt||new dt}function qt(t){T.call(this,Jt.Ta,t)}function Vt(t){const e=zt();yt(e,new qt(e))}function $t(t,e){T.call(this,Jt.STAT_EVENT,t),this.stat=e}function Zt(t){const e=zt();yt(e,new $t(e,t))}function Qt(t,e){T.call(this,Jt.Ua,t),this.size=e}function te(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){t()},e)}Jt.Ta="serverreachability",d(qt,T),Jt.STAT_EVENT="statevent",d($t,T),Jt.Ua="timingevent",d(Qt,T);var ee={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ie={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ne(){}function re(t){return t.h||(t.h=t.i())}function se(){}ne.prototype.h=null;var oe,he={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ae(){T.call(this,"d")}function le(){T.call(this,"c")}function ue(){}function ce(t,e,i,n){this.l=t,this.j=e,this.m=i,this.W=n||1,this.U=new Lt(this),this.P=ge,t=k?125:void 0,this.V=new Ot(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new fe}function fe(){this.i=null,this.g="",this.h=!1}d(ae,T),d(le,T),d(ue,ne),ue.prototype.g=function(){return new XMLHttpRequest},ue.prototype.i=function(){return{}},oe=new ue;var ge=45e3,pe={},de={};function ye(t,e,i){t.L=1,t.v=Xe(ke(e)),t.s=i,t.S=!0,ve(t,null)}function ve(t,e){t.G=Date.now(),Te(t),t.A=ke(t.v);var i=t.A,n=t.W;Array.isArray(n)||(n=[String(n)]),$e(i.i,"t",n),t.C=0,i=t.l.J,t.h=new fe,t.g=nn(t.l,i?e:null,!t.s),0<t.O&&(t.M=new Dt(g(t.Pa,t,t.g),t.O)),Xt(t.U,t.g,"readystatechange",t.nb),e=t.I?V(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),Vt(),Bt(t.j,t.u,t.A,t.m,t.W,t.s)}function me(t){return!!t.g&&("GET"==t.u&&2!=t.L&&t.l.Ha)}function be(t,e,i){let n,r=!0;for(;!t.J&&t.C<i.length;){if((n=we(t,i))==de){4==e&&(t.o=4,Zt(14),r=!1),Kt(t.j,t.m,null,"[Incomplete Response]");break}if(n==pe){t.o=4,Zt(15),Kt(t.j,t.m,i,"[Invalid Chunk]"),r=!1;break}Kt(t.j,t.m,n,null),Ce(t,n)}me(t)&&n!=de&&n!=pe&&(t.h.g="",t.C=0),4!=e||0!=i.length||t.h.h||(t.o=1,Zt(16),r=!1),t.i=t.i&&r,r?0<i.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+i.length),zi(e),e.M=!0,Zt(11))):(Kt(t.j,t.m,i,"[Invalid Chunked Response]"),je(t),xe(t))}function we(t,e){var i=t.C,n=e.indexOf("\n",i);return-1==n?de:(i=Number(e.substring(i,n)),isNaN(i)?pe:(n+=1)+i>e.length?de:(e=e.slice(n,n+i),t.C=n+i,e))}function Te(t){t.Y=Date.now()+t.P,Se(t,t.P)}function Se(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=te(g(t.lb,t),e)}function Ee(t){t.B&&(s.clearTimeout(t.B),t.B=null)}function xe(t){0==t.l.H||t.J||$i(t.l,t)}function je(t){Ee(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,Pt(t.V),Nt(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Ce(t,e){try{var i=t.l;if(0!=i.H&&(i.g==t||si(i.i,t)))if(!t.K&&si(i.i,t)&&3==i.H){try{var n=i.Ja.g.parse(e)}catch(l){n=null}if(Array.isArray(n)&&3==n.length){var r=n;if(0==r[0]){t:if(!i.u){if(i.g){if(!(i.g.G+3e3<t.G))break t;Vi(i),Ni(i)}Wi(i),Zt(18)}}else i.Fa=r[1],0<i.Fa-i.V&&37500>r[2]&&i.G&&0==i.A&&!i.v&&(i.v=te(g(i.ib,i),6e3));if(1>=ri(i.i)&&i.oa){try{i.oa()}catch(l){}i.oa=void 0}}else Qi(i,11)}else if((t.K||i.g==t)&&Vi(i),!E(e))for(r=i.Ja.g.parse(e),e=0;e<r.length;e++){let l=r[e];if(i.V=l[0],l=l[1],2==i.H)if("c"==l[0]){i.K=l[1],i.pa=l[2];const e=l[3];null!=e&&(i.ra=e,i.l.info("VER="+i.ra));const r=l[4];null!=r&&(i.Ga=r,i.l.info("SVER="+i.Ga));const u=l[5];null!=u&&"number"==typeof u&&0<u&&(n=1.5*u,i.L=n,i.l.info("backChannelRequestTimeoutMs_="+n)),n=i;const c=t.g;if(c){const t=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=n.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(oi(s,s.h),s.h=null))}if(n.F){const t=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(n.Da=t,He(n.I,n.F,t))}}i.H=3,i.h&&i.h.Ba(),i.ca&&(i.S=Date.now()-t.G,i.l.info("Handshake RTT: "+i.S+"ms"));var o=t;if((n=i).wa=en(n,n.J?n.pa:null,n.Y),o.K){hi(n.i,o);var h=o,a=n.L;a&&h.setTimeout(a),h.B&&(Ee(h),Te(h)),n.g=o}else Ji(n);0<i.j.length&&Bi(i)}else"stop"!=l[0]&&"close"!=l[0]||Qi(i,7);else 3==i.H&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?Qi(i,7):Xi(i):"noop"!=l[0]&&i.h&&i.h.Aa(l),i.A=0)}Vt(4)}catch(l){}}function Ae(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(o(t)){for(var e=[],i=t.length,n=0;n<i;n++)e.push(t[n]);return e}for(n in e=[],i=0,t)e[i++]=t[n];return e}function Ie(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(o(t)||"string"==typeof t){var e=[];t=t.length;for(var i=0;i<t;i++)e.push(i);return e}e=[],i=0;for(const n in t)e[i++]=n;return e}}}function Me(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(o(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var i=Ie(t),n=Ae(t),r=n.length,s=0;s<r;s++)e.call(void 0,n[s],i&&i[s],t)}(n=ce.prototype).setTimeout=function(t){this.P=t},n.nb=function(t){t=t.target;const e=this.M;e&&3==Oi(t)?e.l():this.Pa(t)},n.Pa=function(t){try{if(t==this.g)t:{const c=Oi(this.g);var e=this.g.Ia();const f=this.g.da();if(!(3>c)&&(3!=c||k||this.g&&(this.h.h||this.g.ja()||Pi(this.g)))){this.J||4!=c||7==e||Vt(8==e||0>=f?3:2),Ee(this);var i=this.g.da();this.ca=i;e:if(me(this)){var n=Pi(this.g);t="";var r=n.length,o=4==Oi(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){je(this),xe(this);var h="";break e}this.h.i=new s.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(n[e],{stream:o&&e==r-1});n.splice(0,r),this.h.g+=t,this.C=0,h=this.h.g}else h=this.g.ja();if(this.i=200==i,Ut(this.j,this.u,this.A,this.m,this.W,c,i),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!E(a)){var u=a;break e}}u=null}if(!(i=u)){this.i=!1,this.o=3,Zt(12),je(this),xe(this);break t}Kt(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ce(this,i)}this.S?(be(this,c,h),k&&this.i&&3==c&&(Xt(this.U,this.V,"tick",this.mb),this.V.start())):(Kt(this.j,this.m,h,null),Ce(this,h)),4==c&&je(this),this.i&&!this.J&&(4==c?$i(this.l,this):(this.i=!1,Te(this)))}else ki(this.g),400==i&&0<h.indexOf("Unknown SID")?(this.o=3,Zt(12)):(this.o=0,Zt(13)),je(this),xe(this)}}}catch(c){}},n.mb=function(){if(this.g){var t=Oi(this.g),e=this.g.ja();this.C<e.length&&(Ee(this),be(this,t,e),this.i&&4!=t&&Te(this))}},n.cancel=function(){this.J=!0,je(this)},n.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(Yt(this.j,this.A),2!=this.L&&(Vt(),Zt(17)),je(this),this.o=2,xe(this)):Se(this,this.Y-t)};var Re=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Oe(t,e){if(t){t=t.split("&");for(var i=0;i<t.length;i++){var n=t[i].indexOf("="),r=null;if(0<=n){var s=t[i].substring(0,n);r=t[i].substring(n+1)}else s=t[i];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function Pe(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Pe){this.h=t.h,_e(this,t.j),this.s=t.s,this.g=t.g,De(this,t.m),this.l=t.l;var e=t.i,i=new We;i.i=e.i,e.g&&(i.g=new Map(e.g),i.h=e.h),Le(this,i),this.o=t.o}else t&&(e=String(t).match(Re))?(this.h=!1,_e(this,e[1]||"",!0),this.s=Ne(e[2]||""),this.g=Ne(e[3]||"",!0),De(this,e[4]),this.l=Ne(e[5]||"",!0),Le(this,e[6]||"",!0),this.o=Ne(e[7]||"")):(this.h=!1,this.i=new We(null,this.h))}function ke(t){return new Pe(t)}function _e(t,e,i){t.j=i?Ne(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function De(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Le(t,e,i){e instanceof We?(t.i=e,Qe(t.i,t.h)):(i||(e=Fe(e,Ge)),t.i=new We(e,t.h))}function He(t,e,i){t.i.set(e,i)}function Xe(t){return He(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Ne(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Fe(t,e,i){return"string"==typeof t?(t=encodeURI(t).replace(e,Be),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Be(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Pe.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Fe(e,Ue,!0),":");var i=this.g;return(i||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Fe(e,Ue,!0),"@"),t.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.m)&&t.push(":",String(i))),(i=this.l)&&(this.g&&"/"!=i.charAt(0)&&t.push("/"),t.push(Fe(i,"/"==i.charAt(0)?Ye:Ke,!0))),(i=this.i.toString())&&t.push("?",i),(i=this.o)&&t.push("#",Fe(i,Je)),t.join("")};var Ue=/[#\/\?@]/g,Ke=/[#\?:]/g,Ye=/[#\?]/g,Ge=/[#\?@]/g,Je=/#/g;function We(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function ze(t){t.g||(t.g=new Map,t.h=0,t.i&&Oe(t.i,function(e,i){t.add(decodeURIComponent(e.replace(/\+/g," ")),i)}))}function qe(t,e){ze(t),e=Ze(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Ve(t,e){return ze(t),e=Ze(t,e),t.g.has(e)}function $e(t,e,i){qe(t,e),0<i.length&&(t.i=null,t.g.set(Ze(t,e),b(i)),t.h+=i.length)}function Ze(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Qe(t,e){e&&!t.j&&(ze(t),t.i=null,t.g.forEach(function(t,e){var i=e.toLowerCase();e!=i&&(qe(this,e),$e(this,i,t))},t)),t.j=e}(n=We.prototype).add=function(t,e){ze(this),this.i=null,t=Ze(this,t);var i=this.g.get(t);return i||this.g.set(t,i=[]),i.push(e),this.h+=1,this},n.forEach=function(t,e){ze(this),this.g.forEach(function(i,n){i.forEach(function(i){t.call(e,i,n,this)},this)},this)},n.ta=function(){ze(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),i=[];for(let n=0;n<e.length;n++){const r=t[n];for(let t=0;t<r.length;t++)i.push(e[n])}return i},n.Z=function(t){ze(this);let e=[];if("string"==typeof t)Ve(this,t)&&(e=e.concat(this.g.get(Ze(this,t))));else{t=Array.from(this.g.values());for(let i=0;i<t.length;i++)e=e.concat(t[i])}return e},n.set=function(t,e){return ze(this),this.i=null,Ve(this,t=Ze(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},n.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var i=0;i<e.length;i++){var n=e[i];const s=encodeURIComponent(String(n)),o=this.Z(n);for(n=0;n<o.length;n++){var r=s;""!==o[n]&&(r+="="+encodeURIComponent(String(o[n]))),t.push(r)}}return this.i=t.join("&")};var ti=class{constructor(t,e){this.g=t,this.map=e}};function ei(t){this.l=t||ii,s.PerformanceNavigationTiming?t=0<(t=s.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(s.g&&s.g.Ka&&s.g.Ka()&&s.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var ii=10;function ni(t){return!!t.h||!!t.g&&t.g.size>=t.j}function ri(t){return t.h?1:t.g?t.g.size:0}function si(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function oi(t,e){t.g?t.g.add(e):t.h=e}function hi(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ai(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const i of t.g.values())e=e.concat(i.F);return e}return b(t.i)}ei.prototype.cancel=function(){if(this.i=ai(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var li=class{stringify(t){return s.JSON.stringify(t,void 0)}parse(t){return s.JSON.parse(t,void 0)}};function ui(){this.g=new li}function ci(t,e,i){const n=i||"";try{Me(t,function(t,i){let r=t;h(t)&&(r=mt(t)),e.push(n+i+"="+encodeURIComponent(r))})}catch(r){throw e.push(n+"type="+encodeURIComponent("_badmap")),r}}function fi(t,e){const i=new Ft;if(s.Image){const n=new Image;n.onload=p(gi,i,n,"TestLoadImage: loaded",!0,e),n.onerror=p(gi,i,n,"TestLoadImage: error",!1,e),n.onabort=p(gi,i,n,"TestLoadImage: abort",!1,e),n.ontimeout=p(gi,i,n,"TestLoadImage: timeout",!1,e),s.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=t}else e(!1)}function gi(t,e,i,n,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(n)}catch(s){}}function pi(t){this.l=t.fc||null,this.j=t.ob||!1}function di(t,e){dt.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=yi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}d(pi,ne),pi.prototype.g=function(){return new di(this.l,this.j)},pi.prototype.i=function(t){return function(){return t}}({}),d(di,dt);var yi=0;function vi(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function mi(t){t.readyState=4,t.l=null,t.j=null,t.A=null,bi(t)}function bi(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(n=di.prototype).open=function(t,e){if(this.readyState!=yi)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,bi(this)},n.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||s).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},n.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,mi(this)),this.readyState=yi},n.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,bi(this)),this.g&&(this.readyState=3,bi(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==s.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;vi(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},n.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?mi(this):bi(this),3==this.readyState&&vi(this)}},n.Za=function(t){this.g&&(this.response=this.responseText=t,mi(this))},n.Ya=function(t){this.g&&(this.response=t,mi(this))},n.ka=function(){this.g&&mi(this)},n.setRequestHeader=function(t,e){this.v.append(t,e)},n.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var i=e.next();!i.done;)i=i.value,t.push(i[0]+": "+i[1]),i=e.next();return t.join("\r\n")},Object.defineProperty(di.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var wi=s.JSON.parse;function Ti(t){dt.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Si,this.L=this.M=!1}d(Ti,dt);var Si="",Ei=/^https?$/i,xi=["POST","PUT"];function ji(t){return O&&"number"==typeof t.timeout&&void 0!==t.ontimeout}function Ci(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Ai(t),Mi(t)}function Ai(t){t.F||(t.F=!0,yt(t,"complete"),yt(t,"error"))}function Ii(t){if(t.h&&void 0!==r&&(!t.C[1]||4!=Oi(t)||2!=t.da()))if(t.v&&4==Oi(t))kt(t.La,0,t);else if(yt(t,"readystatechange"),4==Oi(t)){t.h=!1;try{const r=t.da();t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var i;if(!(i=e)){var n;if(n=0===r){var o=String(t.I).match(Re)[1]||null;!o&&s.self&&s.self.location&&(o=s.self.location.protocol.slice(0,-1)),n=!Ei.test(o?o.toLowerCase():"")}i=n}if(i)yt(t,"complete"),yt(t,"success");else{t.m=6;try{var h=2<Oi(t)?t.g.statusText:""}catch(a){h=""}t.j=h+" ["+t.da()+"]",Ai(t)}}finally{Mi(t)}}}function Mi(t,e){if(t.g){Ri(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||yt(t,"ready");try{n.onreadystatechange=r}catch(i){}}}function Ri(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(s.clearTimeout(t.A),t.A=null)}function Oi(t){return t.g?t.g.readyState:0}function Pi(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Si:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function ki(t){const e={};t=(t.g&&2<=Oi(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<t.length;n++){if(E(t[n]))continue;var i=xt(t[n]);const r=i[0];if("string"!=typeof(i=i[1]))continue;i=i.trim();const s=e[r]||[];e[r]=s,s.push(i)}q(e,function(t){return t.join(", ")})}function _i(t){let e="";return z(t,function(t,i){e+=i,e+=":",e+=t,e+="\r\n"}),e}function Di(t,e,i){t:{for(n in i){var n=!1;break t}n=!0}n||(i=_i(i),"string"==typeof t?null!=i&&encodeURIComponent(String(i)):He(t,e,i))}function Li(t,e,i){return i&&i.internalChannelParams&&i.internalChannelParams[t]||e}function Hi(t){this.Ga=0,this.j=[],this.l=new Ft,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Li("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Li("baseRetryDelayMs",5e3,t),this.hb=Li("retryDelaySeedMs",1e4,t),this.eb=Li("forwardChannelMaxRetries",2,t),this.xa=Li("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new ei(t&&t.concurrentRequestLimit),this.Ja=new ui,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Xi(t){if(Fi(t),3==t.H){var e=t.W++,i=ke(t.I);if(He(i,"SID",t.K),He(i,"RID",e),He(i,"TYPE","terminate"),Yi(t,i),(e=new ce(t,t.l,e)).L=2,e.v=Xe(ke(i)),i=!1,s.navigator&&s.navigator.sendBeacon)try{i=s.navigator.sendBeacon(e.v.toString(),"")}catch(n){}!i&&s.Image&&((new Image).src=e.v,i=!0),i||(e.g=nn(e.l,null),e.g.ha(e.v)),e.G=Date.now(),Te(e)}tn(t)}function Ni(t){t.g&&(zi(t),t.g.cancel(),t.g=null)}function Fi(t){Ni(t),t.u&&(s.clearTimeout(t.u),t.u=null),Vi(t),t.i.cancel(),t.m&&("number"==typeof t.m&&s.clearTimeout(t.m),t.m=null)}function Bi(t){if(!ni(t.i)&&!t.m){t.m=!0;var e=t.Na;Ct||Mt(),At||(Ct(),At=!0),It.add(e,t),t.C=0}}function Ui(t,e){return!(ri(t.i)>=t.i.j-(t.m?1:0))&&(t.m?(t.j=e.F.concat(t.j),!0):!(1==t.H||2==t.H||t.C>=(t.cb?0:t.eb))&&(t.m=te(g(t.Na,t,e),Zi(t,t.C)),t.C++,!0))}function Ki(t,e){var i;i=e?e.m:t.W++;const n=ke(t.I);He(n,"SID",t.K),He(n,"RID",i),He(n,"AID",t.V),Yi(t,n),t.o&&t.s&&Di(n,t.o,t.s),i=new ce(t,t.l,i,t.C+1),null===t.o&&(i.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Gi(t,i,1e3),i.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),oi(t.i,i),ye(i,n,e)}function Yi(t,e){t.na&&z(t.na,function(t,i){He(e,i,t)}),t.h&&Me({},function(t,i){He(e,i,t)})}function Gi(t,e,i){i=Math.min(t.j.length,i);var n=t.h?g(t.h.Va,t.h,t):null;t:{var r=t.j;let e=-1;for(;;){const t=["count="+i];-1==e?0<i?(e=r[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let o=!0;for(let h=0;h<i;h++){let i=r[h].g;const a=r[h].map;if(0>(i-=e))e=Math.max(0,r[h].g-100),o=!1;else try{ci(a,t,"req"+i+"_")}catch(s){n&&n(a)}}if(o){n=t.join("&");break t}}}return t=t.j.splice(0,i),e.F=t,n}function Ji(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Ct||Mt(),At||(Ct(),At=!0),It.add(e,t),t.A=0}}function Wi(t){return!(t.g||t.u||3<=t.A)&&(t.ba++,t.u=te(g(t.Ma,t),Zi(t,t.A)),t.A++,!0)}function zi(t){null!=t.B&&(s.clearTimeout(t.B),t.B=null)}function qi(t){t.g=new ce(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=ke(t.wa);He(e,"RID","rpc"),He(e,"SID",t.K),He(e,"AID",t.V),He(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&He(e,"TO",t.qa),He(e,"TYPE","xmlhttp"),Yi(t,e),t.o&&t.s&&Di(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var i=t.g;t=t.pa,i.L=1,i.v=Xe(ke(e)),i.s=null,i.S=!0,ve(i,t)}function Vi(t){null!=t.v&&(s.clearTimeout(t.v),t.v=null)}function $i(t,e){var i=null;if(t.g==e){Vi(t),zi(t),t.g=null;var n=2}else{if(!si(t.i,e))return;i=e.F,hi(t.i,e),n=1}if(0!=t.H)if(e.i)if(1==n){i=e.s?e.s.length:0,e=Date.now()-e.G;var r=t.C;yt(n=zt(),new Qt(n,i)),Bi(t)}else Ji(t);else if(3==(r=e.o)||0==r&&0<e.ca||!(1==n&&Ui(t,e)||2==n&&Wi(t)))switch(i&&0<i.length&&(e=t.i,e.i=e.i.concat(i)),r){case 1:Qi(t,5);break;case 4:Qi(t,10);break;case 3:Qi(t,6);break;default:Qi(t,2)}}function Zi(t,e){let i=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(i*=2),i*e}function Qi(t,e){if(t.l.info("Error code "+e),2==e){var i=null;t.h&&(i=null);var n=g(t.pb,t);i||(i=new Pe("//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||_e(i,"https"),Xe(i)),fi(i.toString(),n)}else Zt(2);t.H=0,t.h&&t.h.za(e),tn(t),Fi(t)}function tn(t){if(t.H=0,t.ma=[],t.h){const e=ai(t.i);0==e.length&&0==t.j.length||(w(t.ma,e),w(t.ma,t.j),t.i.i.length=0,b(t.j),t.j.length=0),t.h.ya()}}function en(t,e,i){var n=i instanceof Pe?ke(i):new Pe(i);if(""!=n.g)e&&(n.g=e+"."+n.g),De(n,n.m);else{var r=s.location;n=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var o=new Pe(null);n&&_e(o,n),e&&(o.g=e),r&&De(o,r),i&&(o.l=i),n=o}return i=t.F,e=t.Da,i&&e&&He(n,i,e),He(n,"VER",t.ra),Yi(t,n),n}function nn(t,e,i){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=i&&t.Ha&&!t.va?new Ti(new pi({ob:!0})):new Ti(t.va)).Oa(t.J),e}function rn(){}function sn(){if(O&&!(10<=Number(B)))throw Error("Environmental error: no available transport.")}function on(t,e){dt.call(this),this.g=new Hi(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!E(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!E(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new ln(this)}function hn(t){ae.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const i in e){t=i;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function an(){le.call(this),this.status=1}function ln(t){this.g=t}function un(){this.blockSize=-1}function cn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function fn(t,e,i){i||(i=0);var n=Array(16);if("string"==typeof e)for(var r=0;16>r;++r)n[r]=e.charCodeAt(i++)|e.charCodeAt(i++)<<8|e.charCodeAt(i++)<<16|e.charCodeAt(i++)<<24;else for(r=0;16>r;++r)n[r]=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;e=t.g[0],i=t.g[1],r=t.g[2];var s=t.g[3],o=e+(s^i&(r^s))+n[0]+3614090360&4294967295;o=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=i+(o<<7&4294967295|o>>>25))+((o=s+(r^e&(i^r))+n[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(i^s&(e^i))+n[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=i+(e^r&(s^e))+n[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(r^s))+n[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(i^r))+n[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(i^s&(e^i))+n[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=i+(e^r&(s^e))+n[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(r^s))+n[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(i^r))+n[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(i^s&(e^i))+n[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=i+(e^r&(s^e))+n[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(r^s))+n[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(i^r))+n[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(i^s&(e^i))+n[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=i+(e^r&(s^e))+n[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^s&(i^r))+n[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(i^r&(e^i))+n[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^i&(s^e))+n[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=i+(s^e&(r^s))+n[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(i^r))+n[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(i^r&(e^i))+n[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^i&(s^e))+n[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=i+(s^e&(r^s))+n[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(i^r))+n[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(i^r&(e^i))+n[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^i&(s^e))+n[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=i+(s^e&(r^s))+n[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(i^r))+n[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(i^r&(e^i))+n[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^i&(s^e))+n[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=i+(s^e&(r^s))+n[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^r^s)+n[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^i^r)+n[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^i)+n[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=i+(r^s^e)+n[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^r^s)+n[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^i^r)+n[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^i)+n[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=i+(r^s^e)+n[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^r^s)+n[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^i^r)+n[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^i)+n[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=i+(r^s^e)+n[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^r^s)+n[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^i^r)+n[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^i)+n[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=i+(r^s^e)+n[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(r^(i|~s))+n[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(i^(e|~r))+n[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~i))+n[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=i+(s^(r|~e))+n[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(i|~s))+n[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(i^(e|~r))+n[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~i))+n[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=i+(s^(r|~e))+n[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(i|~s))+n[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(i^(e|~r))+n[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~i))+n[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=i+(s^(r|~e))+n[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=i+((o=e+(r^(i|~s))+n[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(i^(e|~r))+n[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=s+((o=r+(e^(s|~i))+n[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+n[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+s&4294967295}function gn(t,e){this.h=e;for(var i=[],n=!0,r=t.length-1;0<=r;r--){var s=0|t[r];n&&s==e||(i[r]=s,n=!1)}this.g=i}(n=Ti.prototype).Oa=function(t){this.M=t},n.ha=function(t,e,i,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():oe.g(),this.C=this.u?re(this.u):re(oe),this.g.onreadystatechange=g(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(o){return void Ci(this,o)}if(t=i||"",i=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var r in n)i.set(r,n[r]);else{if("function"!=typeof n.keys||"function"!=typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(const t of n.keys())i.set(t,n.get(t))}n=Array.from(i.keys()).find(t=>"content-type"==t.toLowerCase()),r=s.FormData&&t instanceof s.FormData,!(0<=m(xi,e))||n||r||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,h]of i)this.g.setRequestHeader(s,h);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Ri(this),0<this.B&&((this.L=ji(this.g))?(this.g.timeout=this.B,this.g.ontimeout=g(this.ua,this)):this.A=kt(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){Ci(this,o)}},n.ua=function(){void 0!==r&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,yt(this,"timeout"),this.abort(8))},n.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,yt(this,"complete"),yt(this,"abort"),Mi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Mi(this,!0)),Ti.$.N.call(this)},n.La=function(){this.s||(this.G||this.v||this.l?Ii(this):this.kb())},n.kb=function(){Ii(this)},n.isActive=function(){return!!this.g},n.da=function(){try{return 2<Oi(this)?this.g.status:-1}catch(t){return-1}},n.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},n.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),wi(e)}},n.Ia=function(){return this.m},n.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(n=Hi.prototype).ra=8,n.H=1,n.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const r=new ce(this,this.l,t);let s=this.s;if(this.U&&(s?Z(s=V(s),this.U):s=this.U),null!==this.o||this.O||(r.I=s,s=null),this.P)t:{for(var e=0,i=0;i<this.j.length;i++){var n=this.j[i];if(void 0===(n="__data__"in n.map&&"string"==typeof(n=n.map.__data__)?n.length:void 0))break;if(4096<(e+=n)){e=i;break t}if(4096===e||i===this.j.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Gi(this,r,e),He(i=ke(this.I),"RID",t),He(i,"CVER",22),this.F&&He(i,"X-HTTP-Session-Id",this.F),Yi(this,i),s&&(this.O?e="headers="+encodeURIComponent(String(_i(s)))+"&"+e:this.o&&Di(i,this.o,s)),oi(this.i,r),this.bb&&He(i,"TYPE","init"),this.P?(He(i,"$req",e),He(i,"SID","null"),r.aa=!0,ye(r,i,null)):ye(r,i,e),this.H=2}}else 3==this.H&&(t?Ki(this,t):0==this.j.length||ni(this.i)||Ki(this))},n.Ma=function(){if(this.u=null,qi(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=te(g(this.jb,this),t)}},n.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Zt(10),Ni(this),qi(this))},n.ib=function(){null!=this.v&&(this.v=null,Ni(this),Wi(this),Zt(19))},n.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Zt(2)):(this.l.info("Failed to ping google.com"),Zt(1))},n.isActive=function(){return!!this.h&&this.h.isActive(this)},(n=rn.prototype).Ba=function(){},n.Aa=function(){},n.za=function(){},n.ya=function(){},n.isActive=function(){return!0},n.Va=function(){},sn.prototype.g=function(t,e){return new on(t,e)},d(on,dt),on.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,i=this.h||void 0;Zt(0),t.Y=e,t.na=i||{},t.G=t.aa,t.I=en(t,null,t.Y),Bi(t)},on.prototype.close=function(){Xi(this.g)},on.prototype.u=function(t){var e=this.g;if("string"==typeof t){var i={};i.__data__=t,t=i}else this.v&&((i={}).__data__=mt(t),t=i);e.j.push(new ti(e.fb++,t)),3==e.H&&Bi(e)},on.prototype.N=function(){this.g.h=null,delete this.j,Xi(this.g),delete this.g,on.$.N.call(this)},d(hn,ae),d(an,le),d(ln,rn),ln.prototype.Ba=function(){yt(this.g,"a")},ln.prototype.Aa=function(t){yt(this.g,new hn(t))},ln.prototype.za=function(t){yt(this.g,new an)},ln.prototype.ya=function(){yt(this.g,"b")},d(cn,un),cn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},cn.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var i=e-this.blockSize,n=this.m,r=this.h,s=0;s<e;){if(0==r)for(;s<=i;)fn(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(n[r++]=t.charCodeAt(s++),r==this.blockSize){fn(this,n),r=0;break}}else for(;s<e;)if(n[r++]=t[s++],r==this.blockSize){fn(this,n),r=0;break}}this.h=r,this.i+=e},cn.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var i=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&i,i/=256;for(this.j(t),t=Array(16),e=i=0;4>e;++e)for(var n=0;32>n;n+=8)t[i++]=this.g[e]>>>n&255;return t};var pn={};function dn(t){return-128<=t&&128>t?A(t,function(t){return new gn([0|t],0>t?-1:0)}):new gn([0|t],0>t?-1:0)}function yn(t){if(isNaN(t)||!isFinite(t))return bn;if(0>t)return xn(yn(-t));for(var e=[],i=1,n=0;t>=i;n++)e[n]=t/i|0,i*=mn;return new gn(e,0)}function vn(t,e){if(0==t.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==t.charAt(0))return xn(vn(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=yn(Math.pow(e,8)),n=bn,r=0;r<t.length;r+=8){var s=Math.min(8,t.length-r),o=parseInt(t.substring(r,r+s),e);8>s?(s=yn(Math.pow(e,s)),n=n.R(s).add(yn(o))):n=(n=n.R(i)).add(yn(o))}return n}var mn=4294967296,bn=dn(0),wn=dn(1),Tn=dn(16777216);function Sn(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function En(t){return-1==t.h}function xn(t){for(var e=t.g.length,i=[],n=0;n<e;n++)i[n]=~t.g[n];return new gn(i,~t.h).add(wn)}function jn(t,e){return t.add(xn(e))}function Cn(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function An(t,e){this.g=t,this.h=e}function In(t,e){if(Sn(e))throw Error("division by zero");if(Sn(t))return new An(bn,bn);if(En(t))return e=In(xn(t),e),new An(xn(e.g),xn(e.h));if(En(e))return e=In(t,xn(e)),new An(xn(e.g),e.h);if(30<t.g.length){if(En(t)||En(e))throw Error("slowDivide_ only works with positive integers.");for(var i=wn,n=e;0>=n.X(t);)i=Mn(i),n=Mn(n);var r=Rn(i,1),s=Rn(n,1);for(n=Rn(n,2),i=Rn(i,2);!Sn(n);){var o=s.add(n);0>=o.X(t)&&(r=r.add(i),s=o),n=Rn(n,1),i=Rn(i,1)}return e=jn(t,r.R(e)),new An(r,e)}for(r=bn;0<=t.X(e);){for(i=Math.max(1,Math.floor(t.ea()/e.ea())),n=48>=(n=Math.ceil(Math.log(i)/Math.LN2))?1:Math.pow(2,n-48),o=(s=yn(i)).R(e);En(o)||0<o.X(t);)o=(s=yn(i-=n)).R(e);Sn(s)&&(s=wn),r=r.add(s),t=jn(t,o)}return new An(r,t)}function Mn(t){for(var e=t.g.length+1,i=[],n=0;n<e;n++)i[n]=t.D(n)<<1|t.D(n-1)>>>31;return new gn(i,t.h)}function Rn(t,e){var i=e>>5;e%=32;for(var n=t.g.length-i,r=[],s=0;s<n;s++)r[s]=0<e?t.D(s+i)>>>e|t.D(s+i+1)<<32-e:t.D(s+i);return new gn(r,t.h)}(n=gn.prototype).ea=function(){if(En(this))return-xn(this).ea();for(var t=0,e=1,i=0;i<this.g.length;i++){var n=this.D(i);t+=(0<=n?n:mn+n)*e,e*=mn}return t},n.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(Sn(this))return"0";if(En(this))return"-"+xn(this).toString(t);for(var e=yn(Math.pow(t,6)),i=this,n="";;){var r=In(i,e).g,s=((0<(i=jn(i,r.R(e))).g.length?i.g[0]:i.h)>>>0).toString(t);if(Sn(i=r))return s+n;for(;6>s.length;)s="0"+s;n=s+n}},n.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},n.X=function(t){return En(t=jn(this,t))?-1:Sn(t)?0:1},n.abs=function(){return En(this)?xn(this):this},n.add=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],n=0,r=0;r<=e;r++){var s=n+(65535&this.D(r))+(65535&t.D(r)),o=(s>>>16)+(this.D(r)>>>16)+(t.D(r)>>>16);n=o>>>16,s&=65535,o&=65535,i[r]=o<<16|s}return new gn(i,-2147483648&i[i.length-1]?-1:0)},n.R=function(t){if(Sn(this)||Sn(t))return bn;if(En(this))return En(t)?xn(this).R(xn(t)):xn(xn(this).R(t));if(En(t))return xn(this.R(xn(t)));if(0>this.X(Tn)&&0>t.X(Tn))return yn(this.ea()*t.ea());for(var e=this.g.length+t.g.length,i=[],n=0;n<2*e;n++)i[n]=0;for(n=0;n<this.g.length;n++)for(var r=0;r<t.g.length;r++){var s=this.D(n)>>>16,o=65535&this.D(n),h=t.D(r)>>>16,a=65535&t.D(r);i[2*n+2*r]+=o*a,Cn(i,2*n+2*r),i[2*n+2*r+1]+=s*a,Cn(i,2*n+2*r+1),i[2*n+2*r+1]+=o*h,Cn(i,2*n+2*r+1),i[2*n+2*r+2]+=s*h,Cn(i,2*n+2*r+2)}for(n=0;n<e;n++)i[n]=i[2*n+1]<<16|i[2*n];for(n=e;n<2*e;n++)i[n]=0;return new gn(i,0)},n.gb=function(t){return In(this,t).h},n.and=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],n=0;n<e;n++)i[n]=this.D(n)&t.D(n);return new gn(i,this.h&t.h)},n.or=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],n=0;n<e;n++)i[n]=this.D(n)|t.D(n);return new gn(i,this.h|t.h)},n.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],n=0;n<e;n++)i[n]=this.D(n)^t.D(n);return new gn(i,this.h^t.h)},sn.prototype.createWebChannel=sn.prototype.g,on.prototype.send=on.prototype.u,on.prototype.open=on.prototype.m,on.prototype.close=on.prototype.close,ee.NO_ERROR=0,ee.TIMEOUT=8,ee.HTTP_ERROR=6,ie.COMPLETE="complete",se.EventType=he,he.OPEN="a",he.CLOSE="b",he.ERROR="c",he.MESSAGE="d",dt.prototype.listen=dt.prototype.O,Ti.prototype.listenOnce=Ti.prototype.P,Ti.prototype.getLastError=Ti.prototype.Sa,Ti.prototype.getLastErrorCode=Ti.prototype.Ia,Ti.prototype.getStatus=Ti.prototype.da,Ti.prototype.getResponseJson=Ti.prototype.Wa,Ti.prototype.getResponseText=Ti.prototype.ja,Ti.prototype.send=Ti.prototype.ha,Ti.prototype.setWithCredentials=Ti.prototype.Oa,cn.prototype.digest=cn.prototype.l,cn.prototype.reset=cn.prototype.reset,cn.prototype.update=cn.prototype.j,gn.prototype.add=gn.prototype.add,gn.prototype.multiply=gn.prototype.R,gn.prototype.modulo=gn.prototype.gb,gn.prototype.compare=gn.prototype.X,gn.prototype.toNumber=gn.prototype.ea,gn.prototype.toString=gn.prototype.toString,gn.prototype.getBits=gn.prototype.D,gn.fromNumber=yn,gn.fromString=vn;var On=i.createWebChannelTransport=function(){return new sn};exports.createWebChannelTransport=On;var Pn=i.getStatEventTarget=function(){return zt()};exports.getStatEventTarget=Pn;var kn=i.ErrorCode=ee;exports.ErrorCode=kn;var _n=i.EventType=ie;exports.EventType=_n;var Dn=i.Event=Jt;exports.Event=Dn;var Ln=i.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20};exports.Stat=Ln;var Hn=i.FetchXmlHttpFactory=pi;exports.FetchXmlHttpFactory=Hn;var Xn=i.WebChannel=se;exports.WebChannel=Xn;var Nn=i.XhrIo=Ti;exports.XhrIo=Nn;var Fn=i.Md5=cn;exports.Md5=Fn;var Bn=i.Integer=gn;exports.Integer=Bn;
},{}],"TIij":[function(require,module,exports) {
var define;
var process = require("process");
var e,t=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports._TestingHooks=exports._FieldPath=exports._EmptyAuthCredentialsProvider=exports._EmptyAppCheckTokenProvider=exports._DocumentKey=exports._DatabaseId=exports.WriteBatch=exports.Transaction=exports.Timestamp=exports.SnapshotMetadata=exports.QueryStartAtConstraint=exports.QuerySnapshot=exports.QueryOrderByConstraint=exports.QueryLimitConstraint=exports.QueryFieldFilterConstraint=exports.QueryEndAtConstraint=exports.QueryDocumentSnapshot=exports.QueryConstraint=exports.QueryCompositeFilterConstraint=exports.Query=exports.LoadBundleTask=exports.GeoPoint=exports.FirestoreError=exports.Firestore=exports.FieldValue=exports.FieldPath=exports.DocumentSnapshot=exports.DocumentReference=exports.CollectionReference=exports.CACHE_SIZE_UNLIMITED=exports.Bytes=exports.AggregateQuerySnapshot=exports.AggregateField=exports.AbstractUserDataWriter=void 0,exports._cast=lf,exports._debugAssert=J,exports._isBase64Available=Bt,exports._logWarn=W,exports._validateIsNotUsedTogether=uf,exports.addDoc=xd,exports.aggregateFieldEqual=rd,exports.aggregateQuerySnapshotEqual=id,exports.and=Rh,exports.arrayRemove=Hd,exports.arrayUnion=Wd,exports.average=td,exports.clearIndexedDbPersistence=Mf,exports.collection=gf,exports.collectionGroup=kf,exports.connectFirestoreEmulator=vf,exports.count=nd,exports.deleteDoc=wd,exports.deleteField=jd,exports.disableNetwork=Vf,exports.doc=wf,exports.documentId=Wf,exports.enableIndexedDbPersistence=Ff,exports.enableMultiTabIndexedDbPersistence=Rf,exports.enableNetwork=Pf,exports.endAt=Kh,exports.endBefore=Gh,exports.ensureFirestoreConfigured=Af,exports.executeWrite=Ed,exports.getAggregateFromServer=_d,exports.getCountFromServer=Sd,exports.getDoc=fd,exports.getDocFromCache=dd,exports.getDocFromServer=vd,exports.getDocs=pd,exports.getDocsFromCache=yd,exports.getDocsFromServer=md,exports.getFirestore=Cf,exports.increment=Yd,exports.initializeFirestore=Df,exports.limit=Ph,exports.limitToLast=Vh,exports.loadBundle=Bf,exports.memoryEagerGarbageCollector=Fd,exports.memoryLocalCache=Ld,exports.memoryLruGarbageCollector=Rd,exports.namedQuery=Uf,exports.onSnapshot=bd,exports.onSnapshotsInSync=Id,exports.or=Fh,exports.orderBy=Mh,exports.persistentLocalCache=Md,exports.persistentMultipleTabManager=qd,exports.persistentSingleTabManager=Vd,exports.query=Dh,exports.queryEqual=bf,exports.refEqual=xf,exports.runTransaction=Kd,exports.serverTimestamp=Qd,exports.setDoc=gd,exports.setIndexConfiguration=Jd,exports.setLogLevel=K,exports.snapshotEqual=ld,exports.startAfter=Uh,exports.startAt=Bh,exports.sum=ed,exports.terminate=qf,exports.updateDoc=kd,exports.waitForPendingWrites=Of,exports.where=Ah,exports.writeBatch=Xd;var n=require("@firebase/app"),r=require("@firebase/component"),i=require("@firebase/logger"),a=require("@firebase/util"),u=require("@firebase/webchannel-wrapper");function o(){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=s(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(this,arguments)}function s(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}function c(e,t){return h(e)||f(e,t)||C(e,t)||l()}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,u,o=[],s=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(o.push(r.value),o.length!==t);s=!0);}catch(l){c=!0,i=l}finally{try{if(!s&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw i}}return o}}function h(e){if(Array.isArray(e))return e}function d(e){var t="function"==typeof Map?new Map:void 0;return(d=function(e){if(null===e||!p(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return v(e,arguments,S(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),x(n,e)})(e)}function v(e,t,n){return(v=T()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&x(i,n.prototype),i}).apply(null,arguments)}function p(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=C(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){o=!0,a=e},f:function(){try{u||null==n.return||n.return()}finally{if(o)throw a}}}}function m(){"use strict";m=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(C){s=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var a=t&&t.prototype instanceof h?t:h,u=Object.create(a.prototype),o=new S(i||[]);return r(u,"_invoke",{value:b(e,n,o)}),u}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(C){return{type:"throw",arg:C}}}e.wrap=c;var f={};function h(){}function d(){}function v(){}var p={};s(p,a,function(){return this});var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==t&&n.call(g,a)&&(p=g);var k=v.prototype=h.prototype=Object.create(p);function w(e){["next","throw","return"].forEach(function(t){s(e,t,function(e){return this._invoke(t,e)})})}function x(e,t){var i;r(this,"_invoke",{value:function(r,a){function u(){return new t(function(i,u){!function r(i,a,u,o){var s=l(e[i],e,a);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==R(f)&&n.call(f,"__await")?t.resolve(f.__await).then(function(e){r("next",e,u,o)},function(e){r("throw",e,u,o)}):t.resolve(f).then(function(e){c.value=e,u(c)},function(e){return r("throw",e,u,o)})}o(s.arg)}(r,a,i,u)})}return i=i?i.then(u,u):u()}})}function b(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return D()}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var o=I(u,n);if(o){if(o===f)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=l(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}function I(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,I(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var i=l(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,f;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function _(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:D}}function D(){return{value:void 0,done:!0}}return d.prototype=v,r(k,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:d,configurable:!0}),d.displayName=s(v,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,s(e,o,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},w(x.prototype),s(x.prototype,u,function(){return this}),e.AsyncIterator=x,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var u=new x(c(t,n,r,i),a);return e.isGeneratorFunction(n)?u:u.next().then(function(e){return e.done?e.value:u.next()})},w(k),s(k,o,"Generator"),s(k,a,function(){return this}),s(k,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return u.type="throw",u.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var o=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(o&&s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var u=a?a.completion:{};return u.type=e,u.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:_(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},e}function g(e,t,n,r,i,a,u){try{var o=e[a](u),s=o.value}catch(c){return void n(c)}o.done?t(s):Promise.resolve(s).then(r,i)}function k(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function u(e){g(a,r,i,u,o,"next",e)}function o(e){g(a,r,i,u,o,"throw",e)}u(void 0)})}}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&x(e,t)}function x(e,t){return(x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function b(e){var t=T();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}function I(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return E(e)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e){return N(e)||A(e)||C(e)||D()}function D(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function C(e,t){if(e){if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(e,t):void 0}}function A(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function N(e){if(Array.isArray(e))return F(e)}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,P(r.key),r)}}function O(e,t,n){return t&&M(e.prototype,t),n&&M(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function P(e){var t=V(e,"string");return"symbol"===R(t)?t:String(t)}function V(e,t){if("object"!==R(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==R(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var q="@firebase/firestore",B=function(){function e(t){L(this,e),this.uid=t}return O(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();B.UNAUTHENTICATED=new B(null),B.GOOGLE_CREDENTIALS=new B("google-credentials-uid"),B.FIRST_PARTY=new B("first-party-uid"),B.MOCK_USER=new B("mock-user");var U="9.22.1",z=new i.Logger("@firebase/firestore");function G(){return z.logLevel}function K(e){z.setLogLevel(e)}function j(e){if(z.logLevel<=i.LogLevel.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map(H);z.debug.apply(z,["Firestore (".concat(U,"): ").concat(e)].concat(_(a)))}}function Q(e){if(z.logLevel<=i.LogLevel.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map(H);z.error.apply(z,["Firestore (".concat(U,"): ").concat(e)].concat(_(a)))}}function W(e){if(z.logLevel<=i.LogLevel.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map(H);z.warn.apply(z,["Firestore (".concat(U,"): ").concat(e)].concat(_(a)))}}function H(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(U,") INTERNAL ASSERTION FAILED: ")+e;throw Q(t),new Error(t)}function X(e,t){e||Y()}function J(e,t){e||Y()}function Z(e,t){return e}var $={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ee=function(e){w(n,a.FirebaseError);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e,r)).code=e,i.message=r,i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return O(n)}();exports.FirestoreError=ee;var te=O(function e(){var t=this;L(this,e),this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}),ne=O(function e(t,n){L(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))}),re=function(){function e(){L(this,e)}return O(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable(function(){return t(B.UNAUTHENTICATED)})}},{key:"shutdown",value:function(){}}]),e}();exports._EmptyAuthCredentialsProvider=re;var ie=function(){function e(t){L(this,e),this.token=t,this.changeListener=null}return O(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable(function(){return t(n.token.user)})}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),ae=function(){function e(t){L(this,e),this.t=t,this.currentUser=B.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return O(e,[{key:"start",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new te;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new te,e.enqueueRetryable(function(){return i(n.currentUser)})};var u=function(){var t=a;e.enqueueRetryable(k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}},e)})))},o=function(e){j("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),u()};this.t.onInit(function(e){return o(e)}),setTimeout(function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?o(e):(j("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new te)}},0),u()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return e.i!==t?(j("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(X("string"==typeof n.accessToken),new ne(n.accessToken,e.currentUser)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return X(null===e||"string"==typeof e),new B(e)}}]),e}(),ue=function(){function e(t,n,r){L(this,e),this.h=t,this.l=n,this.m=r,this.type="FirstParty",this.user=B.FIRST_PARTY,this.g=new Map}return O(e,[{key:"p",value:function(){return this.m?this.m():null}},{key:"headers",get:function(){this.g.set("X-Goog-AuthUser",this.h);var e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}]),e}(),oe=function(){function e(t,n,r){L(this,e),this.h=t,this.l=n,this.m=r}return O(e,[{key:"getToken",value:function(){return Promise.resolve(new ue(this.h,this.l,this.m))}},{key:"start",value:function(e,t){e.enqueueRetryable(function(){return t(B.FIRST_PARTY)})}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),se=O(function e(t){L(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}),ce=function(){function e(t){L(this,e),this.I=t,this.forceRefresh=!1,this.appCheck=null,this.T=null}return O(e,[{key:"start",value:function(e,t){var n=this,r=function(e){null!=e.error&&j("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));var r=e.token!==n.T;return n.T=e.token,j("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?t(e.token):Promise.resolve()};this.o=function(t){e.enqueueRetryable(function(){return r(t)})};var i=function(e){j("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.I.onInit(function(e){return i(e)}),setTimeout(function(){if(!n.appCheck){var e=n.I.getImmediate({optional:!0});e?i(e):j("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}},{key:"getToken",value:function(){var e=this,t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(function(t){return t?(X("string"==typeof t.token),e.T=t.token,new se(t.token)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}(),le=function(){function e(){L(this,e)}return O(e,[{key:"getToken",value:function(){return Promise.resolve(new se(""))}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){}},{key:"shutdown",value:function(){}}]),e}();function fe(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}exports._EmptyAppCheckTokenProvider=le;var he=function(){function e(){L(this,e)}return O(e,null,[{key:"A",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=fe(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function de(e,t){return e<t?-1:e>t?1:0}function ve(e,t,n){return e.length===t.length&&e.every(function(e,r){return n(e,t[r])})}function pe(e){return e+"\0"}var ye=function(){function e(t,n){if(L(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new ee($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ee($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new ee($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ee($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return O(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?de(this.nanoseconds,e.nanoseconds):de(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}();exports.Timestamp=ye;var me=function(){function e(t){L(this,e),this.timestamp=t}return O(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new ye(0,0))}},{key:"max",value:function(){return new e(new ye(253402300799,999999999))}}]),e}(),ge=function(){function e(t,n,r){L(this,e),void 0===n?n=0:n>t.length&&Y(),void 0===r?r=t.length-n:r>t.length-n&&Y(),this.segments=t,this.offset=n,this.len=r}return O(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(e){n.push(e)}):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),ke=function(e){w(n,ge);var t=b(n);function n(){return L(this,n),t.apply(this,arguments)}return O(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,u=r;a<u.length;a++){var o=u[a];if(o.indexOf("//")>=0)throw new ee($.INVALID_ARGUMENT,"Invalid segment (".concat(o,"). Paths must not contain // in them."));e.push.apply(e,_(o.split("/").filter(function(e){return e.length>0})))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(),we=/^[_a-zA-Z][_a-zA-Z0-9]*$/,xe=function(e){w(n,ge);var t=b(n);function n(){return L(this,n),t.apply(this,arguments)}return O(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map(function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e}).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return we.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new ee($.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},u=!1;i<e.length;){var o=e[i];if("\\"===o){if(i+1===e.length)throw new ee($.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[i+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new ee($.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=s,i+=2}else"`"===o?(u=!u,i++):"."!==o||u?(r+=o,i++):(a(),i++)}if(a(),u)throw new ee($.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}();exports._FieldPath=xe;var be=function(){function e(t){L(this,e),this.path=t}return O(e,[{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(e){return null!==e&&0===ke.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(ke.fromString(t))}},{key:"fromName",value:function(t){return new e(ke.fromString(t).popFirst(5))}},{key:"empty",value:function(){return new e(ke.emptyPath())}},{key:"comparator",value:function(e,t){return ke.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new ke(t.slice()))}}]),e}();exports._DocumentKey=be;var Ie=O(function e(t,n,r,i){L(this,e),this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=i});function Ee(e){return e.fields.find(function(e){return 2===e.kind})}function Te(e){return e.fields.filter(function(e){return 2!==e.kind})}function Se(e,t){var n=de(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(var r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=De(e.fields[r],t.fields[r])))return n;return de(e.fields.length,t.fields.length)}Ie.UNKNOWN_ID=-1;var _e=O(function e(t,n){L(this,e),this.fieldPath=t,this.kind=n});function De(e,t){var n=xe.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:de(e.kind,t.kind)}var Ce=function(){function e(t,n){L(this,e),this.sequenceNumber=t,this.offset=n}return O(e,null,[{key:"empty",value:function(){return new e(0,Fe.min())}}]),e}();function Ae(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=me.fromTimestamp(1e9===r?new ye(n+1,0):new ye(n,r));return new Fe(i,be.empty(),t)}function Ne(e){return new Fe(e.readTime,e.key,-1)}var Fe=function(){function e(t,n,r){L(this,e),this.readTime=t,this.documentKey=n,this.largestBatchId=r}return O(e,null,[{key:"min",value:function(){return new e(me.min(),be.empty(),-1)}},{key:"max",value:function(){return new e(me.max(),be.empty(),-1)}}]),e}();function Re(e,t){var n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=be.comparator(e.documentKey,t.documentKey))?n:de(e.largestBatchId,t.largestBatchId)}var Le="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Me=function(){function e(){L(this,e),this.onCommittedListeners=[]}return O(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach(function(e){return e()})}}]),e}();function Oe(e){return Pe.apply(this,arguments)}function Pe(){return(Pe=k(m().mark(function e(t){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===$.FAILED_PRECONDITION&&t.message===Le){e.next=2;break}throw t;case 2:j("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Ve=function(){function e(t){var n=this;L(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)},function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)})}return O(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&Y(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e(function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}})}},{key:"toPromise",value:function(){var e=this;return new Promise(function(t,n){e.next(t,n)})}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.reject(n)}}],[{key:"resolve",value:function(t){return new e(function(e,n){e(t)})}},{key:"reject",value:function(t){return new e(function(e,n){n(t)})}},{key:"waitFor",value:function(t){return new e(function(e,n){var r=0,i=0,a=!1;t.forEach(function(t){++r,t.next(function(){++i,a&&i===r&&e()},function(e){return n(e)})}),a=!0,i===r&&e()})}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=y(t);try{var a=function(){var t=n.value;r=r.next(function(n){return n?e.resolve(n):t()})};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach(function(e,i){r.push(t.call(n,e,i))}),this.waitFor(r)}},{key:"mapArray",value:function(t,n){return new e(function(e,r){for(var i=t.length,a=new Array(i),u=0,o=function(){var o=s;n(t[o]).next(function(t){a[o]=t,++u===i&&e(a)},function(e){return r(e)})},s=0;s<i;s++)o()})}},{key:"doWhile",value:function(t,n){return new e(function(e,r){!function i(){!0===t()?n().next(function(){i()},r):e()}()})}}]),e}(),qe=function(){function e(t,n){var r=this;L(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.v=new te,this.transaction.oncomplete=function(){r.v.resolve()},this.transaction.onabort=function(){n.error?r.v.reject(new ze(t,n.error)):r.v.resolve()},this.transaction.onerror=function(e){var n=We(e.target.error);r.v.reject(new ze(t,n))}}return O(e,[{key:"R",get:function(){return this.v.promise}},{key:"abort",value:function(e){e&&this.v.reject(e),this.aborted||(j("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"P",value:function(){var e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}},{key:"store",value:function(e){var t=this.transaction.objectStore(e);return new Ke(t)}}],[{key:"open",value:function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new ze(n,t)}}}]),e}(),Be=function(){function e(t,n,r){L(this,e),this.name=t,this.version=n,this.V=r,12.2===e.S((0,a.getUA)())&&Q("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return O(e,[{key:"$",value:function(){var e=k(m().mark(function e(t){var n=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return j("SimpleDb","Opening database:",this.name),e.next=5,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new ze(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new ee($.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new ee($.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new ze(t,n))},i.onupgradeneeded=function(e){j("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.V.O(t,i.transaction,e.oldVersion,n.version).next(function(){j("SimpleDb","Database upgrade to version "+n.version+" complete")})}});case 5:this.db=e.sent;case 6:return this.F&&(this.db.onversionchange=function(e){return n.F(e)}),e.abrupt("return",this.db);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"B",value:function(e){this.F=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:function(){var e=k(m().mark(function e(t,n,r,i){var a,u,o,s,c=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a="readonly"===n,u=0,o=m().mark(function e(){var n,o,s,l;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return++u,e.prev=1,e.next=4,c.$(t);case 4:return c.db=e.sent,n=qe.open(c.db,t,a?"readonly":"readwrite",r),(o=i(n).next(function(e){return n.P(),e}).catch(function(e){return n.abort(e),Ve.reject(e)}).toPromise()).catch(function(){}),e.next=9,n.R;case 9:return e.t0=o,e.abrupt("return",{v:e.t0});case 13:if(e.prev=13,e.t1=e.catch(1),s=e.t1,l="FirebaseError"!==s.name&&u<3,j("SimpleDb","Transaction failed with error:",s.message,"Retrying:",l),c.close(),l){e.next=18;break}return e.abrupt("return",{v:Promise.reject(s)});case 18:case"end":return e.stop()}},e,null,[[1,13]])});case 3:return e.delegateYield(o(),"t0",4);case 4:if("object"!==R(s=e.t0)){e.next=7;break}return e.abrupt("return",s.v);case 7:e.next=3;break;case 9:case"end":return e.stop()}},e)}));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"close",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function(e){return j("SimpleDb","Removing database:",e),je(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"D",value:function(){if(!(0,a.isIndexedDBAvailable)())return!1;if(e.C())return!0;var t=(0,a.getUA)(),n=e.S(t),r=0<n&&n<10,i=e.N(t),u=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||u)}},{key:"C",value:function(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.k)}},{key:"M",value:function(e,t){return e.store(t)}},{key:"S",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}},{key:"N",value:function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}}]),e}(),Ue=function(){function e(t){L(this,e),this.L=t,this.q=!1,this.U=null}return O(e,[{key:"isDone",get:function(){return this.q}},{key:"K",get:function(){return this.U}},{key:"cursor",set:function(e){this.L=e}},{key:"done",value:function(){this.q=!0}},{key:"G",value:function(e){this.U=e}},{key:"delete",value:function(){return je(this.L.delete())}}]),e}(),ze=function(e){w(n,ee);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this,$.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(r))).name="IndexedDbTransactionError",i}return O(n)}();function Ge(e){return"IndexedDbTransactionError"===e.name}var Ke=function(){function e(t){L(this,e),this.store=t}return O(e,[{key:"put",value:function(e,t){var n;return void 0!==t?(j("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(j("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),je(n)}},{key:"add",value:function(e){return j("SimpleDb","ADD",this.store.name,e,e),je(this.store.add(e))}},{key:"get",value:function(e){var t=this;return je(this.store.get(e)).next(function(n){return void 0===n&&(n=null),j("SimpleDb","GET",t.store.name,e,n),n})}},{key:"delete",value:function(e){return j("SimpleDb","DELETE",this.store.name,e),je(this.store.delete(e))}},{key:"count",value:function(){return j("SimpleDb","COUNT",this.store.name),je(this.store.count())}},{key:"j",value:function(e,t){var n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){var r=this.cursor(n),i=[];return this.W(r,function(e,t){i.push(t)}).next(function(){return i})}var a=this.store.getAll(n.range);return new Ve(function(e,t){a.onerror=function(e){t(e.target.error)},a.onsuccess=function(t){e(t.target.result)}})}},{key:"H",value:function(e,t){var n=this.store.getAll(e,null===t?void 0:t);return new Ve(function(e,t){n.onerror=function(e){t(e.target.error)},n.onsuccess=function(t){e(t.target.result)}})}},{key:"J",value:function(e,t){j("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.Y=!1;var r=this.cursor(n);return this.W(r,function(e,t,n){return n.delete()})}},{key:"X",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.W(r,t)}},{key:"Z",value:function(e){var t=this.cursor({});return new Ve(function(n,r){t.onerror=function(e){var t=We(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next(function(e){e?r.continue():n()}):n()}})}},{key:"W",value:function(e,t){var n=[];return new Ve(function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var a=new Ue(i),u=t(i.primaryKey,i.value,a);if(u instanceof Ve){var o=u.catch(function(e){return a.done(),Ve.reject(e)});n.push(o)}a.isDone?r():null===a.K?i.continue():i.continue(a.K)}else r()}}).next(function(){return Ve.waitFor(n)})}},{key:"options",value:function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function je(e){return new Ve(function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=We(e.target.error);n(t)}})}var Qe=!1;function We(e){var t=Be.S((0,a.getUA)());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new ee("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(n,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return Qe||(Qe=!0,setTimeout(function(){throw r},0)),r}}return e}var He=function(){function e(t,n){L(this,e),this.asyncQueue=t,this.tt=n,this.task=null}return O(e,[{key:"start",value:function(){this.et(15e3)}},{key:"stop",value:function(){this.task&&(this.task.cancel(),this.task=null)}},{key:"started",get:function(){return null!==this.task}},{key:"et",value:function(e){var t=this;j("IndexBackiller","Scheduled in ".concat(e,"ms")),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.task=null,e.prev=1,e.t0=j,e.t1="Documents written: ",e.next=6,t.tt.nt();case 6:e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),(0,e.t0)("IndexBackiller",e.t3),e.next=19;break;case 11:if(e.prev=11,e.t4=e.catch(1),!Ge(e.t4)){e.next=17;break}j("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e.t4),e.next=19;break;case 17:return e.next=19,Oe(e.t4);case 19:return e.next=21,t.et(6e4);case 21:case"end":return e.stop()}},e,null,[[1,11]])})))}}]),e}(),Ye=function(){function e(t,n){L(this,e),this.localStore=t,this.persistence=n}return O(e,[{key:"nt",value:function(){var e=k(m().mark(function e(){var t,n=this,r=arguments;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:50,e.abrupt("return",this.persistence.runTransaction("Backfill Indexes","readwrite-primary",function(e){return n.st(e,t)}));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"st",value:function(e,t){var n=this,r=new Set,i=t,a=!0;return Ve.doWhile(function(){return!0===a&&i>0},function(){return n.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(function(t){if(null!==t&&!r.has(t))return j("IndexBackiller","Processing collection: ".concat(t)),n.it(e,t,i).next(function(e){i-=e,r.add(t)});a=!1})}).next(function(){return t-i})}},{key:"it",value:function(e,t,n){var r=this;return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(function(i){return r.localStore.localDocuments.getNextDocuments(e,t,i,n).next(function(n){var a=n.changes;return r.localStore.indexManager.updateIndexEntries(e,a).next(function(){return r.rt(i,n)}).next(function(n){return j("IndexBackiller","Updating offset: ".concat(n)),r.localStore.indexManager.updateCollectionGroup(e,t,n)}).next(function(){return a.size})})})}},{key:"rt",value:function(e,t){var n=e;return t.changes.forEach(function(e,t){var r=Ne(t);Re(r,n)>0&&(n=r)}),new Fe(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}]),e}(),Xe=function(){function e(t,n){var r=this;L(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.ot(e)},this.ut=function(e){return n.writeSequenceNumber(e)})}return O(e,[{key:"ot",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.ut&&this.ut(e),e}}]),e}();function Je(e){return null==e}function Ze(e){return 0===e&&1/e==-1/0}function $e(e){return"number"==typeof e&&Number.isInteger(e)&&!Ze(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function et(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=nt(t)),t=tt(e.get(n),t);return nt(t)}function tt(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var a=e.charAt(i);switch(a){case"\0":n+="";break;case"":n+="";break;default:n+=a}}return n}function nt(e){return e+""}function rt(e){var t=e.length;if(X(t>=2),2===t)return X(""===e.charAt(0)&&""===e.charAt(1)),ke.emptyPath();for(var n=t-2,r=[],i="",a=0;a<t;){var u=e.indexOf("",a);switch((u<0||u>n)&&Y(),e.charAt(u+1)){case"":var o=e.substring(a,u),s=void 0;0===i.length?s=o:(s=i+=o,i=""),r.push(s);break;case"":i+=e.substring(a,u),i+="\0";break;case"":i+=e.substring(a,u+1);break;default:Y()}a=u+2}return new ke(r)}Xe.ct=-1;var it=["userId","batchId"];function at(e,t){return[e,et(t)]}function ut(e,t,n){return[e,et(t),n]}var ot={},st=["prefixPath","collectionGroup","readTime","documentId"],ct=["prefixPath","collectionGroup","documentId"],lt=["collectionGroup","readTime","prefixPath","documentId"],ft=["canonicalId","targetId"],ht=["targetId","path"],dt=["path","targetId"],vt=["collectionId","parent"],pt=["indexId","uid"],yt=["uid","sequenceNumber"],mt=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],gt=["indexId","uid","orderedDocumentKey"],kt=["userId","collectionPath","documentId"],wt=["userId","collectionPath","largestBatchId"],xt=["userId","collectionGroup","largestBatchId"],bt=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"].concat(["clientMetadata"]).concat(["remoteDocumentGlobal"]).concat(["collectionParents"]).concat(["bundles","namedQueries"]),It=[].concat(_(bt),["documentOverlays"]),Et=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Tt=Et,St=[].concat(Tt,["indexConfiguration","indexState","indexEntries"]),_t=function(e){w(n,Me);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).ht=e,i.currentSequenceNumber=r,i}return O(n)}();function Dt(e,t){var n=Z(e);return Be.M(n.ht,t)}function Ct(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function At(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Nt(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var Ft=function(){function e(t,n){L(this,e),this.comparator=t,this.root=n||Lt.EMPTY}return O(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,Lt.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Lt.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal(function(t,n){return e(t,n),!1})}},{key:"toString",value:function(){var e=[];return this.inorderTraversal(function(t,n){return e.push("".concat(t,":").concat(n)),!1}),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new Rt(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new Rt(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new Rt(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new Rt(this.root,e,this.comparator,!0)}}]),e}(),Rt=function(){function e(t,n,r,i){L(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,n&&i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return O(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),Lt=function(){function e(t,n,r,i,a){L(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return O(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw Y();if(this.right.isRed())throw Y();var e=this.left.check();if(e!==this.right.check())throw Y();return e+(this.isRed()?0:1)}}]),e}();Lt.EMPTY=null,Lt.RED=!0,Lt.BLACK=!1,Lt.EMPTY=new(function(){function e(){L(this,e),this.size=0}return O(e,[{key:"key",get:function(){throw Y()}},{key:"value",get:function(){throw Y()}},{key:"color",get:function(){throw Y()}},{key:"left",get:function(){throw Y()}},{key:"right",get:function(){throw Y()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new Lt(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var Mt=function(){function e(t){L(this,e),this.comparator=t,this.data=new Ft(this.comparator)}return O(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal(function(t,n){return e(t),!1})}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new Ot(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new Ot(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach(function(e){t=t.add(e)}),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}},{key:"toString",value:function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),Ot=function(){function e(t){L(this,e),this.iter=t}return O(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}();function Pt(e){return e.hasNext()?e.getNext():void 0}var Vt=function(){function e(t){L(this,e),this.fields=t,t.sort(xe.comparator)}return O(e,[{key:"unionWith",value:function(t){var n,r=new Mt(xe.comparator),i=y(this.fields);try{for(i.s();!(n=i.n()).done;){var a=n.value;r=r.add(a)}}catch(c){i.e(c)}finally{i.f()}var u,o=y(t);try{for(o.s();!(u=o.n()).done;){var s=u.value;r=r.add(s)}}catch(c){o.e(c)}finally{o.f()}return new e(r.toArray())}},{key:"covers",value:function(e){var t,n=y(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return ve(this.fields,e.fields,function(e,t){return e.isEqual(t)})}}],[{key:"empty",value:function(){return new e([])}}]),e}(),qt=function(e){w(n,d(Error));var t=b(n);function n(){var e;return L(this,n),(e=t.apply(this,arguments)).name="Base64DecodeError",e}return O(n)}();function Bt(){return"undefined"!=typeof atob}var Ut=function(e){function t(e){L(this,t),this.binaryString=e}return O(t,[{key:Symbol.iterator,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return de(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){return new t(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new qt("Invalid base64 string: "+e):e}}(e))}},{key:"fromUint8Array",value:function(e){return new t(function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}}]),t}();Ut.EMPTY_BYTE_STRING=new Ut("");var zt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Gt(e){if(X(!!e),"string"==typeof e){var t=0,n=zt.exec(e);if(X(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:Kt(e.seconds),nanos:Kt(e.nanos)}}function Kt(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function jt(e){return"string"==typeof e?Ut.fromBase64String(e):Ut.fromUint8Array(e)}function Qt(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Wt(e){var t=e.mapValue.fields.__previous_value__;return Qt(t)?Wt(t):t}function Ht(e){var t=Gt(e.mapValue.fields.__local_write_time__.timestampValue);return new ye(t.seconds,t.nanos)}var Yt=O(function e(t,n,r,i,a,u,o,s,c){L(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=u,this.autoDetectLongPolling=o,this.longPollingOptions=s,this.useFetchStreams=c}),Xt=function(){function e(t,n){L(this,e),this.projectId=t,this.database=n||"(default)"}return O(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}],[{key:"empty",value:function(){return new e("","")}}]),e}();exports._DatabaseId=Xt;var Jt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Zt={nullValue:"NULL_VALUE"};function $t(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Qt(e)?4:pn(e)?9007199254740991:10:Y()}function en(e,t){if(e===t)return!0;var n=$t(e);if(n!==$t(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ht(e).isEqual(Ht(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=Gt(e.timestampValue),r=Gt(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return jt(e.bytesValue).isEqual(jt(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Kt(e.geoPointValue.latitude)===Kt(t.geoPointValue.latitude)&&Kt(e.geoPointValue.longitude)===Kt(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Kt(e.integerValue)===Kt(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=Kt(e.doubleValue),r=Kt(t.doubleValue);return n===r?Ze(n)===Ze(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ve(e.arrayValue.values||[],t.arrayValue.values||[],en);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Ct(n)!==Ct(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!en(n[i],r[i])))return!1;return!0}(e,t);default:return Y()}}function tn(e,t){return void 0!==(e.values||[]).find(function(e){return en(e,t)})}function nn(e,t){if(e===t)return 0;var n=$t(e),r=$t(t);if(n!==r)return de(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return de(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=Kt(e.integerValue||e.doubleValue),r=Kt(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return rn(e.timestampValue,t.timestampValue);case 4:return rn(Ht(e),Ht(t));case 5:return de(e.stringValue,t.stringValue);case 6:return function(e,t){var n=jt(e),r=jt(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=de(n[i],r[i]);if(0!==a)return a}return de(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=de(Kt(e.latitude),Kt(t.latitude));return 0!==n?n:de(Kt(e.longitude),Kt(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=nn(n[i],r[i]);if(a)return a}return de(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Jt.mapValue&&t===Jt.mapValue)return 0;if(e===Jt.mapValue)return 1;if(t===Jt.mapValue)return-1;var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var u=0;u<r.length&&u<a.length;++u){var o=de(r[u],a[u]);if(0!==o)return o;var s=nn(n[r[u]],i[a[u]]);if(0!==s)return s}return de(r.length,a.length)}(e.mapValue,t.mapValue);default:throw Y()}}function rn(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return de(e,t);var n=Gt(e),r=Gt(t),i=de(n.seconds,r.seconds);return 0!==i?i:de(n.nanos,r.nanos)}function an(e){return un(e)}function un(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=Gt(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?jt(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,be.fromName(n).toString()):"geoPointValue"in e?"geo(".concat((t=e.geoPointValue).latitude,",").concat(t.longitude,")"):"arrayValue"in e?function(e){var t,n="[",r=!0,i=y(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=un(a)}}catch(u){i.e(u)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n="{",r=!0,i=y(Object.keys(e.fields||{}).sort());try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+="".concat(a,":").concat(un(e.fields[a]))}}catch(u){i.e(u)}finally{i.f()}return n+"}"}(e.mapValue):Y();var t,n}function on(e){switch($t(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:var t=Wt(e);return t?16+on(t):16;case 5:return 2*e.stringValue.length;case 6:return jt(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce(function(e,t){return e+on(t)},0);case 10:return function(e){var t=0;return At(e.fields,function(e,n){t+=e.length+on(n)}),t}(e.mapValue);default:throw Y()}}function sn(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function cn(e){return!!e&&"integerValue"in e}function ln(e){return!!e&&"arrayValue"in e}function fn(e){return!!e&&"nullValue"in e}function hn(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function dn(e){return!!e&&"mapValue"in e}function vn(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==R(e.timestampValue))return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return At(e.mapValue.fields,function(e,n){return t.mapValue.fields[e]=vn(n)}),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=vn(e.arrayValue.values[r]);return n}return Object.assign({},e)}function pn(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function yn(e){return"nullValue"in e?Zt:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?sn(Xt.empty(),be.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:Y()}function mn(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?sn(Xt.empty(),be.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?Jt:Y()}function gn(e,t){var n=nn(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function kn(e,t){var n=nn(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}var wn=function(){function e(t){L(this,e),this.value=t}return O(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!dn(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=vn(t)}},{key:"setAll",value:function(e){var t=this,n=xe.emptyPath(),r={},i=[];e.forEach(function(e,a){if(!n.isImmediateParentOf(a)){var u=t.getFieldsMap(n);t.applyChanges(u,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=vn(e):i.push(a.lastSegment())});var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());dn(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return en(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];dn(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){At(t,function(t,n){return e[t]=n});var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(u){i.e(u)}finally{i.f()}}},{key:"clone",value:function(){return new e(vn(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function xn(e){var t=[];return At(e.fields,function(e,n){var r=new xe([e]);if(dn(n)){var i=xn(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,u=y(i);try{for(u.s();!(a=u.n()).done;){var o=a.value;t.push(r.child(o))}}catch(s){u.e(s)}finally{u.f()}}}else t.push(r)}),new Vt(t)}var bn=function(){function e(t,n,r,i,a,u,o){L(this,e),this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.createTime=a,this.data=u,this.documentState=o}return O(e,[{key:"convertToFoundDocument",value:function(e,t){return!this.createTime.isEqual(me.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=wn.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=wn.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this.version=me.min(),this}},{key:"setReadTime",value:function(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"mutableCopy",value:function(){return new e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,me.min(),me.min(),me.min(),wn.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r,i){return new e(t,1,n,me.min(),r,i,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,me.min(),me.min(),wn.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,me.min(),me.min(),wn.empty(),2)}}]),e}(),In=O(function e(t,n){L(this,e),this.position=t,this.inclusive=n});function En(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],u=e.position[i];if(r=a.field.isKeyField()?be.comparator(be.fromName(u.referenceValue),n.key):nn(u,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function Tn(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!en(e.position[n],t.position[n]))return!1;return!0}var Sn=O(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";L(this,e),this.field=t,this.dir=n});function _n(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}var Dn=O(function e(){L(this,e)}),Cn=function(e){w(n,Dn);var t=b(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return O(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(nn(t,this.value)):null!==t&&$t(this.value)===$t(t)&&this.matchesComparison(nn(t,this.value))}},{key:"matchesComparison",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Y()}}},{key:"isInequality",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}},{key:"getFlattenedFilters",value:function(){return[this]}},{key:"getFilters",value:function(){return[this]}},{key:"getFirstInequalityField",value:function(){return this.isInequality()?this.field:null}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new qn(e,t,r):"array-contains"===t?new Gn(e,r):"in"===t?new Kn(e,r):"not-in"===t?new jn(e,r):"array-contains-any"===t?new Qn(e,r):new n(e,t,r)}},{key:"createKeyFieldInFilter",value:function(e,t,n){return"in"===t?new Bn(e,n):new Un(e,n)}}]),n}(),An=function(e){w(n,Dn);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).filters=e,i.op=r,i.lt=null,i}return O(n,[{key:"matches",value:function(e){return Nn(this)?void 0===this.filters.find(function(t){return!t.matches(e)}):void 0!==this.filters.find(function(t){return t.matches(e)})}},{key:"getFlattenedFilters",value:function(){return null!==this.lt||(this.lt=this.filters.reduce(function(e,t){return e.concat(t.getFlattenedFilters())},[])),this.lt}},{key:"getFilters",value:function(){return Object.assign([],this.filters)}},{key:"getFirstInequalityField",value:function(){var e=this.ft(function(e){return e.isInequality()});return null!==e?e.field:null}},{key:"ft",value:function(e){var t,n=y(this.getFlattenedFilters());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e(r))return r}}catch(i){n.e(i)}finally{n.f()}return null}}],[{key:"create",value:function(e,t){return new n(e,t)}}]),n}();function Nn(e){return"and"===e.op}function Fn(e){return"or"===e.op}function Rn(e){return Ln(e)&&Nn(e)}function Ln(e){var t,n=y(e.filters);try{for(n.s();!(t=n.n()).done;){if(t.value instanceof An)return!1}}catch(r){n.e(r)}finally{n.f()}return!0}function Mn(e){if(e instanceof Cn)return e.field.canonicalString()+e.op.toString()+an(e.value);if(Rn(e))return e.filters.map(function(e){return Mn(e)}).join(",");var t=e.filters.map(function(e){return Mn(e)}).join(",");return"".concat(e.op,"(").concat(t,")")}function On(e,t){return e instanceof Cn?function(e,t){return t instanceof Cn&&e.op===t.op&&e.field.isEqual(t.field)&&en(e.value,t.value)}(e,t):e instanceof An?function(e,t){return t instanceof An&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(function(e,n,r){return e&&On(n,t.filters[r])},!0)}(e,t):void Y()}function Pn(e,t){var n=e.filters.concat(t);return An.create(n,e.op)}function Vn(e){return e instanceof Cn?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(an(e.value))}(e):e instanceof An?function(e){return e.op.toString()+" {"+e.getFilters().map(Vn).join(" ,")+"}"}(e):"Filter"}var qn=function(e){w(n,Cn);var t=b(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this,e,r,i)).key=be.fromName(i.referenceValue),a}return O(n,[{key:"matches",value:function(e){var t=be.comparator(e.key,this.key);return this.matchesComparison(t)}}]),n}(),Bn=function(e){w(n,Cn);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e,"in",r)).keys=zn("in",r),i}return O(n,[{key:"matches",value:function(e){return this.keys.some(function(t){return t.isEqual(e.key)})}}]),n}(),Un=function(e){w(n,Cn);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e,"not-in",r)).keys=zn("not-in",r),i}return O(n,[{key:"matches",value:function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})}}]),n}();function zn(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(e){return be.fromName(e.referenceValue)})}var Gn=function(e){w(n,Cn);var t=b(n);function n(e,r){return L(this,n),t.call(this,e,"array-contains",r)}return O(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return ln(t)&&tn(t.arrayValue,this.value)}}]),n}(),Kn=function(e){w(n,Cn);var t=b(n);function n(e,r){return L(this,n),t.call(this,e,"in",r)}return O(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&tn(this.value.arrayValue,t)}}]),n}(),jn=function(e){w(n,Cn);var t=b(n);function n(e,r){return L(this,n),t.call(this,e,"not-in",r)}return O(n,[{key:"matches",value:function(e){if(tn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!tn(this.value.arrayValue,t)}}]),n}(),Qn=function(e){w(n,Cn);var t=b(n);function n(e,r){return L(this,n),t.call(this,e,"array-contains-any",r)}return O(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!ln(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(e){return tn(t.value.arrayValue,e)})}}]),n}(),Wn=O(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;L(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=u,this.endAt=o,this.dt=null});function Hn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new Wn(e,t,n,r,i,a,u)}function Yn(e){var t=Z(e);if(null===t.dt){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map(function(e){return Mn(e)}).join(","),n+="|ob:",n+=t.orderBy.map(function(e){return function(e){return e.field.canonicalString()+e.dir}(e)}).join(","),Je(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(function(e){return an(e)}).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(function(e){return an(e)}).join(",")),t.dt=n}return t.dt}function Xn(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!_n(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(!On(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Tn(e.startAt,t.startAt)&&Tn(e.endAt,t.endAt)}function Jn(e){return be.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Zn(e,t){return e.filters.filter(function(e){return e instanceof Cn&&e.field.isEqual(t)})}function $n(e,t,n){var r,i=Zt,a=!0,u=y(Zn(e,t));try{for(u.s();!(r=u.n()).done;){var o=r.value,s=Zt,c=!0;switch(o.op){case"<":case"<=":s=yn(o.value);break;case"==":case"in":case">=":s=o.value;break;case">":s=o.value,c=!1;break;case"!=":case"not-in":s=Zt}gn({value:i,inclusive:a},{value:s,inclusive:c})<0&&(i=s,a=c)}}catch(h){u.e(h)}finally{u.f()}if(null!==n)for(var l=0;l<e.orderBy.length;++l)if(e.orderBy[l].field.isEqual(t)){var f=n.position[l];gn({value:i,inclusive:a},{value:f,inclusive:n.inclusive})<0&&(i=f,a=n.inclusive);break}return{value:i,inclusive:a}}function er(e,t,n){var r,i=Jt,a=!0,u=y(Zn(e,t));try{for(u.s();!(r=u.n()).done;){var o=r.value,s=Jt,c=!0;switch(o.op){case">=":case">":s=mn(o.value),c=!1;break;case"==":case"in":case"<=":s=o.value;break;case"<":s=o.value,c=!1;break;case"!=":case"not-in":s=Jt}kn({value:i,inclusive:a},{value:s,inclusive:c})>0&&(i=s,a=c)}}catch(h){u.e(h)}finally{u.f()}if(null!==n)for(var l=0;l<e.orderBy.length;++l)if(e.orderBy[l].field.isEqual(t)){var f=n.position[l];kn({value:i,inclusive:a},{value:f,inclusive:n.inclusive})>0&&(i=f,a=n.inclusive);break}return{value:i,inclusive:a}}var tr=O(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;L(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=u,this.startAt=o,this.endAt=s,this.wt=null,this._t=null,this.startAt,this.endAt});function nr(e,t,n,r,i,a,u,o){return new tr(e,t,n,r,i,a,u,o)}function rr(e){return new tr(e)}function ir(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ar(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function ur(e){var t,n=y(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value.getFirstInequalityField();if(null!==r)return r}}catch(i){n.e(i)}finally{n.f()}return null}function or(e){return null!==e.collectionGroup}function sr(e){var t=Z(e);if(null===t.wt){t.wt=[];var n=ur(t),r=ar(t);if(null!==n&&null===r)n.isKeyField()||t.wt.push(new Sn(n)),t.wt.push(new Sn(xe.keyField(),"asc"));else{var i,a=!1,u=y(t.explicitOrderBy);try{for(u.s();!(i=u.n()).done;){var o=i.value;t.wt.push(o),o.field.isKeyField()&&(a=!0)}}catch(c){u.e(c)}finally{u.f()}if(!a){var s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.wt.push(new Sn(xe.keyField(),s))}}}return t.wt}function cr(e){var t=Z(e);if(!t._t)if("F"===t.limitType)t._t=Hn(t.path,t.collectionGroup,sr(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],i=y(sr(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,u="desc"===a.dir?"asc":"desc";r.push(new Sn(a.field,u))}}catch(c){i.e(c)}finally{i.f()}var o=t.endAt?new In(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new In(t.startAt.position,t.startAt.inclusive):null;t._t=Hn(t.path,t.collectionGroup,r,t.filters,t.limit,o,s)}return t._t}function lr(e,t){t.getFirstInequalityField(),ur(e);var n=e.filters.concat([t]);return new tr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function fr(e,t,n){return new tr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function hr(e,t){return Xn(cr(e),cr(t))&&e.limitType===t.limitType}function dr(e){return"".concat(Yn(cr(e)),"|lt:").concat(e.limitType)}function vr(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(function(e){return Vn(e)}).join(", "),"]")),Je(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)}).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(function(e){return an(e)}).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(function(e){return an(e)}).join(",")),"Target(".concat(t,")")}(cr(e)),"; limitType=").concat(e.limitType,")")}function pr(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):be.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=y(sr(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=y(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){var r=En(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,sr(e),t))&&!(e.endAt&&!function(e,t,n){var r=En(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,sr(e),t))}(e,t)}function yr(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function mr(e){return function(t,n){var r,i=!1,a=y(sr(e));try{for(a.s();!(r=a.n()).done;){var u=r.value,o=gr(u,t,n);if(0!==o)return o;i=i||u.field.isKeyField()}}catch(s){a.e(s)}finally{a.f()}return 0}}function gr(e,t,n){var r=e.field.isKeyField()?be.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?nn(r,i):Y()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Y()}}var kr=function(){function e(t,n){L(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}return O(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var a=c(r.value,2),u=a[0],o=a[1];if(this.equalsFn(u,e))return o}}catch(s){i.e(s)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function(e){At(this.inner,function(t,n){var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var a=c(r.value,2),u=a[0],o=a[1];e(u,o)}}catch(s){i.e(s)}finally{i.f()}})}},{key:"isEmpty",value:function(){return Nt(this.inner)}},{key:"size",value:function(){return this.innerSize}}]),e}(),wr=new Ft(be.comparator);function xr(){return wr}var br=new Ft(be.comparator);function Ir(){for(var e=br,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=e.insert(u.key,u)}return e}function Er(e){var t=br;return e.forEach(function(e,n){return t=t.insert(e,n.overlayedDocument)}),t}function Tr(){return _r()}function Sr(){return _r()}function _r(){return new kr(function(e){return e.toString()},function(e,t){return e.isEqual(t)})}var Dr=new Ft(be.comparator),Cr=new Mt(be.comparator);function Ar(){for(var e=Cr,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=e.add(u)}return e}var Nr=new Mt(de);function Fr(){return Nr}function Rr(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ze(t)?"-0":t}}function Lr(e){return{integerValue:""+e}}function Mr(e,t){return $e(t)?Lr(t):Rr(e,t)}var Or=O(function e(){L(this,e),this._=void 0});function Pr(e,t,n){return e instanceof Br?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Qt(t)&&(t=Wt(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Ur?zr(e,t):e instanceof Gr?Kr(e,t):function(e,t){var n=qr(e,t),r=Qr(n)+Qr(e.gt);return cn(n)&&cn(e.gt)?Lr(r):Rr(e.serializer,r)}(e,t)}function Vr(e,t,n){return e instanceof Ur?zr(e,t):e instanceof Gr?Kr(e,t):n}function qr(e,t){return e instanceof jr?cn(n=t)||n&&"doubleValue"in n?t:{integerValue:0}:null;var n}var Br=function(e){w(n,Or);var t=b(n);function n(){return L(this,n),t.apply(this,arguments)}return O(n)}(),Ur=function(e){w(n,Or);var t=b(n);function n(e){var r;return L(this,n),(r=t.call(this)).elements=e,r}return O(n)}();function zr(e,t){var n,r=Wr(t),i=y(e.elements);try{var a=function(){var e=n.value;r.some(function(t){return en(t,e)})||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var Gr=function(e){w(n,Or);var t=b(n);function n(e){var r;return L(this,n),(r=t.call(this)).elements=e,r}return O(n)}();function Kr(e,t){var n,r=Wr(t),i=y(e.elements);try{var a=function(){var e=n.value;r=r.filter(function(t){return!en(t,e)})};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var jr=function(e){w(n,Or);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).serializer=e,i.gt=r,i}return O(n)}();function Qr(e){return Kt(e.integerValue||e.doubleValue)}function Wr(e){return ln(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Hr=O(function e(t,n){L(this,e),this.field=t,this.transform=n});function Yr(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Ur&&t instanceof Ur||e instanceof Gr&&t instanceof Gr?ve(e.elements,t.elements,en):e instanceof jr&&t instanceof jr?en(e.gt,t.gt):e instanceof Br&&t instanceof Br}(e.transform,t.transform)}var Xr=O(function e(t,n){L(this,e),this.version=t,this.transformResults=n}),Jr=function(){function e(t,n){L(this,e),this.updateTime=t,this.exists=n}return O(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function Zr(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var $r=O(function e(){L(this,e)});function ei(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new hi(e.key,Jr.none()):new ai(e.key,e.data,Jr.none());var n,r=e.data,i=wn.empty(),a=new Mt(xe.comparator),u=y(t.fields);try{for(u.s();!(n=u.n()).done;){var o=n.value;if(!a.has(o)){var s=r.field(o);null===s&&o.length>1&&(o=o.popLast(),s=r.field(o)),null===s?i.delete(o):i.set(o,s),a=a.add(o)}}}catch(c){u.e(c)}finally{u.f()}return new ui(e.key,i,new Vt(a.toArray()),Jr.none())}function ti(e,t,n){e instanceof ai?function(e,t,n){var r=e.value.clone(),i=si(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof ui?function(e,t,n){if(Zr(e.precondition,t)){var r=si(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(oi(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ni(e,t,n,r){return e instanceof ai?function(e,t,n,r){if(!Zr(e.precondition,t))return n;var i=e.value.clone(),a=ci(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof ui?function(e,t,n,r){if(!Zr(e.precondition,t))return n;var i=ci(e.fieldTransforms,r,t),a=t.data;return a.setAll(oi(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(function(e){return e.field}))}(e,t,n,r):function(e,t,n){return Zr(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function ri(e,t){var n,r=null,i=y(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.field),o=qr(a.transform,u||null);null!=o&&(null===r&&(r=wn.empty()),r.set(a.field,o))}}catch(s){i.e(s)}finally{i.f()}return r||null}function ii(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ve(e,t,function(e,t){return Yr(e,t)})}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var ai=function(e){w(n,$r);var t=b(n);function n(e,r,i){var a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return L(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=u,a.type=0,a}return O(n,[{key:"getFieldMask",value:function(){return null}}]),n}(),ui=function(e){w(n,$r);var t=b(n);function n(e,r,i,a){var u,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return L(this,n),(u=t.call(this)).key=e,u.data=r,u.fieldMask=i,u.precondition=a,u.fieldTransforms=o,u.type=1,u}return O(n,[{key:"getFieldMask",value:function(){return this.fieldMask}}]),n}();function oi(e){var t=new Map;return e.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}}),t}function si(e,t,n){var r=new Map;X(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],u=a.transform,o=t.data.field(a.field);r.set(a.field,Vr(u,o,n[i]))}return r}function ci(e,t,n){var r,i=new Map,a=y(e);try{for(a.s();!(r=a.n()).done;){var u=r.value,o=u.transform,s=n.data.field(u.field);i.set(u.field,Pr(o,s,t))}}catch(c){a.e(c)}finally{a.f()}return i}var li,fi,hi=function(e){w(n,$r);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return O(n,[{key:"getFieldMask",value:function(){return null}}]),n}(),di=function(e){w(n,$r);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return O(n,[{key:"getFieldMask",value:function(){return null}}]),n}(),vi=function(){function e(t,n,r,i){L(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return O(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&ti(i,e,n[r])}}},{key:"applyToLocalView",value:function(e,t){var n,r=y(this.baseMutations);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.key.isEqual(e.key)&&(t=ni(i,e,t,this.localWriteTime))}}catch(s){r.e(s)}finally{r.f()}var a,u=y(this.mutations);try{for(u.s();!(a=u.n()).done;){var o=a.value;o.key.isEqual(e.key)&&(t=ni(o,e,t,this.localWriteTime))}}catch(s){u.e(s)}finally{u.f()}return t}},{key:"applyToLocalDocumentSet",value:function(e,t){var n=this,r=Sr();return this.mutations.forEach(function(i){var a=e.get(i.key),u=a.overlayedDocument,o=n.applyToLocalView(u,a.mutatedFields),s=ei(u,o=t.has(i.key)?null:o);null!==s&&r.set(i.key,s),u.isValidDocument()||u.convertToNoDocument(me.min())}),r}},{key:"keys",value:function(){return this.mutations.reduce(function(e,t){return e.add(t.key)},Ar())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&ve(this.mutations,e.mutations,function(e,t){return ii(e,t)})&&ve(this.baseMutations,e.baseMutations,function(e,t){return ii(e,t)})}}]),e}(),pi=function(){function e(t,n,r,i){L(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return O(e,null,[{key:"from",value:function(t,n,r){X(t.mutations.length===r.length);for(var i=Dr,a=t.mutations,u=0;u<a.length;u++)i=i.insert(a[u].key,r[u].version);return new e(t,n,r,i)}}]),e}(),yi=function(){function e(t,n){L(this,e),this.largestBatchId=t,this.mutation=n}return O(e,[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(e){return null!==e&&this.mutation===e.mutation}},{key:"toString",value:function(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]),e}(),mi=O(function e(t,n,r){L(this,e),this.alias=t,this.yt=n,this.fieldPath=r}),gi=O(function e(t,n){L(this,e),this.count=t,this.unchangedNames=n});function ki(e){switch(e){default:return Y();case $.CANCELLED:case $.UNKNOWN:case $.DEADLINE_EXCEEDED:case $.RESOURCE_EXHAUSTED:case $.INTERNAL:case $.UNAVAILABLE:case $.UNAUTHENTICATED:return!1;case $.INVALID_ARGUMENT:case $.NOT_FOUND:case $.ALREADY_EXISTS:case $.PERMISSION_DENIED:case $.FAILED_PRECONDITION:case $.ABORTED:case $.OUT_OF_RANGE:case $.UNIMPLEMENTED:case $.DATA_LOSS:return!0}}function wi(e){if(void 0===e)return Q("GRPC error has no .code"),$.UNKNOWN;switch(e){case li.OK:return $.OK;case li.CANCELLED:return $.CANCELLED;case li.UNKNOWN:return $.UNKNOWN;case li.DEADLINE_EXCEEDED:return $.DEADLINE_EXCEEDED;case li.RESOURCE_EXHAUSTED:return $.RESOURCE_EXHAUSTED;case li.INTERNAL:return $.INTERNAL;case li.UNAVAILABLE:return $.UNAVAILABLE;case li.UNAUTHENTICATED:return $.UNAUTHENTICATED;case li.INVALID_ARGUMENT:return $.INVALID_ARGUMENT;case li.NOT_FOUND:return $.NOT_FOUND;case li.ALREADY_EXISTS:return $.ALREADY_EXISTS;case li.PERMISSION_DENIED:return $.PERMISSION_DENIED;case li.FAILED_PRECONDITION:return $.FAILED_PRECONDITION;case li.ABORTED:return $.ABORTED;case li.OUT_OF_RANGE:return $.OUT_OF_RANGE;case li.UNIMPLEMENTED:return $.UNIMPLEMENTED;case li.DATA_LOSS:return $.DATA_LOSS;default:return Y()}}(fi=li||(li={}))[fi.OK=0]="OK",fi[fi.CANCELLED=1]="CANCELLED",fi[fi.UNKNOWN=2]="UNKNOWN",fi[fi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fi[fi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fi[fi.NOT_FOUND=5]="NOT_FOUND",fi[fi.ALREADY_EXISTS=6]="ALREADY_EXISTS",fi[fi.PERMISSION_DENIED=7]="PERMISSION_DENIED",fi[fi.UNAUTHENTICATED=16]="UNAUTHENTICATED",fi[fi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fi[fi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fi[fi.ABORTED=10]="ABORTED",fi[fi.OUT_OF_RANGE=11]="OUT_OF_RANGE",fi[fi.UNIMPLEMENTED=12]="UNIMPLEMENTED",fi[fi.INTERNAL=13]="INTERNAL",fi[fi.UNAVAILABLE=14]="UNAVAILABLE",fi[fi.DATA_LOSS=15]="DATA_LOSS";var xi=function(){function e(){L(this,e),this.onExistenceFilterMismatchCallbacks=new Map}return O(e,[{key:"onExistenceFilterMismatch",value:function(e){var t=this,n=Symbol();return this.onExistenceFilterMismatchCallbacks.set(n,e),function(){return t.onExistenceFilterMismatchCallbacks.delete(n)}}},{key:"notifyOnExistenceFilterMismatch",value:function(e){this.onExistenceFilterMismatchCallbacks.forEach(function(t){return t(e)})}}],[{key:"instance",get:function(){return bi}},{key:"getOrCreateInstance",value:function(){return null===bi&&(bi=new e),bi}}]),e}();exports._TestingHooks=xi;var bi=null;function Ii(){return new TextEncoder}var Ei=new u.Integer([4294967295,4294967295],0);function Ti(e){var t=Ii().encode(e),n=new u.Md5;return n.update(t),new Uint8Array(n.digest())}function Si(e){var t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new u.Integer([n,r],0),new u.Integer([i,a],0)]}var _i=function(){function e(t,n,r){if(L(this,e),this.bitmap=t,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Di("Invalid padding: ".concat(n));if(r<0)throw new Di("Invalid hash count: ".concat(r));if(t.length>0&&0===this.hashCount)throw new Di("Invalid hash count: ".concat(r));if(0===t.length&&0!==n)throw new Di("Invalid padding when bitmap length is 0: ".concat(n));this.It=8*t.length-n,this.Tt=u.Integer.fromNumber(this.It)}return O(e,[{key:"Et",value:function(e,t,n){var r=e.add(t.multiply(u.Integer.fromNumber(n)));return 1===r.compare(Ei)&&(r=new u.Integer([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}},{key:"At",value:function(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}},{key:"vt",value:function(e){if(0===this.It)return!1;for(var t=c(Si(Ti(e)),2),n=t[0],r=t[1],i=0;i<this.hashCount;i++){var a=this.Et(n,r,i);if(!this.At(a))return!1}return!0}},{key:"insert",value:function(e){if(0!==this.It)for(var t=c(Si(Ti(e)),2),n=t[0],r=t[1],i=0;i<this.hashCount;i++){var a=this.Et(n,r,i);this.Rt(a)}}},{key:"Rt",value:function(e){var t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}],[{key:"create",value:function(t,n,r){var i=t%8==0?0:8-t%8,a=new e(new Uint8Array(Math.ceil(t/8)),i,n);return r.forEach(function(e){return a.insert(e)}),a}}]),e}(),Di=function(e){w(n,d(Error));var t=b(n);function n(){var e;return L(this,n),(e=t.apply(this,arguments)).name="BloomFilterError",e}return O(n)}(),Ci=function(){function e(t,n,r,i,a){L(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return O(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n,r){var i=new Map;return i.set(t,Ai.createSynthesizedTargetChangeForCurrentChange(t,n,r)),new e(me.min(),i,new Ft(de),xr(),Ar())}}]),e}(),Ai=function(){function e(t,n,r,i,a){L(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return O(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n,r){return new e(r,n,Ar(),Ar(),Ar())}}]),e}(),Ni=O(function e(t,n,r,i){L(this,e),this.Pt=t,this.removedTargetIds=n,this.key=r,this.bt=i}),Fi=O(function e(t,n){L(this,e),this.targetId=t,this.Vt=n}),Ri=O(function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ut.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;L(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i}),Li=function(){function e(){L(this,e),this.St=0,this.Dt=Pi(),this.Ct=Ut.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}return O(e,[{key:"current",get:function(){return this.xt}},{key:"resumeToken",get:function(){return this.Ct}},{key:"kt",get:function(){return 0!==this.St}},{key:"Mt",get:function(){return this.Nt}},{key:"$t",value:function(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}},{key:"Ot",value:function(){var e=Ar(),t=Ar(),n=Ar();return this.Dt.forEach(function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Y()}}),new Ai(this.Ct,this.xt,e,t,n)}},{key:"Ft",value:function(){this.Nt=!1,this.Dt=Pi()}},{key:"Bt",value:function(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}},{key:"Lt",value:function(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}},{key:"qt",value:function(){this.St+=1}},{key:"Ut",value:function(){this.St-=1}},{key:"Kt",value:function(){this.Nt=!0,this.xt=!0}}]),e}(),Mi=function(){function e(t){L(this,e),this.Gt=t,this.Qt=new Map,this.jt=xr(),this.zt=Oi(),this.Wt=new Ft(de)}return O(e,[{key:"Ht",value:function(e){var t,n=y(e.Pt);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.bt&&e.bt.isFoundDocument()?this.Jt(r,e.bt):this.Yt(r,e.key,e.bt)}}catch(o){n.e(o)}finally{n.f()}var i,a=y(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var u=i.value;this.Yt(u,e.key,e.bt)}}catch(o){a.e(o)}finally{a.f()}}},{key:"Xt",value:function(e){var t=this;this.forEachTarget(e,function(n){var r=t.Zt(n);switch(e.state){case 0:t.te(n)&&r.$t(e.resumeToken);break;case 1:r.Ut(),r.kt||r.Ft(),r.$t(e.resumeToken);break;case 2:r.Ut(),r.kt||t.removeTarget(n);break;case 3:t.te(n)&&(r.Kt(),r.$t(e.resumeToken));break;case 4:t.te(n)&&(t.ee(n),r.$t(e.resumeToken));break;default:Y()}})}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach(function(e,r){n.te(r)&&t(r)})}},{key:"ne",value:function(e){var t,n=e.targetId,r=e.Vt.count,i=this.se(n);if(i){var a=i.target;if(Jn(a))if(0===r){var u=new be(a.path);this.Yt(n,u,bn.newNoDocument(u,me.min()))}else X(1===r);else{var o=this.ie(n);if(o!==r){var s=this.re(e,o);if(0!==s){this.ee(n);var c=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,c)}null===(t=xi.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n){var r,i,a,u,o,s,c={localCacheCount:t,existenceFilterCount:n.count},l=n.unchangedNames;return l&&(c.bloomFilter={applied:0===e,hashCount:null!==(r=null==l?void 0:l.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(u=null===(a=null===(i=null==l?void 0:l.bits)||void 0===i?void 0:i.bitmap)||void 0===a?void 0:a.length)&&void 0!==u?u:0,padding:null!==(s=null===(o=null==l?void 0:l.bits)||void 0===o?void 0:o.padding)&&void 0!==s?s:0}),c}(s,o,e.Vt))}}}}},{key:"re",value:function(e,t){var n=e.Vt,r=n.unchangedNames,i=n.count;if(!r||!r.bits)return 1;var a,u,o=r.bits,s=o.bitmap,c=void 0===s?"":s,l=o.padding,f=void 0===l?0:l,h=r.hashCount,d=void 0===h?0:h;try{a=jt(c).toUint8Array()}catch(e){if(e instanceof qt)return W("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{u=new _i(a,f,d)}catch(e){return W(e instanceof Di?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===u.It?1:i!==t-this.oe(e.targetId,u)?2:0}},{key:"oe",value:function(e,t){var n=this,r=this.Gt.getRemoteKeysForTarget(e),i=0;return r.forEach(function(r){var a=n.Gt.ue(),u="projects/".concat(a.projectId,"/databases/").concat(a.database,"/documents/").concat(r.path.canonicalString());t.vt(u)||(n.Yt(e,r,null),i++)}),i}},{key:"ce",value:function(e){var t=this,n=new Map;this.Qt.forEach(function(r,i){var a=t.se(i);if(a){if(r.current&&Jn(a.target)){var u=new be(a.target.path);null!==t.jt.get(u)||t.ae(i,u)||t.Yt(i,u,bn.newNoDocument(u,e))}r.Mt&&(n.set(i,r.Ot()),r.Ft())}});var r=Ar();this.zt.forEach(function(e,n){var i=!0;n.forEachWhile(function(e){var n=t.se(e);return!n||"TargetPurposeLimboResolution"===n.purpose||(i=!1,!1)}),i&&(r=r.add(e))}),this.jt.forEach(function(t,n){return n.setReadTime(e)});var i=new Ci(e,n,this.Wt,this.jt,r);return this.jt=xr(),this.zt=Oi(),this.Wt=new Ft(de),i}},{key:"Jt",value:function(e,t){if(this.te(e)){var n=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}}},{key:"Yt",value:function(e,t,n){if(this.te(e)){var r=this.Zt(e);this.ae(e,t)?r.Bt(t,1):r.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}}},{key:"removeTarget",value:function(e){this.Qt.delete(e)}},{key:"ie",value:function(e){var t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"qt",value:function(e){this.Zt(e).qt()}},{key:"Zt",value:function(e){var t=this.Qt.get(e);return t||(t=new Li,this.Qt.set(e,t)),t}},{key:"he",value:function(e){var t=this.zt.get(e);return t||(t=new Mt(de),this.zt=this.zt.insert(e,t)),t}},{key:"te",value:function(e){var t=null!==this.se(e);return t||j("WatchChangeAggregator","Detected inactive target",e),t}},{key:"se",value:function(e){var t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}},{key:"ee",value:function(e){var t=this;this.Qt.set(e,new Li),this.Gt.getRemoteKeysForTarget(e).forEach(function(n){t.Yt(e,n,null)})}},{key:"ae",value:function(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}]),e}();function Oi(){return new Ft(be.comparator)}function Pi(){return new Ft(be.comparator)}var Vi={asc:"ASCENDING",desc:"DESCENDING"},qi={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Bi={and:"AND",or:"OR"},Ui=O(function e(t,n){L(this,e),this.databaseId=t,this.useProto3Json=n});function zi(e,t){return e.useProto3Json||Je(t)?t:{value:t}}function Gi(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ki(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function ji(e,t){return Gi(e,t.toTimestamp())}function Qi(e){return X(!!e),me.fromTimestamp(function(e){var t=Gt(e);return new ye(t.seconds,t.nanos)}(e))}function Wi(e,t){return function(e){return new ke(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Hi(e){var t=ke.fromString(e);return X(wa(t)),t}function Yi(e,t){return Wi(e.databaseId,t.path)}function Xi(e,t){var n=Hi(t);if(n.get(1)!==e.databaseId.projectId)throw new ee($.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new ee($.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new be(ea(n))}function Ji(e,t){return Wi(e.databaseId,t)}function Zi(e){var t=Hi(e);return 4===t.length?ke.emptyPath():ea(t)}function $i(e){return new ke(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ea(e){return X(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function ta(e,t,n){return{name:Yi(e,t),fields:n.value.mapValue.fields}}function na(e,t,n){var r=Xi(e,t.name),i=Qi(t.updateTime),a=t.createTime?Qi(t.createTime):me.min(),u=new wn({mapValue:{fields:t.fields}}),o=bn.newFoundDocument(r,i,a,u);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function ra(e,t){return"found"in t?function(e,t){X(!!t.found),t.found.name,t.found.updateTime;var n=Xi(e,t.found.name),r=Qi(t.found.updateTime),i=t.found.createTime?Qi(t.found.createTime):me.min(),a=new wn({mapValue:{fields:t.found.fields}});return bn.newFoundDocument(n,r,i,a)}(e,t):"missing"in t?function(e,t){X(!!t.missing),X(!!t.readTime);var n=Xi(e,t.missing),r=Qi(t.readTime);return bn.newNoDocument(n,r)}(e,t):Y()}function ia(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Y()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.useProto3Json?(X(void 0===t||"string"==typeof t),Ut.fromBase64String(t||"")):(X(void 0===t||t instanceof Uint8Array),Ut.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),u=t.targetChange.cause,o=u&&function(e){var t=void 0===e.code?$.UNKNOWN:wi(e.code);return new ee(t,e.message||"")}(u);n=new Ri(r,i,a,o||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var c=Xi(e,s.document.name),l=Qi(s.document.updateTime),f=s.document.createTime?Qi(s.document.createTime):me.min(),h=new wn({mapValue:{fields:s.document.fields}}),d=bn.newFoundDocument(c,l,f,h),v=s.targetIds||[],p=s.removedTargetIds||[];n=new Ni(v,p,d.key,d)}else if("documentDelete"in t){t.documentDelete;var y=t.documentDelete;y.document;var m=Xi(e,y.document),g=y.readTime?Qi(y.readTime):me.min(),k=bn.newNoDocument(m,g),w=y.removedTargetIds||[];n=new Ni([],w,k.key,k)}else if("documentRemove"in t){t.documentRemove;var x=t.documentRemove;x.document;var b=Xi(e,x.document),I=x.removedTargetIds||[];n=new Ni([],I,b,null)}else{if(!("filter"in t))return Y();t.filter;var E=t.filter;E.targetId;var T=E.count,S=void 0===T?0:T,_=E.unchangedNames,D=new gi(S,_),C=E.targetId;n=new Fi(C,D)}return n}function aa(e,t){var n;if(t instanceof ai)n={update:ta(e,t.key,t.value)};else if(t instanceof hi)n={delete:Yi(e,t.key)};else if(t instanceof ui)n={update:ta(e,t.key,t.data),updateMask:ka(t.fieldMask)};else{if(!(t instanceof di))return Y();n={verify:Yi(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(function(e){return function(e,t){var n=t.transform;if(n instanceof Br)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ur)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Gr)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof jr)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw Y()}(0,e)})),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:ji(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Y()}(e,t.precondition)),n}function ua(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?Jr.updateTime(Qi(e.updateTime)):void 0!==e.exists?Jr.exists(e.exists):Jr.none()}(t.currentDocument):Jr.none(),r=t.updateTransforms?t.updateTransforms.map(function(t){return function(e,t){var n=null;if("setToServerValue"in t)X("REQUEST_TIME"===t.setToServerValue),n=new Br;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new Ur(r)}else if("removeAllFromArray"in t){var i=t.removeAllFromArray.values||[];n=new Gr(i)}else"increment"in t?n=new jr(e,t.increment):Y();var a=xe.fromServerFormat(t.fieldPath);return new Hr(a,n)}(e,t)}):[];if(t.update){t.update.name;var i=Xi(e,t.update.name),a=new wn({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=function(e){var t=e.fieldPaths||[];return new Vt(t.map(function(e){return xe.fromServerFormat(e)}))}(t.updateMask);return new ui(i,a,u,n,r)}return new ai(i,a,n,r)}if(t.delete){var o=Xi(e,t.delete);return new hi(o,n)}if(t.verify){var s=Xi(e,t.verify);return new di(s,n)}return Y()}function oa(e,t){return e&&e.length>0?(X(void 0!==t),e.map(function(e){return function(e,t){var n=e.updateTime?Qi(e.updateTime):Qi(t);return n.isEqual(me.min())&&(n=Qi(t)),new Xr(n,e.transformResults||[])}(e,t)})):[]}function sa(e,t){return{documents:[Ji(e,t.path)]}}function ca(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Ji(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Ji(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length)return ga(An.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map(function(e){return function(e){return{field:ya(e.field),direction:da(e.dir)}}(e)})}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var u,o=zi(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(u=t.startAt).inclusive,values:u.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function la(e){var t=Zi(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){X(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var u=[];n.where&&(u=function(e){var t=ha(n.where);return t instanceof An&&Rn(t)?t.getFilters():[t]}());var o=[];n.orderBy&&(o=n.orderBy.map(function(e){return function(e){return new Sn(ma(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)}));var s=null;n.limit&&(s=function(e){var t;return Je(t="object"==R(e)?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=function(e){var t=!!e.before,n=e.values||[];return new In(n,t)}(n.startAt));var l=null;return n.endAt&&(l=function(e){var t=!e.before,n=e.values||[];return new In(n,t)}(n.endAt)),nr(t,i,o,u,s,"F",c,l)}function fa(e,t){var n=function(e){switch(t.purpose){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Y()}}();return null==n?null:{"goog-listen-tags":n}}function ha(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=ma(e.unaryFilter.field);return Cn.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=ma(e.unaryFilter.field);return Cn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ma(e.unaryFilter.field);return Cn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ma(e.unaryFilter.field);return Cn.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Y()}}(e):void 0!==e.fieldFilter?function(e){return Cn.create(ma(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Y()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return An.create(e.compositeFilter.filters.map(function(e){return ha(e)}),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Y()}}(e.compositeFilter.op))}(e):Y()}function da(e){return Vi[e]}function va(e){return qi[e]}function pa(e){return Bi[e]}function ya(e){return{fieldPath:e.canonicalString()}}function ma(e){return xe.fromServerFormat(e.fieldPath)}function ga(e){return e instanceof Cn?function(e){if("=="===e.op){if(hn(e.value))return{unaryFilter:{field:ya(e.field),op:"IS_NAN"}};if(fn(e.value))return{unaryFilter:{field:ya(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(hn(e.value))return{unaryFilter:{field:ya(e.field),op:"IS_NOT_NAN"}};if(fn(e.value))return{unaryFilter:{field:ya(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ya(e.field),op:va(e.op),value:e.value}}}(e):e instanceof An?function(e){var t=e.getFilters().map(function(e){return ga(e)});return 1===t.length?t[0]:{compositeFilter:{op:pa(e.op),filters:t}}}(e):Y()}function ka(e){var t=[];return e.fields.forEach(function(e){return t.push(e.canonicalString())}),{fieldPaths:t}}function wa(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}var xa=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:me.min(),u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:me.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ut.EMPTY_BYTE_STRING,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;L(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=o,this.expectedCount=s}return O(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t,null)}},{key:"withExpectedCount",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}]),e}(),ba=O(function e(t){L(this,e),this.fe=t});function Ia(e,t){var n;if(t.document)n=na(e.fe,t.document,!!t.hasCommittedMutations);else if(t.noDocument){var r=be.fromSegments(t.noDocument.path),i=_a(t.noDocument.readTime);n=bn.newNoDocument(r,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Y();var a=be.fromSegments(t.unknownDocument.path),u=_a(t.unknownDocument.version);n=bn.newUnknownDocument(a,u)}return t.readTime&&n.setReadTime(function(e){var t=new ye(e[0],e[1]);return me.fromTimestamp(t)}(t.readTime)),n}function Ea(e,t){var n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Ta(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Yi(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Gi(e,t.version.toTimestamp()),createTime:Gi(e,t.createTime.toTimestamp())}}(e.fe,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Sa(t.version)};else{if(!t.isUnknownDocument())return Y();r.unknownDocument={path:n.path.toArray(),version:Sa(t.version)}}return r}function Ta(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Sa(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function _a(e){var t=new ye(e.seconds,e.nanoseconds);return me.fromTimestamp(t)}function Da(e,t){for(var n=(t.baseMutations||[]).map(function(t){return ua(e.fe,t)}),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){var a=t.mutations[r+1];i.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var u=t.mutations.map(function(t){return ua(e.fe,t)}),o=ye.fromMillis(t.localWriteTimeMs);return new vi(t.batchId,o,n,u)}function Ca(e){var t,n,r=_a(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?_a(e.lastLimboFreeSnapshotVersion):me.min();return void 0!==e.query.documents?(X(1===(n=e.query).documents.length),t=cr(rr(Zi(n.documents[0])))):t=function(e){return cr(la(e))}(e.query),new xa(t,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,i,Ut.fromBase64String(e.resumeToken))}function Aa(e,t){var n,r=Sa(t.snapshotVersion),i=Sa(t.lastLimboFreeSnapshotVersion);n=Jn(t.target)?sa(e.fe,t.target):ca(e.fe,t.target);var a=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Yn(t.target),readTime:r,resumeToken:a,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function Na(e){var t=la({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?fr(t,t.limit,"L"):t}function Fa(e,t){return new yi(t.largestBatchId,ua(e.fe,t.overlayMutation))}function Ra(e,t){var n=t.path.lastSegment();return[e,et(t.path.popLast()),n]}function La(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Sa(r.readTime),documentKey:et(r.documentKey.path),largestBatchId:r.largestBatchId}}var Ma=function(){function e(){L(this,e)}return O(e,[{key:"getBundleMetadata",value:function(e,t){return Oa(e).get(t).next(function(e){if(e)return{id:(t=e).bundleId,createTime:_a(t.createTime),version:t.version};var t})}},{key:"saveBundleMetadata",value:function(e,t){return Oa(e).put({bundleId:(n=t).id,createTime:Sa(Qi(n.createTime)),version:n.version});var n}},{key:"getNamedQuery",value:function(e,t){return Pa(e).get(t).next(function(e){if(e)return{name:(t=e).name,query:Na(t.bundledQuery),readTime:_a(t.readTime)};var t})}},{key:"saveNamedQuery",value:function(e,t){return Pa(e).put(function(e){return{name:e.name,readTime:Sa(Qi(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]),e}();function Oa(e){return Dt(e,"bundles")}function Pa(e){return Dt(e,"namedQueries")}var Va=function(){function e(t,n){L(this,e),this.serializer=t,this.userId=n}return O(e,[{key:"getOverlay",value:function(e,t){var n=this;return qa(e).get(Ra(this.userId,t)).next(function(e){return e?Fa(n.serializer,e):null})}},{key:"getOverlays",value:function(e,t){var n=this,r=Tr();return Ve.forEach(t,function(t){return n.getOverlay(e,t).next(function(e){null!==e&&r.set(t,e)})}).next(function(){return r})}},{key:"saveOverlays",value:function(e,t,n){var r=this,i=[];return n.forEach(function(n,a){var u=new yi(t,a);i.push(r.we(e,u))}),Ve.waitFor(i)}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=new Set;t.forEach(function(e){return i.add(et(e.getCollectionPath()))});var a=[];return i.forEach(function(t){var i=IDBKeyRange.bound([r.userId,t,n],[r.userId,t,n+1],!1,!0);a.push(qa(e).J("collectionPathOverlayIndex",i))}),Ve.waitFor(a)}},{key:"getOverlaysForCollection",value:function(e,t,n){var r=this,i=Tr(),a=et(t),u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,Number.POSITIVE_INFINITY],!0);return qa(e).j("collectionPathOverlayIndex",u).next(function(e){var t,n=y(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,u=Fa(r.serializer,a);i.set(u.getKey(),u)}}catch(o){n.e(o)}finally{n.f()}return i})}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){var i,a=this,u=Tr(),o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return qa(e).X({index:"collectionGroupOverlayIndex",range:o},function(e,t,n){var o=Fa(a.serializer,t);u.size()<r||o.largestBatchId===i?(u.set(o.getKey(),o),i=o.largestBatchId):n.done()}).next(function(){return u})}},{key:"we",value:function(e,t){return qa(e).put(function(e,t,n){var r=c(Ra(t,n.mutation.key),3);r[0];return{userId:t,collectionPath:r[1],documentId:r[2],collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:aa(e.fe,n.mutation)}}(this.serializer,this.userId,t))}}],[{key:"de",value:function(t,n){return new e(t,n.uid||"")}}]),e}();function qa(e){return Dt(e,"documentOverlays")}var Ba=function(){function e(){L(this,e)}return O(e,[{key:"_e",value:function(e,t){this.me(e,t),t.ge()}},{key:"me",value:function(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(Kt(e.integerValue));else if("doubleValue"in e){var n=Kt(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),Ze(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){var r=e.timestampValue;this.ye(t,20),"string"==typeof r?t.Ie(r):(t.Ie("".concat(r.seconds||"")),t.pe(r.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(jt(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){var i=e.geoPointValue;this.ye(t,45),t.pe(i.latitude||0),t.pe(i.longitude||0)}else"mapValue"in e?pn(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):Y()}},{key:"Te",value:function(e,t){this.ye(t,25),this.be(e,t)}},{key:"be",value:function(e,t){t.Ie(e)}},{key:"Re",value:function(e,t){var n=e.fields||{};this.ye(t,55);for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];this.Te(a,t),this.me(n[a],t)}}},{key:"Pe",value:function(e,t){var n=e.values||[];this.ye(t,50);var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.me(a,t)}}catch(u){i.e(u)}finally{i.f()}}},{key:"ve",value:function(e,t){var n=this;this.ye(t,37),be.fromName(e).path.forEach(function(e){n.ye(t,60),n.be(e,t)})}},{key:"ye",value:function(e,t){e.pe(t)}},{key:"Ee",value:function(e){e.pe(2)}}]),e}();function Ua(e){if(0===e)return 8;var t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function za(e){var t=64-function(e){for(var t=0,n=0;n<8;++n){var r=Ua(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}Ba.Ve=new Ba;var Ga=function(){function e(){L(this,e),this.buffer=new Uint8Array(1024),this.position=0}return O(e,[{key:"Se",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.De(n.value),n=t.next();this.Ce()}},{key:"xe",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.Ne(n.value),n=t.next();this.ke()}},{key:"Me",value:function(e){var t,n=y(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.De(i);else if(i<2048)this.De(960|i>>>6),this.De(128|63&i);else if(r<"\ud800"||"\udbff"<r)this.De(480|i>>>12),this.De(128|63&i>>>6),this.De(128|63&i);else{var a=r.codePointAt(0);this.De(240|a>>>18),this.De(128|63&a>>>12),this.De(128|63&a>>>6),this.De(128|63&a)}}}catch(u){n.e(u)}finally{n.f()}this.Ce()}},{key:"$e",value:function(e){var t,n=y(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.Ne(i);else if(i<2048)this.Ne(960|i>>>6),this.Ne(128|63&i);else if(r<"\ud800"||"\udbff"<r)this.Ne(480|i>>>12),this.Ne(128|63&i>>>6),this.Ne(128|63&i);else{var a=r.codePointAt(0);this.Ne(240|a>>>18),this.Ne(128|63&a>>>12),this.Ne(128|63&a>>>6),this.Ne(128|63&a)}}}catch(u){n.e(u)}finally{n.f()}this.ke()}},{key:"Oe",value:function(e){var t=this.Fe(e),n=za(t);this.Be(1+n),this.buffer[this.position++]=255&n;for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}},{key:"Le",value:function(e){var t=this.Fe(e),n=za(t);this.Be(1+n),this.buffer[this.position++]=~(255&n);for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}},{key:"qe",value:function(){this.Ue(255),this.Ue(255)}},{key:"Ke",value:function(){this.Ge(255),this.Ge(255)}},{key:"reset",value:function(){this.position=0}},{key:"seed",value:function(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}},{key:"Qe",value:function(){return this.buffer.slice(0,this.position)}},{key:"Fe",value:function(e){var t=function(e){var t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(var r=1;r<t.length;++r)t[r]^=n?255:0;return t}},{key:"De",value:function(e){var t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}},{key:"Ne",value:function(e){var t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}},{key:"Ce",value:function(){this.Ue(0),this.Ue(1)}},{key:"ke",value:function(){this.Ge(0),this.Ge(1)}},{key:"Ue",value:function(e){this.Be(1),this.buffer[this.position++]=e}},{key:"Ge",value:function(e){this.Be(1),this.buffer[this.position++]=~e}},{key:"Be",value:function(e){var t=e+this.position;if(!(t<=this.buffer.length)){var n=2*this.buffer.length;n<t&&(n=t);var r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}}]),e}(),Ka=function(){function e(t){L(this,e),this.je=t}return O(e,[{key:"Ae",value:function(e){this.je.Se(e)}},{key:"Ie",value:function(e){this.je.Me(e)}},{key:"pe",value:function(e){this.je.Oe(e)}},{key:"ge",value:function(){this.je.qe()}}]),e}(),ja=function(){function e(t){L(this,e),this.je=t}return O(e,[{key:"Ae",value:function(e){this.je.xe(e)}},{key:"Ie",value:function(e){this.je.$e(e)}},{key:"pe",value:function(e){this.je.Le(e)}},{key:"ge",value:function(){this.je.Ke()}}]),e}(),Qa=function(){function e(){L(this,e),this.je=new Ga,this.ze=new Ka(this.je),this.We=new ja(this.je)}return O(e,[{key:"seed",value:function(e){this.je.seed(e)}},{key:"He",value:function(e){return 0===e?this.ze:this.We}},{key:"Qe",value:function(){return this.je.Qe()}},{key:"reset",value:function(){this.je.reset()}}]),e}(),Wa=function(){function e(t,n,r,i){L(this,e),this.indexId=t,this.documentKey=n,this.arrayValue=r,this.directionalValue=i}return O(e,[{key:"Je",value:function(){var t=this.directionalValue.length,n=0===t||255===this.directionalValue[t-1]?t+1:t,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new e(this.indexId,this.documentKey,this.arrayValue,r)}}]),e}();function Ha(e,t){var n=e.indexId-t.indexId;return 0!==n?n:0!==(n=Ya(e.arrayValue,t.arrayValue))?n:0!==(n=Ya(e.directionalValue,t.directionalValue))?n:be.comparator(e.documentKey,t.documentKey)}function Ya(e,t){for(var n=0;n<e.length&&n<t.length;++n){var r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}var Xa=function(){function e(t){L(this,e),this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Ye=t.orderBy,this.Xe=[];var n,r=y(t.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.isInequality()?this.Ze=i:this.Xe.push(i)}}catch(a){r.e(a)}finally{r.f()}}return O(e,[{key:"tn",value:function(e){X(e.collectionGroup===this.collectionId);var t=Ee(e);if(void 0!==t&&!this.en(t))return!1;for(var n=Te(e),r=0,i=0;r<n.length&&this.en(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Ze){var a=n[r];if(!this.nn(this.Ze,a)||!this.sn(this.Ye[i++],a))return!1;++r}for(;r<n.length;++r){var u=n[r];if(i>=this.Ye.length||!this.sn(this.Ye[i++],u))return!1}return!0}},{key:"en",value:function(e){var t,n=y(this.Xe);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.nn(r,e))return!0}}catch(i){n.e(i)}finally{n.f()}return!1}},{key:"nn",value:function(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}},{key:"sn",value:function(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}]),e}();function Ja(e){var t,n;if(X(e instanceof Cn||e instanceof An),e instanceof Cn){if(e instanceof Kn){var r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map(function(t){return Cn.create(e.field,"==",t)}))||[];return An.create(r,"or")}return e}var i=e.filters.map(function(e){return Ja(e)});return An.create(i,e.op)}function Za(e){if(0===e.getFilters().length)return[];var t=nu(Ja(e));return X(tu(t)),$a(t)||eu(t)?[t]:t.getFilters()}function $a(e){return e instanceof Cn}function eu(e){return e instanceof An&&Rn(e)}function tu(e){return $a(e)||eu(e)||function(e){if(e instanceof An&&Fn(e)){var t,n=y(e.getFilters());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!$a(r)&&!eu(r))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}return!1}(e)}function nu(e){if(X(e instanceof Cn||e instanceof An),e instanceof Cn)return e;if(1===e.filters.length)return nu(e.filters[0]);var t=e.filters.map(function(e){return nu(e)}),n=An.create(t,e.op);return tu(n=au(n))?n:(X(n instanceof An),X(Nn(n)),X(n.filters.length>1),n.filters.reduce(function(e,t){return ru(e,t)}))}function ru(e,t){return X(e instanceof Cn||e instanceof An),X(t instanceof Cn||t instanceof An),au(e instanceof Cn?t instanceof Cn?function(e,t){return An.create([e,t],"and")}(e,t):iu(e,t):t instanceof Cn?iu(t,e):function(e,t){if(X(e.filters.length>0&&t.filters.length>0),Nn(e)&&Nn(t))return Pn(e,t.getFilters());var n=Fn(e)?e:t,r=Fn(e)?t:e,i=n.filters.map(function(e){return ru(e,r)});return An.create(i,"or")}(e,t))}function iu(e,t){if(Nn(t))return Pn(t,e.getFilters());var n=t.filters.map(function(t){return ru(e,t)});return An.create(n,"or")}function au(e){if(X(e instanceof Cn||e instanceof An),e instanceof Cn)return e;var t=e.getFilters();if(1===t.length)return au(t[0]);if(Ln(e))return e;var n=t.map(function(e){return au(e)}),r=[];return n.forEach(function(t){t instanceof Cn?r.push(t):t instanceof An&&(t.op===e.op?r.push.apply(r,_(t.filters)):r.push(t))}),1===r.length?r[0]:An.create(r,e.op)}var uu=function(){function e(){L(this,e),this.rn=new ou}return O(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.rn.add(t),Ve.resolve()}},{key:"getCollectionParents",value:function(e,t){return Ve.resolve(this.rn.getEntries(t))}},{key:"addFieldIndex",value:function(e,t){return Ve.resolve()}},{key:"deleteFieldIndex",value:function(e,t){return Ve.resolve()}},{key:"getDocumentsMatchingTarget",value:function(e,t){return Ve.resolve(null)}},{key:"getIndexType",value:function(e,t){return Ve.resolve(0)}},{key:"getFieldIndexes",value:function(e,t){return Ve.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(e){return Ve.resolve(null)}},{key:"getMinOffset",value:function(e,t){return Ve.resolve(Fe.min())}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return Ve.resolve(Fe.min())}},{key:"updateCollectionGroup",value:function(e,t,n){return Ve.resolve()}},{key:"updateIndexEntries",value:function(e,t){return Ve.resolve()}}]),e}(),ou=function(){function e(){L(this,e),this.index={}}return O(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Mt(ke.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new Mt(ke.comparator)).toArray()}}]),e}(),su=new Uint8Array(0),cu=function(){function e(t,n){L(this,e),this.user=t,this.databaseId=n,this.on=new ou,this.un=new kr(function(e){return Yn(e)},function(e,t){return Xn(e,t)}),this.uid=t.uid||""}return O(e,[{key:"addToCollectionParentIndex",value:function(e,t){var n=this;if(!this.on.has(t)){var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(function(){n.on.add(t)});var a={collectionId:r,parent:et(i)};return lu(e).put(a)}return Ve.resolve()}},{key:"getCollectionParents",value:function(e,t){var n=[],r=IDBKeyRange.bound([t,""],[pe(t),""],!1,!0);return lu(e).j(r).next(function(e){var r,i=y(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.collectionId!==t)break;n.push(rt(a.parent))}}catch(u){i.e(u)}finally{i.f()}return n})}},{key:"addFieldIndex",value:function(e,t){var n=this,r=hu(e),i=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(function(e){return[e.fieldPath.canonicalString(),e.kind]})}}(t);delete i.indexId;var a=r.add(i);if(t.indexState){var u=du(e);return a.next(function(e){u.put(La(e,n.user,t.indexState.sequenceNumber,t.indexState.offset))})}return a.next()}},{key:"deleteFieldIndex",value:function(e,t){var n=hu(e),r=du(e),i=fu(e);return n.delete(t.indexId).next(function(){return r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))}).next(function(){return i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))})}},{key:"getDocumentsMatchingTarget",value:function(e,t){var n=this,r=fu(e),i=!0,a=new Map;return Ve.forEach(this.cn(t),function(t){return n.an(e,t).next(function(e){i&&(i=!!e),a.set(t,e)})}).next(function(){if(i){var e=Ar(),u=[];return Ve.forEach(a,function(i,a){var o;j("IndexedDbIndexManager","Using index ".concat((o=i,"id=".concat(o.indexId,"|cg=").concat(o.collectionGroup,"|f=").concat(o.fields.map(function(e){return"".concat(e.fieldPath,":").concat(e.kind)}).join(",")))," to execute ").concat(Yn(t)));var s=function(e,t){var n=Ee(i);if(void 0===n)return null;var r,a=y(Zn(e,n.fieldPath));try{for(a.s();!(r=a.n()).done;){var u=r.value;switch(u.op){case"array-contains-any":return u.value.arrayValue.values||[];case"array-contains":return[u.value]}}}catch(o){a.e(o)}finally{a.f()}return null}(a),c=function(e,t){var n,r=new Map,i=y(Te(t));try{for(i.s();!(n=i.n()).done;){var a,u=n.value,o=y(Zn(e,u.fieldPath));try{for(o.s();!(a=o.n()).done;){var s=a.value;switch(s.op){case"==":case"in":r.set(u.fieldPath.canonicalString(),s.value);break;case"not-in":case"!=":return r.set(u.fieldPath.canonicalString(),s.value),Array.from(r.values())}}}catch(c){o.e(c)}finally{o.f()}}}catch(c){i.e(c)}finally{i.f()}return null}(a,i),l=function(e,t){var n,r=[],a=!0,u=y(Te(i));try{for(u.s();!(n=u.n()).done;){var o=n.value,s=0===o.kind?$n(e,o.fieldPath,e.startAt):er(e,o.fieldPath,e.startAt);r.push(s.value),a&&(a=s.inclusive)}}catch(c){u.e(c)}finally{u.f()}return new In(r,a)}(a),f=function(e,t){var n,r=[],a=!0,u=y(Te(i));try{for(u.s();!(n=u.n()).done;){var o=n.value,s=0===o.kind?er(e,o.fieldPath,e.endAt):$n(e,o.fieldPath,e.endAt);r.push(s.value),a&&(a=s.inclusive)}}catch(c){u.e(c)}finally{u.f()}return new In(r,a)}(a),h=n.hn(i,a,l),d=n.hn(i,a,f),v=n.ln(i,a,c),p=n.fn(i.indexId,s,h,l.inclusive,d,f.inclusive,v);return Ve.forEach(p,function(n){return r.H(n,t.limit).next(function(t){t.forEach(function(t){var n=be.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),u.push(n))})})})}).next(function(){return u})}return Ve.resolve(null)})}},{key:"cn",value:function(e){var t=this.un.get(e);return t||(t=0===e.filters.length?[e]:Za(An.create(e.filters,"and")).map(function(t){return Hn(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)}),this.un.set(e,t),t)}},{key:"fn",value:function(e,t,n,r,i,a,u){for(var o=this,s=(null!=t?t.length:1)*Math.max(n.length,i.length),c=s/(null!=t?t.length:1),l=[],f=function(){var s=t?o.dn(t[h/c]):su,f=o.wn(e,s,n[h%c],r),d=o._n(e,s,i[h%c],a),v=u.map(function(t){return o.wn(e,s,t,!0)});l.push.apply(l,_(o.createRange(f,d,v)))},h=0;h<s;++h)f();return l}},{key:"wn",value:function(e,t,n,r){var i=new Wa(e,be.empty(),t,n);return r?i:i.Je()}},{key:"_n",value:function(e,t,n,r){var i=new Wa(e,be.empty(),t,n);return r?i.Je():i}},{key:"an",value:function(e,t){var n=new Xa(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(function(e){var t,r=null,i=y(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;n.tn(a)&&(!r||a.fields.length>r.fields.length)&&(r=a)}}catch(u){i.e(u)}finally{i.f()}return r})}},{key:"getIndexType",value:function(e,t){var n=this,r=2,i=this.cn(t);return Ve.forEach(i,function(t){return n.an(e,t).next(function(e){e?0!==r&&e.fields.length<function(e){var t,n=new Mt(xe.comparator),r=!1,i=y(e.filters);try{for(i.s();!(t=i.n()).done;){var a,u=y(t.value.getFlattenedFilters());try{for(u.s();!(a=u.n()).done;){var o=a.value;o.field.isKeyField()||("array-contains"===o.op||"array-contains-any"===o.op?r=!0:n=n.add(o.field))}}catch(f){u.e(f)}finally{u.f()}}}catch(f){i.e(f)}finally{i.f()}var s,c=y(e.orderBy);try{for(c.s();!(s=c.n()).done;){var l=s.value;l.field.isKeyField()||(n=n.add(l.field))}}catch(f){c.e(f)}finally{c.f()}return n.size+(r?1:0)}(t)&&(r=1):r=0})}).next(function(){return null!==t.limit&&i.length>1&&2===r?1:r})}},{key:"mn",value:function(e,t){var n,r=new Qa,i=y(Te(e));try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.fieldPath);if(null==u)return null;var o=r.He(a.kind);Ba.Ve._e(u,o)}}catch(s){i.e(s)}finally{i.f()}return r.Qe()}},{key:"dn",value:function(e){var t=new Qa;return Ba.Ve._e(e,t.He(0)),t.Qe()}},{key:"gn",value:function(e,t){var n=new Qa;return Ba.Ve._e(sn(this.databaseId,t),n.He(function(e){var t=Te(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Qe()}},{key:"ln",value:function(e,t,n){if(null===n)return[];var r=[];r.push(new Qa);var i,a=0,u=y(Te(e));try{for(u.s();!(i=u.n()).done;){var o,s=i.value,c=n[a++],l=y(r);try{for(l.s();!(o=l.n()).done;){var f=o.value;if(this.yn(t,s.fieldPath)&&ln(c))r=this.pn(r,s,c);else{var h=f.He(s.kind);Ba.Ve._e(c,h)}}}catch(d){l.e(d)}finally{l.f()}}}catch(d){u.e(d)}finally{u.f()}return this.In(r)}},{key:"hn",value:function(e,t,n){return this.ln(e,t,n.position)}},{key:"In",value:function(e){for(var t=[],n=0;n<e.length;++n)t[n]=e[n].Qe();return t}},{key:"pn",value:function(e,t,n){var r,i=_(e),a=[],u=y(n.arrayValue.values||[]);try{for(u.s();!(r=u.n()).done;){var o,s=r.value,c=y(i);try{for(c.s();!(o=c.n()).done;){var l=o.value,f=new Qa;f.seed(l.Qe()),Ba.Ve._e(s,f.He(t.kind)),a.push(f)}}catch(h){c.e(h)}finally{c.f()}}}catch(h){u.e(h)}finally{u.f()}return a}},{key:"yn",value:function(e,t){return!!e.filters.find(function(e){return e instanceof Cn&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)})}},{key:"getFieldIndexes",value:function(e,t){var n=this,r=hu(e),i=du(e);return(t?r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.j()).next(function(e){var t=[];return Ve.forEach(e,function(e){return i.get([e.indexId,n.uid]).next(function(n){t.push(function(e,t){var n=t?new Ce(t.sequenceNumber,new Fe(_a(t.readTime),new be(rt(t.documentKey)),t.largestBatchId)):Ce.empty(),r=e.fields.map(function(e){var t=c(e,2),n=t[0],r=t[1];return new _e(xe.fromServerFormat(n),r)});return new Ie(e.indexId,e.collectionGroup,r,n)}(e,n))})}).next(function(){return t})})}},{key:"getNextCollectionGroupToUpdate",value:function(e){return this.getFieldIndexes(e).next(function(e){return 0===e.length?null:(e.sort(function(e,t){var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:de(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup)})}},{key:"updateCollectionGroup",value:function(e,t,n){var r=this,i=hu(e),a=du(e);return this.Tn(e).next(function(e){return i.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(function(t){return Ve.forEach(t,function(t){return a.put(La(t.indexId,r.user,e,n))})})})}},{key:"updateIndexEntries",value:function(e,t){var n=this,r=new Map;return Ve.forEach(t,function(t,i){var a=r.get(t.collectionGroup);return(a?Ve.resolve(a):n.getFieldIndexes(e,t.collectionGroup)).next(function(a){return r.set(t.collectionGroup,a),Ve.forEach(a,function(r){return n.En(e,t,r).next(function(t){var a=n.An(i,r);return t.isEqual(a)?Ve.resolve():n.vn(e,i,r,t,a)})})})})}},{key:"Rn",value:function(e,t,n,r){return fu(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.gn(n,t.key),documentKey:t.key.path.toArray()})}},{key:"Pn",value:function(e,t,n,r){return fu(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.gn(n,t.key),t.key.path.toArray()])}},{key:"En",value:function(e,t,n){var r=fu(e),i=new Mt(Ha);return r.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,t)])},function(e,r){i=i.add(new Wa(n.indexId,t,r.arrayValue,r.directionalValue))}).next(function(){return i})}},{key:"An",value:function(e,t){var n=new Mt(Ha),r=this.mn(t,e);if(null==r)return n;var i=Ee(t);if(null!=i){var a=e.data.field(i.fieldPath);if(ln(a)){var u,o=y(a.arrayValue.values||[]);try{for(o.s();!(u=o.n()).done;){var s=u.value;n=n.add(new Wa(t.indexId,e.key,this.dn(s),r))}}catch(c){o.e(c)}finally{o.f()}}}else n=n.add(new Wa(t.indexId,e.key,su,r));return n}},{key:"vn",value:function(e,t,n,r,i){var a=this;j("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);var u=[];return function(e,t,n,r,i){for(var a=e.getIterator(),u=t.getIterator(),o=Pt(a),s=Pt(u);o||s;){var c=!1,l=!1;if(o&&s){var f=n(o,s);f<0?l=!0:f>0&&(c=!0)}else null!=o?l=!0:c=!0;c?(r(s),s=Pt(u)):l?(i(o),o=Pt(a)):(o=Pt(a),s=Pt(u))}}(r,i,Ha,function(r){u.push(a.Rn(e,t,n,r))},function(r){u.push(a.Pn(e,t,n,r))}),Ve.waitFor(u)}},{key:"Tn",value:function(e){var t=1;return du(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},function(e,n,r){r.done(),t=n.sequenceNumber+1}).next(function(){return t})}},{key:"createRange",value:function(e,t,n){n=n.sort(function(e,t){return Ha(e,t)}).filter(function(e,t,n){return!t||0!==Ha(e,n[t-1])});var r=[];r.push(e);var i,a=y(n);try{for(a.s();!(i=a.n()).done;){var u=i.value,o=Ha(u,e),s=Ha(u,t);if(0===o)r[0]=e.Je();else if(o>0&&s<0)r.push(u),r.push(u.Je());else if(s>0)break}}catch(d){a.e(d)}finally{a.f()}r.push(t);for(var c=[],l=0;l<r.length;l+=2){if(this.bn(r[l],r[l+1]))return[];var f=[r[l].indexId,this.uid,r[l].arrayValue,r[l].directionalValue,su,[]],h=[r[l+1].indexId,this.uid,r[l+1].arrayValue,r[l+1].directionalValue,su,[]];c.push(IDBKeyRange.bound(f,h))}return c}},{key:"bn",value:function(e,t){return Ha(e,t)>0}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return this.getFieldIndexes(e,t).next(vu)}},{key:"getMinOffset",value:function(e,t){var n=this;return Ve.mapArray(this.cn(t),function(t){return n.an(e,t).next(function(e){return e||Y()})}).next(vu)}}]),e}();function lu(e){return Dt(e,"collectionParents")}function fu(e){return Dt(e,"indexEntries")}function hu(e){return Dt(e,"indexConfiguration")}function du(e){return Dt(e,"indexState")}function vu(e){X(0!==e.length);for(var t=e[0].indexState.offset,n=t.largestBatchId,r=1;r<e.length;r++){var i=e[r].indexState.offset;Re(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new Fe(t.readTime,t.documentKey,n)}var pu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},yu=function(){function e(t,n,r){L(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return O(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();function mu(e,t,n){var r=e.store("mutations"),i=e.store("documentMutations"),a=[],u=IDBKeyRange.only(n.batchId),o=0,s=r.X({range:u},function(e,t,n){return o++,n.delete()});a.push(s.next(function(){X(1===o)}));var c,l=[],f=y(n.mutations);try{for(f.s();!(c=f.n()).done;){var h=c.value,d=ut(t,h.key.path,n.batchId);a.push(i.delete(d)),l.push(h.key)}}catch(v){f.e(v)}finally{f.f()}return Ve.waitFor(a).next(function(){return l})}function gu(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Y();t=e.noDocument}return JSON.stringify(t).length}yu.DEFAULT_COLLECTION_PERCENTILE=10,yu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yu.DEFAULT=new yu(41943040,yu.DEFAULT_COLLECTION_PERCENTILE,yu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yu.DISABLED=new yu(-1,0,0);var ku=function(){function e(t,n,r,i){L(this,e),this.userId=t,this.serializer=n,this.indexManager=r,this.referenceDelegate=i,this.Vn={}}return O(e,[{key:"checkEmpty",value:function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return xu(e).X({index:"userMutationsIndex",range:n},function(e,n,r){t=!1,r.done()}).next(function(){return t})}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this,a=bu(e),u=xu(e);return u.add({}).next(function(o){X("number"==typeof o);var s,c=new vi(o,t,n,r),l=function(e,t,n){var r=n.baseMutations.map(function(t){return aa(e.fe,t)}),i=n.mutations.map(function(t){return aa(e.fe,t)});return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(i.serializer,i.userId,c),f=[],h=new Mt(function(e,t){return de(e.canonicalString(),t.canonicalString())}),d=y(r);try{for(d.s();!(s=d.n()).done;){var v=s.value,p=ut(i.userId,v.key.path,o);h=h.add(v.key.path.popLast()),f.push(u.put(l)),f.push(a.put(p,ot))}}catch(m){d.e(m)}finally{d.f()}return h.forEach(function(t){f.push(i.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(function(){i.Vn[o]=c.keys()}),Ve.waitFor(f).next(function(){return c})})}},{key:"lookupMutationBatch",value:function(e,t){var n=this;return xu(e).get(t).next(function(e){return e?(X(e.userId===n.userId),Da(n.serializer,e)):null})}},{key:"Sn",value:function(e,t){var n=this;return this.Vn[t]?Ve.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next(function(e){if(e){var r=e.keys();return n.Vn[t]=r,r}return null})}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this,r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),a=null;return xu(e).X({index:"userMutationsIndex",range:i},function(e,t,i){t.userId===n.userId&&(X(t.batchId>=r),a=Da(n.serializer,t)),i.done()}).next(function(){return a})}},{key:"getHighestUnacknowledgedBatchId",value:function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return xu(e).X({index:"userMutationsIndex",range:t,reverse:!0},function(e,t,r){n=t.batchId,r.done()}).next(function(){return n})}},{key:"getAllMutationBatches",value:function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return xu(e).j("userMutationsIndex",n).next(function(e){return e.map(function(e){return Da(t.serializer,e)})})}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=at(this.userId,t.path),i=IDBKeyRange.lowerBound(r),a=[];return bu(e).X({range:i},function(r,i,u){var o=c(r,3),s=o[0],l=o[1],f=o[2],h=rt(l);if(s===n.userId&&t.path.isEqual(h))return xu(e).get(f).next(function(e){if(!e)throw Y();X(e.userId===n.userId),a.push(Da(n.serializer,e))});u.done()}).next(function(){return a})}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Mt(de),i=[];return t.forEach(function(t){var a=at(n.userId,t.path),u=IDBKeyRange.lowerBound(a),o=bu(e).X({range:u},function(e,i,a){var u=c(e,3),o=u[0],s=u[1],l=u[2],f=rt(s);o===n.userId&&t.path.isEqual(f)?r=r.add(l):a.done()});i.push(o)}),Ve.waitFor(i).next(function(){return n.Dn(e,r)})}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=this,r=t.path,i=r.length+1,a=at(this.userId,r),u=IDBKeyRange.lowerBound(a),o=new Mt(de);return bu(e).X({range:u},function(e,t,a){var u=c(e,3),s=u[0],l=u[1],f=u[2],h=rt(l);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(o=o.add(f)):a.done()}).next(function(){return n.Dn(e,o)})}},{key:"Dn",value:function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(xu(e).get(t).next(function(e){if(null===e)throw Y();X(e.userId===n.userId),r.push(Da(n.serializer,e))}))}),Ve.waitFor(i).next(function(){return r})}},{key:"removeMutationBatch",value:function(e,t){var n=this;return mu(e.ht,this.userId,t).next(function(r){return e.addOnCommittedListener(function(){n.Cn(t.batchId)}),Ve.forEach(r,function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)})})}},{key:"Cn",value:function(e){delete this.Vn[e]}},{key:"performConsistencyCheck",value:function(e){var t=this;return this.checkEmpty(e).next(function(n){if(!n)return Ve.resolve();var r=IDBKeyRange.lowerBound([t.userId]),i=[];return bu(e).X({range:r},function(e,n,r){if(e[0]===t.userId){var a=rt(e[1]);i.push(a)}else r.done()}).next(function(){X(0===i.length)})})}},{key:"containsKey",value:function(e,t){return wu(e,this.userId,t)}},{key:"xn",value:function(e){var t=this;return Iu(e).get(this.userId).next(function(e){return e||{userId:t.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}})}}],[{key:"de",value:function(t,n,r,i){return X(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",n,r,i)}}]),e}();function wu(e,t,n){var r=at(t,n.path),i=r[1],a=IDBKeyRange.lowerBound(r),u=!1;return bu(e).X({range:a,Y:!0},function(e,n,r){var a=c(e,3),o=a[0],s=a[1];a[2];o===t&&s===i&&(u=!0),r.done()}).next(function(){return u})}function xu(e){return Dt(e,"mutations")}function bu(e){return Dt(e,"documentMutations")}function Iu(e){return Dt(e,"mutationQueues")}var Eu=function(){function e(t){L(this,e),this.Nn=t}return O(e,[{key:"next",value:function(){return this.Nn+=2,this.Nn}}],[{key:"kn",value:function(){return new e(0)}},{key:"Mn",value:function(){return new e(-1)}}]),e}(),Tu=function(){function e(t,n){L(this,e),this.referenceDelegate=t,this.serializer=n}return O(e,[{key:"allocateTargetId",value:function(e){var t=this;return this.$n(e).next(function(n){var r=new Eu(n.highestTargetId);return n.highestTargetId=r.next(),t.On(e,n).next(function(){return n.highestTargetId})})}},{key:"getLastRemoteSnapshotVersion",value:function(e){return this.$n(e).next(function(e){return me.fromTimestamp(new ye(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))})}},{key:"getHighestSequenceNumber",value:function(e){return this.$n(e).next(function(e){return e.highestListenSequenceNumber})}},{key:"setTargetsMetadata",value:function(e,t,n){var r=this;return this.$n(e).next(function(i){return i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),r.On(e,i)})}},{key:"addTargetData",value:function(e,t){var n=this;return this.Fn(e,t).next(function(){return n.$n(e).next(function(r){return r.targetCount+=1,n.Bn(t,r),n.On(e,r)})})}},{key:"updateTargetData",value:function(e,t){return this.Fn(e,t)}},{key:"removeTargetData",value:function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return Su(e).delete(t.targetId)}).next(function(){return n.$n(e)}).next(function(t){return X(t.targetCount>0),t.targetCount-=1,n.On(e,t)})}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return Su(e).X(function(u,o){var s=Ca(o);s.sequenceNumber<=t&&null===n.get(s.targetId)&&(i++,a.push(r.removeTargetData(e,s)))}).next(function(){return Ve.waitFor(a)}).next(function(){return i})}},{key:"forEachTarget",value:function(e,t){return Su(e).X(function(e,n){var r=Ca(n);t(r)})}},{key:"$n",value:function(e){return _u(e).get("targetGlobalKey").next(function(e){return X(null!==e),e})}},{key:"On",value:function(e,t){return _u(e).put("targetGlobalKey",t)}},{key:"Fn",value:function(e,t){return Su(e).put(Aa(this.serializer,t))}},{key:"Bn",value:function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:"getTargetCount",value:function(e){return this.$n(e).next(function(e){return e.targetCount})}},{key:"getTargetData",value:function(e,t){var n=Yn(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Su(e).X({range:r,index:"queryTargetsIndex"},function(e,n,r){var a=Ca(n);Xn(t,a.target)&&(i=a,r.done())}).next(function(){return i})}},{key:"addMatchingKeys",value:function(e,t,n){var r=this,i=[],a=Du(e);return t.forEach(function(t){var u=et(t.path);i.push(a.put({targetId:n,path:u})),i.push(r.referenceDelegate.addReference(e,n,t))}),Ve.waitFor(i)}},{key:"removeMatchingKeys",value:function(e,t,n){var r=this,i=Du(e);return Ve.forEach(t,function(t){var a=et(t.path);return Ve.waitFor([i.delete([n,a]),r.referenceDelegate.removeReference(e,n,t)])})}},{key:"removeMatchingKeysForTargetId",value:function(e,t){var n=Du(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Du(e),i=Ar();return r.X({range:n,Y:!0},function(e,t,n){var r=rt(e[1]),a=new be(r);i=i.add(a)}).next(function(){return i})}},{key:"containsKey",value:function(e,t){var n=et(t.path),r=IDBKeyRange.bound([n],[pe(n)],!1,!0),i=0;return Du(e).X({index:"documentTargetsIndex",Y:!0,range:r},function(e,t,n){var r=c(e,2),a=r[0];r[1];0!==a&&(i++,n.done())}).next(function(){return i>0})}},{key:"le",value:function(e,t){return Su(e).get(t).next(function(e){return e?Ca(e):null})}}]),e}();function Su(e){return Dt(e,"targets")}function _u(e){return Dt(e,"targetGlobal")}function Du(e){return Dt(e,"targetDocuments")}function Cu(e,t){var n=c(e,2),r=n[0],i=n[1],a=c(t,2),u=a[0],o=a[1],s=de(r,u);return 0===s?de(i,o):s}var Au=function(){function e(t){L(this,e),this.Ln=t,this.buffer=new Mt(Cu),this.qn=0}return O(e,[{key:"Un",value:function(){return++this.qn}},{key:"Kn",value:function(e){var t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();Cu(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}},{key:"maxValue",get:function(){return this.buffer.last()[0]}}]),e}(),Nu=function(){function e(t,n,r){L(this,e),this.garbageCollector=t,this.asyncQueue=n,this.localStore=r,this.Gn=null}return O(e,[{key:"start",value:function(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}},{key:"stop",value:function(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}},{key:"started",get:function(){return null!==this.Gn}},{key:"Qn",value:function(e){var t=this;j("LruGarbageCollector","Garbage collection scheduled in ".concat(e,"ms")),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.Gn=null,e.prev=1,e.next=4,t.localStore.collectGarbage(t.garbageCollector);case 4:e.next=14;break;case 6:if(e.prev=6,e.t0=e.catch(1),!Ge(e.t0)){e.next=12;break}j("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e.t0),e.next=14;break;case 12:return e.next=14,Oe(e.t0);case 14:return e.next=16,t.Qn(3e5);case 16:case"end":return e.stop()}},e,null,[[1,6]])})))}}]),e}(),Fu=function(){function e(t,n){L(this,e),this.jn=t,this.params=n}return O(e,[{key:"calculateTargetCount",value:function(e,t){return this.jn.zn(e).next(function(e){return Math.floor(t/100*e)})}},{key:"nthSequenceNumber",value:function(e,t){var n=this;if(0===t)return Ve.resolve(Xe.ct);var r=new Au(t);return this.jn.forEachTarget(e,function(e){return r.Kn(e.sequenceNumber)}).next(function(){return n.jn.Wn(e,function(e){return r.Kn(e)})}).next(function(){return r.maxValue})}},{key:"removeTargets",value:function(e,t,n){return this.jn.removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){return this.jn.removeOrphanedDocuments(e,t)}},{key:"collect",value:function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(j("LruGarbageCollector","Garbage collection skipped; disabled"),Ve.resolve(pu)):this.getCacheSize(e).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(j("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(r," is lower than threshold ").concat(n.params.cacheSizeCollectionThreshold)),pu):n.Hn(e,t)})}},{key:"getCacheSize",value:function(e){return this.jn.getCacheSize(e)}},{key:"Hn",value:function(e,t){var n,r,a,u,o,s,c,l=this,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return t>l.params.maximumSequenceNumbersToCollect?(j("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(l.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=l.params.maximumSequenceNumbersToCollect):r=t,u=Date.now(),l.nthSequenceNumber(e,r)}).next(function(r){return n=r,o=Date.now(),l.removeTargets(e,n,t)}).next(function(t){return a=t,s=Date.now(),l.removeOrphanedDocuments(e,n)}).next(function(e){return c=Date.now(),G()<=i.LogLevel.DEBUG&&j("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(u-f,"ms\n\tDetermined least recently used ").concat(r," in ")+(o-u)+"ms\n"+"\tRemoved ".concat(a," targets in ")+(s-o)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(c-s)+"ms\n"+"Total Duration: ".concat(c-f,"ms")),Ve.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:a,documentsRemoved:e})})}}]),e}();function Ru(e,t){return new Fu(e,t)}var Lu=function(){function e(t,n){L(this,e),this.db=t,this.garbageCollector=Ru(this,n)}return O(e,[{key:"zn",value:function(e){var t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next(function(e){return t.next(function(t){return e+t})})}},{key:"Jn",value:function(e){var t=0;return this.Wn(e,function(e){t++}).next(function(){return t})}},{key:"forEachTarget",value:function(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:"Wn",value:function(e,t){return this.Yn(e,function(e,n){return t(n)})}},{key:"addReference",value:function(e,t,n){return Mu(e,n)}},{key:"removeReference",value:function(e,t,n){return Mu(e,n)}},{key:"removeTargets",value:function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:"markPotentiallyOrphaned",value:function(e,t){return Mu(e,t)}},{key:"Xn",value:function(e,t){return function(e,t){var n=!1;return Iu(e).Z(function(r){return wu(e,r,t).next(function(e){return e&&(n=!0),Ve.resolve(!e)})}).next(function(){return n})}(e,t)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],a=0;return this.Yn(e,function(u,o){if(o<=t){var s=n.Xn(e,u).next(function(t){if(!t)return a++,r.getEntry(e,u).next(function(){return r.removeEntry(u,me.min()),Du(e).delete([0,et(u.path)])})});i.push(s)}}).next(function(){return Ve.waitFor(i)}).next(function(){return r.apply(e)}).next(function(){return a})}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:"updateLimboDocument",value:function(e,t){return Mu(e,t)}},{key:"Yn",value:function(e,t){var n,r=Du(e),i=Xe.ct;return r.X({index:"documentTargetsIndex"},function(e,r){var a=c(e,2),u=a[0],o=(a[1],r.path),s=r.sequenceNumber;0===u?(i!==Xe.ct&&t(new be(rt(n)),i),i=s,n=o):i=Xe.ct}).next(function(){i!==Xe.ct&&t(new be(rt(n)),i)})}},{key:"getCacheSize",value:function(e){return this.db.getRemoteDocumentCache().getSize(e)}}]),e}();function Mu(e,t){return Du(e).put(function(e,t){return{targetId:0,path:et(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}var Ou=function(){function e(){L(this,e),this.changes=new kr(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),this.changesApplied=!1}return O(e,[{key:"addEntry",value:function(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:"removeEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e,bn.newInvalidDocument(e).setReadTime(t))}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Ve.resolve(n):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),Pu=function(){function e(t){L(this,e),this.serializer=t}return O(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t,n){return Uu(e).put(n)}},{key:"removeEntry",value:function(e,t,n){return Uu(e).delete(function(e,t){var n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Ta(t),n[n.length-1]]}(t,n))}},{key:"updateMetadata",value:function(e,t){var n=this;return this.getMetadata(e).next(function(r){return r.byteSize+=t,n.Zn(e,r)})}},{key:"getEntry",value:function(e,t){var n=this,r=bn.newInvalidDocument(t);return Uu(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(zu(t))},function(e,i){r=n.ts(t,i)}).next(function(){return r})}},{key:"es",value:function(e,t){var n=this,r={size:0,document:bn.newInvalidDocument(t)};return Uu(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(zu(t))},function(e,i){r={document:n.ts(t,i),size:gu(i)}}).next(function(){return r})}},{key:"getEntries",value:function(e,t){var n=this,r=xr();return this.ns(e,t,function(e,t){var i=n.ts(e,t);r=r.insert(e,i)}).next(function(){return r})}},{key:"ss",value:function(e,t){var n=this,r=xr(),i=new Ft(be.comparator);return this.ns(e,t,function(e,t){var a=n.ts(e,t);r=r.insert(e,a),i=i.insert(e,gu(t))}).next(function(){return{documents:r,rs:i}})}},{key:"ns",value:function(e,t,n){if(t.isEmpty())return Ve.resolve();var r=new Mt(Ku);t.forEach(function(e){return r=r.add(e)});var i=IDBKeyRange.bound(zu(r.first()),zu(r.last())),a=r.getIterator(),u=a.getNext();return Uu(e).X({index:"documentKeyIndex",range:i},function(e,t,r){for(var i=be.fromSegments([].concat(_(t.prefixPath),[t.collectionGroup,t.documentId]));u&&Ku(u,i)<0;)n(u,null),u=a.getNext();u&&u.isEqual(i)&&(n(u,t),u=a.hasNext()?a.getNext():null),u?r.G(zu(u)):r.done()}).next(function(){for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this,a=t.path,u=[a.popLast().toArray(),a.lastSegment(),Ta(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Uu(e).j(IDBKeyRange.bound(u,o,!0)).next(function(e){var n,a=xr(),u=y(e);try{for(u.s();!(n=u.n()).done;){var o=n.value,s=i.ts(be.fromSegments(o.prefixPath.concat(o.collectionGroup,o.documentId)),o);s.isFoundDocument()&&(pr(t,s)||r.has(s.key))&&(a=a.insert(s.key,s))}}catch(c){u.e(c)}finally{u.f()}return a})}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){var i=this,a=xr(),u=Gu(t,n),o=Gu(t,Fe.max());return Uu(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,o,!0)},function(e,t,n){var u=i.ts(be.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(a=a.insert(u.key,u)).size===r&&n.done()}).next(function(){return a})}},{key:"newChangeBuffer",value:function(e){return new qu(this,!!e&&e.trackRemovals)}},{key:"getSize",value:function(e){return this.getMetadata(e).next(function(e){return e.byteSize})}},{key:"getMetadata",value:function(e){return Bu(e).get("remoteDocumentGlobalKey").next(function(e){return X(!!e),e})}},{key:"Zn",value:function(e,t){return Bu(e).put("remoteDocumentGlobalKey",t)}},{key:"ts",value:function(e,t){if(t){var n=Ia(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(me.min()))return n}return bn.newInvalidDocument(e)}}]),e}();function Vu(e){return new Pu(e)}var qu=function(e){w(n,Ou);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).os=e,i.trackRemovals=r,i.us=new kr(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),i}return O(n,[{key:"applyChanges",value:function(e){var t=this,n=[],r=0,i=new Mt(function(e,t){return de(e.canonicalString(),t.canonicalString())});return this.changes.forEach(function(a,u){var o=t.us.get(a);if(n.push(t.os.removeEntry(e,a,o.readTime)),u.isValidDocument()){var s=Ea(t.os.serializer,u);i=i.add(a.path.popLast());var c=gu(s);r+=c-o.size,n.push(t.os.addEntry(e,a,s))}else if(r-=o.size,t.trackRemovals){var l=Ea(t.os.serializer,u.convertToNoDocument(me.min()));n.push(t.os.addEntry(e,a,l))}}),i.forEach(function(r){n.push(t.os.indexManager.addToCollectionParentIndex(e,r))}),n.push(this.os.updateMetadata(e,r)),Ve.waitFor(n)}},{key:"getFromCache",value:function(e,t){var n=this;return this.os.es(e,t).next(function(e){return n.us.set(t,{size:e.size,readTime:e.document.readTime}),e.document})}},{key:"getAllFromCache",value:function(e,t){var n=this;return this.os.ss(e,t).next(function(e){var t=e.documents;return e.rs.forEach(function(e,r){n.us.set(e,{size:r,readTime:t.get(e).readTime})}),t})}}]),n}();function Bu(e){return Dt(e,"remoteDocumentGlobal")}function Uu(e){return Dt(e,"remoteDocumentsV14")}function zu(e){var t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Gu(e,t){var n=t.documentKey.path.toArray();return[e,Ta(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Ku(e,t){for(var n=e.path.toArray(),r=t.path.toArray(),i=0,a=0;a<n.length-2&&a<r.length-2;++a)if(i=de(n[a],r[a]))return i;return(i=de(n.length,r.length))||((i=de(n[n.length-2],r[r.length-2]))||de(n[n.length-1],r[r.length-1]))}var ju=O(function e(t,n){L(this,e),this.overlayedDocument=t,this.mutatedFields=n}),Qu=function(){function e(t,n,r,i){L(this,e),this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}return O(e,[{key:"getDocument",value:function(e,t){var n=this,r=null;return this.documentOverlayCache.getOverlay(e,t).next(function(i){return r=i,n.remoteDocumentCache.getEntry(e,t)}).next(function(e){return null!==r&&ni(r.mutation,e,Vt.empty(),ye.now()),e})}},{key:"getDocuments",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t,Ar()).next(function(){return t})})}},{key:"getLocalViewOfDocuments",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ar(),i=Tr();return this.populateOverlays(e,i,t).next(function(){return n.computeViews(e,t,i,r).next(function(e){var t=Ir();return e.forEach(function(e,n){t=t.insert(e,n.overlayedDocument)}),t})})}},{key:"getOverlayedDocuments",value:function(e,t){var n=this,r=Tr();return this.populateOverlays(e,r,t).next(function(){return n.computeViews(e,t,r,Ar())})}},{key:"populateOverlays",value:function(e,t,n){var r=[];return n.forEach(function(e){t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(function(e){e.forEach(function(e,n){t.set(e,n)})})}},{key:"computeViews",value:function(e,t,n,r){var i=xr(),a=_r(),u=_r();return t.forEach(function(e,t){var u=n.get(t.key);r.has(t.key)&&(void 0===u||u.mutation instanceof ui)?i=i.insert(t.key,t):void 0!==u?(a.set(t.key,u.mutation.getFieldMask()),ni(u.mutation,t,u.mutation.getFieldMask(),ye.now())):a.set(t.key,Vt.empty())}),this.recalculateAndSaveOverlays(e,i).next(function(e){return e.forEach(function(e,t){return a.set(e,t)}),t.forEach(function(e,t){var n;return u.set(e,new ju(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),u})}},{key:"recalculateAndSaveOverlays",value:function(e,t){var n=this,r=_r(),i=new Ft(function(e,t){return e-t}),a=Ar();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(function(e){var n,a=y(e);try{var u=function(){var e=n.value;e.keys().forEach(function(n){var a=t.get(n);if(null!==a){var u=r.get(n)||Vt.empty();u=e.applyToLocalView(a,u),r.set(n,u);var o=(i.get(e.batchId)||Ar()).add(n);i=i.insert(e.batchId,o)}})};for(a.s();!(n=a.n()).done;)u()}catch(o){a.e(o)}finally{a.f()}}).next(function(){for(var u=[],o=i.getReverseIterator(),s=function(){var i=o.getNext(),s=i.key,c=i.value,l=Sr();c.forEach(function(e){if(!a.has(e)){var n=ei(t.get(e),r.get(e));null!==n&&l.set(e,n),a=a.add(e)}}),u.push(n.documentOverlayCache.saveOverlays(e,s,l))};o.hasNext();)s();return Ve.waitFor(u)}).next(function(){return r})}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.recalculateAndSaveOverlays(e,t)})}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){return function(e){return be.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):or(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}},{key:"getNextDocuments",value:function(e,t,n,r){var i=this;return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(function(a){var u=r-a.size>0?i.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-a.size):Ve.resolve(Tr()),o=-1,s=a;return u.next(function(t){return Ve.forEach(t,function(t,n){return o<n.largestBatchId&&(o=n.largestBatchId),a.get(t)?Ve.resolve():i.remoteDocumentCache.getEntry(e,t).next(function(e){s=s.insert(t,e)})}).next(function(){return i.populateOverlays(e,t,a)}).next(function(){return i.computeViews(e,s,t,Ar())}).next(function(e){return{batchId:o,changes:Er(e)}})})})}},{key:"getDocumentsMatchingDocumentQuery",value:function(e,t){return this.getDocument(e,new be(t)).next(function(e){var t=Ir();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function(e,t,n){var r=this,i=t.collectionGroup,a=Ir();return this.indexManager.getCollectionParents(e,i).next(function(u){return Ve.forEach(u,function(u){var o=function(e,t){return new tr(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,u.child(i));return r.getDocumentsMatchingCollectionQuery(e,o,n).next(function(e){e.forEach(function(e,t){a=a.insert(e,t)})})}).next(function(){return a})})}},{key:"getDocumentsMatchingCollectionQuery",value:function(e,t,n){var r,i=this;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(function(a){return r=a,i.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r)}).next(function(e){r.forEach(function(t,n){var r=n.getKey();null===e.get(r)&&(e=e.insert(r,bn.newInvalidDocument(r)))});var n=Ir();return e.forEach(function(e,i){var a=r.get(e);void 0!==a&&ni(a.mutation,i,Vt.empty(),ye.now()),pr(t,i)&&(n=n.insert(e,i))}),n})}}]),e}(),Wu=function(){function e(t){L(this,e),this.serializer=t,this.cs=new Map,this.hs=new Map}return O(e,[{key:"getBundleMetadata",value:function(e,t){return Ve.resolve(this.cs.get(t))}},{key:"saveBundleMetadata",value:function(e,t){var n;return this.cs.set(t.id,{id:(n=t).id,version:n.version,createTime:Qi(n.createTime)}),Ve.resolve()}},{key:"getNamedQuery",value:function(e,t){return Ve.resolve(this.hs.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.hs.set(t.name,function(e){return{name:e.name,query:Na(e.bundledQuery),readTime:Qi(e.readTime)}}(t)),Ve.resolve()}}]),e}(),Hu=function(){function e(){L(this,e),this.overlays=new Ft(be.comparator),this.ls=new Map}return O(e,[{key:"getOverlay",value:function(e,t){return Ve.resolve(this.overlays.get(t))}},{key:"getOverlays",value:function(e,t){var n=this,r=Tr();return Ve.forEach(t,function(t){return n.getOverlay(e,t).next(function(e){null!==e&&r.set(t,e)})}).next(function(){return r})}},{key:"saveOverlays",value:function(e,t,n){var r=this;return n.forEach(function(n,i){r.we(e,t,i)}),Ve.resolve()}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=this.ls.get(n);return void 0!==i&&(i.forEach(function(e){return r.overlays=r.overlays.remove(e)}),this.ls.delete(n)),Ve.resolve()}},{key:"getOverlaysForCollection",value:function(e,t,n){for(var r=Tr(),i=t.length+1,a=new be(t.child("")),u=this.overlays.getIteratorFrom(a);u.hasNext();){var o=u.getNext().value,s=o.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&o.largestBatchId>n&&r.set(o.getKey(),o)}return Ve.resolve(r)}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){for(var i=new Ft(function(e,t){return e-t}),a=this.overlays.getIterator();a.hasNext();){var u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>n){var o=i.get(u.largestBatchId);null===o&&(o=Tr(),i=i.insert(u.largestBatchId,o)),o.set(u.getKey(),u)}}for(var s=Tr(),c=i.getIterator();c.hasNext()&&(c.getNext().value.forEach(function(e,t){return s.set(e,t)}),!(s.size()>=r)););return Ve.resolve(s)}},{key:"we",value:function(e,t,n){var r=this.overlays.get(n.key);if(null!==r){var i=this.ls.get(r.largestBatchId).delete(n.key);this.ls.set(r.largestBatchId,i)}this.overlays=this.overlays.insert(n.key,new yi(t,n));var a=this.ls.get(t);void 0===a&&(a=Ar(),this.ls.set(t,a)),this.ls.set(t,a.add(n.key))}}]),e}(),Yu=function(){function e(){L(this,e),this.fs=new Mt(Xu.ds),this.ws=new Mt(Xu._s)}return O(e,[{key:"isEmpty",value:function(){return this.fs.isEmpty()}},{key:"addReference",value:function(e,t){var n=new Xu(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}},{key:"gs",value:function(e,t){var n=this;e.forEach(function(e){return n.addReference(e,t)})}},{key:"removeReference",value:function(e,t){this.ys(new Xu(e,t))}},{key:"ps",value:function(e,t){var n=this;e.forEach(function(e){return n.removeReference(e,t)})}},{key:"Is",value:function(e){var t=this,n=new be(new ke([])),r=new Xu(n,e),i=new Xu(n,e+1),a=[];return this.ws.forEachInRange([r,i],function(e){t.ys(e),a.push(e.key)}),a}},{key:"Ts",value:function(){var e=this;this.fs.forEach(function(t){return e.ys(t)})}},{key:"ys",value:function(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}},{key:"Es",value:function(e){var t=new be(new ke([])),n=new Xu(t,e),r=new Xu(t,e+1),i=Ar();return this.ws.forEachInRange([n,r],function(e){i=i.add(e.key)}),i}},{key:"containsKey",value:function(e){var t=new Xu(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),Xu=function(){function e(t,n){L(this,e),this.key=t,this.As=n}return O(e,null,[{key:"ds",value:function(e,t){return be.comparator(e.key,t.key)||de(e.As,t.As)}},{key:"_s",value:function(e,t){return de(e.As,t.As)||be.comparator(e.key,t.key)}}]),e}(),Ju=function(){function e(t,n){L(this,e),this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.vs=1,this.Rs=new Mt(Xu.ds)}return O(e,[{key:"checkEmpty",value:function(e){return Ve.resolve(0===this.mutationQueue.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];var a=new vi(i,t,n,r);this.mutationQueue.push(a);var u,o=y(r);try{for(o.s();!(u=o.n()).done;){var s=u.value;this.Rs=this.Rs.add(new Xu(s.key,i)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast())}}catch(c){o.e(c)}finally{o.f()}return Ve.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return Ve.resolve(this.Ps(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this.bs(n),i=r<0?0:r;return Ve.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return Ve.resolve(0===this.mutationQueue.length?-1:this.vs-1)}},{key:"getAllMutationBatches",value:function(e){return Ve.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new Xu(t,0),i=new Xu(t,Number.POSITIVE_INFINITY),a=[];return this.Rs.forEachInRange([r,i],function(e){var t=n.Ps(e.As);a.push(t)}),Ve.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Mt(de);return t.forEach(function(e){var t=new Xu(e,0),i=new Xu(e,Number.POSITIVE_INFINITY);n.Rs.forEachInRange([t,i],function(e){r=r.add(e.As)})}),Ve.resolve(this.Vs(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;be.isDocumentKey(i)||(i=i.child(""));var a=new Xu(new be(i),0),u=new Mt(de);return this.Rs.forEachWhile(function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(u=u.add(e.As)),!0)},a),Ve.resolve(this.Vs(u))}},{key:"Vs",value:function(e){var t=this,n=[];return e.forEach(function(e){var r=t.Ps(e);null!==r&&n.push(r)}),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;X(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();var r=this.Rs;return Ve.forEach(t.mutations,function(i){var a=new Xu(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(function(){n.Rs=r})}},{key:"Cn",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new Xu(t,0),r=this.Rs.firstAfterOrEqual(n);return Ve.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.mutationQueue.length,Ve.resolve()}},{key:"Ss",value:function(e,t){return this.bs(e)}},{key:"bs",value:function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}},{key:"Ps",value:function(e){var t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}]),e}(),Zu=function(){function e(t){L(this,e),this.Ds=t,this.docs=new Ft(be.comparator),this.size=0}return O(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t){var n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return Ve.resolve(n?n.document.mutableCopy():bn.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=xr();return t.forEach(function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():bn.newInvalidDocument(e))}),Ve.resolve(r)}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){for(var i=xr(),a=t.path,u=new be(a.child("")),o=this.docs.getIteratorFrom(u);o.hasNext();){var s=o.getNext(),c=s.key,l=s.value.document;if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||Re(Ne(l),n)<=0||(r.has(l.key)||pr(t,l))&&(i=i.insert(l.key,l.mutableCopy()))}return Ve.resolve(i)}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){Y()}},{key:"Cs",value:function(e,t){return Ve.forEach(this.docs,function(e){return t(e)})}},{key:"newChangeBuffer",value:function(e){return new $u(this)}},{key:"getSize",value:function(e){return Ve.resolve(this.size)}}]),e}(),$u=function(e){w(n,Ou);var t=b(n);function n(e){var r;return L(this,n),(r=t.call(this)).os=e,r}return O(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach(function(r,i){i.isValidDocument()?n.push(t.os.addEntry(e,i)):t.os.removeEntry(r)}),Ve.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.os.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.os.getEntries(e,t)}}]),n}(),eo=function(){function e(t){L(this,e),this.persistence=t,this.xs=new kr(function(e){return Yn(e)},Xn),this.lastRemoteSnapshotVersion=me.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Yu,this.targetCount=0,this.Ms=Eu.kn()}return O(e,[{key:"forEachTarget",value:function(e,t){return this.xs.forEach(function(e,n){return t(n)}),Ve.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return Ve.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return Ve.resolve(this.Ns)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.Ms.next(),Ve.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),Ve.resolve()}},{key:"Fn",value:function(e){this.xs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Ms=new Eu(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.Fn(t),this.targetCount+=1,Ve.resolve()}},{key:"updateTargetData",value:function(e,t){return this.Fn(t),Ve.resolve()}},{key:"removeTargetData",value:function(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,Ve.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.xs.forEach(function(u,o){o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r.xs.delete(u),a.push(r.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),Ve.waitFor(a).next(function(){return i})}},{key:"getTargetCount",value:function(e){return Ve.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.xs.get(t)||null;return Ve.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.ks.gs(t,n),Ve.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.ks.ps(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),Ve.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.ks.Is(t),Ve.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.ks.Es(t);return Ve.resolve(n)}},{key:"containsKey",value:function(e,t){return Ve.resolve(this.ks.containsKey(t))}}]),e}(),to=function(){function e(t,n){var r=this;L(this,e),this.$s={},this.overlays={},this.Os=new Xe(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=t(this),this.Bs=new eo(this),this.indexManager=new uu,this.remoteDocumentCache=new Zu(function(e){return r.referenceDelegate.Ls(e)}),this.serializer=new ba(n),this.qs=new Wu(this.serializer)}return O(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.Fs=!1,Promise.resolve()}},{key:"started",get:function(){return this.Fs}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(e){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(e){var t=this.overlays[e.toKey()];return t||(t=new Hu,this.overlays[e.toKey()]=t),t}},{key:"getMutationQueue",value:function(e,t){var n=this.$s[e.toKey()];return n||(n=new Ju(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}},{key:"getTargetCache",value:function(){return this.Bs}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function(){return this.qs}},{key:"runTransaction",value:function(e,t,n){var r=this;j("MemoryPersistence","Starting transaction:",e);var i=new no(this.Os.next());return this.referenceDelegate.Us(),n(i).next(function(e){return r.referenceDelegate.Ks(i).next(function(){return e})}).toPromise().then(function(e){return i.raiseOnCommittedEvent(),e})}},{key:"Gs",value:function(e,t){return Ve.or(Object.values(this.$s).map(function(n){return function(){return n.containsKey(e,t)}}))}}]),e}(),no=function(e){w(n,Me);var t=b(n);function n(e){var r;return L(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return O(n)}(),ro=function(){function e(t){L(this,e),this.persistence=t,this.Qs=new Yu,this.js=null}return O(e,[{key:"Ws",get:function(){if(this.js)return this.js;throw Y()}},{key:"addReference",value:function(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),Ve.resolve()}},{key:"removeReference",value:function(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),Ve.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.Ws.add(t.toString()),Ve.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.Qs.Is(t.targetId).forEach(function(e){return n.Ws.add(e.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(function(e){e.forEach(function(e){return n.Ws.add(e.toString())})}).next(function(){return r.removeTargetData(e,t)})}},{key:"Us",value:function(){this.js=new Set}},{key:"Ks",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ve.forEach(this.Ws,function(r){var i=be.fromPath(r);return t.Hs(e,i).next(function(e){e||n.removeEntry(i,me.min())})}).next(function(){return t.js=null,n.apply(e)})}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.Hs(e,t).next(function(e){e?n.Ws.delete(t.toString()):n.Ws.add(t.toString())})}},{key:"Ls",value:function(e){return 0}},{key:"Hs",value:function(e,t){var n=this;return Ve.or([function(){return Ve.resolve(n.Qs.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Gs(e,t)}])}}],[{key:"zs",value:function(t){return new e(t)}}]),e}(),io=function(){function e(t,n){L(this,e),this.persistence=t,this.Js=new kr(function(e){return et(e.path)},function(e,t){return e.isEqual(t)}),this.garbageCollector=Ru(this,n)}return O(e,[{key:"Us",value:function(){}},{key:"Ks",value:function(e){return Ve.resolve()}},{key:"forEachTarget",value:function(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}},{key:"zn",value:function(e){var t=this.Jn(e);return this.persistence.getTargetCache().getTargetCount(e).next(function(e){return t.next(function(t){return e+t})})}},{key:"Jn",value:function(e){var t=0;return this.Wn(e,function(e){t++}).next(function(){return t})}},{key:"Wn",value:function(e,t){var n=this;return Ve.forEach(this.Js,function(r,i){return n.Xn(e,r,i).next(function(e){return e?Ve.resolve():t(i)})})}},{key:"removeTargets",value:function(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=0,i=this.persistence.getRemoteDocumentCache(),a=i.newChangeBuffer();return i.Cs(e,function(i){return n.Xn(e,i,t).next(function(e){e||(r++,a.removeEntry(i,me.min()))})}).next(function(){return a.apply(e)}).next(function(){return r})}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.Js.set(t,e.currentSequenceNumber),Ve.resolve()}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}},{key:"addReference",value:function(e,t,n){return this.Js.set(n,e.currentSequenceNumber),Ve.resolve()}},{key:"removeReference",value:function(e,t,n){return this.Js.set(n,e.currentSequenceNumber),Ve.resolve()}},{key:"updateLimboDocument",value:function(e,t){return this.Js.set(t,e.currentSequenceNumber),Ve.resolve()}},{key:"Ls",value:function(e){var t=e.key.toString().length;return e.isFoundDocument()&&(t+=on(e.data.value)),t}},{key:"Xn",value:function(e,t,n){var r=this;return Ve.or([function(){return r.persistence.Gs(e,t)},function(){return r.persistence.getTargetCache().containsKey(e,t)},function(){var e=r.Js.get(t);return Ve.resolve(void 0!==e&&e>n)}])}},{key:"getCacheSize",value:function(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}],[{key:"zs",value:function(t,n){return new e(t,n)}}]),e}(),ao=function(){function e(t){L(this,e),this.serializer=t}return O(e,[{key:"O",value:function(e,t,n,r){var i=this,a=new qe("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",it,{unique:!0}),e.createObjectStore("documentMutations")}(e),uo(e),function(e){e.createObjectStore("remoteDocuments")}(e));var u=Ve.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),uo(e)),u=u.next(function(){return e=a.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:me.min().toTimestamp(),targetCount:0},e.put("targetGlobalKey",t);var e,t})),n<4&&r>=4&&(0!==n&&(u=u.next(function(){return function(e,t){return t.store("mutations").j().next(function(n){e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",it,{unique:!0});var r=t.store("mutations"),i=n.map(function(e){return r.put(e)});return Ve.waitFor(i)})}(e,a)})),u=u.next(function(){!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&r>=5&&(u=u.next(function(){return i.Ys(a)})),n<6&&r>=6&&(u=u.next(function(){return function(e){e.createObjectStore("remoteDocumentGlobal")}(e),i.Xs(a)})),n<7&&r>=7&&(u=u.next(function(){return i.Zs(a)})),n<8&&r>=8&&(u=u.next(function(){return i.ti(e,a)})),n<9&&r>=9&&(u=u.next(function(){!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&r>=10&&(u=u.next(function(){return i.ei(a)})),n<11&&r>=11&&(u=u.next(function(){!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&r>=12&&(u=u.next(function(){!function(e){var t=e.createObjectStore("documentOverlays",{keyPath:kt});t.createIndex("collectionPathOverlayIndex",wt,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",xt,{unique:!1})}(e)})),n<13&&r>=13&&(u=u.next(function(){return function(e){var t=e.createObjectStore("remoteDocumentsV14",{keyPath:st});t.createIndex("documentKeyIndex",ct),t.createIndex("collectionGroupIndex",lt)}(e)}).next(function(){return i.ni(e,a)}).next(function(){return e.deleteObjectStore("remoteDocuments")})),n<14&&r>=14&&(u=u.next(function(){return i.si(e,a)})),n<15&&r>=15&&(u=u.next(function(){return function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:pt}).createIndex("sequenceNumberIndex",yt,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:mt}).createIndex("documentKeyIndex",gt,{unique:!1})}(e)})),u}},{key:"Xs",value:function(e){var t=0;return e.store("remoteDocuments").X(function(e,n){t+=gu(n)}).next(function(){var n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}},{key:"Ys",value:function(e){var t=this,n=e.store("mutationQueues"),r=e.store("mutations");return n.j().next(function(n){return Ve.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.j("userMutationsIndex",i).next(function(r){return Ve.forEach(r,function(r){X(r.userId===n.userId);var i=Da(t.serializer,r);return mu(e,n.userId,i).next(function(){})})})})})}},{key:"Zs",value:function(e){var t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(function(e){var r=[];return n.X(function(n,i){var a=new ke(n),u=[0,et(a)];r.push(t.get(u).next(function(n){return n?Ve.resolve():function(n){return t.put({targetId:0,path:et(n),sequenceNumber:e.highestListenSequenceNumber})}(a)}))}).next(function(){return Ve.waitFor(r)})})}},{key:"ti",value:function(e,t){e.createObjectStore("collectionParents",{keyPath:vt});var n=t.store("collectionParents"),r=new ou,i=function(e){if(r.add(e)){var t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:et(i)})}};return t.store("remoteDocuments").X({Y:!0},function(e,t){var n=new ke(e);return i(n.popLast())}).next(function(){return t.store("documentMutations").X({Y:!0},function(e,t){var n=c(e,3),r=(n[0],n[1]),a=(n[2],rt(r));return i(a.popLast())})})}},{key:"ei",value:function(e){var t=this,n=e.store("targets");return n.X(function(e,r){var i=Ca(r),a=Aa(t.serializer,i);return n.put(a)})}},{key:"ni",value:function(e,t){var n=t.store("remoteDocuments"),r=[];return n.X(function(e,n){var i,a=t.store("remoteDocumentsV14"),u=(i=n,i.document?new be(ke.fromString(i.document.name).popFirst(5)):i.noDocument?be.fromSegments(i.noDocument.path):i.unknownDocument?be.fromSegments(i.unknownDocument.path):Y()).path.toArray(),o={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(a.put(o))}).next(function(){return Ve.waitFor(r)})}},{key:"si",value:function(e,t){var n=this,r=t.store("mutations"),i=Vu(this.serializer),a=new to(ro.zs,this.serializer.fe);return r.j().next(function(e){var r=new Map;return e.forEach(function(e){var t,i=null!==(t=r.get(e.userId))&&void 0!==t?t:Ar();Da(n.serializer,e).keys().forEach(function(e){return i=i.add(e)}),r.set(e.userId,i)}),Ve.forEach(r,function(e,r){var u=new B(r),o=Va.de(n.serializer,u),s=a.getIndexManager(u),c=ku.de(u,n.serializer,s,a.referenceDelegate);return new Qu(i,c,o,s).recalculateAndSaveOverlaysForDocumentKeys(new _t(t,Xe.ct),e).next()})})}}]),e}();function uo(e){e.createObjectStore("targetDocuments",{keyPath:ht}).createIndex("documentTargetsIndex",dt,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",ft,{unique:!0}),e.createObjectStore("targetGlobal")}var oo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",so=function(){function e(t,n,r,i,a,u,o,s,c,l){var f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:15;if(L(this,e),this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.ii=a,this.window=u,this.document=o,this.ri=c,this.oi=l,this.ui=f,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=function(e){return Promise.resolve()},!e.D())throw new ee($.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Lu(this,i),this.di=n+"main",this.serializer=new ba(s),this.wi=new Be(this.di,this.ui,new ao(this.serializer)),this.Bs=new Tu(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Vu(this.serializer),this.qs=new Ma,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===l&&Q("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return O(e,[{key:"start",value:function(){var e=this;return this.mi().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new ee($.FAILED_PRECONDITION,oo);return e.gi(),e.yi(),e.pi(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Bs.getHighestSequenceNumber(t)})}).then(function(t){e.Os=new Xe(t,e.ri)}).then(function(){e.Fs=!0}).catch(function(t){return e.wi&&e.wi.close(),Promise.reject(t)})}},{key:"Ii",value:function(e){var t=this;return this.fi=function(){var n=k(m().mark(function n(r){return m().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.started){n.next=2;break}return n.abrupt("return",e(r));case 2:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}},{key:"setDatabaseDeletedListener",value:function(e){this.wi.B(function(){var t=k(m().mark(function t(n){return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===n.newVersion,!t.t0){t.next=4;break}return t.next=4,e();case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"setNetworkEnabled",value:function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget(k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.started,!e.t0){e.next=4;break}return e.next=4,t.mi();case 4:case"end":return e.stop()}},e)}))))}},{key:"mi",value:function(){var e=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(t){return lo(t).put({clientId:e.clientId,updateTimeMs:Date.now(),networkEnabled:e.networkEnabled,inForeground:e.inForeground}).next(function(){if(e.isPrimary)return e.Ti(t).next(function(t){t||(e.isPrimary=!1,e.ii.enqueueRetryable(function(){return e.fi(!1)}))})}).next(function(){return e.Ei(t)}).next(function(n){return e.isPrimary&&!n?e.Ai(t).next(function(){return!1}):!!n&&e.vi(t).next(function(){return!0})})}).catch(function(t){if(Ge(t))return j("IndexedDbPersistence","Failed to extend owner lease: ",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return j("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){e.isPrimary!==t&&e.ii.enqueueRetryable(function(){return e.fi(t)}),e.isPrimary=t})}},{key:"Ti",value:function(e){var t=this;return co(e).get("owner").next(function(e){return Ve.resolve(t.Ri(e))})}},{key:"Pi",value:function(e){return lo(e).delete(this.clientId)}},{key:"bi",value:function(){var e=k(m().mark(function e(){var t,n,r,i,a=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrimary||this.Vi(this.li,18e5)){e.next=6;break}return this.li=Date.now(),e.next=4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(e){var t=Dt(e,"clientMetadata");return t.j().next(function(e){var n=a.Si(e,18e5),r=e.filter(function(e){return-1===n.indexOf(e)});return Ve.forEach(r,function(e){return t.delete(e.clientId)}).next(function(){return r})})}).catch(function(){return[]});case 4:if(t=e.sent,this._i){n=y(t);try{for(n.s();!(r=n.n()).done;)i=r.value,this._i.removeItem(this.Di(i.clientId))}catch(u){n.e(u)}finally{n.f()}}case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"pi",value:function(){var e=this;this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return e.mi().then(function(){return e.bi()}).then(function(){return e.pi()})})}},{key:"Ri",value:function(e){return!!e&&e.ownerId===this.clientId}},{key:"Ei",value:function(e){var t=this;return this.oi?Ve.resolve(!0):co(e).get("owner").next(function(n){if(null!==n&&t.Vi(n.leaseTimestampMs,5e3)&&!t.Ci(n.ownerId)){if(t.Ri(n)&&t.networkEnabled)return!0;if(!t.Ri(n)){if(!n.allowTabSynchronization)throw new ee($.FAILED_PRECONDITION,oo);return!1}}return!(!t.networkEnabled||!t.inForeground)||lo(e).j().next(function(e){return void 0===t.Si(e,5e3).find(function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled,r=!t.inForeground&&e.inForeground,i=t.networkEnabled===e.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(e){return t.isPrimary!==e&&j("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e})}},{key:"shutdown",value:function(){var e=k(m().mark(function e(){var t=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.Fs=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Ni(),this.ki(),e.next=7,this.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],function(e){var n=new _t(e,Xe.ct);return t.Ai(n).next(function(){return t.Pi(n)})});case 7:this.wi.close(),this.Mi();case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"Si",value:function(e,t){var n=this;return e.filter(function(e){return n.Vi(e.updateTimeMs,t)&&!n.Ci(e.clientId)})}},{key:"$i",value:function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return lo(t).j().next(function(t){return e.Si(t,18e5).map(function(e){return e.clientId})})})}},{key:"started",get:function(){return this.Fs}},{key:"getMutationQueue",value:function(e,t){return ku.de(e,this.serializer,t,this.referenceDelegate)}},{key:"getTargetCache",value:function(){return this.Bs}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getIndexManager",value:function(e){return new cu(e,this.serializer.fe.databaseId)}},{key:"getDocumentOverlayCache",value:function(e){return Va.de(this.serializer,e)}},{key:"getBundleCache",value:function(){return this.qs}},{key:"runTransaction",value:function(e,t,n){var r=this;j("IndexedDbPersistence","Starting transaction:",e);var i,a,u="readonly"===t?"readonly":"readwrite",o=15===(i=this.ui)?St:14===i?Tt:13===i?Et:12===i?It:11===i?bt:void Y();return this.wi.runTransaction(e,u,o,function(i){return a=new _t(i,r.Os?r.Os.next():Xe.ct),"readwrite-primary"===t?r.Ti(a).next(function(e){return!!e||r.Ei(a)}).next(function(t){if(!t)throw Q("Failed to obtain primary lease for action '".concat(e,"'.")),r.isPrimary=!1,r.ii.enqueueRetryable(function(){return r.fi(!1)}),new ee($.FAILED_PRECONDITION,Le);return n(a)}).next(function(e){return r.vi(a).next(function(){return e})}):r.Oi(a).next(function(){return n(a)})}).then(function(e){return a.raiseOnCommittedEvent(),e})}},{key:"Oi",value:function(e){var t=this;return co(e).get("owner").next(function(e){if(null!==e&&t.Vi(e.leaseTimestampMs,5e3)&&!t.Ci(e.ownerId)&&!t.Ri(e)&&!(t.oi||t.allowTabSynchronization&&e.allowTabSynchronization))throw new ee($.FAILED_PRECONDITION,oo)})}},{key:"vi",value:function(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return co(e).put("owner",t)}},{key:"Ai",value:function(e){var t=this,n=co(e);return n.get("owner").next(function(e){return t.Ri(e)?(j("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):Ve.resolve()})}},{key:"Vi",value:function(e,t){var n=Date.now();return!(e<n-t||e>n&&(Q("Detected an update time that is in the future: ".concat(e," > ").concat(n)),1))}},{key:"gi",value:function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=function(){e.ii.enqueueAndForget(function(){return e.inForeground="visible"===e.document.visibilityState,e.mi()})},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}},{key:"Ni",value:function(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}},{key:"yi",value:function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=function(){t.xi();var e=/(?:Version|Mobile)\/1[456]/;(0,a.isSafari)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&t.ii.enterRestrictedMode(!0),t.ii.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("pagehide",this.ci))}},{key:"ki",value:function(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}},{key:"Ci",value:function(e){var t;try{var n=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Di(e)));return j("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return Q("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}},{key:"xi",value:function(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){Q("Failed to set zombie client id.",e)}}},{key:"Mi",value:function(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch(e){}}},{key:"Di",value:function(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}],[{key:"D",value:function(){return Be.D()}}]),e}();function co(e){return Dt(e,"owner")}function lo(e){return Dt(e,"clientMetadata")}function fo(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var ho=function(){function e(t,n,r,i){L(this,e),this.targetId=t,this.fromCache=n,this.Fi=r,this.Bi=i}return O(e,null,[{key:"Li",value:function(t,n){var r,i=Ar(),a=Ar(),u=y(n.docChanges);try{for(u.s();!(r=u.n()).done;){var o=r.value;switch(o.type){case 0:i=i.add(o.doc.key);break;case 1:a=a.add(o.doc.key)}}}catch(s){u.e(s)}finally{u.f()}return new e(t,n.fromCache,i,a)}}]),e}(),vo=function(){function e(){L(this,e),this.qi=!1}return O(e,[{key:"initialize",value:function(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this;return this.Ki(e,t).next(function(a){return a||i.Gi(e,t,r,n)}).next(function(n){return n||i.Qi(e,t)})}},{key:"Ki",value:function(e,t){var n=this;if(ir(t))return Ve.resolve(null);var r=cr(t);return this.indexManager.getIndexType(e,r).next(function(i){return 0===i?null:(null!==t.limit&&1===i&&(t=fr(t,null,"F"),r=cr(t)),n.indexManager.getDocumentsMatchingTarget(e,r).next(function(i){var a=Ar.apply(void 0,_(i));return n.Ui.getDocuments(e,a).next(function(i){return n.indexManager.getMinOffset(e,r).next(function(r){var u=n.ji(t,i);return n.zi(t,u,a,r.readTime)?n.Ki(e,fr(t,null,"F")):n.Wi(e,u,t,r)})})}))})}},{key:"Gi",value:function(e,t,n,r){var a=this;return ir(t)||r.isEqual(me.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next(function(u){var o=a.ji(t,u);return a.zi(t,o,n,r)?a.Qi(e,t):(G()<=i.LogLevel.DEBUG&&j("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),vr(t)),a.Wi(e,o,t,Ae(r,-1)))})}},{key:"ji",value:function(e,t){var n=new Mt(mr(e));return t.forEach(function(t,r){pr(e,r)&&(n=n.add(r))}),n}},{key:"zi",value:function(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;var i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Qi",value:function(e,t){return G()<=i.LogLevel.DEBUG&&j("QueryEngine","Using full collection scan to execute query:",vr(t)),this.Ui.getDocumentsMatchingQuery(e,t,Fe.min())}},{key:"Wi",value:function(e,t,n,r){return this.Ui.getDocumentsMatchingQuery(e,n,r).next(function(e){return t.forEach(function(t){e=e.insert(t.key,t)}),e})}}]),e}(),po=function(){function e(t,n,r,i){L(this,e),this.persistence=t,this.Hi=n,this.serializer=i,this.Ji=new Ft(de),this.Yi=new kr(function(e){return Yn(e)},Xn),this.Xi=new Map,this.Zi=t.getRemoteDocumentCache(),this.Bs=t.getTargetCache(),this.qs=t.getBundleCache(),this.tr(r)}return O(e,[{key:"tr",value:function(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Qu(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return e.collect(n,t.Ji)})}}]),e}();function yo(e,t,n,r){return new po(e,t,n,r)}function mo(e,t){return go.apply(this,arguments)}function go(){return(go=k(m().mark(function e(t,n){var r;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Z(t),e.next=3,r.persistence.runTransaction("Handle user change","readonly",function(e){var t;return r.mutationQueue.getAllMutationBatches(e).next(function(i){return t=i,r.tr(n),r.mutationQueue.getAllMutationBatches(e)}).next(function(n){var i,a=[],u=[],o=Ar(),s=y(t);try{for(s.s();!(i=s.n()).done;){var c=i.value;a.push(c.batchId);var l,f=y(c.mutations);try{for(f.s();!(l=f.n()).done;){var h=l.value;o=o.add(h.key)}}catch(w){f.e(w)}finally{f.f()}}}catch(w){s.e(w)}finally{s.f()}var d,v=y(n);try{for(v.s();!(d=v.n()).done;){var p=d.value;u.push(p.batchId);var m,g=y(p.mutations);try{for(g.s();!(m=g.n()).done;){var k=m.value;o=o.add(k.key)}}catch(w){g.e(w)}finally{g.f()}}}catch(w){v.e(w)}finally{v.f()}return r.localDocuments.getDocuments(e,o).next(function(e){return{er:e,removedBatchIds:a,addedBatchIds:u}})})});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ko(e,t){var n=Z(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(e){var r=t.batch.keys(),i=n.Zi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),u=Ve.resolve();return a.forEach(function(e){u=u.next(function(){return r.getEntry(t,e)}).next(function(t){var a=n.docVersions.get(e);X(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),u.next(function(){return e.mutationQueue.removeMutationBatch(t,i)})}(n,e,t,i).next(function(){return i.apply(e)}).next(function(){return n.mutationQueue.performConsistencyCheck(e)}).next(function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)}).next(function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){for(var t=Ar(),n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))}).next(function(){return n.localDocuments.getDocuments(e,r)})})}function wo(e){var t=Z(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.Bs.getLastRemoteSnapshotVersion(e)})}function xo(e,t){var n=Z(e),r=t.snapshotVersion,i=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(e){var a=n.Zi.newChangeBuffer({trackRemovals:!0});i=n.Ji;var u=[];t.targetChanges.forEach(function(a,o){var s=i.get(o);if(s){u.push(n.Bs.removeMatchingKeys(e,a.removedDocuments,o).next(function(){return n.Bs.addMatchingKeys(e,a.addedDocuments,o)}));var c=s.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?c=c.withResumeToken(Ut.EMPTY_BYTE_STRING,me.min()).withLastLimboFreeSnapshotVersion(me.min()):a.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(a.resumeToken,r)),i=i.insert(o,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(s,c,a)&&u.push(n.Bs.updateTargetData(e,c))}});var o=xr(),s=Ar();if(t.documentUpdates.forEach(function(r){t.resolvedLimboDocuments.has(r)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),u.push(bo(e,a,t.documentUpdates).next(function(e){o=e.nr,s=e.sr})),!r.isEqual(me.min())){var c=n.Bs.getLastRemoteSnapshotVersion(e).next(function(t){return n.Bs.setTargetsMetadata(e,e.currentSequenceNumber,r)});u.push(c)}return Ve.waitFor(u).next(function(){return a.apply(e)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(e,o,s)}).next(function(){return o})}).then(function(e){return n.Ji=i,e})}function bo(e,t,n){var r=Ar(),i=Ar();return n.forEach(function(e){return r=r.add(e)}),t.getEntries(e,r).next(function(e){var r=xr();return n.forEach(function(n,a){var u=e.get(n);a.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(n)),a.isNoDocument()&&a.version.isEqual(me.min())?(t.removeEntry(n,a.readTime),r=r.insert(n,a)):!u.isValidDocument()||a.version.compareTo(u.version)>0||0===a.version.compareTo(u.version)&&u.hasPendingWrites?(t.addEntry(a),r=r.insert(n,a)):j("LocalStore","Ignoring outdated watch update for ",n,". Current version:",u.version," Watch version:",a.version)}),{nr:r,sr:i}})}function Io(e,t){var n=Z(e);return n.persistence.runTransaction("Get next mutation batch","readonly",function(e){return void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)})}function Eo(e,t){var n=Z(e);return n.persistence.runTransaction("Allocate target","readwrite",function(e){var r;return n.Bs.getTargetData(e,t).next(function(i){return i?(r=i,Ve.resolve(r)):n.Bs.allocateTargetId(e).next(function(i){return r=new xa(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Bs.addTargetData(e,r).next(function(){return r})})})}).then(function(e){var r=n.Ji.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(t,e.targetId)),e})}function To(e,t,n){return So.apply(this,arguments)}function So(){return(So=k(m().mark(function e(t,n,r){var i,a,u;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Z(t),a=i.Ji.get(n),u=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",u,function(e){return i.persistence.referenceDelegate.removeTarget(e,a)});case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),Ge(e.t1)){e.next=12;break}throw e.t1;case 12:j("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.Ji=i.Ji.remove(n),i.Yi.delete(a.target);case 14:case"end":return e.stop()}},e,null,[[1,8]])}))).apply(this,arguments)}function _o(e,t,n){var r=Z(e),i=me.min(),a=Ar();return r.persistence.runTransaction("Execute query","readonly",function(e){return function(e,t,n){var r=Z(e),i=r.Yi.get(n);return void 0!==i?Ve.resolve(r.Ji.get(i)):r.Bs.getTargetData(t,n)}(r,e,cr(t)).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(e,t.targetId).next(function(e){a=e})}).next(function(){return r.Hi.getDocumentsMatchingQuery(e,t,n?i:me.min(),n?a:Ar())}).next(function(e){return Ao(r,yr(t),e),{documents:e,ir:a}})})}function Do(e,t){var n=Z(e),r=Z(n.Bs),i=n.Ji.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(e){return r.le(e,t).next(function(e){return e?e.target:null})})}function Co(e,t){var n=Z(e),r=n.Xi.get(t)||me.min();return n.persistence.runTransaction("Get new document changes","readonly",function(e){return n.Zi.getAllFromCollectionGroup(e,t,Ae(r,-1),Number.MAX_SAFE_INTEGER)}).then(function(e){return Ao(n,t,e),e})}function Ao(e,t,n){var r=e.Xi.get(t)||me.min();n.forEach(function(e,t){t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Xi.set(t,r)}function No(e,t,n,r){return Fo.apply(this,arguments)}function Fo(){return(Fo=k(m().mark(function e(t,n,r,i){var a,u,o,s,c,l,f,h,d,v;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=Z(t),u=Ar(),o=xr(),s=y(r);try{for(s.s();!(c=s.n()).done;)l=c.value,f=n.rr(l.metadata.name),l.document&&(u=u.add(f)),(h=n.ur(l)).setReadTime(n.cr(l.metadata.readTime)),o=o.insert(f,h)}catch(p){s.e(p)}finally{s.f()}return d=a.Zi.newChangeBuffer({trackRemovals:!0}),e.next=7,Eo(a,function(e){return cr(rr(ke.fromString("__bundle__/docs/".concat(e))))}(i));case 7:return v=e.sent,e.abrupt("return",a.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return bo(e,d,o).next(function(t){return d.apply(e),t}).next(function(t){return a.Bs.removeMatchingKeysForTargetId(e,v.targetId).next(function(){return a.Bs.addMatchingKeys(e,u,v.targetId)}).next(function(){return a.localDocuments.getLocalViewOfDocuments(e,t.nr,t.sr)}).next(function(){return t.nr})})}));case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ro(e,t){return Lo.apply(this,arguments)}function Lo(){return(Lo=k(m().mark(function e(t,n){var r,i,a,u=arguments;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:Ar(),e.next=3,Eo(t,cr(Na(n.bundledQuery)));case 3:return i=e.sent,a=Z(t),e.abrupt("return",a.persistence.runTransaction("Save named query","readwrite",function(e){var t=Qi(n.readTime);if(i.snapshotVersion.compareTo(t)>=0)return a.qs.saveNamedQuery(e,n);var u=i.withResumeToken(Ut.EMPTY_BYTE_STRING,t);return a.Ji=a.Ji.insert(u.targetId,u),a.Bs.updateTargetData(e,u).next(function(){return a.Bs.removeMatchingKeysForTargetId(e,i.targetId)}).next(function(){return a.Bs.addMatchingKeys(e,r,i.targetId)}).next(function(){return a.qs.saveNamedQuery(e,n)})}));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Mo(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function Oo(e,t,n){var r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}function Po(e,t){return"firestore_targets_".concat(e,"_").concat(t)}var Vo=function(){function e(t,n,r,i){L(this,e),this.user=t,this.batchId=n,this.state=r,this.error=i}return O(e,[{key:"hr",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"ar",value:function(t,n,r){var i,a=JSON.parse(r),u="object"==R(a)&&-1!==["pending","acknowledged","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==R(a.error));return u&&a.error&&((u="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(i=new ee(a.error.code,a.error.message))),u?new e(t,n,a.state,i):(Q("SharedClientState","Failed to parse mutation state for ID '".concat(n,"': ").concat(r)),null)}}]),e}(),qo=function(){function e(t,n,r){L(this,e),this.targetId=t,this.state=n,this.error=r}return O(e,[{key:"hr",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"ar",value:function(t,n){var r,i=JSON.parse(n),a="object"==R(i)&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==R(i.error));return a&&i.error&&((a="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new ee(i.error.code,i.error.message))),a?new e(t,i.state,r):(Q("SharedClientState","Failed to parse target state for ID '".concat(t,"': ").concat(n)),null)}}]),e}(),Bo=function(){function e(t,n){L(this,e),this.clientId=t,this.activeTargetIds=n}return O(e,null,[{key:"ar",value:function(t,n){for(var r=JSON.parse(n),i="object"==R(r)&&r.activeTargetIds instanceof Array,a=Fr(),u=0;i&&u<r.activeTargetIds.length;++u)i=$e(r.activeTargetIds[u]),a=a.add(r.activeTargetIds[u]);return i?new e(t,a):(Q("SharedClientState","Failed to parse client data for instance '".concat(t,"': ").concat(n)),null)}}]),e}(),Uo=function(){function e(t,n){L(this,e),this.clientId=t,this.onlineState=n}return O(e,null,[{key:"ar",value:function(t){var n=JSON.parse(t);return"object"==R(n)&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new e(n.clientId,n.onlineState):(Q("SharedClientState","Failed to parse online state: ".concat(t)),null)}}]),e}(),zo=function(){function e(){L(this,e),this.activeTargetIds=Fr()}return O(e,[{key:"lr",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"dr",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"hr",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),Go=function(){function e(t,n,r,i,a){L(this,e),this.window=t,this.ii=n,this.persistenceKey=r,this.wr=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.mr.bind(this),this.gr=new Ft(de),this.started=!1,this.yr=[];var u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.pr=Mo(this.persistenceKey,this.wr),this.Ir=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.gr=this.gr.insert(this.wr,new zo),this.Tr=new RegExp("^firestore_clients_".concat(u,"_([^_]*)$")),this.Er=new RegExp("^firestore_mutations_".concat(u,"_(\\d+)(?:_(.*))?$")),this.Ar=new RegExp("^firestore_targets_".concat(u,"_(\\d+)$")),this.vr=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.Rr=function(e){return"firestore_bundle_loaded_v2_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this._r)}return O(e,[{key:"start",value:function(){var e=k(m().mark(function e(){var t,n,r,i,a,u,o,s,c,l,f,h=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncEngine.$i();case 2:t=e.sent,n=y(t),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=14;break}if((i=r.value)!==this.wr){e.next=10;break}return e.abrupt("continue",12);case 10:(a=this.getItem(Mo(this.persistenceKey,i)))&&(u=Bo.ar(i,a))&&(this.gr=this.gr.insert(u.clientId,u));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:this.Pr(),(o=this.storage.getItem(this.vr))&&(s=this.br(o))&&this.Vr(s),c=y(this.yr);try{for(c.s();!(l=c.n()).done;)f=l.value,this.mr(f)}catch(d){c.e(d)}finally{c.f()}this.yr=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0;case 28:case"end":return e.stop()}},e,this,[[4,16,19,22]])}));return function(){return e.apply(this,arguments)}}()},{key:"writeSequenceNumber",value:function(e){this.setItem(this.Ir,JSON.stringify(e))}},{key:"getAllActiveQueryTargets",value:function(){return this.Sr(this.gr)}},{key:"isActiveQueryTarget",value:function(e){var t=!1;return this.gr.forEach(function(n,r){r.activeTargetIds.has(e)&&(t=!0)}),t}},{key:"addPendingMutation",value:function(e){this.Dr(e,"pending")}},{key:"updateMutationState",value:function(e,t,n){this.Dr(e,t,n),this.Cr(e)}},{key:"addLocalQueryTarget",value:function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(Po(this.persistenceKey,e));if(n){var r=qo.ar(e,n);r&&(t=r.state)}}return this.Nr.lr(e),this.Pr(),t}},{key:"removeLocalQueryTarget",value:function(e){this.Nr.dr(e),this.Pr()}},{key:"isLocalQueryTarget",value:function(e){return this.Nr.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){this.removeItem(Po(this.persistenceKey,e))}},{key:"updateQueryState",value:function(e,t,n){this.kr(e,t,n)}},{key:"handleUserChange",value:function(e,t,n){var r=this;t.forEach(function(e){r.Cr(e)}),this.currentUser=e,n.forEach(function(e){r.addPendingMutation(e)})}},{key:"setOnlineState",value:function(e){this.Mr(e)}},{key:"notifyBundleLoaded",value:function(e){this.$r(e)}},{key:"shutdown",value:function(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.pr),this.started=!1)}},{key:"getItem",value:function(e){var t=this.storage.getItem(e);return j("SharedClientState","READ",e,t),t}},{key:"setItem",value:function(e,t){j("SharedClientState","SET",e,t),this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){j("SharedClientState","REMOVE",e),this.storage.removeItem(e)}},{key:"mr",value:function(e){var t=this,n=e;if(n.storageArea===this.storage){if(j("SharedClientState","EVENT",n.key,n.newValue),n.key===this.pr)return void Q("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable(k(m().mark(function e(){var r,i,a,u,o,s,c;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.started){e.next=43;break}if(null===n.key){e.next=41;break}if(!t.Tr.test(n.key)){e.next=11;break}if(null!=n.newValue){e.next=6;break}return r=t.Or(n.key),e.abrupt("return",t.Fr(r,null));case 6:if(!(i=t.Br(n.key,n.newValue))){e.next=9;break}return e.abrupt("return",t.Fr(i.clientId,i));case 9:e.next=41;break;case 11:if(!t.Er.test(n.key)){e.next=18;break}if(null===n.newValue){e.next=16;break}if(!(a=t.Lr(n.key,n.newValue))){e.next=16;break}return e.abrupt("return",t.qr(a));case 16:e.next=41;break;case 18:if(!t.Ar.test(n.key)){e.next=25;break}if(null===n.newValue){e.next=23;break}if(!(u=t.Ur(n.key,n.newValue))){e.next=23;break}return e.abrupt("return",t.Kr(u));case 23:e.next=41;break;case 25:if(n.key!==t.vr){e.next=32;break}if(null===n.newValue){e.next=30;break}if(!(o=t.br(n.newValue))){e.next=30;break}return e.abrupt("return",t.Vr(o));case 30:e.next=41;break;case 32:if(n.key!==t.Ir){e.next=37;break}(s=function(e){var t=Xe.ct;if(null!=e)try{var n=JSON.parse(e);X("number"==typeof n),t=n}catch(e){Q("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue))!==Xe.ct&&t.sequenceNumberHandler(s),e.next=41;break;case 37:if(n.key!==t.Rr){e.next=41;break}return c=t.Gr(n.newValue),e.next=41,Promise.all(c.map(function(e){return t.syncEngine.Qr(e)}));case 41:e.next=44;break;case 43:t.yr.push(n);case 44:case"end":return e.stop()}},e)})))}}},{key:"Nr",get:function(){return this.gr.get(this.wr)}},{key:"Pr",value:function(){this.setItem(this.pr,this.Nr.hr())}},{key:"Dr",value:function(e,t,n){var r=new Vo(this.currentUser,e,t,n),i=Oo(this.persistenceKey,this.currentUser,e);this.setItem(i,r.hr())}},{key:"Cr",value:function(e){var t=Oo(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:"Mr",value:function(e){var t={clientId:this.wr,onlineState:e};this.storage.setItem(this.vr,JSON.stringify(t))}},{key:"kr",value:function(e,t,n){var r=Po(this.persistenceKey,e),i=new qo(e,t,n);this.setItem(r,i.hr())}},{key:"$r",value:function(e){var t=JSON.stringify(Array.from(e));this.setItem(this.Rr,t)}},{key:"Or",value:function(e){var t=this.Tr.exec(e);return t?t[1]:null}},{key:"Br",value:function(e,t){var n=this.Or(e);return Bo.ar(n,t)}},{key:"Lr",value:function(e,t){var n=this.Er.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Vo.ar(new B(i),r,t)}},{key:"Ur",value:function(e,t){var n=this.Ar.exec(e),r=Number(n[1]);return qo.ar(r,t)}},{key:"br",value:function(e){return Uo.ar(e)}},{key:"Gr",value:function(e){return JSON.parse(e)}},{key:"qr",value:function(){var e=k(m().mark(function e(t){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user.uid!==this.currentUser.uid){e.next=2;break}return e.abrupt("return",this.syncEngine.jr(t.batchId,t.state,t.error));case 2:j("SharedClientState","Ignoring mutation for non-active user ".concat(t.user.uid));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"Kr",value:function(e){return this.syncEngine.zr(e.targetId,e.state,e.error)}},{key:"Fr",value:function(e,t){var n=this,r=t?this.gr.insert(e,t):this.gr.remove(e),i=this.Sr(this.gr),a=this.Sr(r),u=[],o=[];return a.forEach(function(e){i.has(e)||u.push(e)}),i.forEach(function(e){a.has(e)||o.push(e)}),this.syncEngine.Wr(u,o).then(function(){n.gr=r})}},{key:"Vr",value:function(e){this.gr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:"Sr",value:function(e){var t=Fr();return e.forEach(function(e,n){t=t.unionWith(n.activeTargetIds)}),t}}],[{key:"D",value:function(e){return!(!e||!e.localStorage)}}]),e}(),Ko=function(){function e(){L(this,e),this.Hr=new zo,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return O(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.Jr[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.Hr.dr(e)}},{key:"isLocalQueryTarget",value:function(e){return this.Hr.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.Jr[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.Hr.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.Hr.activeTargetIds.has(e)}},{key:"start",value:function(){return this.Hr=new zo,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(e){}}]),e}(),jo=function(){function e(){L(this,e)}return O(e,[{key:"Yr",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),Qo=function(){function e(){var t=this;L(this,e),this.Xr=function(){return t.Zr()},this.eo=function(){return t.no()},this.so=[],this.io()}return O(e,[{key:"Yr",value:function(e){this.so.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}},{key:"io",value:function(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}},{key:"Zr",value:function(){j("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=y(this.so);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"no",value:function(){j("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=y(this.so);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"D",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),Wo=null;function Ho(){return null===Wo?Wo=268435456+Math.round(2147483648*Math.random()):Wo++,"0x"+Wo.toString(16)}var Yo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Xo=function(){function e(t){L(this,e),this.ro=t.ro,this.oo=t.oo}return O(e,[{key:"uo",value:function(e){this.co=e}},{key:"ao",value:function(e){this.ho=e}},{key:"onMessage",value:function(e){this.lo=e}},{key:"close",value:function(){this.oo()}},{key:"send",value:function(e){this.ro(e)}},{key:"fo",value:function(){this.co()}},{key:"wo",value:function(e){this.ho(e)}},{key:"_o",value:function(e){this.lo(e)}}]),e}(),Jo="WebChannelConnection",Zo=function(e){w(n,function(){function e(t){L(this,e);this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.mo=n+"://"+t.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}O(e,[{key:"po",get:function e(){return!1}},{key:"Io",value:function e(t,n,r,i,a){var u=Ho(),o=this.To(t,n);j("RestConnection","Sending RPC '".concat(t,"' ").concat(u,":"),o,r);var s={};return this.Eo(s,i,a),this.Ao(t,o,s,r).then(function(e){return j("RestConnection","Received RPC '".concat(t,"' ").concat(u,": "),e),e},function(e){throw W("RestConnection","RPC '".concat(t,"' ").concat(u," failed with error: "),e,"url: ",o,"request:",r),e})}},{key:"vo",value:function e(t,n,r,i,a,u){return this.Io(t,n,r,i,a)}},{key:"Eo",value:function e(t,n,r){t["X-Goog-Api-Client"]="gl-js/ fire/"+U,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(function(e,n){return t[n]=e}),r&&r.headers.forEach(function(e,n){return t[n]=e})}},{key:"To",value:function e(t,n){var r=Yo[t];return"".concat(this.mo,"/v1/").concat(n,":").concat(r)}}]);return e}());var t=b(n);function n(e){var r;return L(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r.longPollingOptions=e.longPollingOptions,r}return O(n,[{key:"Ao",value:function(e,t,n,r){var i=Ho();return new Promise(function(a,o){var s=new u.XhrIo;s.setWithCredentials(!0),s.listenOnce(u.EventType.COMPLETE,function(){try{switch(s.getLastErrorCode()){case u.ErrorCode.NO_ERROR:var t=s.getResponseJson();j(Jo,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(t)),a(t);break;case u.ErrorCode.TIMEOUT:j(Jo,"RPC '".concat(e,"' ").concat(i," timed out")),o(new ee($.DEADLINE_EXCEEDED,"Request time out"));break;case u.ErrorCode.HTTP_ERROR:var n=s.getStatus();if(j(Jo,"RPC '".concat(e,"' ").concat(i," failed with status:"),n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson();Array.isArray(r)&&(r=r[0]);var c=null==r?void 0:r.error;if(c&&c.status&&c.message){var l=(f=c.status.toLowerCase().replace(/_/g,"-"),Object.values($).indexOf(f)>=0?f:$.UNKNOWN);o(new ee(l,c.message))}else o(new ee($.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new ee($.UNAVAILABLE,"Connection failed."));break;default:Y()}}finally{j(Jo,"RPC '".concat(e,"' ").concat(i," completed."))}var f});var c=JSON.stringify(r);j(Jo,"RPC '".concat(e,"' ").concat(i," sending request:"),r),s.send(t,"POST",c,n,15)})}},{key:"Ro",value:function(e,t,n){var r=Ho(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=(0,u.createWebChannelTransport)(),o=(0,u.getStatEventTarget)(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(s.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(s.xmlHttpFactory=new u.FetchXmlHttpFactory({})),this.Eo(s.initMessageHeaders,t,n),s.encodeInitMessageHeaders=!0;var l=i.join("");j(Jo,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(l),s);var f=a.createWebChannel(l,s),h=!1,d=!1,v=new Xo({ro:function(t){d?j(Jo,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(h||(j(Jo,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),f.open(),h=!0),j(Jo,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),f.send(t))},oo:function(){return f.close()}}),p=function(e,t,n){e.listen(t,function(e){try{n(e)}catch(e){setTimeout(function(){throw e},0)}})};return p(f,u.WebChannel.EventType.OPEN,function(){d||j(Jo,"RPC '".concat(e,"' stream ").concat(r," transport opened."))}),p(f,u.WebChannel.EventType.CLOSE,function(){d||(d=!0,j(Jo,"RPC '".concat(e,"' stream ").concat(r," transport closed")),v.wo())}),p(f,u.WebChannel.EventType.ERROR,function(t){d||(d=!0,W(Jo,"RPC '".concat(e,"' stream ").concat(r," transport errored:"),t),v.wo(new ee($.UNAVAILABLE,"The operation could not be completed")))}),p(f,u.WebChannel.EventType.MESSAGE,function(t){var n;if(!d){var i=t.data[0];X(!!i);var a=i,u=a.error||(null===(n=a[0])||void 0===n?void 0:n.error);if(u){j(Jo,"RPC '".concat(e,"' stream ").concat(r," received error:"),u);var o=u.status,s=function(e){var t=li[o];if(void 0!==t)return wi(t)}(),c=u.message;void 0===s&&(s=$.INTERNAL,c="Unknown error status: "+o+" with message "+u.message),d=!0,v.wo(new ee(s,c)),f.close()}else j(Jo,"RPC '".concat(e,"' stream ").concat(r," received:"),i),v._o(i)}}),p(o,u.Event.STAT_EVENT,function(t){t.stat===u.Stat.PROXY?j(Jo,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===u.Stat.NOPROXY&&j(Jo,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))}),setTimeout(function(){v.fo()},0),v}}]),n}();function $o(){return"undefined"!=typeof window?window:null}function es(){return"undefined"!=typeof document?document:null}function ts(e){return new Ui(e,!0)}var ns=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;L(this,e),this.ii=t,this.timerId=n,this.Po=r,this.bo=i,this.Vo=a,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}return O(e,[{key:"reset",value:function(){this.So=0}},{key:"xo",value:function(){this.So=this.Vo}},{key:"No",value:function(e){var t=this;this.cancel();var n=Math.floor(this.So+this.ko()),r=Math.max(0,Date.now()-this.Co),i=Math.max(0,n-r);i>0&&j("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.So," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.Do=this.ii.enqueueAfterDelay(this.timerId,i,function(){return t.Co=Date.now(),e()}),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}},{key:"Mo",value:function(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}},{key:"cancel",value:function(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}},{key:"ko",value:function(){return(Math.random()-.5)*this.So}}]),e}(),rs=function(){function e(t,n,r,i,a,u,o,s){L(this,e),this.ii=t,this.$o=r,this.Oo=i,this.connection=a,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=o,this.listener=s,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new ns(t,n)}return O(e,[{key:"Uo",value:function(){return 1===this.state||5===this.state||this.Ko()}},{key:"Ko",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.Go()}},{key:"stop",value:function(){var e=k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.Uo(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"Qo",value:function(){this.state=0,this.qo.reset()}},{key:"jo",value:function(){var e=this;this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,function(){return e.zo()}))}},{key:"Wo",value:function(e){this.Ho(),this.stream.send(e)}},{key:"zo",value:function(){var e=k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.Ko()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"Ho",value:function(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}},{key:"Jo",value:function(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}},{key:"close",value:function(){var e=k(m().mark(function e(t,n){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==t?this.qo.reset():n&&n.code===$.RESOURCE_EXHAUSTED?(Q(n.toString()),Q("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):n&&n.code===$.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.ao(n);case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"Yo",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.Xo(this.Fo),n=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(function(t){var r=c(t,2),i=r[0],a=r[1];e.Fo===n&&e.Zo(i,a)},function(n){t(function(){var t=new ee($.UNKNOWN,"Fetching auth token failed: "+n.message);return e.tu(t)})})}},{key:"Zo",value:function(e,t){var n=this,r=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo(function(){r(function(){return n.state=2,n.Lo=n.ii.enqueueAfterDelay(n.Oo,1e4,function(){return n.Ko()&&(n.state=3),Promise.resolve()}),n.listener.uo()})}),this.stream.ao(function(e){r(function(){return n.tu(e)})}),this.stream.onMessage(function(e){r(function(){return n.onMessage(e)})})}},{key:"Go",value:function(){var e=this;this.state=5,this.qo.No(k(m().mark(function t(){return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}},t)})))}},{key:"tu",value:function(e){return j("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"Xo",value:function(e){var t=this;return function(n){t.ii.enqueueAndForget(function(){return t.Fo===e?n():(j("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}}}]),e}(),is=function(e){w(n,rs);var t=b(n);function n(e,r,i,a,u,o){var s;return L(this,n),(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,i,a,o)).serializer=u,s}return O(n,[{key:"eu",value:function(e,t){return this.connection.Ro("Listen",e,t)}},{key:"onMessage",value:function(e){this.qo.reset();var t=ia(this.serializer,e),n=function(e){if(!("targetChange"in e))return me.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?me.min():t.readTime?Qi(t.readTime):me.min()}(e);return this.listener.nu(t,n)}},{key:"su",value:function(e){var t={};t.database=$i(this.serializer),t.addTarget=function(e,t){var n,r=t.target;if((n=Jn(r)?{documents:sa(e,r)}:{query:ca(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Ki(e,t.resumeToken);var i=zi(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(me.min())>0){n.readTime=Gi(e,t.snapshotVersion.toTimestamp());var a=zi(e,t.expectedCount);null!==a&&(n.expectedCount=a)}return n}(this.serializer,e);var n=fa(this.serializer,e);n&&(t.labels=n),this.Wo(t)}},{key:"iu",value:function(e){var t={};t.database=$i(this.serializer),t.removeTarget=e,this.Wo(t)}}]),n}(),as=function(e){w(n,rs);var t=b(n);function n(e,r,i,a,u,o){var s;return L(this,n),(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,o)).serializer=u,s.ru=!1,s}return O(n,[{key:"ou",get:function(){return this.ru}},{key:"start",value:function(){this.ru=!1,this.lastStreamToken=void 0,o(S(n.prototype),"start",this).call(this)}},{key:"Yo",value:function(){this.ru&&this.uu([])}},{key:"eu",value:function(e,t){return this.connection.Ro("Write",e,t)}},{key:"onMessage",value:function(e){if(X(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();var t=oa(e.writeResults,e.commitTime),n=Qi(e.commitTime);return this.listener.cu(n,t)}return X(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}},{key:"hu",value:function(){var e={};e.database=$i(this.serializer),this.Wo(e)}},{key:"uu",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map(function(e){return aa(t.serializer,e)})};this.Wo(n)}}]),n}(),us=function(e){w(n,function(){function e(){L(this,e)}return O(e)}());var t=b(n);function n(e,r,i,a){var u;return L(this,n),(u=t.call(this)).authCredentials=e,u.appCheckCredentials=r,u.connection=i,u.serializer=a,u.lu=!1,u}return O(n,[{key:"fu",value:function(){if(this.lu)throw new ee($.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"Io",value:function(e,t,n){var r=this;return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(i){var a=c(i,2),u=a[0],o=a[1];return r.connection.Io(e,t,n,u,o)}).catch(function(e){throw"FirebaseError"===e.name?(e.code===$.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new ee($.UNKNOWN,e.toString())})}},{key:"vo",value:function(e,t,n,r){var i=this;return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(a){var u=c(a,2),o=u[0],s=u[1];return i.connection.vo(e,t,n,o,s,r)}).catch(function(e){throw"FirebaseError"===e.name?(e.code===$.UNAUTHENTICATED&&(i.authCredentials.invalidateToken(),i.appCheckCredentials.invalidateToken()),e):new ee($.UNKNOWN,e.toString())})}},{key:"terminate",value:function(){this.lu=!0}}]),n}();function os(e,t,n){return ss.apply(this,arguments)}function ss(){return(ss=k(m().mark(function e(t,n,r){var i,a,u,o,s,c,l,f;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Z(t),u=function(e,t,n){var r=ca(e,t),i={},a=[],u=0;return n.forEach(function(e){var t="aggregate_"+u++;i[t]=e.alias,"count"===e.yt?a.push({alias:t,count:{}}):"avg"===e.yt?a.push({alias:t,avg:{field:ya(e.fieldPath)}}):"sum"===e.yt&&a.push({alias:t,sum:{field:ya(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:r.structuredQuery},parent:r.parent},du:i}}(a.serializer,cr(n),r),o=u.request,s=u.du,c=o.parent,a.connection.po||delete o.parent,e.next=4,a.vo("RunAggregationQuery",c,o,1);case 4:return X(1===(l=e.sent.filter(function(e){return!!e.result})).length),f=null===(i=l[0].result)||void 0===i?void 0:i.aggregateFields,e.abrupt("return",Object.keys(f).reduce(function(e,t){return e[s[t]]=f[t],e},{}));case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}var cs=function(){function e(t,n){L(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}return O(e,[{key:"gu",value:function(){var e=this;0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return e._u=null,e.pu("Backend didn't respond within 10 seconds."),e.yu("Offline"),Promise.resolve()}))}},{key:"Iu",value:function(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.yu("Offline")))}},{key:"set",value:function(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}},{key:"yu",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"pu",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.mu?(Q(t),this.mu=!1):j("OnlineStateTracker",t)}},{key:"Tu",value:function(){null!==this._u&&(this._u.cancel(),this._u=null)}}]),e}(),ls=O(function e(t,n,r,i,a){var u=this;L(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=a,this.Pu.Yr(function(e){r.enqueueAndForget(k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=xs(u),!e.t0){e.next=5;break}return j("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=k(m().mark(function e(t){var n;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=Z(t)).vu.add(4),e.next=4,ds(n);case 4:return n.bu.set("Unknown"),n.vu.delete(4),e.next=8,fs(n);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()(u);case 5:case"end":return e.stop()}},e)})))}),this.bu=new cs(r,i)});function fs(e){return hs.apply(this,arguments)}function hs(){return(hs=k(m().mark(function e(t){var n,r,i;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!xs(t)){e.next=18;break}n=y(t.Ru),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}},e,null,[[2,12,15,18]])}))).apply(this,arguments)}function ds(e){return vs.apply(this,arguments)}function vs(){return(vs=k(m().mark(function e(t){var n,r,i;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=y(t.Ru),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}},e,null,[[1,11,14,17]])}))).apply(this,arguments)}function ps(e,t){var n=Z(e);n.Au.has(t.targetId)||(n.Au.set(t.targetId,t),ws(n)?ks(n):Xs(n).Ko()&&ms(n,t))}function ys(e,t){var n=Z(e),r=Xs(n);n.Au.delete(t),r.Ko()&&gs(n,t),0===n.Au.size&&(r.Ko()?r.jo():xs(n)&&n.bu.set("Unknown"))}function ms(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(me.min())>0){var n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Xs(e).su(t)}function gs(e,t){e.Vu.qt(t),Xs(e).iu(t)}function ks(e){e.Vu=new Mi({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},le:function(t){return e.Au.get(t)||null},ue:function(){return e.datastore.serializer.databaseId}}),Xs(e).start(),e.bu.gu()}function ws(e){return xs(e)&&!Xs(e).Uo()&&e.Au.size>0}function xs(e){return 0===Z(e).vu.size}function bs(e){e.Vu=void 0}function Is(e){return Es.apply(this,arguments)}function Es(){return(Es=k(m().mark(function e(t){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.Au.forEach(function(e,n){ms(t,e)});case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ts(e,t){return Ss.apply(this,arguments)}function Ss(){return(Ss=k(m().mark(function e(t,n){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:bs(t),ws(t)?(t.bu.Iu(n),ks(t)):t.bu.set("Unknown");case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function _s(e,t,n){return Ds.apply(this,arguments)}function Ds(){return(Ds=k(m().mark(function e(t,n,r){var i;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.bu.set("Online"),!(n instanceof Ri&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=k(m().mark(function e(t,n){var r,i,a,u;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=y(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(u=a.value,e.t0=t.Au.has(u),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(u,r);case 10:t.Au.delete(u),t.Vu.removeTarget(u);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}},e,null,[[2,16,19,22]])}));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),j("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,Cs(t,e.t0);case 11:e.next=29;break;case 13:if(n instanceof Ni?t.Vu.Ht(n):n instanceof Fi?t.Vu.ne(n):t.Vu.Xt(n),r.isEqual(me.min())){e.next=29;break}return e.prev=14,e.next=17,wo(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.Vu.ce(t);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.Au.get(r);i&&e.Au.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(function(t,n){var r=e.Au.get(t);if(r){e.Au.set(t,r.withResumeToken(Ut.EMPTY_BYTE_STRING,r.snapshotVersion)),gs(e,t);var i=new xa(r.target,t,n,r.sequenceNumber);ms(e,i)}}),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 22:e.next=29;break;case 24:return e.prev=24,e.t2=e.catch(14),j("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,Cs(t,e.t2);case 29:case"end":return e.stop()}},e,null,[[1,6],[14,24]])}))).apply(this,arguments)}function Cs(e,t,n){return As.apply(this,arguments)}function As(){return(As=k(m().mark(function e(t,n,r){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Ge(n)){e.next=2;break}throw n;case 2:return t.vu.add(1),e.next=5,ds(t);case 5:t.bu.set("Offline"),r||(r=function(){return wo(t.localStore)}),t.asyncQueue.enqueueRetryable(k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return j("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.vu.delete(1),e.next=6,fs(t);case 6:case"end":return e.stop()}},e)})));case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ns(e,t){return t().catch(function(n){return Cs(e,n,t)})}function Fs(e){return Rs.apply(this,arguments)}function Rs(){return(Rs=k(m().mark(function e(t){var n,r,i,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Z(t),r=Js(n),i=n.Eu.length>0?n.Eu[n.Eu.length-1].batchId:-1;case 2:if(!Ls(n)){e.next=19;break}return e.prev=3,e.next=6,Io(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.Eu.length&&r.jo(),e.abrupt("break",19);case 10:i=a.batchId,Ms(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,Cs(n,e.t0);case 17:e.next=2;break;case 19:Os(n)&&Ps(n);case 20:case"end":return e.stop()}},e,null,[[3,13]])}))).apply(this,arguments)}function Ls(e){return xs(e)&&e.Eu.length<10}function Ms(e,t){e.Eu.push(t);var n=Js(e);n.Ko()&&n.ou&&n.uu(t.mutations)}function Os(e){return xs(e)&&!Js(e).Uo()&&e.Eu.length>0}function Ps(e){Js(e).start()}function Vs(e){return qs.apply(this,arguments)}function qs(){return(qs=k(m().mark(function e(t){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Js(t).hu();case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Bs(e){return Us.apply(this,arguments)}function Us(){return(Us=k(m().mark(function e(t){var n,r,i,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Js(t),r=y(t.Eu);try{for(r.s();!(i=r.n()).done;)a=i.value,n.uu(a.mutations)}catch(u){r.e(u)}finally{r.f()}case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function zs(e,t,n){return Gs.apply(this,arguments)}function Gs(){return(Gs=k(m().mark(function e(t,n,r){var i,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.Eu.shift(),a=pi.from(i,n,r),e.next=3,Ns(t,function(){return t.remoteSyncer.applySuccessfulWrite(a)});case 3:return e.next=5,Fs(t);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ks(e,t){return js.apply(this,arguments)}function js(){return(js=k(m().mark(function e(t,n){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&Js(t).ou,!e.t0){e.next=4;break}return e.next=4,function(){var e=k(m().mark(function e(t,n){var r,i;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!ki(i=n.code)||i===$.ABORTED){e.next=7;break}return r=t.Eu.shift(),Js(t).Qo(),e.next=5,Ns(t,function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)});case 5:return e.next=7,Fs(t);case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:Os(t)&&Ps(t);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Qs(e,t){return Ws.apply(this,arguments)}function Ws(){return(Ws=k(m().mark(function e(t,n){var r,i;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=Z(t)).asyncQueue.verifyOperationInProgress(),j("RemoteStore","RemoteStore received new credentials"),i=xs(r),r.vu.add(3),e.next=6,ds(r);case 6:return i&&r.bu.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.vu.delete(3),e.next=12,fs(r);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Hs(e,t){return Ys.apply(this,arguments)}function Ys(){return(Ys=k(m().mark(function e(t,n){var r;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Z(t),!n){e.next=7;break}return r.vu.delete(2),e.next=5,fs(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.vu.add(2),e.next=12,ds(r);case 12:r.bu.set("Unknown");case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Xs(e){return e.Su||(e.Su=function(e,t,n){var r=Z(e);return r.fu(),new is(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:Is.bind(null,e),ao:Ts.bind(null,e),nu:_s.bind(null,e)}),e.Ru.push(function(){var t=k(m().mark(function t(n){return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.Su.Qo(),ws(e)?ks(e):e.bu.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.Su.stop();case 6:bs(e);case 7:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())),e.Su}function Js(e){return e.Du||(e.Du=function(e,t,n){var r=Z(e);return r.fu(),new as(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:Vs.bind(null,e),ao:Ks.bind(null,e),au:Bs.bind(null,e),cu:zs.bind(null,e)}),e.Ru.push(function(){var t=k(m().mark(function t(n){return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.Du.Qo(),t.next=4,Fs(e);case 4:t.next=9;break;case 6:return t.next=8,e.Du.stop();case 8:e.Eu.length>0&&(j("RemoteStore","Stopping write stream with ".concat(e.Eu.length," pending writes")),e.Eu=[]);case 9:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())),e.Du}var Zs=function(){function e(t,n,r,i,a){L(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new te,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(e){})}return O(e,[{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout(function(){return t.handleDelayElapsed()},e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ee($.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)})}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var u=new e(t,n,Date.now()+r,i,a);return u.start(r),u}}]),e}();function $s(e,t){if(Q("AsyncQueue","".concat(t,": ").concat(e)),Ge(e))return new ee($.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var ec=function(){function e(t){L(this,e),this.comparator=t?function(e,n){return t(e,n)||be.comparator(e.key,n.key)}:function(e,t){return be.comparator(e.key,t.key)},this.keyedMap=Ir(),this.sortedSet=new Ft(this.comparator)}return O(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal(function(t,n){return e(t),!1})}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),tc=function(){function e(){L(this,e),this.Cu=new Ft(be.comparator)}return O(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):Y():this.Cu=this.Cu.insert(t,e)}},{key:"xu",value:function(){var e=[];return this.Cu.inorderTraversal(function(t,n){e.push(n)}),e}}]),e}(),nc=function(){function e(t,n,r,i,a,u,o,s,c){L(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=u,this.syncStateChanged=o,this.excludesMetadataChanges=s,this.hasCachedResults=c}return O(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i,a){var u=[];return n.forEach(function(e){u.push({type:0,doc:e})}),new e(t,n,ec.emptySet(n),u,r,i,!0,!1,a)}}]),e}(),rc=O(function e(){L(this,e),this.Nu=void 0,this.listeners=[]}),ic=O(function e(){L(this,e),this.queries=new kr(function(e){return dr(e)},hr),this.onlineState="Unknown",this.ku=new Set});function ac(e,t){return uc.apply(this,arguments)}function uc(){return(uc=k(m().mark(function e(t,n){var r,i,a,u,o;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Z(t),i=n.query,a=!1,(u=r.queries.get(i))||(a=!0,u=new rc),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:u.Nu=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),o=$s(e.t0,"Initialization of query '".concat(vr(n.query),"' failed")),e.abrupt("return",void n.onError(o));case 13:r.queries.set(i,u),u.listeners.push(n),n.Mu(r.onlineState),u.Nu&&n.$u(u.Nu)&&fc(r);case 14:case"end":return e.stop()}},e,null,[[3,9]])}))).apply(this,arguments)}function oc(e,t){return sc.apply(this,arguments)}function sc(){return(sc=k(m().mark(function e(t,n){var r,i,a,u,o;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Z(t),i=n.query,a=!1,(u=r.queries.get(i))&&(o=u.listeners.indexOf(n))>=0&&(u.listeners.splice(o,1),a=0===u.listeners.length),!a){e.next=6;break}return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function cc(e,t){var n,r=Z(e),i=!1,a=y(t);try{for(a.s();!(n=a.n()).done;){var u=n.value,o=u.query,s=r.queries.get(o);if(s){var c,l=y(s.listeners);try{for(l.s();!(c=l.n()).done;){c.value.$u(u)&&(i=!0)}}catch(f){l.e(f)}finally{l.f()}s.Nu=u}}}catch(f){a.e(f)}finally{a.f()}i&&fc(r)}function lc(e,t,n){var r=Z(e),i=r.queries.get(t);if(i){var a,u=y(i.listeners);try{for(u.s();!(a=u.n()).done;){a.value.onError(n)}}catch(o){u.e(o)}finally{u.f()}}r.queries.delete(t)}function fc(e){e.ku.forEach(function(e){e.next()})}var hc=function(){function e(t,n,r){L(this,e),this.query=t,this.Ou=n,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=r||{}}return O(e,[{key:"$u",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=y(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(u){r.e(u)}finally{r.f()}e=new nc(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}var a=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),a=!0):this.qu(e,this.onlineState)&&(this.Uu(e),a=!0),this.Bu=e,a}},{key:"onError",value:function(e){this.Ou.error(e)}},{key:"Mu",value:function(e){this.onlineState=e;var t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}},{key:"qu",value:function(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return(!this.options.Ku||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}},{key:"Lu",value:function(e){if(e.docChanges.length>0)return!0;var t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"Uu",value:function(e){e=nc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}]),e}(),dc=function(){function e(t,n){L(this,e),this.Gu=t,this.byteLength=n}return O(e,[{key:"Qu",value:function(){return"metadata"in this.Gu}}]),e}(),vc=function(){function e(t){L(this,e),this.serializer=t}return O(e,[{key:"rr",value:function(e){return Xi(this.serializer,e)}},{key:"ur",value:function(e){return e.metadata.exists?na(this.serializer,e.document,!1):bn.newNoDocument(this.rr(e.metadata.name),this.cr(e.metadata.readTime))}},{key:"cr",value:function(e){return Qi(e)}}]),e}(),pc=function(){function e(t,n,r){L(this,e),this.ju=t,this.localStore=n,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=yc(t)}return O(e,[{key:"zu",value:function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;if(e.Gu.namedQuery)this.queries.push(e.Gu.namedQuery);else if(e.Gu.documentMetadata){this.documents.push({metadata:e.Gu.documentMetadata}),e.Gu.documentMetadata.exists||++t;var n=ke.fromString(e.Gu.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Gu.document&&(this.documents[this.documents.length-1].document=e.Gu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:"Wu",value:function(e){var t,n=new Map,r=new vc(this.serializer),i=y(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.metadata.queries){var u,o=r.rr(a.metadata.name),s=y(a.metadata.queries);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=(n.get(c)||Ar()).add(o);n.set(c,l)}}catch(f){s.e(f)}finally{s.f()}}}}catch(f){i.e(f)}finally{i.f()}return n}},{key:"complete",value:function(){var e=k(m().mark(function e(){var t,n,r,i,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,No(this.localStore,new vc(this.serializer),this.documents,this.ju.id);case 2:t=e.sent,n=this.Wu(this.documents),r=y(this.queries),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=13;break}return a=i.value,e.next=11,Ro(this.localStore,a,n.get(a.name));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",(this.progress.taskState="Success",{progress:this.progress,Hu:this.collectionGroups,Ju:t}));case 22:case"end":return e.stop()}},e,this,[[5,15,18,21]])}));return function(){return e.apply(this,arguments)}}()}]),e}();function yc(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var mc=O(function e(t){L(this,e),this.key=t}),gc=O(function e(t){L(this,e),this.key=t}),kc=function(){function e(t,n){L(this,e),this.query=t,this.Yu=n,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=Ar(),this.mutatedKeys=Ar(),this.tc=mr(t),this.ec=new ec(this.tc)}return O(e,[{key:"nc",get:function(){return this.Yu}},{key:"sc",value:function(e,t){var n=this,r=t?t.ic:new tc,i=t?t.ec:this.ec,a=t?t.mutatedKeys:this.mutatedKeys,u=i,o=!1,s="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(function(e,t){var l=i.get(e),f=pr(n.query,t)?t:null,h=!!l&&n.mutatedKeys.has(l.key),d=!!f&&(f.hasLocalMutations||n.mutatedKeys.has(f.key)&&f.hasCommittedMutations),v=!1;l&&f?l.data.isEqual(f.data)?h!==d&&(r.track({type:3,doc:f}),v=!0):n.rc(l,f)||(r.track({type:2,doc:f}),v=!0,(s&&n.tc(f,s)>0||c&&n.tc(f,c)<0)&&(o=!0)):!l&&f?(r.track({type:0,doc:f}),v=!0):l&&!f&&(r.track({type:1,doc:l}),v=!0,(s||c)&&(o=!0)),v&&(f?(u=u.add(f),a=d?a.add(e):a.delete(e)):(u=u.delete(e),a=a.delete(e)))}),null!==this.query.limit)for(;u.size>this.query.limit;){var l="F"===this.query.limitType?u.last():u.first();u=u.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{ec:u,ic:r,zi:o,mutatedKeys:a}}},{key:"rc",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,i=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;var a=e.ic.xu();a.sort(function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Y()}};return n(e)-n(t)}(e.type,t.type)||r.tc(e.doc,t.doc)}),this.oc(n);var u=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,s=o!==this.Xu;return this.Xu=o,0!==a.length||s?{snapshot:new nc(this.query,e.ec,i,a,e.mutatedKeys,0===o,s,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:u}:{cc:u}}},{key:"Mu",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new tc,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}},{key:"ac",value:function(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}},{key:"oc",value:function(e){var t=this;e&&(e.addedDocuments.forEach(function(e){return t.Yu=t.Yu.add(e)}),e.modifiedDocuments.forEach(function(e){}),e.removedDocuments.forEach(function(e){return t.Yu=t.Yu.delete(e)}),this.current=e.current)}},{key:"uc",value:function(){var e=this;if(!this.current)return[];var t=this.Zu;this.Zu=Ar(),this.ec.forEach(function(t){e.ac(t.key)&&(e.Zu=e.Zu.add(t.key))});var n=[];return t.forEach(function(t){e.Zu.has(t)||n.push(new gc(t))}),this.Zu.forEach(function(e){t.has(e)||n.push(new mc(e))}),n}},{key:"hc",value:function(e){this.Yu=e.ir,this.Zu=Ar();var t=this.sc(e.documents);return this.applyChanges(t,!0)}},{key:"lc",value:function(){return nc.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}]),e}(),wc=O(function e(t,n,r){L(this,e),this.query=t,this.targetId=n,this.view=r}),xc=O(function e(t){L(this,e),this.key=t,this.fc=!1}),bc=function(){function e(t,n,r,i,a,u){L(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=u,this.dc={},this.wc=new kr(function(e){return dr(e)},hr),this._c=new Map,this.mc=new Set,this.gc=new Ft(be.comparator),this.yc=new Map,this.Ic=new Yu,this.Tc={},this.Ec=new Map,this.Ac=Eu.Mn(),this.onlineState="Unknown",this.vc=void 0}return O(e,[{key:"isPrimaryClient",get:function(){return!0===this.vc}}]),e}();function Ic(e,t){return Ec.apply(this,arguments)}function Ec(){return(Ec=k(m().mark(function e(t,n){var r,i,a,u,o,s;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=yl(t),!(u=r.wc.get(n))){e.next=6;break}i=u.targetId,r.sharedClientState.addLocalQueryTarget(i),a=u.view.lc(),e.next=15;break;case 6:return e.next=8,Eo(r.localStore,cr(n));case 8:return o=e.sent,s=r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.targetId,e.next=13,Tc(r,n,i,"current"===s,o.resumeToken);case 13:a=e.sent,r.isPrimaryClient&&ps(r.remoteStore,o);case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Tc(e,t,n,r,i){return Sc.apply(this,arguments)}function Sc(){return(Sc=k(m().mark(function e(t,n,r,i,a){var u,o,s,c,l,f;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.Rc=function(e,n,r){return(i=k(m().mark(function e(t,n,r,i){var a,u,o;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.sc(r),e.t0=a.zi,!e.t0){e.next=6;break}return e.next=5,_o(t.localStore,n.query,!1).then(function(e){var t=e.documents;return n.view.sc(t,a)});case 5:a=e.sent;case 6:return u=i&&i.targetChanges.get(n.targetId),o=n.view.applyChanges(a,t.isPrimaryClient,u),e.abrupt("return",(Qc(t,n.targetId,o.cc),o.snapshot));case 8:case"end":return e.stop()}},e)})),function(e,t,n,r){return i.apply(this,arguments)})(t,e,n,r);var i},e.next=3,_o(t.localStore,n,!0);case 3:return u=e.sent,o=new kc(n,u.ir),s=o.sc(u.documents),c=Ai.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState,a),l=o.applyChanges(s,t.isPrimaryClient,c),Qc(t,r,l.cc),f=new wc(n,r,o),e.abrupt("return",(t.wc.set(n,f),t._c.has(r)?t._c.get(r).push(n):t._c.set(r,[n]),l.snapshot));case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function _c(e,t){return Dc.apply(this,arguments)}function Dc(){return(Dc=k(m().mark(function e(t,n){var r,i,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Z(t),i=r.wc.get(n),!((a=r._c.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r._c.set(i.targetId,a.filter(function(e){return!hr(e,n)})),void r.wc.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,To(r.localStore,i.targetId,!1).then(function(){r.sharedClientState.clearQueryState(i.targetId),ys(r.remoteStore,i.targetId),Kc(r,i.targetId)}).catch(Oe);case 9:e.next=14;break;case 11:return Kc(r,i.targetId),e.next=14,To(r.localStore,i.targetId,!0);case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Cc(e,t,n){return Ac.apply(this,arguments)}function Ac(){return(Ac=k(m().mark(function e(t,n,r){var i,a,u;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=ml(t),e.prev=1,e.next=4,function(e,t){var n,r,i=Z(e),a=ye.now(),u=t.reduce(function(e,t){return e.add(t.key)},Ar());return i.persistence.runTransaction("Locally write mutations","readwrite",function(e){var o=xr(),s=Ar();return i.Zi.getEntries(e,u).next(function(e){(o=e).forEach(function(e,t){t.isValidDocument()||(s=s.add(e))})}).next(function(){return i.localDocuments.getOverlayedDocuments(e,o)}).next(function(r){n=r;var u,o=[],s=y(t);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=ri(c,n.get(c.key).overlayedDocument);null!=l&&o.push(new ui(c.key,l,xn(l.value.mapValue),Jr.exists(!0)))}}catch(f){s.e(f)}finally{s.f()}return i.mutationQueue.addMutationBatch(e,a,o,t)}).next(function(t){r=t;var a=t.applyToLocalDocumentSet(n,s);return i.documentOverlayCache.saveOverlays(e,t.batchId,a)})}).then(function(){return{batchId:r.batchId,changes:Er(n)}})}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.Tc[e.currentUser.toKey()];r||(r=new Ft(de)),r=r.insert(t,n),e.Tc[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,Yc(i,a.changes);case 9:return e.next=11,Fs(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),u=$s(e.t0,"Failed to persist write"),r.reject(u);case 17:case"end":return e.stop()}},e,null,[[1,13]])}))).apply(this,arguments)}function Nc(e,t){return Fc.apply(this,arguments)}function Fc(){return(Fc=k(m().mark(function e(t,n){var r,i;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Z(t),e.prev=1,e.next=4,xo(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach(function(e,t){var n=r.yc.get(t);n&&(X(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.fc=!0:e.modifiedDocuments.size>0?X(n.fc):e.removedDocuments.size>0&&(X(n.fc),n.fc=!1))}),e.next=8,Yc(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,Oe(e.t0);case 14:case"end":return e.stop()}},e,null,[[1,10]])}))).apply(this,arguments)}function Rc(e,t,n){var r=Z(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.wc.forEach(function(e,n){var r=n.view.Mu(t);r.snapshot&&i.push(r.snapshot)}),function(e,t){var n=Z(e);n.onlineState=t;var r=!1;n.queries.forEach(function(e,n){var i,a=y(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.Mu(t)&&(r=!0)}}catch(u){a.e(u)}finally{a.f()}}),r&&fc(n)}(r.eventManager,t),i.length&&r.dc.nu(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Lc(e,t,n){return Mc.apply(this,arguments)}function Mc(){return(Mc=k(m().mark(function e(t,n,r){var i,a,u,o,s,c;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((i=Z(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.yc.get(n),!(u=a&&a.key)){e.next=14;break}return o=(o=new Ft(be.comparator)).insert(u,bn.newNoDocument(u,me.min())),s=Ar().add(u),c=new Ci(me.min(),new Map,new Ft(de),o,s),e.next=9,Nc(i,c);case 9:i.gc=i.gc.remove(u),i.yc.delete(n),Hc(i),e.next=16;break;case 14:return e.next=16,To(i.localStore,n,!1).then(function(){return Kc(i,n,r)}).catch(Oe);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Oc(e,t){return Pc.apply(this,arguments)}function Pc(){return(Pc=k(m().mark(function e(t,n){var r,i,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Z(t),i=n.batch.batchId,e.prev=1,e.next=4,ko(r.localStore,n);case 4:return a=e.sent,Gc(r,i,null),zc(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,Yc(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Oe(e.t0);case 16:case"end":return e.stop()}},e,null,[[1,12]])}))).apply(this,arguments)}function Vc(e,t,n){return qc.apply(this,arguments)}function qc(){return(qc=k(m().mark(function e(t,n,r){var i,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=Z(t),e.prev=1,e.next=4,function(e,t){var n=Z(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var r;return n.mutationQueue.lookupMutationBatch(e,t).next(function(t){return X(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)}).next(function(){return n.mutationQueue.performConsistencyCheck(e)}).next(function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)}).next(function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)}).next(function(){return n.localDocuments.getDocuments(e,r)})})}(i.localStore,n);case 4:return a=e.sent,Gc(i,n,r),zc(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,Yc(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Oe(e.t0);case 16:case"end":return e.stop()}},e,null,[[1,12]])}))).apply(this,arguments)}function Bc(e,t){return Uc.apply(this,arguments)}function Uc(){return(Uc=k(m().mark(function e(t,n){var r,i,a,u;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return xs((r=Z(t)).remoteStore)||j("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.prev=2,e.next=5,function(e){var t=Z(r.localStore);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)})}();case 5:if(-1!==(i=e.sent)){e.next=8;break}return e.abrupt("return",void n.resolve());case 8:(a=r.Ec.get(i)||[]).push(n),r.Ec.set(i,a),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),u=$s(e.t0,"Initialization of waitForPendingWrites() operation failed"),n.reject(u);case 16:case"end":return e.stop()}},e,null,[[2,12]])}))).apply(this,arguments)}function zc(e,t){(e.Ec.get(t)||[]).forEach(function(e){e.resolve()}),e.Ec.delete(t)}function Gc(e,t,n){var r=Z(e),i=r.Tc[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.Tc[r.currentUser.toKey()]=i}}function Kc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=y(e._c.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.wc.delete(a),n&&e.dc.Pc(a,n)}}catch(u){i.e(u)}finally{i.f()}e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach(function(t){e.Ic.containsKey(t)||jc(e,t)})}function jc(e,t){e.mc.delete(t.path.canonicalString());var n=e.gc.get(t);null!==n&&(ys(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),Hc(e))}function Qc(e,t,n){var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof mc?(e.Ic.addReference(a.key,t),Wc(e,a)):a instanceof gc?(j("SyncEngine","Document no longer in limbo: "+a.key),e.Ic.removeReference(a.key,t),e.Ic.containsKey(a.key)||jc(e,a.key)):Y()}}catch(u){i.e(u)}finally{i.f()}}function Wc(e,t){var n=t.key,r=n.path.canonicalString();e.gc.get(n)||e.mc.has(r)||(j("SyncEngine","New document in limbo: "+n),e.mc.add(r),Hc(e))}function Hc(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){var t=e.mc.values().next().value;e.mc.delete(t);var n=new be(ke.fromString(t)),r=e.Ac.next();e.yc.set(r,new xc(n)),e.gc=e.gc.insert(n,r),ps(e.remoteStore,new xa(cr(rr(n.path)),r,"TargetPurposeLimboResolution",Xe.ct))}}function Yc(e,t,n){return Xc.apply(this,arguments)}function Xc(){return(Xc=k(m().mark(function e(t,n,r){var i,a,u,o;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Z(t),a=[],u=[],o=[],e.t0=i.wc.isEmpty(),e.t0){e.next=9;break}return i.wc.forEach(function(e,t){o.push(i.Rc(t,n,r).then(function(e){if((e||r)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){a.push(e);var n=ho.Li(t.targetId,e);u.push(n)}}))}),e.next=6,Promise.all(o);case 6:return i.dc.nu(a),e.next=9,function(){var e=k(m().mark(function e(t,n){var r,i,a,u,o,s,c,l;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Z(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return Ve.forEach(n,function(t){return Ve.forEach(t.Fi,function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)}).next(function(){return Ve.forEach(t.Bi,function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)})})})});case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),Ge(e.t0)){e.next=10;break}throw e.t0;case 10:j("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=y(n);try{for(i.s();!(a=i.n()).done;)u=a.value,o=u.targetId,u.fromCache||(s=r.Ji.get(o),c=s.snapshotVersion,l=s.withLastLimboFreeSnapshotVersion(c),r.Ji=r.Ji.insert(o,l))}catch(f){i.e(f)}finally{i.f()}case 13:case"end":return e.stop()}},e,null,[[1,6]])}));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,u);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Jc(e,t){return Zc.apply(this,arguments)}function Zc(){return(Zc=k(m().mark(function e(t,n){var r,i;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Z(t)).currentUser.isEqual(n)){e.next=11;break}return j("SyncEngine","User change. New user:",n.toKey()),e.next=5,mo(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.Ec.forEach(function(e){e.forEach(function(e){e.reject(new ee($.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Ec.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,Yc(r,i.er);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function $c(e,t){var n=Z(e),r=n.yc.get(t);if(r&&r.fc)return Ar().add(r.key);var i=Ar(),a=n._c.get(t);if(!a)return i;var u,o=y(a);try{for(o.s();!(u=o.n()).done;){var s=u.value,c=n.wc.get(s);i=i.unionWith(c.view.nc)}}catch(l){o.e(l)}finally{o.f()}return i}function el(e,t){return tl.apply(this,arguments)}function tl(){return(tl=k(m().mark(function e(t,n){var r,i,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Z(t),e.next=3,_o(r.localStore,n.query,!0);case 3:return i=e.sent,a=n.view.hc(i),e.abrupt("return",(r.isPrimaryClient&&Qc(r,n.targetId,a.cc),a));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function nl(e,t){return rl.apply(this,arguments)}function rl(){return(rl=k(m().mark(function e(t,n){var r;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Z(t),e.abrupt("return",Co(r.localStore,n).then(function(e){return Yc(r,e)}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function il(e,t,n,r){return al.apply(this,arguments)}function al(){return(al=k(m().mark(function e(t,n,r,i){var a,u;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Z(t),e.next=3,function(e,t){var n=Z(e),r=Z(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return r.Sn(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):Ve.resolve(null)})})}(a.localStore,n);case 3:if(null===(u=e.sent)){e.next=15;break}if("pending"!==r){e.next=10;break}return e.next=8,Fs(a.remoteStore);case 8:e.next=11;break;case 10:"acknowledged"===r||"rejected"===r?(Gc(a,n,i||null),zc(a,n),function(e,t){Z(Z(e).mutationQueue).Cn(t)}(a.localStore,n)):Y();case 11:return e.next=13,Yc(a,u);case 13:e.next=16;break;case 15:j("SyncEngine","Cannot apply mutation batch with id: "+n);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ul(e,t){return ol.apply(this,arguments)}function ol(){return(ol=k(m().mark(function e(t,n){var r,i,a,u,o,s,c,l;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(yl(r=Z(t)),ml(r),!0!==n||!0===r.vc){e.next=13;break}return i=r.sharedClientState.getAllActiveQueryTargets(),e.next=5,sl(r,i.toArray());case 5:return a=e.sent,r.vc=!0,e.next=9,Hs(r.remoteStore,!0);case 9:u=y(a);try{for(u.s();!(o=u.n()).done;)s=o.value,ps(r.remoteStore,s)}catch(f){u.e(f)}finally{u.f()}e.next=25;break;case 13:if(!1!==n||!1===r.vc){e.next=25;break}return c=[],l=Promise.resolve(),r._c.forEach(function(e,t){r.sharedClientState.isLocalQueryTarget(t)?c.push(t):l=l.then(function(){return Kc(r,t),To(r.localStore,t,!0)}),ys(r.remoteStore,t)}),e.next=19,l;case 19:return e.next=21,sl(r,c);case 21:return function(e){var t=Z(r);t.yc.forEach(function(e,n){ys(t.remoteStore,n)}),t.Ic.Ts(),t.yc=new Map,t.gc=new Ft(be.comparator)}(),r.vc=!1,e.next=25,Hs(r.remoteStore,!1);case 25:case"end":return e.stop()}},e)}))).apply(this,arguments)}function sl(e,t,n){return cl.apply(this,arguments)}function cl(){return(cl=k(m().mark(function e(t,n,r){var i,a,u,o,s,c,l,f,h,d,v,p,g,k;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=Z(t),a=[],u=[],o=y(n),e.prev=2,o.s();case 4:if((s=o.n()).done){e.next=45;break}if(c=s.value,l=void 0,!(f=i._c.get(c))||0===f.length){e.next=34;break}return e.next=11,Eo(i.localStore,cr(f[0]));case 11:l=e.sent,h=y(f),e.prev=13,h.s();case 15:if((d=h.n()).done){e.next=24;break}return v=d.value,p=i.wc.get(v),e.next=20,el(i,p);case 20:(g=e.sent).snapshot&&u.push(g.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),h.e(e.t0);case 29:return e.prev=29,h.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,Do(i.localStore,c);case 36:return k=e.sent,e.next=39,Eo(i.localStore,k);case 39:return l=e.sent,e.next=42,Tc(i,ll(k),c,!1,l.resumeToken);case 42:a.push(l);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),o.e(e.t1);case 50:return e.prev=50,o.f(),e.finish(50);case 53:return e.abrupt("return",(i.dc.nu(u),a));case 54:case"end":return e.stop()}},e,null,[[2,47,50,53],[13,26,29,32]])}))).apply(this,arguments)}function ll(e){return nr(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function fl(e){var t=Z(e);return Z(Z(t.localStore).persistence).$i()}function hl(e,t,n,r){return dl.apply(this,arguments)}function dl(){return(dl=k(m().mark(function e(t,n,r,i){var a,u,o,s;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=Z(t)).vc){e.next=3;break}return e.abrupt("return",void j("SyncEngine","Ignoring unexpected query state notification."));case 3:if(!((u=a._c.get(n))&&u.length>0)){e.next=20;break}e.t0=r,e.next="current"===e.t0?8:"not-current"===e.t0?8:"rejected"===e.t0?15:19;break;case 8:return e.next=10,Co(a.localStore,yr(u[0]));case 10:return o=e.sent,s=Ci.createSynthesizedRemoteEventForCurrentChange(n,"current"===r,Ut.EMPTY_BYTE_STRING),e.next=14,Yc(a,o,s);case 14:return e.abrupt("break",20);case 15:return e.next=17,To(a.localStore,n,!0);case 17:return Kc(a,n,i),e.abrupt("break",20);case 19:Y();case 20:case"end":return e.stop()}},e)}))).apply(this,arguments)}function vl(e,t,n){return pl.apply(this,arguments)}function pl(){return(pl=k(m().mark(function e(t,n,r){var i,a,u,o,s,c,l,f,h;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=yl(t)).vc){e.next=45;break}a=y(n),e.prev=3,a.s();case 5:if((u=a.n()).done){e.next=21;break}if(o=u.value,!i._c.has(o)){e.next=10;break}return j("SyncEngine","Adding an already active target "+o),e.abrupt("continue",19);case 10:return e.next=12,Do(i.localStore,o);case 12:return s=e.sent,e.next=15,Eo(i.localStore,s);case 15:return c=e.sent,e.next=18,Tc(i,ll(s),c.targetId,!1,c.resumeToken);case 18:ps(i.remoteStore,c);case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),a.e(e.t0);case 26:return e.prev=26,a.f(),e.finish(26);case 29:l=y(r),e.prev=30,h=m().mark(function e(){var t;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,e.t0=i._c.has(t),!e.t0){e.next=5;break}return e.next=5,To(i.localStore,t,!1).then(function(){ys(i.remoteStore,t),Kc(i,t)}).catch(Oe);case 5:case"end":return e.stop()}},e)}),l.s();case 33:if((f=l.n()).done){e.next=37;break}return e.delegateYield(h(),"t1",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(30),l.e(e.t2);case 42:return e.prev=42,l.f(),e.finish(42);case 45:case"end":return e.stop()}},e,null,[[3,23,26,29],[30,39,42,45]])}))).apply(this,arguments)}function yl(e){var t=Z(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Nc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=$c.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Lc.bind(null,t),t.dc.nu=cc.bind(null,t.eventManager),t.dc.Pc=lc.bind(null,t.eventManager),t}function ml(e){var t=Z(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Oc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Vc.bind(null,t),t}function gl(e,t,n){var r,i=Z(e);(r=k(m().mark(function e(t,n,r){var i,a,u,o,s;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getMetadata();case 3:return i=e.sent,e.next=6,function(e,t){var n=Z(e),r=Qi(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",function(e){return n.qs.getBundleMetadata(e,t.id)}).then(function(e){return!!e&&e.createTime.compareTo(r)>=0})}(t.localStore,i);case 6:if(!e.sent){e.next=11;break}return e.next=9,n.close();case 9:return r._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(i)),e.abrupt("return",Promise.resolve(new Set));case 11:return r._updateProgress(yc(i)),a=new pc(i,t.localStore,n.serializer),e.next=15,n.bc();case 15:u=e.sent;case 16:if(!u){e.next=26;break}return e.next=19,a.zu(u);case 19:return(o=e.sent)&&r._updateProgress(o),e.next=23,n.bc();case 23:u=e.sent;case 24:e.next=16;break;case 26:return e.next=28,a.complete();case 28:return s=e.sent,e.next=31,Yc(t,s.Ju,void 0);case 31:return e.next=33,function(e,t){var n=Z(e);return n.persistence.runTransaction("Save bundle","readwrite",function(e){return n.qs.saveBundleMetadata(e,t)})}(t.localStore,i);case 33:return r._completeWith(s.progress),e.abrupt("return",Promise.resolve(s.Hu));case 37:return e.prev=37,e.t0=e.catch(0),e.abrupt("return",(W("SyncEngine","Loading bundle failed with ".concat(e.t0)),r._failWith(e.t0),Promise.resolve(new Set)));case 40:case"end":return e.stop()}},e,null,[[0,37]])})),function(e,t,n){return r.apply(this,arguments)})(i,t,n).then(function(e){i.sharedClientState.notifyBundleLoaded(e)})}var kl=function(){function e(){L(this,e),this.synchronizeTabs=!1}return O(e,[{key:"initialize",value:function(){var e=k(m().mark(function e(t){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.serializer=ts(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),e.next=5,this.persistence.start();case 5:this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createGarbageCollectionScheduler",value:function(e,t){return null}},{key:"createIndexBackfillerScheduler",value:function(e,t){return null}},{key:"createLocalStore",value:function(e){return yo(this.persistence,new vo,e.initialUser,this.serializer)}},{key:"createPersistence",value:function(e){return new to(ro.zs,this.serializer)}},{key:"createSharedClientState",value:function(e){return new Ko}},{key:"terminate",value:function(){var e=k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),wl=function(e){w(n,kl);var t=b(n);function n(e){var r;return L(this,n),(r=t.call(this)).cacheSizeBytes=e,r}return O(n,[{key:"createGarbageCollectionScheduler",value:function(e,t){X(this.persistence.referenceDelegate instanceof io);var n=this.persistence.referenceDelegate.garbageCollector;return new Nu(n,e.asyncQueue,t)}},{key:"createPersistence",value:function(e){var t=void 0!==this.cacheSizeBytes?yu.withCacheSize(this.cacheSizeBytes):yu.DEFAULT;return new to(function(e){return io.zs(e,t)},this.serializer)}}]),n}(),xl=function(e){w(n,kl);var t=b(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this)).Vc=e,a.cacheSizeBytes=r,a.forceOwnership=i,a.synchronizeTabs=!1,a}return O(n,[{key:"initialize",value:function(){var e=k(m().mark(function e(t){var r=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(S(n.prototype),"initialize",this).call(this,t);case 2:return e.next=4,this.Vc.initialize(this,t);case 4:return e.next=6,ml(this.Vc.syncEngine);case 6:return e.next=8,Fs(this.Vc.remoteStore);case 8:return e.next=10,this.persistence.Ii(function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()});case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createLocalStore",value:function(e){return yo(this.persistence,new vo,e.initialUser,this.serializer)}},{key:"createGarbageCollectionScheduler",value:function(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new Nu(n,e.asyncQueue,t)}},{key:"createIndexBackfillerScheduler",value:function(e,t){var n=new Ye(t,this.persistence);return new He(e.asyncQueue,n)}},{key:"createPersistence",value:function(e){var t=fo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?yu.withCacheSize(this.cacheSizeBytes):yu.DEFAULT;return new so(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,$o(),es(),this.serializer,this.sharedClientState,!!this.forceOwnership)}},{key:"createSharedClientState",value:function(e){return new Ko}}]),n}(),bl=function(e){w(n,xl);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e,r,!1)).Vc=e,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return O(n,[{key:"initialize",value:function(){var e=k(m().mark(function e(t){var r,i=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(S(n.prototype),"initialize",this).call(this,t);case 2:if(r=this.Vc.syncEngine,e.t0=this.sharedClientState instanceof Go,!e.t0){e.next=8;break}return this.sharedClientState.syncEngine={jr:il.bind(null,r),zr:hl.bind(null,r),Wr:vl.bind(null,r),$i:fl.bind(null,r),Qr:nl.bind(null,r)},e.next=8,this.sharedClientState.start();case 8:return e.next=10,this.persistence.Ii(function(){var e=k(m().mark(function e(t){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ul(i.Vc.syncEngine,t);case 2:i.gcScheduler&&(t&&!i.gcScheduler.started?i.gcScheduler.start():t||i.gcScheduler.stop()),i.indexBackfillerScheduler&&(t&&!i.indexBackfillerScheduler.started?i.indexBackfillerScheduler.start():t||i.indexBackfillerScheduler.stop());case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createSharedClientState",value:function(e){var t=$o();if(!Go.D(t))throw new ee($.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=fo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Go(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]),n}(),Il=function(){function e(){L(this,e)}return O(e,[{key:"initialize",value:function(){var e=k(m().mark(function e(t,n){var r=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return Rc(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Jc.bind(null,this.syncEngine),e.next=12,Hs(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"createEventManager",value:function(e){return new ic}},{key:"createDatastore",value:function(e){var t,n=ts(e.databaseInfo.databaseId),r=(t=e.databaseInfo,new Zo(t));return function(e,t,n,r){return new us(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,r,n)}},{key:"createRemoteStore",value:function(e){var t,n,r,i,a,u=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return Rc(u.syncEngine,e,0)},a=Qo.D()?new Qo:new jo,new ls(t,n,r,i,a)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,u){var o=new bc(e,t,n,r,i,a);return u&&(o.vc=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){return(e=k(m().mark(function e(t){var n;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Z(t),j("RemoteStore","RemoteStore shutting down."),n.vu.add(5),e.next=5,ds(n);case 5:n.Pu.shutdown(),n.bu.set("Unknown");case 7:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}]),e}();function El(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{read:function(){return k(m().mark(function r(){var i;return m().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n<e.byteLength)){r.next=3;break}return i={value:e.slice(n,n+t),done:!1},r.abrupt("return",(n+=t,i));case 3:return r.abrupt("return",{done:!0});case 4:case"end":return r.stop()}},r)}))()},cancel:function(){return k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))()},releaseLock:function(){},closed:Promise.resolve()}}var Tl=function(){function e(t){L(this,e),this.observer=t,this.muted=!1}return O(e,[{key:"next",value:function(e){this.observer.next&&this.Sc(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.Sc(this.observer.error,e):Q("Uncaught Error in snapshot listener:",e.toString())}},{key:"Dc",value:function(){this.muted=!0}},{key:"Sc",value:function(e,t){var n=this;this.muted||setTimeout(function(){n.muted||e(t)},0)}}]),e}(),Sl=function(){function e(t,n){var r=this;L(this,e),this.Cc=t,this.serializer=n,this.metadata=new te,this.buffer=new Uint8Array,this.xc=new TextDecoder("utf-8"),this.Nc().then(function(e){e&&e.Qu()?r.metadata.resolve(e.Gu.metadata):r.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.Gu))))},function(e){return r.metadata.reject(e)})}return O(e,[{key:"close",value:function(){return this.Cc.cancel()}},{key:"getMetadata",value:function(){var e=k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.metadata.promise);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"bc",value:function(){var e=k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata();case 2:return e.abrupt("return",this.Nc());case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"Nc",value:function(){var e=k(m().mark(function e(){var t,n,r,i;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.kc();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return n=this.xc.decode(t),r=Number(n),isNaN(r)&&this.Mc("length string (".concat(n,") is not valid number")),e.next=9,this.$c(r);case 9:return i=e.sent,e.abrupt("return",new dc(JSON.parse(i),t.length+r));case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"Oc",value:function(){return this.buffer.findIndex(function(e){return e==="{".charCodeAt(0)})}},{key:"kc",value:function(){var e=k(m().mark(function e(){var t,n;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.Oc()<0)){e.next=7;break}return e.next=3,this.Fc();case 3:if(!e.sent){e.next=5;break}return e.abrupt("break",7);case 5:e.next=0;break;case 7:if(0!==this.buffer.length){e.next=9;break}return e.abrupt("return",null);case 9:return(t=this.Oc())<0&&this.Mc("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"$c",value:function(){var e=k(m().mark(function e(t){var n;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length<t)){e.next=8;break}return e.next=3,this.Fc();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.Mc("Reached the end of bundle when more is expected.");case 6:e.next=0;break;case 8:return n=this.xc.decode(this.buffer.slice(0,t)),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"Mc",value:function(e){throw this.Cc.cancel(),new Error("Invalid bundle format: ".concat(e))}},{key:"Fc",value:function(){var e=k(m().mark(function e(){var t,n;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Cc.read();case 2:return(t=e.sent).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),e.abrupt("return",t.done);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),_l=function(){function e(t){L(this,e),this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return O(e,[{key:"lookup",value:function(){var e=k(m().mark(function e(t){var n,r=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!(this.mutations.length>0)){e.next=2;break}throw new ee($.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");case 2:return e.next=4,function(){var e=k(m().mark(function e(t,n){var r,i,a,u,o,s;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Z(t),i=$i(r.serializer)+"/documents",a={documents:n.map(function(e){return Yi(r.serializer,e)})},e.next=5,r.vo("BatchGetDocuments",i,a,n.length);case 5:return u=e.sent,o=new Map,u.forEach(function(e){var t=ra(r.serializer,e);o.set(t.key.toString(),t)}),s=[],e.abrupt("return",(n.forEach(function(e){var t=o.get(e.toString());X(!!t),s.push(t)}),s));case 10:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,t);case 4:return n=e.sent,e.abrupt("return",(n.forEach(function(e){return r.recordVersion(e)}),n));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"update",value:function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}},{key:"delete",value:function(e){this.write(new hi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"commit",value:function(){var e=k(m().mark(function e(){var t,n=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!this.lastWriteError){e.next=2;break}throw this.lastWriteError;case 2:return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(e,t){var r=be.fromPath(t);n.mutations.push(new di(r,n.precondition(r)))}),e.next=7,function(){var e=k(m().mark(function e(t,n){var r,i,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Z(t),i=$i(r.serializer)+"/documents",a={writes:n.map(function(e){return aa(r.serializer,e)})},e.next=3,r.Io("Commit",i,a);case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,this.mutations);case 7:this.committed=!0;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"recordVersion",value:function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Y();t=me.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new ee($.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}},{key:"precondition",value:function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(me.min())?Jr.exists(!1):Jr.updateTime(t):Jr.none()}},{key:"preconditionForUpdate",value:function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(me.min()))throw new ee($.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Jr.updateTime(t)}return Jr.exists(!0)}},{key:"write",value:function(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:"ensureCommitNotCalled",value:function(){}}]),e}(),Dl=function(){function e(t,n,r,i,a){L(this,e),this.asyncQueue=t,this.datastore=n,this.options=r,this.updateFunction=i,this.deferred=a,this.Bc=r.maxAttempts,this.qo=new ns(this.asyncQueue,"transaction_retry")}return O(e,[{key:"run",value:function(){this.Bc-=1,this.Lc()}},{key:"Lc",value:function(){var e=this;this.qo.No(k(m().mark(function t(){var n,r;return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=new _l(e.datastore),(r=e.qc(n))&&r.then(function(t){e.asyncQueue.enqueueAndForget(function(){return n.commit().then(function(){e.deferred.resolve(t)}).catch(function(t){e.Uc(t)})})}).catch(function(t){e.Uc(t)});case 2:case"end":return t.stop()}},t)})))}},{key:"qc",value:function(e){try{var t=this.updateFunction(e);return!Je(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}},{key:"Uc",value:function(e){var t=this;this.Bc>0&&this.Kc(e)?(this.Bc-=1,this.asyncQueue.enqueueAndForget(function(){return t.Lc(),Promise.resolve()})):this.deferred.reject(e)}},{key:"Kc",value:function(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!ki(t)}return!1}}]),e}(),Cl=function(){function e(t,n,r,i){var a=this;L(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=B.UNAUTHENTICATED,this.clientId=he.A(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var e=k(m().mark(function e(t){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return j("FirestoreClient","Received user=",t.uid),e.next=3,a.authCredentialListener(t);case 3:a.user=t;case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,function(e){return j("FirestoreClient","Received new app check token=",e),a.appCheckCredentialListener(e,a.user)})}return O(e,[{key:"getConfiguration",value:function(){var e=k(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"setAppCheckTokenChangeListener",value:function(e){this.appCheckCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new ee($.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new te;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(k(m().mark(function n(){var r;return m().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e._onlineComponents,!n.t0){n.next=5;break}return n.next=5,e._onlineComponents.terminate();case 5:if(n.t1=e._offlineComponents,!n.t1){n.next=9;break}return n.next=9,e._offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=$s(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}},n,null,[[0,14]])}))),t.promise}}]),e}();function Al(e,t){return Nl.apply(this,arguments)}function Nl(){return(Nl=k(m().mark(function e(t,n){var r,i;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),j("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:i=r.initialUser,t.setCredentialChangeListener(function(){var e=k(m().mark(function e(t){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,mo(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t._offlineComponents=n;case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Fl(e,t){return Rl.apply(this,arguments)}function Rl(){return(Rl=k(m().mark(function e(t,n){var r,i;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,Ml(t);case 3:return r=e.sent,j("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,t.getConfiguration();case 7:return i=e.sent,e.next=10,n.initialize(r,i);case 10:t.setCredentialChangeListener(function(e){return Qs(n.remoteStore,e)}),t.setAppCheckTokenChangeListener(function(e,t){return Qs(n.remoteStore,t)}),t._onlineComponents=n;case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ll(e){return"FirebaseError"===e.name?e.code===$.FAILED_PRECONDITION||e.code===$.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}function Ml(e){return Ol.apply(this,arguments)}function Ol(){return(Ol=k(m().mark(function e(t){var n;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t._offlineComponents){e.next=21;break}if(!t._uninitializedComponentsProvider){e.next=18;break}return j("FirestoreClient","Using user provided OfflineComponentProvider"),e.prev=3,e.next=6,Al(t,t._uninitializedComponentsProvider._offline);case 6:e.next=16;break;case 8:if(e.prev=8,e.t0=e.catch(3),Ll(n=e.t0)){e.next=13;break}throw n;case 13:return W("Error using user provided cache. Falling back to memory cache: "+n),e.next=16,Al(t,new kl);case 16:e.next=21;break;case 18:return j("FirestoreClient","Using default OfflineComponentProvider"),e.next=21,Al(t,new kl);case 21:return e.abrupt("return",t._offlineComponents);case 22:case"end":return e.stop()}},e,null,[[3,8]])}))).apply(this,arguments)}function Pl(e){return Vl.apply(this,arguments)}function Vl(){return(Vl=k(m().mark(function e(t){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t._onlineComponents,e.t0){e.next=11;break}if(!t._uninitializedComponentsProvider){e.next=8;break}return j("FirestoreClient","Using user provided OnlineComponentProvider"),e.next=6,Fl(t,t._uninitializedComponentsProvider._online);case 6:e.next=11;break;case 8:return j("FirestoreClient","Using default OnlineComponentProvider"),e.next=11,Fl(t,new Il);case 11:return e.abrupt("return",t._onlineComponents);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ql(e){return Ml(e).then(function(e){return e.persistence})}function Bl(e){return Ml(e).then(function(e){return e.localStore})}function Ul(e){return Pl(e).then(function(e){return e.remoteStore})}function zl(e){return Pl(e).then(function(e){return e.syncEngine})}function Gl(e){return Pl(e).then(function(e){return e.datastore})}function Kl(e){return jl.apply(this,arguments)}function jl(){return(jl=k(m().mark(function e(t){var n,r;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Pl(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=Ic.bind(null,n.syncEngine),r.onUnlisten=_c.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ql(e){return e.asyncQueue.enqueue(k(m().mark(function t(){var n,r;return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ql(e);case 2:return n=t.sent,t.next=5,Ul(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!0),function(e){var t=Z(r);return t.vu.delete(0),fs(t)}()));case 7:case"end":return t.stop()}},t)})))}function Wl(e){return e.asyncQueue.enqueue(k(m().mark(function t(){var n,r;return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ql(e);case 2:return n=t.sent,t.next=5,Ul(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!1),function(){var e=k(m().mark(function e(t){var n;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=Z(t)).vu.add(0),e.next=4,ds(n);case 4:n.bu.set("Offline");case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()(r)));case 7:case"end":return t.stop()}},t)})))}function Hl(e,t){var n=new te;return e.asyncQueue.enqueueAndForget(k(m().mark(function r(){return m().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=k(m().mark(function e(t,n,r){var i,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,function(e,t){var n=Z(e);return n.persistence.runTransaction("read document","readonly",function(e){return n.localDocuments.getDocument(e,t)})}(t,n);case 3:(i=e.sent).isFoundDocument()?r.resolve(i):i.isNoDocument()?r.resolve(null):r.reject(new ee($.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a=$s(e.t0,"Failed to get document '".concat(n," from cache")),r.reject(a);case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Bl(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}},r)}))),n.promise}function Yl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new te;return e.asyncQueue.enqueueAndForget(k(m().mark(function i(){return m().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new Tl({next:function(a){t.enqueueAndForget(function(){return oc(e,u)});var o=a.docs.has(n);!o&&a.fromCache?i.reject(new ee($.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&a.fromCache&&r&&"server"===r.source?i.reject(new ee($.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),u=new hc(rr(n.path),a,{includeMetadataChanges:!0,Ku:!0});return ac(e,u)},i.next=3,Kl(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}},i)}))),r.promise}function Xl(e,t){var n=new te;return e.asyncQueue.enqueueAndForget(k(m().mark(function r(){return m().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=k(m().mark(function e(t,n,r){var i,a,u,o,s;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_o(t,n,!0);case 3:i=e.sent,a=new kc(n,i.ir),u=a.sc(i.documents),o=a.applyChanges(u,!1),r.resolve(o.snapshot),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),s=$s(e.t0,"Failed to execute query '".concat(n," against cache")),r.reject(s);case 14:case"end":return e.stop()}},e,null,[[0,10]])}));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Bl(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}},r)}))),n.promise}function Jl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new te;return e.asyncQueue.enqueueAndForget(k(m().mark(function i(){return m().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new Tl({next:function(n){t.enqueueAndForget(function(){return oc(e,u)}),n.fromCache&&"server"===r.source?i.reject(new ee($.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),u=new hc(n,a,{includeMetadataChanges:!0,Ku:!0});return ac(e,u)},i.next=3,Kl(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}},i)}))),r.promise}function Zl(e,t){var n=new Tl(t);return e.asyncQueue.enqueueAndForget(k(m().mark(function t(){return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){Z(e).ku.add(t),t.next()},t.next=3,Kl(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}},t)}))),function(){n.Dc(),e.asyncQueue.enqueueAndForget(k(m().mark(function t(){return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){Z(e).ku.delete(t)},t.next=3,Kl(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}},t)})))}}function $l(e,t,n,r){var i=function(e,t){return function(e,t){return new Sl(e,t)}(function(e,t){if(e instanceof Uint8Array)return El(e,t);if(e instanceof ArrayBuffer)return El(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?Ii().encode(e):e),t)}(n,ts(t));e.asyncQueue.enqueueAndForget(k(m().mark(function t(){return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=gl,t.next=3,zl(e);case 3:t.t1=t.sent,t.t2=i,t.t3=r,(0,t.t0)(t.t1,t.t2,t.t3);case 7:case"end":return t.stop()}},t)})))}function ef(e,t){return e.asyncQueue.enqueue(k(m().mark(function n(){return m().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){var n=Z(e);return n.persistence.runTransaction("Get named query","readonly",function(e){return n.qs.getNamedQuery(e,t)})},n.next=3,Bl(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}},n)})))}function tf(e,t){return e.asyncQueue.enqueue(k(m().mark(function n(){return m().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(){var e=k(m().mark(function e(t,n){var r,i,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Z(t),i=r.indexManager,a=[],e.abrupt("return",r.persistence.runTransaction("Configure indexes","readwrite",function(e){return i.getFieldIndexes(e).next(function(t){return function(e,t,n,r,i){e=_(e),t=_(t),e.sort(n),t.sort(n);for(var a=e.length,u=t.length,o=0,s=0;o<u&&s<a;){var c=n(e[s],t[o]);c<0?i(e[s++]):c>0?r(t[o++]):(o++,s++)}for(;o<u;)r(t[o++]);for(;s<a;)i(e[s++])}(t,n,Se,function(t){a.push(i.addFieldIndex(e,t))},function(t){a.push(i.deleteFieldIndex(e,t))})}).next(function(){return Ve.waitFor(a)})}));case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),n.next=3,Bl(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}},n)})))}function nf(e){var t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}var rf=new Map;function af(e,t,n){if(!n)throw new ee($.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function uf(e,t,n,r){if(!0===t&&!0===r)throw new ee($.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function of(e){if(!be.isDocumentKey(e))throw new ee($.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function sf(e){if(be.isDocumentKey(e))throw new ee($.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function cf(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==R(e)){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":Y()}function lf(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ee($.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=cf(e);throw new ee($.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}function ff(e,t){if(t<=0)throw new ee($.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}var hf=function(){function e(t){var n,r;if(L(this,e),void 0===t.host){if(void 0!==t.ssl)throw new ee($.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.cache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ee($.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}uf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nf(null!==(r=t.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ee($.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new ee($.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new ee($.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}return O(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}]),e}(),df=function(){function e(t,n,r,i){L(this,e),this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hf({}),this._settingsFrozen=!1}return O(e,[{key:"app",get:function(){if(!this._app)throw new ee($.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new ee($.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hf(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new re;switch(e.type){case"firstParty":return new oe(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ee($.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return e=this,(t=rf.get(e))&&(j("ComponentProvider","Removing Datastore"),rf.delete(e),t.terminate()),Promise.resolve();var e,t}}]),e}();function vf(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=(e=lf(e,df))._getSettings();if("firestore.googleapis.com"!==u.host&&u.host!==t&&W("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},u),{host:"".concat(t,":").concat(n),ssl:!1})),i.mockUserToken){var o,s;if("string"==typeof i.mockUserToken)o=i.mockUserToken,s=B.MOCK_USER;else{o=(0,a.createMockUserToken)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new ee($.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new B(c)}e._authCredentials=new ie(new ne(o,s))}}var pf=function(){function e(t,n,r){L(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return O(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new mf(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}();exports.DocumentReference=pf;var yf=function(){function e(t,n,r){L(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return O(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}();exports.Query=yf;var mf=function(e){w(n,yf);var t=b(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this,e,r,rr(i)))._path=i,a.type="collection",a}return O(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new pf(this.firestore,null,new be(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}();function gf(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,a.getModularInstance)(e),af("collection","path",t),e instanceof df){var u=ke.fromString.apply(ke,[t].concat(r));return sf(u),new mf(e,null,u)}if(!(e instanceof pf||e instanceof mf))throw new ee($.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(ke.fromString.apply(ke,[t].concat(r)));return sf(o),new mf(e.firestore,null,o)}function kf(e,t){if(e=lf(e,df),af("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new ee($.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new yf(e,null,function(e){return new tr(ke.emptyPath(),e)}(t))}function wf(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,a.getModularInstance)(e),1===arguments.length&&(t=he.A()),af("doc","path",t),e instanceof df){var u=ke.fromString.apply(ke,[t].concat(r));return of(u),new pf(e,null,new be(u))}if(!(e instanceof pf||e instanceof mf))throw new ee($.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(ke.fromString.apply(ke,[t].concat(r)));return of(o),new pf(e.firestore,e instanceof mf?e.converter:null,new be(o))}function xf(e,t){return e=(0,a.getModularInstance)(e),t=(0,a.getModularInstance)(t),(e instanceof pf||e instanceof mf)&&(t instanceof pf||t instanceof mf)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function bf(e,t){return e=(0,a.getModularInstance)(e),t=(0,a.getModularInstance)(t),e instanceof yf&&t instanceof yf&&e.firestore===t.firestore&&hr(e._query,t._query)&&e.converter===t.converter}exports.CollectionReference=mf;var If=function(){function e(){var t=this;L(this,e),this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new ns(this,"async_queue_retry"),this.Xc=function(){var e=es();e&&j("AsyncQueue","Visibility state changed to "+e.visibilityState),t.qo.Mo()};var n=es();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.Xc)}return O(e,[{key:"isShuttingDown",get:function(){return this.jc}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.Zc(),this.ta(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;var t=es();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}},{key:"enqueue",value:function(e){var t=this;if(this.Zc(),this.jc)return new Promise(function(){});var n=new te;return this.ta(function(){return t.jc&&t.Jc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget(function(){return t.Qc.push(e),t.ea()})}},{key:"ea",value:function(){var e=k(m().mark(function e(){var t=this;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.Qc.length){e.next=14;break}return e.prev=1,e.next=4,this.Qc[0]();case 4:this.Qc.shift(),this.qo.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),Ge(e.t0)){e.next=12;break}throw e.t0;case 12:j("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.Qc.length>0&&this.qo.No(function(){return t.ea()});case 14:case"end":return e.stop()}},e,this,[[1,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"ta",value:function(e){var t=this,n=this.Gc.then(function(){return t.Hc=!0,e().catch(function(e){throw t.Wc=e,t.Hc=!1,Q("INTERNAL UNHANDLED ERROR: ",function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(function(e){return t.Hc=!1,e})});return this.Gc=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);var i=Zs.createAndSchedule(this,e,t,n,function(e){return r.na(e)});return this.zc.push(i),i}},{key:"Zc",value:function(){this.Wc&&Y()}},{key:"verifyOperationInProgress",value:function(){}},{key:"sa",value:function(){var e=k(m().mark(function e(){var t;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.Gc,e.next=3,t;case 3:if(t!==this.Gc){e.next=0;break}case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"ia",value:function(e){var t,n=y(this.zc);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"ra",value:function(e){var t=this;return this.sa().then(function(){t.zc.sort(function(e,t){return e.targetTimeMs-t.targetTimeMs});var n,r=y(t.zc);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.sa()})}},{key:"oa",value:function(e){this.Yc.push(e)}},{key:"na",value:function(e){var t=this.zc.indexOf(e);this.zc.splice(t,1)}}]),e}();function Ef(e){return function(e,t){if("object"!=R(e)||null===e)return!1;var n,r=e,i=y(["next","error","complete"]);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"==typeof r[a])return!0}}catch(u){i.e(u)}finally{i.f()}return!1}(e)}var Tf=function(){function e(){L(this,e),this._progressObserver={},this._taskCompletionResolver=new te,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return O(e,[{key:"onProgress",value:function(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:"catch",value:function(e){return this._taskCompletionResolver.promise.catch(e)}},{key:"then",value:function(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:"_completeWith",value:function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:"_failWith",value:function(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:"_updateProgress",value:function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]),e}();exports.LoadBundleTask=Tf;var Sf=-1;exports.CACHE_SIZE_UNLIMITED=Sf;var _f=function(e){w(n,df);var t=b(n);function n(e,r,i,a){var u;return L(this,n),(u=t.call(this,e,r,i,a)).type="firestore",u._queue=new If,u._persistenceKey=(null==a?void 0:a.name)||"[DEFAULT]",u}return O(n,[{key:"_terminate",value:function(){return this._firestoreClient||Nf(this),this._firestoreClient.terminate()}}]),n}();function Df(e,t,r){r||(r="(default)");var i=(0,n._getProvider)(e,"firestore");if(i.isInitialized(r)){var u=i.getImmediate({identifier:r}),o=i.getOptions(r);if((0,a.deepEqual)(o,t))return u;throw new ee($.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new ee($.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ee($.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return i.initialize({options:t,instanceIdentifier:r})}function Cf(e,t){var r="object"==R(e)?e:(0,n.getApp)(),i="string"==typeof e?e:t||"(default)",u=(0,n._getProvider)(r,"firestore").getImmediate({identifier:i});if(!u._initialized){var o=(0,a.getDefaultEmulatorHostnameAndPort)("firestore");o&&vf.apply(void 0,[u].concat(_(o)))}return u}function Af(e){return e._firestoreClient||Nf(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Nf(e){var t,n,r,i=e._freezeSettings(),a=function(e,t,n,r){return new Yt(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,nf(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new Cl(e._authCredentials,e._appCheckCredentials,e._queue,a),(null===(n=i.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.cache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}function Ff(e,t){zf(e=lf(e,_f));var n=Af(e);if(n._uninitializedComponentsProvider)throw new ee($.FAILED_PRECONDITION,"SDK cache is already specified.");W("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");var r=e._freezeSettings(),i=new Il;return Lf(n,i,new xl(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function Rf(e){zf(e=lf(e,_f));var t=Af(e);if(t._uninitializedComponentsProvider)throw new ee($.FAILED_PRECONDITION,"SDK cache is already specified.");W("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");var n=e._freezeSettings(),r=new Il;return Lf(t,r,new bl(r,n.cacheSizeBytes))}function Lf(e,t,n){var r=new te;return e.asyncQueue.enqueue(k(m().mark(function i(){var a;return m().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Al(e,n);case 3:return i.next=5,Fl(e,t);case 5:r.resolve(),i.next=14;break;case 8:if(i.prev=8,i.t0=i.catch(0),Ll(a=i.t0)){i.next=13;break}throw a;case 13:W("Error enabling indexeddb cache. Falling back to memory cache: "+a),r.reject(a);case 14:case"end":return i.stop()}},i,null,[[0,8]])}))).then(function(){return r.promise})}function Mf(e){if(e._initialized&&!e._terminated)throw new ee($.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var t=new te;return e._queue.enqueueAndForgetEvenWhileRestricted(k(m().mark(function n(){return m().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,function(){var e=k(m().mark(function e(t){var n;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Be.D()){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t+"main",e.next=5,Be.delete(n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()(fo(e._databaseId,e._persistenceKey));case 3:t.resolve(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t.reject(n.t0);case 9:case"end":return n.stop()}},n,null,[[0,6]])}))),t.promise}function Of(e){return function(e){var t=new te;return e.asyncQueue.enqueueAndForget(k(m().mark(function n(){return m().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=Bc,n.next=3,zl(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}},n)}))),t.promise}(Af(e=lf(e,_f)))}function Pf(e){return Ql(Af(e=lf(e,_f)))}function Vf(e){return Wl(Af(e=lf(e,_f)))}function qf(e){return(0,n._removeServiceInstance)(e.app,"firestore",e._databaseId.database),e._delete()}function Bf(e,t){var n=Af(e=lf(e,_f)),r=new Tf;return $l(n,e._databaseId,t,r),r}function Uf(e,t){return ef(Af(e=lf(e,_f)),t).then(function(t){return t?new yf(e,null,t.query):null})}function zf(e){if(e._initialized||e._terminated)throw new ee($.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}exports.Firestore=_f;var Gf=O(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"count",n=arguments.length>1?arguments[1]:void 0;L(this,e),this._aggregateType=t,this._internalFieldPath=n,this.type="AggregateField"});exports.AggregateField=Gf;var Kf=function(){function e(t,n,r){L(this,e),this._userDataWriter=n,this._data=r,this.type="AggregateQuerySnapshot",this.query=t}return O(e,[{key:"data",value:function(){return this._userDataWriter.convertObjectMap(this._data)}}]),e}();exports.AggregateQuerySnapshot=Kf;var jf=function(){function e(t){L(this,e),this._byteString=t}return O(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(Ut.fromBase64String(t))}catch(t){throw new ee($.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(Ut.fromUint8Array(t))}}]),e}();exports.Bytes=jf;var Qf=function(){function e(){L(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new ee($.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new xe(n)}return O(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();function Wf(){return new Qf("__name__")}exports.FieldPath=Qf;var Hf=O(function e(t){L(this,e),this._methodName=t});exports.FieldValue=Hf;var Yf=function(){function e(t,n){if(L(this,e),!isFinite(t)||t<-90||t>90)throw new ee($.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new ee($.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return O(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return de(this._lat,e._lat)||de(this._long,e._long)}}]),e}();exports.GeoPoint=Yf;var Xf=/^__.*__$/,Jf=function(){function e(t,n,r){L(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return O(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new ui(e,this.data,this.fieldMask,t,this.fieldTransforms):new ai(e,this.data,t,this.fieldTransforms)}}]),e}(),Zf=function(){function e(t,n,r){L(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return O(e,[{key:"toMutation",value:function(e,t){return new ui(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function $f(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Y()}}var eh=function(){function e(t,n,r,i,a,u){L(this,e),this.settings=t,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===a&&this.ua(),this.fieldTransforms=a||[],this.fieldMask=u||[]}return O(e,[{key:"path",get:function(){return this.settings.path}},{key:"ca",get:function(){return this.settings.ca}},{key:"aa",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"ha",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.fa(e),r}},{key:"da",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.ua(),r}},{key:"wa",value:function(e){return this.aa({path:void 0,la:!0})}},{key:"_a",value:function(e){return wh(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})}},{key:"ua",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.fa(this.path.get(e))}},{key:"fa",value:function(e){if(0===e.length)throw this._a("Document fields must not be empty");if($f(this.ca)&&Xf.test(e))throw this._a('Document fields cannot begin and end with "__"')}}]),e}(),th=function(){function e(t,n,r){L(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.serializer=r||ts(t)}return O(e,[{key:"ya",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new eh({ca:e,methodName:t,ga:n,path:xe.emptyPath(),la:!1,ma:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}]),e}();function nh(e){var t=e._freezeSettings(),n=ts(e._databaseId);return new th(e._databaseId,!!t.ignoreUndefinedProperties,n)}function rh(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=e.ya(a.merge||a.mergeFields?2:0,t,n,i);yh("Data must be an object, but it was:",u,r);var o,s,c=vh(r,u);if(a.merge)o=new Vt(u.fieldMask),s=u.fieldTransforms;else if(a.mergeFields){var l,f=[],h=y(a.mergeFields);try{for(h.s();!(l=h.n()).done;){var d=mh(t,l.value,n);if(!u.contains(d))throw new ee($.INVALID_ARGUMENT,"Field '".concat(d,"' is specified in your field mask but missing from your input data."));xh(f,d)||f.push(d)}}catch(v){h.e(v)}finally{h.f()}o=new Vt(f),s=u.fieldTransforms.filter(function(e){return o.covers(e.field)})}else o=null,s=u.fieldTransforms;return new Jf(new wn(c),o,s)}var ih=function(e){w(n,Hf);var t=b(n);function n(){return L(this,n),t.apply(this,arguments)}return O(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.ca)throw 1===e.ca?e._a("".concat(this._methodName,"() can only appear at the top level of your update data")):e._a("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}();function ah(e,t,n){return new eh({ca:3,ga:t.settings.ga,methodName:e._methodName,la:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var uh=function(e){w(n,Hf);var t=b(n);function n(){return L(this,n),t.apply(this,arguments)}return O(n,[{key:"_toFieldTransform",value:function(e){return new Hr(e.path,new Br)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(),oh=function(e){w(n,Hf);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e)).pa=r,i}return O(n,[{key:"_toFieldTransform",value:function(e){var t=ah(this,e,!0),n=this.pa.map(function(e){return dh(e,t)}),r=new Ur(n);return new Hr(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(),sh=function(e){w(n,Hf);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e)).pa=r,i}return O(n,[{key:"_toFieldTransform",value:function(e){var t=ah(this,e,!0),n=this.pa.map(function(e){return dh(e,t)}),r=new Gr(n);return new Hr(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(),ch=function(e){w(n,Hf);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e)).Ia=r,i}return O(n,[{key:"_toFieldTransform",value:function(e){var t=new jr(e.serializer,Mr(e.serializer,this.Ia));return new Hr(e.path,t)}},{key:"isEqual",value:function(e){return this===e}}]),n}();function lh(e,t,n,r){var i=e.ya(1,t,n);yh("Data must be an object, but it was:",i,r);var u=[],o=wn.empty();At(r,function(e,r){var s=kh(t,e,n);r=(0,a.getModularInstance)(r);var c=i.da(s);if(r instanceof ih)u.push(s);else{var l=dh(r,c);null!=l&&(u.push(s),o.set(s,l))}});var s=new Vt(u);return new Zf(o,s,i.fieldTransforms)}function fh(e,t,n,r,i,u){var o=e.ya(1,t,n),s=[mh(t,r,n)],c=[i];if(u.length%2!=0)throw new ee($.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var l=0;l<u.length;l+=2)s.push(mh(t,u[l])),c.push(u[l+1]);for(var f=[],h=wn.empty(),d=s.length-1;d>=0;--d)if(!xh(f,s[d])){var v=s[d],p=c[d];p=(0,a.getModularInstance)(p);var y=o.da(v);if(p instanceof ih)f.push(v);else{var m=dh(p,y);null!=m&&(f.push(v),h.set(v,m))}}var g=new Vt(f);return new Zf(h,g,o.fieldTransforms)}function hh(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return dh(n,e.ya(r?4:3,t))}function dh(e,t){if(ph(e=(0,a.getModularInstance)(e)))return yh("Unsupported field value:",t,e),vh(e,t);if(e instanceof Hf)return function(e,t){if(!$f(t.ca))throw t._a("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t._a("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=y(e);try{for(a.s();!(n=a.n()).done;){var u=dh(n.value,t.wa(i));null==u&&(u={nullValue:"NULL_VALUE"}),r.push(u),i++}}catch(o){a.e(o)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,a.getModularInstance)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Mr(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=ye.fromDate(e);return{timestampValue:Gi(t.serializer,n)}}if(e instanceof ye){var r=new ye(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Gi(t.serializer,r)}}if(e instanceof Yf)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof jf)return{bytesValue:Ki(t.serializer,e._byteString)};if(e instanceof pf){var i=t.databaseId,u=e.firestore._databaseId;if(!u.isEqual(i))throw t._a("Document reference is for database ".concat(u.projectId,"/").concat(u.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:Wi(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a("Unsupported field value: ".concat(cf(e)))}(e,t)}function vh(e,t){var n={};return Nt(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):At(e,function(e,r){var i=dh(r,t.ha(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function ph(e){return!("object"!=R(e)||null===e||e instanceof Array||e instanceof Date||e instanceof ye||e instanceof Yf||e instanceof jf||e instanceof pf||e instanceof Hf)}function yh(e,t,n){if(!ph(n)||!function(e){return"object"==R(e)&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=cf(n);throw"an object"===r?t._a(e+" a custom object"):t._a(e+" "+r)}}function mh(e,t,n){if((t=(0,a.getModularInstance)(t))instanceof Qf)return t._internalPath;if("string"==typeof t)return kh(e,t);throw wh("Field path arguments must be of type string or ",e,!1,void 0,n)}var gh=new RegExp("[~\\*/\\[\\]]");function kh(e,t,n){if(t.search(gh)>=0)throw wh("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return v(Qf,_(t.split(".")))._internalPath}catch(r){throw wh("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function wh(e,t,n,r,i){var a=r&&!r.isEmpty(),u=void 0!==i,o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";var s="";return(a||u)&&(s+=" (found",a&&(s+=" in field ".concat(r)),u&&(s+=" in document ".concat(i)),s+=")"),new ee($.INVALID_ARGUMENT,o+e+s)}function xh(e,t){return e.some(function(e){return e.isEqual(t)})}var bh=function(){function e(t,n,r,i,a){L(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return O(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new pf(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new Ih(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(Eh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),Ih=function(e){w(n,bh);var t=b(n);function n(){return L(this,n),t.apply(this,arguments)}return O(n,[{key:"data",value:function(){return o(S(n.prototype),"data",this).call(this)}}]),n}();function Eh(e,t){return"string"==typeof t?kh(e,t):t instanceof Qf?t._internalPath:t._delegate._internalPath}function Th(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new ee($.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Sh=O(function e(){L(this,e)}),_h=function(e){w(n,Sh);var t=b(n);function n(){return L(this,n),t.apply(this,arguments)}return O(n)}();function Dh(e,t){for(var n=[],r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];t instanceof Sh&&n.push(t),function(e){var t=e.filter(function(e){return e instanceof Nh}).length,n=e.filter(function(e){return e instanceof Ch}).length;if(t>1||t>0&&n>0)throw new ee($.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(i));var u,o=y(n);try{for(o.s();!(u=o.n()).done;){e=u.value._apply(e)}}catch(s){o.e(s)}finally{o.f()}return e}exports.QueryConstraint=_h;var Ch=function(e){w(n,_h);var t=b(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this))._field=e,a._op=r,a._value=i,a.type="where",a}return O(n,[{key:"_apply",value:function(e){var t=this._parse(e);return Hh(e._query,t),new yf(e.firestore,e.converter,lr(e._query,t))}},{key:"_parse",value:function(e){var t=nh(e.firestore);return function(e,t,n,r,i,a,u){var o;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new ee($.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on documentId()."));if("in"===a||"not-in"===a){Wh(u,a);var s,c=[],l=y(u);try{for(l.s();!(s=l.n()).done;){var f=s.value;c.push(Qh(r,e,f))}}catch(h){l.e(h)}finally{l.f()}o={arrayValue:{values:c}}}else o=Qh(r,e,u)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||Wh(u,a),o=hh(n,"where",u,"in"===a||"not-in"===a);return Cn.create(i,a,o)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}();function Ah(e,t,n){var r=t,i=Eh("where",e);return Ch._create(i,r,n)}exports.QueryFieldFilterConstraint=Ch;var Nh=function(e){w(n,Sh);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).type=e,i._queryConstraints=r,i}return O(n,[{key:"_parse",value:function(e){var t=this._queryConstraints.map(function(t){return t._parse(e)}).filter(function(e){return e.getFilters().length>0});return 1===t.length?t[0]:An.create(t,this._getOperator())}},{key:"_apply",value:function(e){var t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){var n,r=e,i=y(t.getFlattenedFilters());try{for(i.s();!(n=i.n()).done;){var a=n.value;Hh(r,a),r=lr(r,a)}}catch(u){i.e(u)}finally{i.f()}}(e._query,t),new yf(e.firestore,e.converter,lr(e._query,t)))}},{key:"_getQueryConstraints",value:function(){return this._queryConstraints}},{key:"_getOperator",value:function(){return"and"===this.type?"and":"or"}}],[{key:"_create",value:function(e,t){return new n(e,t)}}]),n}();function Fh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.forEach(function(e){return Xh("or",e)}),Nh._create("or",t)}function Rh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.forEach(function(e){return Xh("and",e)}),Nh._create("and",t)}exports.QueryCompositeFilterConstraint=Nh;var Lh=function(e){w(n,_h);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this))._field=e,i._direction=r,i.type="orderBy",i}return O(n,[{key:"_apply",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new ee($.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new ee($.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Sn(t,n);return function(e,t){if(null===ar(e)){var n=ur(e);null!==n&&Yh(e,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new yf(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new tr(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}],[{key:"_create",value:function(e,t){return new n(e,t)}}]),n}();function Mh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Eh("orderBy",e);return Lh._create(n,t)}exports.QueryOrderByConstraint=Lh;var Oh=function(e){w(n,_h);var t=b(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this)).type=e,a._limit=r,a._limitType=i,a}return O(n,[{key:"_apply",value:function(e){return new yf(e.firestore,e.converter,fr(e._query,this._limit,this._limitType))}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}();function Ph(e){return ff("limit",e),Oh._create("limit",e,"F")}function Vh(e){return ff("limitToLast",e),Oh._create("limitToLast",e,"L")}exports.QueryLimitConstraint=Oh;var qh=function(e){w(n,_h);var t=b(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this)).type=e,a._docOrFields=r,a._inclusive=i,a}return O(n,[{key:"_apply",value:function(e){var t=jh(e,this.type,this._docOrFields,this._inclusive);return new yf(e.firestore,e.converter,function(e,t){return new tr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}();function Bh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return qh._create("startAt",t,!0)}function Uh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return qh._create("startAfter",t,!1)}exports.QueryStartAtConstraint=qh;var zh=function(e){w(n,_h);var t=b(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this)).type=e,a._docOrFields=r,a._inclusive=i,a}return O(n,[{key:"_apply",value:function(e){var t=jh(e,this.type,this._docOrFields,this._inclusive);return new yf(e.firestore,e.converter,function(e,t){return new tr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}();function Gh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return zh._create("endBefore",t,!1)}function Kh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return zh._create("endAt",t,!0)}function jh(e,t,n,r){if(n[0]=(0,a.getModularInstance)(n[0]),n[0]instanceof bh)return function(e,t,n,r,i){if(!r)throw new ee($.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var a,u=[],o=y(sr(e));try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.field.isKeyField())u.push(sn(t,r.key));else{var c=r.data.field(s.field);if(Qt(c))throw new ee($.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var l=s.field.canonicalString();throw new ee($.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(l,"' (used as the orderBy) does not exist."))}u.push(c)}}}catch(f){o.e(f)}finally{o.f()}return new In(u,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=nh(e.firestore);return function(e,t,n,r,i,a){var u=e.explicitOrderBy;if(i.length>u.length)throw new ee($.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));for(var o=[],s=0;s<i.length;s++){var c=i[s];if(u[s].field.isKeyField()){if("string"!=typeof c)throw new ee($.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(R(c)));if(!or(e)&&-1!==c.indexOf("/"))throw new ee($.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(c,"' contains a slash."));var l=e.path.child(ke.fromString(c));if(!be.isDocumentKey(l))throw new ee($.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(l,"' is not because it contains an odd number of segments."));var f=new be(l);o.push(sn(t,f))}else{var h=hh(n,r,c);o.push(h)}}return new In(o,a)}(e._query,e.firestore._databaseId,i,t,n,r)}function Qh(e,t,n){if("string"==typeof(n=(0,a.getModularInstance)(n))){if(""===n)throw new ee($.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!or(t)&&-1!==n.indexOf("/"))throw new ee($.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child(ke.fromString(n));if(!be.isDocumentKey(r))throw new ee($.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return sn(e,new be(r))}if(n instanceof pf)return sn(e,n._key);throw new ee($.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(cf(n),"."))}function Wh(e,t){if(!Array.isArray(e)||0===e.length)throw new ee($.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function Hh(e,t){if(t.isInequality()){var n=ur(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new ee($.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(r.toString(),"'"));var i=ar(e);null!==i&&Yh(e,r,i)}var a=function(e,t){var n,r=y(e);try{for(r.s();!(n=r.n()).done;){var i,a=y(n.value.getFlattenedFilters());try{for(a.s();!(i=a.n()).done;){var u=i.value;if(t.indexOf(u.op)>=0)return u.op}}catch(o){a.e(o)}finally{a.f()}}}catch(o){r.e(o)}finally{r.f()}return null}(e.filters,function(e){switch(t.op){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}());if(null!==a)throw a===t.op?new ee($.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new ee($.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(a.toString(),"' filters."))}function Yh(e,t,n){if(!n.isEqual(t))throw new ee($.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}function Xh(e,t){if(!(t instanceof Ch||t instanceof Nh))throw new ee($.INVALID_ARGUMENT,"Function ".concat(e,"() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'."))}exports.QueryEndAtConstraint=zh;var Jh=function(){function e(){L(this,e)}return O(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch($t(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Kt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(jt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Y()}}},{key:"convertObject",value:function(e,t){return this.convertObjectMap(e.fields,t)}},{key:"convertObjectMap",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",r={};return At(e,function(e,i){r[e]=t.convertValue(i,n)}),r}},{key:"convertGeoPoint",value:function(e){return new Yf(Kt(e.latitude),Kt(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map(function(e){return n.convertValue(e,t)})}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=Wt(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ht(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=Gt(e);return new ye(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=ke.fromString(e);X(wa(n));var r=new Xt(n.get(1),n.get(3)),i=new be(n.popFirst(5));return r.isEqual(t)||Q("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}();function Zh(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}exports.AbstractUserDataWriter=Jh;var $h=function(e){w(n,Jh);var t=b(n);function n(e){var r;return L(this,n),(r=t.call(this)).firestore=e,r}return O(n,[{key:"convertBytes",value:function(e){return new jf(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new pf(this.firestore,null,t)}}]),n}();function ed(e){return new Gf("sum",mh("sum",e))}function td(e){return new Gf("avg",mh("average",e))}function nd(){return new Gf("count")}function rd(e,t){var n,r;return e instanceof Gf&&t instanceof Gf&&e._aggregateType===t._aggregateType&&(null===(n=e._internalFieldPath)||void 0===n?void 0:n.canonicalString())===(null===(r=t._internalFieldPath)||void 0===r?void 0:r.canonicalString())}function id(e,t){return bf(e.query,t.query)&&(0,a.deepEqual)(e.data(),t.data())}var ad=function(){function e(t,n){L(this,e),this.hasPendingWrites=t,this.fromCache=n}return O(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}();exports.SnapshotMetadata=ad;var ud=function(e){w(n,bh);var t=b(n);function n(e,r,i,a,u,o){var s;return L(this,n),(s=t.call(this,e,r,i,a,o))._firestore=e,s._firestoreImpl=e,s.metadata=u,s}return O(n,[{key:"exists",value:function(){return o(S(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new od(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(Eh("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}();exports.DocumentSnapshot=ud;var od=function(e){w(n,ud);var t=b(n);function n(){return L(this,n),t.apply(this,arguments)}return O(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(S(n.prototype),"data",this).call(this,e)}}]),n}();exports.QueryDocumentSnapshot=od;var sd=function(){function e(t,n,r,i){L(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new ad(i.hasPendingWrites,i.fromCache),this.query=r}return O(e,[{key:"docs",get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach(function(r){e.call(t,new od(n._firestore,n._userDataWriter,r.key,r,new ad(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})}},{key:"docChanges",value:function(){var e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new ee($.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map(function(t){var r=new od(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ad(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);return t.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}})}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(function(e){return t||3!==e.type}).map(function(t){var n=new od(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ad(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:cd(t.type),doc:n,oldIndex:i,newIndex:a}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}]),e}();function cd(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Y()}}function ld(e,t){return e instanceof ud&&t instanceof ud?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof sd&&t instanceof sd&&e._firestore===t._firestore&&bf(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function fd(e){e=lf(e,pf);var t=lf(e.firestore,_f);return Yl(Af(t),e._key).then(function(n){return Td(t,e,n)})}exports.QuerySnapshot=sd;var hd=function(e){w(n,Jh);var t=b(n);function n(e){var r;return L(this,n),(r=t.call(this)).firestore=e,r}return O(n,[{key:"convertBytes",value:function(e){return new jf(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new pf(this.firestore,null,t)}}]),n}();function dd(e){e=lf(e,pf);var t=lf(e.firestore,_f),n=Af(t),r=new hd(t);return Hl(n,e._key).then(function(n){return new ud(t,r,e._key,n,new ad(null!==n&&n.hasLocalMutations,!0),e.converter)})}function vd(e){e=lf(e,pf);var t=lf(e.firestore,_f);return Yl(Af(t),e._key,{source:"server"}).then(function(n){return Td(t,e,n)})}function pd(e){e=lf(e,yf);var t=lf(e.firestore,_f),n=Af(t),r=new hd(t);return Th(e._query),Jl(n,e._query).then(function(n){return new sd(t,r,e,n)})}function yd(e){e=lf(e,yf);var t=lf(e.firestore,_f),n=Af(t),r=new hd(t);return Xl(n,e._query).then(function(n){return new sd(t,r,e,n)})}function md(e){e=lf(e,yf);var t=lf(e.firestore,_f),n=Af(t),r=new hd(t);return Jl(n,e._query,{source:"server"}).then(function(n){return new sd(t,r,e,n)})}function gd(e,t,n){e=lf(e,pf);var r=lf(e.firestore,_f),i=Zh(e.converter,t,n);return Ed(r,[rh(nh(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Jr.none())])}function kd(e,t,n){e=lf(e,pf);for(var r=lf(e.firestore,_f),i=nh(r),u=arguments.length,o=new Array(u>3?u-3:0),s=3;s<u;s++)o[s-3]=arguments[s];return Ed(r,[("string"==typeof(t=(0,a.getModularInstance)(t))||t instanceof Qf?fh(i,"updateDoc",e._key,t,n,o):lh(i,"updateDoc",e._key,t)).toMutation(e._key,Jr.exists(!0))])}function wd(e){return Ed(lf(e.firestore,_f),[new hi(e._key,Jr.none())])}function xd(e,t){var n=lf(e.firestore,_f),r=wf(e),i=Zh(e.converter,t);return Ed(n,[rh(nh(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Jr.exists(!1))]).then(function(){return r})}function bd(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,u,o;e=(0,a.getModularInstance)(e);var s={includeMetadataChanges:!1},c=0;"object"!=R(n[c])||Ef(n[c])||(s=n[c],c++);var l,f,h,d={includeMetadataChanges:s.includeMetadataChanges};if(Ef(n[c])){var v=n[c];n[c]=null===(i=v.next)||void 0===i?void 0:i.bind(v),n[c+1]=null===(u=v.error)||void 0===u?void 0:u.bind(v),n[c+2]=null===(o=v.complete)||void 0===o?void 0:o.bind(v)}if(e instanceof pf)f=lf(e.firestore,_f),h=rr(e._key.path),l={next:function(t){n[c]&&n[c](Td(f,e,t))},error:n[c+1],complete:n[c+2]};else{var p=lf(e,yf);f=lf(p.firestore,_f),h=p._query;var y=new hd(f);l={next:function(e){n[c]&&n[c](new sd(f,y,p,e))},error:n[c+1],complete:n[c+2]},Th(e._query)}return function(e,t,n,r){var i=new Tl(l),a=new hc(t,i,n);return e.asyncQueue.enqueueAndForget(k(m().mark(function t(){return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=ac,t.next=3,Kl(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}},t)}))),function(){i.Dc(),e.asyncQueue.enqueueAndForget(k(m().mark(function t(){return m().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=oc,t.next=3,Kl(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}},t)})))}}(Af(f),h,d)}function Id(e,t){return Zl(Af(e=lf(e,_f)),Ef(t)?t:{next:t})}function Ed(e,t){return function(e,t){var n=new te;return e.asyncQueue.enqueueAndForget(k(m().mark(function r(){return m().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=Cc,r.next=3,zl(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}},r)}))),n.promise}(Af(e),t)}function Td(e,t,n){var r=n.docs.get(t._key),i=new hd(e);return new ud(e,i,t._key,r,new ad(n.hasPendingWrites,n.fromCache),t.converter)}function Sd(e){return _d(e,{count:nd()})}function _d(e,t){var n=lf(e.firestore,_f),r=Af(n),i=function(e,t){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r));return n}(t,function(e,t){return new mi(t,e._aggregateType,e._internalFieldPath)});return function(e,t,n){var r=new te;return e.asyncQueue.enqueueAndForget(k(m().mark(function i(){var a;return m().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Gl(e);case 3:a=i.sent,r.resolve(os(a,t,n)),i.next=10;break;case 7:i.prev=7,i.t0=i.catch(0),r.reject(i.t0);case 10:case"end":return i.stop()}},i,null,[[0,7]])}))),r.promise}(r,e._query,i).then(function(t){return function(e,t,n){var r=new hd(e);return new Kf(t,r,n)}(n,e,t)})}var Dd=function(){function e(t){L(this,e),this.kind="memory",this._onlineComponentProvider=new Il,(null==t?void 0:t.garbageCollector)?this._offlineComponentProvider=t.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=new kl}return O(e,[{key:"toJSON",value:function(){return{kind:this.kind}}}]),e}(),Cd=function(){function e(t){var n;L(this,e),this.kind="persistent",(null==t?void 0:t.tabManager)?(t.tabManager._initialize(t),n=t.tabManager):(n=Vd(void 0))._initialize(t),this._onlineComponentProvider=n._onlineComponentProvider,this._offlineComponentProvider=n._offlineComponentProvider}return O(e,[{key:"toJSON",value:function(){return{kind:this.kind}}}]),e}(),Ad=function(){function e(){L(this,e),this.kind="memoryEager",this._offlineComponentProvider=new kl}return O(e,[{key:"toJSON",value:function(){return{kind:this.kind}}}]),e}(),Nd=function(){function e(t){L(this,e),this.kind="memoryLru",this._offlineComponentProvider=new wl(t)}return O(e,[{key:"toJSON",value:function(){return{kind:this.kind}}}]),e}();function Fd(){return new Ad}function Rd(e){return new Nd(null==e?void 0:e.cacheSizeBytes)}function Ld(e){return new Dd(e)}function Md(e){return new Cd(e)}var Od=function(){function e(t){L(this,e),this.forceOwnership=t,this.kind="persistentSingleTab"}return O(e,[{key:"toJSON",value:function(){return{kind:this.kind}}},{key:"_initialize",value:function(e){this._onlineComponentProvider=new Il,this._offlineComponentProvider=new xl(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}]),e}(),Pd=function(){function e(){L(this,e),this.kind="PersistentMultipleTab"}return O(e,[{key:"toJSON",value:function(){return{kind:this.kind}}},{key:"_initialize",value:function(e){this._onlineComponentProvider=new Il,this._offlineComponentProvider=new bl(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes)}}]),e}();function Vd(e){return new Od(null==e?void 0:e.forceOwnership)}function qd(){return new Pd}var Bd={maxAttempts:5},Ud=function(){function e(t,n){L(this,e),this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=nh(t)}return O(e,[{key:"set",value:function(e,t,n){this._verifyNotCommitted();var r=zd(e,this._firestore),i=Zh(r.converter,t,n),a=rh(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(a.toMutation(r._key,Jr.none())),this}},{key:"update",value:function(e,t,n){this._verifyNotCommitted();for(var r,i=zd(e,this._firestore),u=arguments.length,o=new Array(u>3?u-3:0),s=3;s<u;s++)o[s-3]=arguments[s];return r="string"==typeof(t=(0,a.getModularInstance)(t))||t instanceof Qf?fh(this._dataReader,"WriteBatch.update",i._key,t,n,o):lh(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(r.toMutation(i._key,Jr.exists(!0))),this}},{key:"delete",value:function(e){this._verifyNotCommitted();var t=zd(e,this._firestore);return this._mutations=this._mutations.concat(new hi(t._key,Jr.none())),this}},{key:"commit",value:function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:"_verifyNotCommitted",value:function(){if(this._committed)throw new ee($.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}]),e}();function zd(e,t){if((e=(0,a.getModularInstance)(e)).firestore!==t)throw new ee($.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}exports.WriteBatch=Ud;var Gd=function(e){w(n,e);var t=b(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e,r))._firestore=e,i}return O(n,[{key:"get",value:function(e){var t=this,r=zd(e,this._firestore),i=new hd(this._firestore);return o(S(n.prototype),"get",this).call(this,e).then(function(e){return new ud(t._firestore,i,r._key,e._document,new ad(!1,!1),r.converter)})}}]),n}(function(){function e(t,n){L(this,e),this._firestore=t,this._transaction=n,this._dataReader=nh(t)}return O(e,[{key:"get",value:function(e){var t=this,n=zd(e,this._firestore),r=new $h(this._firestore);return this._transaction.lookup([n._key]).then(function(e){if(!e||1!==e.length)return Y();var i=e[0];if(i.isFoundDocument())return new bh(t._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new bh(t._firestore,r,n._key,null,n.converter);throw Y()})}},{key:"set",value:function(e,t,n){var r=zd(e,this._firestore),i=Zh(r.converter,t,n),a=rh(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,a),this}},{key:"update",value:function(e,t,n){for(var r,i=zd(e,this._firestore),u=arguments.length,o=new Array(u>3?u-3:0),s=3;s<u;s++)o[s-3]=arguments[s];return r="string"==typeof(t=(0,a.getModularInstance)(t))||t instanceof Qf?fh(this._dataReader,"Transaction.update",i._key,t,n,o):lh(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,r),this}},{key:"delete",value:function(e){var t=zd(e,this._firestore);return this._transaction.delete(t._key),this}}]),e}());function Kd(e,t,n){e=lf(e,_f);var r=Object.assign(Object.assign({},Bd),n);return function(e){if(r.maxAttempts<1)throw new ee($.INVALID_ARGUMENT,"Max attempts must be at least 1")}(),function(e,t,n){var r=new te;return e.asyncQueue.enqueueAndForget(k(m().mark(function i(){var a;return m().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Gl(e);case 2:a=i.sent,new Dl(e.asyncQueue,a,n,t,r).run();case 4:case"end":return i.stop()}},i)}))),r.promise}(Af(e),function(n){return t(new Gd(e,n))},r)}function jd(){return new ih("deleteField")}function Qd(){return new uh("serverTimestamp")}function Wd(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new oh("arrayUnion",t)}function Hd(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new sh("arrayRemove",t)}function Yd(e){return new ch("increment",e)}function Xd(e){return Af(e=lf(e,_f)),new Ud(e,function(t){return Ed(e,t)})}function Jd(e,t){var n,r=Af(e=lf(e,_f));return r._uninitializedComponentsProvider&&"memory"!==(null===(n=r._uninitializedComponentsProvider)||void 0===n?void 0:n._offlineKind)?tf(r,function(e){var t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new ee($.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,n=[];if(Array.isArray(t.indexes)){var r,i=y(t.indexes);try{for(i.s();!(r=i.n()).done;){var a=r.value,u=Zd(a,"collectionGroup"),o=[];if(Array.isArray(a.fields)){var s,c=y(a.fields);try{for(c.s();!(s=c.n()).done;){var l=s.value,f=kh("setIndexConfiguration",Zd(l,"fieldPath"));"CONTAINS"===l.arrayConfig?o.push(new _e(f,2)):"ASCENDING"===l.order?o.push(new _e(f,0)):"DESCENDING"===l.order&&o.push(new _e(f,1))}}catch(h){c.e(h)}finally{c.f()}}n.push(new Ie(Ie.UNKNOWN_ID,u,o,Ce.empty()))}}catch(h){i.e(h)}finally{i.f()}}return n}(t)):(W("Cannot enable indexes when persistence is disabled"),Promise.resolve())}function Zd(e,t){if("string"!=typeof e[t])throw new ee($.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}exports.Transaction=Gd,function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){U=e}(n.SDK_VERSION),(0,n._registerComponent)(new r.Component("firestore",function(e,n){var r=n.instanceIdentifier,i=n.options,a=e.getProvider("app").getImmediate(),u=new _f(new ae(e.getProvider("auth-internal")),new ce(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ee($.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Xt(e.options.projectId,t)}(a,r),a);return i=Object.assign({useFetchStreams:t},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),(0,n.registerVersion)(q,"3.12.1",e),(0,n.registerVersion)(q,"3.12.1","esm2017")}();
},{"@firebase/app":"qn02","@firebase/component":"bXWY","@firebase/logger":"uNCT","@firebase/util":"VOc0","@firebase/webchannel-wrapper":"wvte","process":"g5IB"}],"R6ck":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@firebase/firestore");Object.keys(e).forEach(function(r){"default"!==r&&"__esModule"!==r&&(r in exports&&exports[r]===e[r]||Object.defineProperty(exports,r,{enumerable:!0,get:function(){return e[r]}}))});
},{"@firebase/firestore":"TIij"}],"hLvv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@firebase/app");Object.keys(e).forEach(function(r){"default"!==r&&"__esModule"!==r&&(r in exports&&exports[r]===e[r]||Object.defineProperty(exports,r,{enumerable:!0,get:function(){return e[r]}}))});var r="firebase",t="9.22.1";(0,e.registerVersion)(r,t,"app");
},{"@firebase/app":"qn02"}],"zPhD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._UploadTask=exports._TaskState=exports._TaskEvent=exports._Location=exports._FbsBlob=exports.StringFormat=exports.StorageErrorCode=exports.StorageError=void 0,exports._dataFromString=oe,exports._getChild=Kt,exports._invalidArgument=O,exports._invalidRootOperation=A,exports.connectStorageEmulator=Jt,exports.deleteObject=Xt,exports.getBlob=Yt,exports.getBytes=Bt,exports.getDownloadURL=Wt,exports.getMetadata=zt,exports.getStorage=Zt,exports.getStream=Qt,exports.list=Vt,exports.listAll=Gt,exports.ref=$t,exports.updateMetadata=jt,exports.uploadBytes=qt,exports.uploadBytesResumable=Ht,exports.uploadString=Ft;var e=require("@firebase/app"),t=require("@firebase/util"),n=require("@firebase/component");const r="firebasestorage.googleapis.com",s="storageBucket",o=12e4,i=6e5,a=1e3;class u extends t.FirebaseError{constructor(e,t,n=0){super(h(e),`Firebase Storage: ${t} (${h(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,u.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return h(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var c,l;function h(e){return"storage/"+e}function d(){return new u(c.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function _(e){return new u(c.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist.")}function p(e){return new u(c.QUOTA_EXCEEDED,"Quota for bucket '"+e+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function f(){return new u(c.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again.")}function g(){return new u(c.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function m(e){return new u(c.UNAUTHORIZED,"User does not have permission to access '"+e+"'.")}function b(){return new u(c.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function T(){return new u(c.CANCELED,"User canceled the upload/download.")}function R(e){return new u(c.INVALID_URL,"Invalid URL '"+e+"'.")}function w(e){return new u(c.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function k(){return new u(c.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+s+"' property when initializing the app?")}function E(){return new u(c.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function v(){return new u(c.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function y(){return new u(c.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function x(e){return new u(c.UNSUPPORTED_ENVIRONMENT,`${e} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function O(e){return new u(c.INVALID_ARGUMENT,e)}function U(){return new u(c.APP_DELETED,"The Firebase app was deleted.")}function A(e){return new u(c.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function C(e,t){return new u(c.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function S(e){throw new u(c.INTERNAL_ERROR,"Internal error: "+e)}exports.StorageError=u,exports.StorageErrorCode=c,function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(c||(exports.StorageErrorCode=c={}));class I{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=I.makeFromUrl(e,t)}catch(r){return new I(e,"")}if(""===n.path)return n;throw w(e)}static makeFromUrl(e,t){let n=null;const s=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i");function o(e){e.path_=decodeURIComponent(e.path)}const i=t.replace(/[.]/g,"\\."),a=[{regex:s,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${i}/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:o},{regex:new RegExp(`^https?://${t===r?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/([A-Za-z0-9.\\-_]+)/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:o}];for(let r=0;r<a.length;r++){const t=a[r],s=t.regex.exec(e);if(s){const e=s[t.indices.bucket];let r=s[t.indices.path];r||(r=""),n=new I(e,r),t.postModify(n);break}}if(null==n)throw R(e);return n}}exports._Location=I;class N{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function P(e,t,n){let r=1,s=null,o=null,i=!1,a=0;function u(){return 2===a}let c=!1;function l(...e){c||(c=!0,t.apply(null,e))}function h(t){s=setTimeout(()=>{s=null,e(_,u())},t)}function d(){o&&clearTimeout(o)}function _(e,...t){if(c)return void d();if(e)return d(),void l.call(null,e,...t);if(u()||i)return d(),void l.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),h(n)}let p=!1;function f(e){p||(p=!0,d(),c||(null!==s?(e||(a=2),clearTimeout(s),h(0)):e||(a=1)))}return h(0),o=setTimeout(()=>{i=!0,f(!0)},n),f}function D(e){e(!1)}function L(e){return void 0!==e}function M(e){return"function"==typeof e}function B(e){return"object"==typeof e&&!Array.isArray(e)}function q(e){return"string"==typeof e||e instanceof String}function F(e){return H()&&e instanceof Blob}function H(){return"undefined"!=typeof Blob&&!(0,t.isNode)()}function z(e,t,n,r){if(r<t)throw O(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw O(`Invalid value for '${e}'. Expected ${n} or less.`)}function j(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function V(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1)}function G(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),s=-1!==t.indexOf(e);return n||r||s}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(l||(l={}));class W{constructor(e,t,n,r,s,o,i,a,u,c,l,h=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=i,this.errorCallback_=a,this.timeout_=u,this.progressCallback_=c,this.connectionFactory_=l,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new X(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===l.NO_ERROR,s=n.getStatus();if(!t||G(s,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===l.ABORT;return void e(!1,new X(!1,null,t))}const o=-1!==this.successCodes_.indexOf(s);e(!0,new X(o,n))})},t=(e,t)=>{const n=this.resolve_,r=this.reject_,s=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(s,s.getResponse());L(e)?n(e):n()}catch(o){r(o)}else if(null!==s){const e=d();e.serverResponse=s.getErrorText(),this.errorCallback_?r(this.errorCallback_(s,e)):r(e)}else if(t.canceled){r(this.appDelete_?U():T())}else{r(b())}};this.canceled_?t(0,new X(!1,null,!0)):this.backoffId_=P(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&D(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class X{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function $(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}function K(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}function Z(e,t){t&&(e["X-Firebase-GMPID"]=t)}function J(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}function Y(e,t,n,r,s,o,i=!0){const a=V(e.urlParams),u=e.url+a,c=Object.assign({},e.headers);return Z(c,t),$(c,n),K(c,o),J(c,r),new W(u,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,s,i)}function Q(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function ee(...e){const t=Q();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(H())return new Blob(e);throw new u(c.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function te(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}function ne(e){if("undefined"==typeof atob)throw x("base-64");return atob(e)}const re={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};exports.StringFormat=re;class se{constructor(e,t){this.data=e,this.contentType=t||null}}function oe(e,t){switch(e){case re.RAW:return new se(ie(t));case re.BASE64:case re.BASE64URL:return new se(ue(e,t));case re.DATA_URL:return new se(le(t),he(t))}throw d()}function ie(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296==(64512&r)){if(n<e.length-1&&56320==(64512&e.charCodeAt(n+1))){r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else t.push(239,191,189)}else 56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function ae(e){let t;try{t=decodeURIComponent(e)}catch(n){throw C(re.DATA_URL,"Malformed data URL.")}return ie(t)}function ue(e,t){switch(e){case re.BASE64:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r){throw C(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case re.BASE64URL:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r){throw C(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=ne(t)}catch(s){if(s.message.includes("polyfill"))throw s;throw C(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let o=0;o<n.length;o++)r[o]=n.charCodeAt(o);return r}class ce{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw C(re.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=de(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=e.substring(e.indexOf(",")+1)}}function le(e){const t=new ce(e);return t.base64?ue(re.BASE64,t.rest):ae(t.rest)}function he(e){return new ce(e).contentType}function de(e,t){return!!(e.length>=t.length)&&e.substring(e.length-t.length)===t}class _e{constructor(e,t){let n=0,r="";F(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(F(this.data_)){const n=te(this.data_,e,t);return null===n?null:new _e(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new _e(n,!0)}}static getBlob(...e){if(H()){const t=e.map(e=>e instanceof _e?e.data_:e);return new _e(ee.apply(null,t))}{const t=e.map(e=>q(e)?oe(re.RAW,e).data:e.data_);let n=0;t.forEach(e=>{n+=e.byteLength});const r=new Uint8Array(n);let s=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)r[s++]=e[t]}),new _e(r,!0)}}uploadData(){return this.data_}}function pe(e){let t;try{t=JSON.parse(e)}catch(n){return null}return B(t)?t:null}function fe(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}function ge(e,t){const n=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?n:e+"/"+n}function me(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function be(e,t){return t}exports._FbsBlob=_e;class Te{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||be}}let Re=null;function we(e){return!q(e)||e.length<2?e:me(e)}function ke(){if(Re)return Re;const e=[];e.push(new Te("bucket")),e.push(new Te("generation")),e.push(new Te("metageneration")),e.push(new Te("name","fullPath",!0));const t=new Te("name");t.xform=function(e,t){return we(t)},e.push(t);const n=new Te("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new Te("timeCreated")),e.push(new Te("updated")),e.push(new Te("md5Hash",null,!0)),e.push(new Te("cacheControl",null,!0)),e.push(new Te("contentDisposition",null,!0)),e.push(new Te("contentEncoding",null,!0)),e.push(new Te("contentLanguage",null,!0)),e.push(new Te("contentType",null,!0)),e.push(new Te("metadata","customMetadata",!0)),Re=e}function Ee(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,s=new I(n,r);return t._makeStorageReference(s)}})}function ve(e,t,n){const r={type:"file"},s=n.length;for(let o=0;o<s;o++){const e=n[o];r[e.local]=e.xform(r,t[e.server])}return Ee(r,e),r}function ye(e,t,n){const r=pe(t);return null===r?null:ve(e,r,n)}function xe(e,t,n,r){const s=pe(t);if(null===s)return null;if(!q(s.downloadTokens))return null;const o=s.downloadTokens;if(0===o.length)return null;const i=encodeURIComponent;return o.split(",").map(t=>{const s=e.bucket,o=e.fullPath;return j("/b/"+i(s)+"/o/"+i(o),n,r)+V({alt:"media",token:t})})[0]}function Oe(e,t){const n={},r=t.length;for(let s=0;s<r;s++){const r=t[s];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}const Ue="prefixes",Ae="items";function Ce(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[Ue])for(const s of n[Ue]){const n=s.replace(/\/$/,""),o=e._makeStorageReference(new I(t,n));r.prefixes.push(o)}if(n[Ae])for(const s of n[Ae]){const n=e._makeStorageReference(new I(t,s.name));r.items.push(n)}return r}function Se(e,t,n){const r=pe(n);return null===r?null:Ce(e,t,r)}class Ie{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Ne(e){if(!e)throw d()}function Pe(e,t){return function(n,r){const s=ye(e,r,t);return Ne(null!==s),s}}function De(e,t){return function(n,r){const s=Se(e,t,r);return Ne(null!==s),s}}function Le(e,t){return function(n,r){const s=ye(e,r,t);return Ne(null!==s),xe(s,r,e.host,e._protocol)}}function Me(e){return function(t,n){let r;return(r=401===t.getStatus()?t.getErrorText().includes("Firebase App Check token is invalid")?g():f():402===t.getStatus()?p(e.bucket):403===t.getStatus()?m(e.path):n).status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function Be(e){const t=Me(e);return function(n,r){let s=t(n,r);return 404===n.getStatus()&&(s=_(e.path)),s.serverResponse=r.serverResponse,s}}function qe(e,t,n){const r=j(t.fullServerUrl(),e.host,e._protocol),s=e.maxOperationRetryTime,o=new Ie(r,"GET",Pe(e,n),s);return o.errorHandler=Be(t),o}function Fe(e,t,n,r,s){const o={};t.isRoot?o.prefix="":o.prefix=t.path+"/",n&&n.length>0&&(o.delimiter=n),r&&(o.pageToken=r),s&&(o.maxResults=s);const i=j(t.bucketOnlyServerUrl(),e.host,e._protocol),a=e.maxOperationRetryTime,u=new Ie(i,"GET",De(e,t.bucket),a);return u.urlParams=o,u.errorHandler=Me(t),u}function He(e,t,n){const r=j(t.fullServerUrl(),e.host,e._protocol)+"?alt=media",s=e.maxOperationRetryTime,o=new Ie(r,"GET",(e,t)=>t,s);return o.errorHandler=Be(t),void 0!==n&&(o.headers.Range=`bytes=0-${n}`,o.successCodes=[200,206]),o}function ze(e,t,n){const r=j(t.fullServerUrl(),e.host,e._protocol),s=e.maxOperationRetryTime,o=new Ie(r,"GET",Le(e,n),s);return o.errorHandler=Be(t),o}function je(e,t,n,r){const s=j(t.fullServerUrl(),e.host,e._protocol),o=Oe(n,r),i=e.maxOperationRetryTime,a=new Ie(s,"PATCH",Pe(e,r),i);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=o,a.errorHandler=Be(t),a}function Ve(e,t){const n=j(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime;const s=new Ie(n,"DELETE",function(e,t){},r);return s.successCodes=[200,204],s.errorHandler=Be(t),s}function Ge(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}function We(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=Ge(null,t)),r}function Xe(e,t,n,r,s){const o=t.bucketOnlyServerUrl(),i={"X-Goog-Upload-Protocol":"multipart"};const a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();i["Content-Type"]="multipart/related; boundary="+a;const u=We(t,r,s),c="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Oe(u,n)+"\r\n--"+a+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",l="\r\n--"+a+"--",h=_e.getBlob(c,r,l);if(null===h)throw E();const d={name:u.fullPath},_=j(o,e.host,e._protocol),p=e.maxUploadRetryTime,f=new Ie(_,"POST",Pe(e,n),p);return f.urlParams=d,f.headers=i,f.body=h.uploadData(),f.errorHandler=Me(t),f}class $e{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function Ke(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(r){Ne(!1)}return Ne(!!n&&-1!==(t||["active"]).indexOf(n)),n}function Ze(e,t,n,r,s){const o=t.bucketOnlyServerUrl(),i=We(t,r,s),a={name:i.fullPath},u=j(o,e.host,e._protocol),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":i.contentType,"Content-Type":"application/json; charset=utf-8"},l=Oe(i,n),h=e.maxUploadRetryTime;const d=new Ie(u,"POST",function(e){let t;Ke(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(n){Ne(!1)}return Ne(q(t)),t},h);return d.urlParams=a,d.headers=c,d.body=l,d.errorHandler=Me(t),d}function Je(e,t,n,r){const s=e.maxUploadRetryTime,o=new Ie(n,"POST",function(e){const t=Ke(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(o){Ne(!1)}n||Ne(!1);const s=Number(n);return Ne(!isNaN(s)),new $e(s,r.size(),"final"===t)},s);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=Me(t),o}const Ye=262144;function Qe(e,t,n,r,s,o,i,a){const u=new $e(0,0);if(i?(u.current=i.current,u.total=i.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw v();const c=u.total-u.current;let l=c;s>0&&(l=Math.min(l,s));const h=u.current,d=h+l;let _="";const p={"X-Goog-Upload-Command":_=0===l?"finalize":c===l?"upload, finalize":"upload","X-Goog-Upload-Offset":`${u.current}`},f=r.slice(h,d);if(null===f)throw E();const g=t.maxUploadRetryTime,m=new Ie(n,"POST",function(e,n){const s=Ke(e,["active","final"]),i=u.current+l,a=r.size();let c;return c="final"===s?Pe(t,o)(e,n):null,new $e(i,a,"final"===s,c)},g);return m.headers=p,m.body=f.uploadData(),m.progressCallback=a||null,m.errorHandler=Me(e),m}const et={STATE_CHANGED:"state_changed"};exports._TaskEvent=et;const tt={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function nt(e){switch(e){case"running":case"pausing":case"canceling":return tt.RUNNING;case"paused":return tt.PAUSED;case"success":return tt.SUCCESS;case"canceled":return tt.CANCELED;case"error":default:return tt.ERROR}}exports._TaskState=tt;class rt{constructor(e,t,n){if(M(e)||null!=t||null!=n)this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function st(e){return(...t)=>{Promise.resolve().then(()=>e(...t))}}let ot=null;class it{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=l.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=l.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=l.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw S("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const s in r)r.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,r[s].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw S("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw S("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw S("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw S("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class at extends it{initXhr(){this.xhr_.responseType="text"}}function ut(){return ot?ot():new at}class ct extends it{initXhr(){this.xhr_.responseType="arraybuffer"}}function lt(){return new ct}class ht extends it{initXhr(){this.xhr_.responseType="blob"}}function dt(){return new ht}class _t{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=ke(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=(e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(c.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const t=this.isExponentialBackoffExpired();if(G(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,a),this._needToFetchStatus=!0,void this.completeTransitions_();e=b()}this._error=e,this._transition("error")}}),this._metadataErrorHandler=(e=>{this._request=void 0,e._codeEquals(c.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))}),this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,n])=>{switch(this._state){case"running":e(t,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{const n=Ze(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,ut,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,n)=>{const r=Je(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(r,ut,t,n);this._request=s,s.getPromise().then(e=>{e=e,this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=Ye*this._chunkMultiplier,t=new $e(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken((r,s)=>{let o;try{o=Qe(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(a){return this._error=a,void this._transition("error")}const i=this._ref.storage._makeRequest(o,ut,r,s,!1);this._request=i,i.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){2*(Ye*this._chunkMultiplier)<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const n=qe(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,ut,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const n=Xe(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,ut,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=T(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=nt(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const s=new rt(t||void 0,n||void 0,r||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(nt(this._state)){case tt.SUCCESS:st(this._resolve.bind(null,this.snapshot))();break;case tt.CANCELED:case tt.ERROR:st(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(nt(this._state)){case tt.RUNNING:case tt.PAUSED:e.next&&st(e.next.bind(e,this.snapshot))();break;case tt.SUCCESS:e.complete&&st(e.complete.bind(e))();break;case tt.CANCELED:case tt.ERROR:e.error&&st(e.error.bind(e,this._error))();break;default:e.error&&st(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}exports._UploadTask=_t;class pt{constructor(e,t){this._service=e,this._location=t instanceof I?t:I.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new pt(e,t)}get root(){const e=new I(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return me(this._location.path)}get storage(){return this._service}get parent(){const e=fe(this._location.path);if(null===e)return null;const t=new I(this._location.bucket,e);return new pt(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw A(e)}}function ft(e,t){e._throwIfRoot("getBytes");const n=He(e.storage,e._location,t);return e.storage.makeRequestWithTokens(n,lt).then(e=>void 0!==t?e.slice(0,t):e)}function gt(e,t){e._throwIfRoot("getBlob");const n=He(e.storage,e._location,t);return e.storage.makeRequestWithTokens(n,dt).then(e=>void 0!==t?e.slice(0,t):e)}function mt(e,t,n){e._throwIfRoot("uploadBytes");const r=Xe(e.storage,e._location,ke(),new _e(t,!0),n);return e.storage.makeRequestWithTokens(r,ut).then(t=>({metadata:t,ref:e}))}function bt(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new _t(e,new _e(t),n)}function Tt(e,t,n=re.RAW,r){e._throwIfRoot("uploadString");const s=oe(n,t),o=Object.assign({},r);return null==o.contentType&&null!=s.contentType&&(o.contentType=s.contentType),mt(e,s.data,o)}function Rt(e){const t={prefixes:[],items:[]};return wt(e,t).then(()=>t)}async function wt(e,t,n){const r={pageToken:n},s=await kt(e,r);t.prefixes.push(...s.prefixes),t.items.push(...s.items),null!=s.nextPageToken&&await wt(e,t,s.nextPageToken)}function kt(e,t){null!=t&&"number"==typeof t.maxResults&&z("options.maxResults",1,1e3,t.maxResults);const n=t||{},r=Fe(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(r,ut)}function Et(e){e._throwIfRoot("getMetadata");const t=qe(e.storage,e._location,ke());return e.storage.makeRequestWithTokens(t,ut)}function vt(e,t){e._throwIfRoot("updateMetadata");const n=je(e.storage,e._location,t,ke());return e.storage.makeRequestWithTokens(n,ut)}function yt(e){e._throwIfRoot("getDownloadURL");const t=ze(e.storage,e._location,ke());return e.storage.makeRequestWithTokens(t,ut).then(e=>{if(null===e)throw y();return e})}function xt(e){e._throwIfRoot("deleteObject");const t=Ve(e.storage,e._location);return e.storage.makeRequestWithTokens(t,ut)}function Ot(e,t){const n=ge(e._location.path,t),r=new I(e._location.bucket,n);return new pt(e.storage,r)}function Ut(e){return/^[A-Za-z]+:\/\//.test(e)}function At(e,t){return new pt(e,t)}function Ct(e,t){if(e instanceof Pt){const n=e;if(null==n._bucket)throw k();const r=new pt(n,n._bucket);return null!=t?Ct(r,t):r}return void 0!==t?Ot(e,t):e}function St(e,t){if(t&&Ut(t)){if(e instanceof Pt)return At(e,t);throw O("To use ref(service, url), the first argument must be a Storage instance.")}return Ct(e,t)}function It(e,t){const n=null==t?void 0:t[s];return null==n?null:I.makeFromBucketSpec(n,e)}function Nt(e,n,r,s={}){e.host=`${n}:${r}`,e._protocol="http";const{mockUserToken:o}=s;o&&(e._overrideAuthToken="string"==typeof o?o:(0,t.createMockUserToken)(o,e.app.options.projectId))}class Pt{constructor(e,t,n,s,a){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=s,this._firebaseVersion=a,this._bucket=null,this._host=r,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=o,this._maxUploadRetryTime=i,this._requests=new Set,this._bucket=null!=s?I.makeFromBucketSpec(s,this._host):It(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=I.makeFromBucketSpec(this._url,e):this._bucket=It(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){z("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){z("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new pt(this,e)}_makeRequest(e,t,n,r,s=!0){if(this._deleted)return new N(U());{const o=Y(e,this._appId,n,r,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const Dt="@firebase/storage",Lt="0.11.2",Mt="storage";function Bt(e,n){return ft(e=(0,t.getModularInstance)(e),n)}function qt(e,n,r){return mt(e=(0,t.getModularInstance)(e),n,r)}function Ft(e,n,r,s){return Tt(e=(0,t.getModularInstance)(e),n,r,s)}function Ht(e,n,r){return bt(e=(0,t.getModularInstance)(e),n,r)}function zt(e){return Et(e=(0,t.getModularInstance)(e))}function jt(e,n){return vt(e=(0,t.getModularInstance)(e),n)}function Vt(e,n){return kt(e=(0,t.getModularInstance)(e),n)}function Gt(e){return Rt(e=(0,t.getModularInstance)(e))}function Wt(e){return yt(e=(0,t.getModularInstance)(e))}function Xt(e){return xt(e=(0,t.getModularInstance)(e))}function $t(e,n){return St(e=(0,t.getModularInstance)(e),n)}function Kt(e,t){return Ot(e,t)}function Zt(n=(0,e.getApp)(),r){n=(0,t.getModularInstance)(n);const s=(0,e._getProvider)(n,Mt).getImmediate({identifier:r}),o=(0,t.getDefaultEmulatorHostnameAndPort)("storage");return o&&Jt(s,...o),s}function Jt(e,t,n,r={}){Nt(e,t,n,r)}function Yt(e,n){return gt(e=(0,t.getModularInstance)(e),n)}function Qt(e,t){throw new Error("getStream() is only supported by NodeJS builds")}function en(t,{instanceIdentifier:n}){const r=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),o=t.getProvider("app-check-internal");return new Pt(r,s,o,n,e.SDK_VERSION)}function tn(){(0,e._registerComponent)(new n.Component(Mt,en,"PUBLIC").setMultipleInstances(!0)),(0,e.registerVersion)(Dt,Lt,""),(0,e.registerVersion)(Dt,Lt,"esm2017")}tn();
},{"@firebase/app":"qn02","@firebase/util":"VOc0","@firebase/component":"bXWY"}],"pIUw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@firebase/storage");Object.keys(e).forEach(function(r){"default"!==r&&"__esModule"!==r&&(r in exports&&exports[r]===e[r]||Object.defineProperty(exports,r,{enumerable:!0,get:function(){return e[r]}}))});
},{"@firebase/storage":"zPhD"}],"Sfr6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.storage=exports.database=exports.app=void 0;var e=require("firebase/app"),a=require("firebase/firestore"),r=require("firebase/storage"),t={apiKey:"AIzaSyCnmOeKX504_sA3DR6NNU6Y2RZgYVzBYv0",authDomain:"projektsda-d31aa.firebaseapp.com",projectId:"projektsda-d31aa",storageBucket:"projektsda-d31aa.appspot.com",messagingSenderId:"733111748832",appId:"1:733111748832:web:f84e1784177a37804ae885"},s=(0,e.initializeApp)(t);exports.app=s;var p=(0,a.getFirestore)(s);exports.database=p;var o=(0,r.getStorage)();exports.storage=o;
},{"firebase/app":"hLvv","firebase/firestore":"R6ck","firebase/storage":"pIUw"}],"CvJj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__assign=void 0,exports.__asyncDelegator=g,exports.__asyncGenerator=x,exports.__asyncValues=O,exports.__await=m,exports.__awaiter=f,exports.__classPrivateFieldGet=E,exports.__classPrivateFieldIn=A,exports.__classPrivateFieldSet=I,exports.__createBinding=void 0,exports.__decorate=o,exports.__esDecorate=i,exports.__exportStar=y,exports.__extends=t,exports.__generator=p,exports.__importDefault=T,exports.__importStar=S,exports.__makeTemplateObject=j,exports.__metadata=l,exports.__param=a,exports.__propKey=u,exports.__read=v,exports.__rest=n,exports.__runInitializers=c,exports.__setFunctionName=s,exports.__spread=h,exports.__spreadArray=w,exports.__spreadArrays=b,exports.__values=d,exports.default=void 0;var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};function t(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return exports.__assign=r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)};function n(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function o(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i}function a(e,t){return function(r,n){t(r,n,e)}}function i(e,t,r,n,o,a){function i(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var c,u=n.kind,s="getter"===u?"get":"setter"===u?"set":"value",l=!t&&e?n.static?e:e.prototype:null,f=t||(l?Object.getOwnPropertyDescriptor(l,n.name):{}),p=!1,_=r.length-1;_>=0;_--){var y={};for(var d in n)y[d]="access"===d?{}:n[d];for(var d in n.access)y.access[d]=n.access[d];y.addInitializer=function(e){if(p)throw new TypeError("Cannot add initializers after decoration has completed");a.push(i(e||null))};var v=(0,r[_])("accessor"===u?{get:f.get,set:f.set}:f[s],y);if("accessor"===u){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(c=i(v.get))&&(f.get=c),(c=i(v.set))&&(f.set=c),(c=i(v.init))&&o.unshift(c)}else(c=i(v))&&("field"===u?o.unshift(c):f[s]=c)}l&&Object.defineProperty(l,n.name,f),p=!0}function c(e,t,r){for(var n=arguments.length>2,o=0;o<t.length;o++)r=n?t[o].call(e,r):t[o].call(e);return n?r:void 0}function u(e){return"symbol"==typeof e?e:"".concat(e)}function s(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function f(e,t,r,n){return new(r||(r=Promise))(function(o,a){function i(e){try{u(n.next(e))}catch(t){a(t)}}function c(e){try{u(n.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,c)}u((n=n.apply(e,t||[])).next())})}function p(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(u){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&c[0]?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,n=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(u){c=[6,u],n=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}}exports.__assign=r;var _=Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function y(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||_(t,e,r)}function d(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function v(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(v(arguments[t]));return e}function b(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,c=a.length;i<c;i++,o++)n[o]=a[i];return n}function w(e,t,r){if(r||2===arguments.length)for(var n,o=0,a=t.length;o<a;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}function m(e){return this instanceof m?(this.v=e,this):new m(e)}function x(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(e,t||[]),a=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(e){o[e]&&(n[e]=function(t){return new Promise(function(r,n){a.push([e,t,r,n])>1||c(e,t)})})}function c(e,t){try{(r=o[e](t)).value instanceof m?Promise.resolve(r.value.v).then(u,s):l(a[0][2],r)}catch(n){l(a[0][3],n)}var r}function u(e){c("next",e)}function s(e){c("throw",e)}function l(e,t){e(t),a.shift(),a.length&&c(a[0][0],a[0][1])}}function g(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,o){t[n]=e[n]?function(t){return(r=!r)?{value:m(e[n](t)),done:!1}:o?o(t):t}:o}}function O(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof d?d(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,o){(function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)})(n,o,(t=e[r](t)).done,t.value)})}}}function j(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}exports.__createBinding=_;var P=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function S(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&_(t,e,r);return P(t,e),t}function T(e){return e&&e.__esModule?e:{default:e}}function E(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function I(e,t,r,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r}function A(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}var D={__extends:t,__assign:r,__rest:n,__decorate:o,__param:a,__metadata:l,__awaiter:f,__generator:p,__createBinding:_,__exportStar:y,__values:d,__read:v,__spread:h,__spreadArrays:b,__spreadArray:w,__await:m,__asyncGenerator:x,__asyncDelegator:g,__asyncValues:O,__makeTemplateObject:j,__importStar:S,__importDefault:T,__classPrivateFieldGet:E,__classPrivateFieldSet:I,__classPrivateFieldIn:A};exports.default=D;
},{}],"zZOs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.$=Qt,exports.A=void 0,exports.B=jn,exports.C=zn,exports.G=exports.F=exports.E=exports.D=void 0,exports.H=Je,exports.I=Xe,exports.Z=exports.Y=exports.X=exports.W=exports.V=exports.U=exports.T=exports.S=exports.R=exports.Q=exports.P=exports.O=exports.N=exports.M=exports.L=exports.K=exports.J=void 0,exports._=zt,exports.a=void 0,exports.a0=Zt,exports.a1=en,exports.a2=nn,exports.a3=cn,exports.a4=un,exports.a5=dn,exports.a6=ln,exports.a7=hn,exports.a8=pn,exports.a9=mn,exports.aA=k,exports.aB=void 0,exports.aC=he,exports.aD=fe,exports.aE=Lr,exports.aF=kr,exports.aG=Er,exports.aH=Be,exports.aJ=exports.aI=void 0,exports.aK=Ce,exports.aL=hi,exports.aO=exports.aN=exports.aM=void 0,exports.aa=fn,exports.ab=gn,exports.ac=vn,exports.ad=_n,exports.ae=Tn,exports.af=yn,exports.ag=void 0,exports.ah=Nt,exports.ai=En,exports.aj=kn,exports.ak=An,exports.al=$,exports.am=J,exports.an=Bt,exports.ao=Ln,exports.ap=re,exports.aq=Kn,exports.ar=ei,exports.as=R,exports.at=Ae,exports.au=we,exports.av=_,exports.aw=fs,exports.ax=qr,exports.ay=Re,exports.az=T,exports.b=void 0,exports.c=mr,exports.d=gr,exports.e=fr,exports.f=Nr,exports.g=Cr,exports.h=br,exports.i=void 0,exports.j=Dr,exports.k=void 0,exports.l=nr,exports.n=exports.m=void 0,exports.o=xs,exports.p=void 0,exports.q=Mn,exports.r=ir,exports.s=tr,exports.t=xn,exports.u=sr,exports.v=Un,exports.w=Fn,exports.x=Vn,exports.y=Hn,exports.z=qn;var e=require("@firebase/util"),t=require("@firebase/app"),n=require("tslib"),i=require("@firebase/logger"),r=require("@firebase/component");const s={PHONE:"phone",TOTP:"totp"};exports.F=s;const o={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};exports.p=o;const a={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"};exports.S=a;const c={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"};exports.O=c;const u={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function d(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend."}}function l(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}exports.A=u;const h=d;exports.D=h;const p=l;exports.E=p;const m=new e.ErrorFactory("auth","Firebase",l()),f={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};exports.G=f;const g=new i.Logger("@firebase/auth");function v(e,...n){g.logLevel<=i.LogLevel.WARN&&g.warn(`Auth (${t.SDK_VERSION}): ${e}`,...n)}function I(e,...n){g.logLevel<=i.LogLevel.ERROR&&g.error(`Auth (${t.SDK_VERSION}): ${e}`,...n)}function _(e,...t){throw E(e,...t)}function T(e,...t){return E(e,...t)}function y(t,n,i){const r=Object.assign(Object.assign({},p()),{[n]:i});return new e.ErrorFactory("auth","Firebase",r).create(n,{appName:t.name})}function w(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&_(e,"argument-error"),y(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function E(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return m.create(e,...t)}function k(e,t,...n){if(!e)throw E(t,...n)}function A(e){const t="INTERNAL ASSERTION FAILED: "+e;throw I(t),new Error(t)}function R(e,t){e||A(t)}function N(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function S(){return"http:"===b()||"https:"===b()}function b(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function O(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(S()||(0,e.isBrowserExtension)()||"connection"in navigator))||navigator.onLine}function C(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}class P{constructor(t,n){this.shortDelay=t,this.longDelay=n,R(n>t,"Short delay should be less than long delay!"),this.isMobile=(0,e.isMobileCordova)()||(0,e.isReactNative)()}get(){return O()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function D(e,t){R(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class L{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void A("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void A("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void A("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}exports.aN=L;const M={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},x=new P(3e4,6e4);function U(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function F(t,n,i,r,s={}){return V(t,s,async()=>{let s={},o={};r&&("GET"===n?o=r:s={body:JSON.stringify(r)});const a=(0,e.querystring)(Object.assign({key:t.config.apiKey},o)).slice(1),c=await t._getAdditionalHeaders();return c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode),L.fetch()(q(t,t.config.apiHost,i,a),Object.assign({method:n,headers:c,referrerPolicy:"no-referrer"},s))})}async function V(t,n,i){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},M),n);try{const n=new j(t),o=await Promise.race([i(),n.promise]);n.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw z(t,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const e=o.ok?a.errorMessage:a.error.message,[n,i]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw z(t,"credential-already-in-use",a);if("EMAIL_EXISTS"===n)throw z(t,"email-already-in-use",a);if("USER_DISABLED"===n)throw z(t,"user-disabled",a);const s=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(i)throw y(t,s,i);_(t,s)}}catch(s){if(s instanceof e.FirebaseError)throw s;_(t,"network-request-failed",{message:String(s)})}}async function H(e,t,n,i,r={}){const s=await F(e,t,n,i,r);return"mfaPendingCredential"in s&&_(e,"multi-factor-auth-required",{_serverResponse:s}),s}function q(e,t,n,i){const r=`${t}${n}?${i}`;return e.config.emulator?D(e.config,r):`${e.config.apiScheme}://${r}`}class j{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(T(this.auth,"network-request-failed")),x.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function z(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=T(e,t,i);return r.customData._tokenResponse=n,r}async function G(e,t){return F(e,"POST","/v1/accounts:delete",t)}async function W(e,t){return F(e,"POST","/v1/accounts:update",t)}async function K(e,t){return F(e,"POST","/v1/accounts:lookup",t)}function B(e){if(e)try{const n=new Date(Number(e));if(!isNaN(n.getTime()))return n.toUTCString()}catch(t){}}function $(t,n=!1){return(0,e.getModularInstance)(t).getIdToken(n)}async function J(t,n=!1){const i=(0,e.getModularInstance)(t),r=await i.getIdToken(n),s=X(r);k(s&&s.exp&&s.auth_time&&s.iat,i.auth,"internal-error");const o="object"==typeof s.firebase?s.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:s,token:r,authTime:B(Y(s.auth_time)),issuedAtTime:B(Y(s.iat)),expirationTime:B(Y(s.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}function Y(e){return 1e3*Number(e)}function X(t){const[n,i,r]=t.split(".");if(void 0===n||void 0===i||void 0===r)return I("JWT malformed, contained fewer than 3 sections"),null;try{const t=(0,e.base64Decode)(i);return t?JSON.parse(t):(I("Failed to decode base64 JWT payload"),null)}catch(s){return I("Caught error parsing JWT payload as JSON",null==s?void 0:s.toString()),null}}function Q(e){const t=X(e);return k(t,"internal-error"),k(void 0!==t.exp,"internal-error"),k(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Z(t,n,i=!1){if(i)return n;try{return await n}catch(r){throw r instanceof e.FirebaseError&&ee(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function ee({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class te{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class ne{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=B(this.lastLoginAt),this.creationTime=B(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ie(e){var t;const n=e.auth,i=await e.getIdToken(),r=await Z(e,K(n,{idToken:i}));k(null==r?void 0:r.users.length,n,"internal-error");const s=r.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?oe(s.providerUserInfo):[],a=se(e.providerData,o),c=e.isAnonymous,u=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!c&&u,l={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new ne(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,l)}async function re(t){const n=(0,e.getModularInstance)(t);await ie(n),await n.auth._persistUserIfCurrent(n),n.auth._notifyListenersIfCurrent(n)}function se(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function oe(e){return e.map(e=>{var{providerId:t}=e,i=(0,n.__rest)(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}async function ae(t,n){const i=await V(t,{},async()=>{const i=(0,e.querystring)({grant_type:"refresh_token",refresh_token:n}).slice(1),{tokenApiHost:r,apiKey:s}=t.config,o=q(t,r,"/v1/token",`key=${s}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",L.fetch()(o,{method:"POST",headers:a,body:i})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}class ce{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){k(e.idToken,"internal-error"),k(void 0!==e.idToken,"internal-error"),k(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Q(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return k(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:r}=await ae(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new ce;return n&&(k("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(k("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(k("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ce,this.toJSON())}_performRefresh(){return A("not implemented")}}function ue(e,t){k("string"==typeof e||void 0===e,"internal-error",{appName:t})}class de{constructor(e){var{uid:t,auth:i,stsTokenManager:r}=e,s=(0,n.__rest)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new te(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new ne(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Z(this,this.stsTokenManager.getToken(this.auth,e));return k(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return J(this,e)}reload(){return re(this)}_assign(e){this!==e&&(k(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new de(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){k(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ie(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Z(this,G(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,c,u;const d=null!==(n=t.displayName)&&void 0!==n?n:void 0,l=null!==(i=t.email)&&void 0!==i?i:void 0,h=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,m=null!==(o=t.tenantId)&&void 0!==o?o:void 0,f=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,v=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:I,emailVerified:_,isAnonymous:T,providerData:y,stsTokenManager:w}=t;k(I&&w,e,"internal-error");const E=ce.fromJSON(this.name,w);k("string"==typeof I,e,"internal-error"),ue(d,e.name),ue(l,e.name),k("boolean"==typeof _,e,"internal-error"),k("boolean"==typeof T,e,"internal-error"),ue(h,e.name),ue(p,e.name),ue(m,e.name),ue(f,e.name),ue(g,e.name),ue(v,e.name);const A=new de({uid:I,auth:e,email:l,emailVerified:_,displayName:d,isAnonymous:T,photoURL:p,phoneNumber:h,tenantId:m,stsTokenManager:E,createdAt:g,lastLoginAt:v});return y&&Array.isArray(y)&&(A.providerData=y.map(e=>Object.assign({},e))),f&&(A._redirectEventId=f),A}static async _fromIdTokenResponse(e,t,n=!1){const i=new ce;i.updateFromServerResponse(t);const r=new de({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await ie(r),r}}exports.aI=de;const le=new Map;function he(e){R(e instanceof Function,"Expected a class definition");let t=le.get(e);return t?(R(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,le.set(e,t),t)}class pe{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}pe.type="NONE";const me=pe;function fe(e,t,n){return`firebase:${e}:${t}:${n}`}exports.N=me;class ge{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=fe(this.userKey,i.apiKey,r),this.fullPersistenceKey=fe("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?de._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ge(he(me),e,n);const i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let r=i[0]||he(me);const s=fe(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{const t=await u._get(s);if(t){const n=de._fromJSON(e,t);u!==r&&(o=n),r=u;break}}catch(c){}const a=i.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(s)}catch(c){}})),new ge(r,e,n)):new ge(r,e,n)}}function ve(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ye(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Ie(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Ee(t))return"Blackberry";if(ke(t))return"Webos";if(_e(t))return"Safari";if((t.includes("chrome/")||Te(t))&&!t.includes("edge/"))return"Chrome";if(we(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Ie(t=(0,e.getUA)()){return/firefox\//i.test(t)}function _e(t=(0,e.getUA)()){const n=t.toLowerCase();return n.includes("safari/")&&!n.includes("chrome/")&&!n.includes("crios/")&&!n.includes("android")}function Te(t=(0,e.getUA)()){return/crios\//i.test(t)}function ye(t=(0,e.getUA)()){return/iemobile/i.test(t)}function we(t=(0,e.getUA)()){return/android/i.test(t)}function Ee(t=(0,e.getUA)()){return/blackberry/i.test(t)}function ke(t=(0,e.getUA)()){return/webos/i.test(t)}function Ae(t=(0,e.getUA)()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Re(t=(0,e.getUA)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(t)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(t)}function Ne(t=(0,e.getUA)()){var n;return Ae(t)&&!!(null===(n=window.navigator)||void 0===n?void 0:n.standalone)}function Se(){return(0,e.isIE)()&&10===document.documentMode}function be(t=(0,e.getUA)()){return Ae(t)||we(t)||ke(t)||Ee(t)||/windows phone/i.test(t)||ye(t)}function Oe(){try{return!(!window||window===window.top)}catch(e){return!1}}function Ce(n,i=[]){let r;switch(n){case"Browser":r=ve((0,e.getUA)());break;case"Worker":r=`${ve((0,e.getUA)())}-${n}`;break;default:r=n}const s=i.length?i.join(","):"FirebaseCore-web";return`${r}/JsCore/${t.SDK_VERSION}/${s}`}async function Pe(e){return(await F(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function De(e,t){return F(e,"GET","/v2/recaptchaConfig",U(e,t))}function Le(e){return void 0!==e&&void 0!==e.getResponse}function Me(e){return void 0!==e&&void 0!==e.enterprise}class xe{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState)}}function Ue(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}function Fe(e){return new Promise((t,n)=>{const i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=(e=>{const t=T("internal-error");t.customData=e,n(t)}),i.type="text/javascript",i.charset="UTF-8",Ue().appendChild(i)})}function Ve(e){return`__${e}${Math.floor(1e6*Math.random())}`}const He="https://www.google.com/recaptcha/enterprise.js?render=",qe="recaptcha-enterprise",je="NO_RECAPTCHA";class ze{constructor(e){this.type=qe,this.auth=Be(e)}async verify(e="verify",t=!1){function n(t,n,i){const r=window.grecaptcha;Me(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(je)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{De(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0!==i.recaptchaKey){const n=new xe(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(r=>{if(!t&&Me(window.grecaptcha))n(r,e,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));Fe(He+r).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function Ge(e,t,n,i=!1){const r=new ze(e);let s;try{s=await r.verify(n)}catch(a){s=await r.verify(n,!0)}const o=Object.assign({},t);return i?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class We{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,i)=>{try{n(e(t))}catch(r){i(r)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=(()=>Promise.resolve())}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(i){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==n?void 0:n.message})}}}class Ke{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new $e(this),this.idTokenSubscription=new $e(this),this.beforeStateQueue=new We(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=m,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=he(t)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await ge.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(r){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e,!0)):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||null==o||!o.user||(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(s){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return k(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ie(e)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=C()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const n=t?(0,e.getModularInstance)(t):null;return n&&k(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&k(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(he(e))})}async initializeRecaptchaConfig(){const e=await De(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),t=new xe(e);if(null==this.tenantId?this._agentRecaptchaConfig=t:this._tenantRecaptchaConfigs[this.tenantId]=t,t.emailPasswordEnabled){new ze(this).verify()}}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new e.ErrorFactory("auth","Firebase",t())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&he(e)||this._popupRedirectResolver;k(t,this,"argument-error"),this.redirectPersistenceManager=await ge.create(this,[he(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return k(s,this,"internal-error"),s.then(()=>r(this.currentUser)),"function"==typeof t?e.addObserver(t,n,i):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return k(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ce(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&v(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Be(t){return(0,e.getModularInstance)(t)}exports.aJ=Ke;class $e{constructor(t){this.auth=t,this.observer=null,this.addObserver=(0,e.createSubscribe)(e=>this.observer=e)}get next(){return k(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Je(n,i){const r=(0,t._getProvider)(n,"auth");if(r.isInitialized()){const t=r.getImmediate(),n=r.getOptions();if((0,e.deepEqual)(n,null!=i?i:{}))return t;_(t,"already-initialized")}return r.initialize({options:i})}function Ye(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(he);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}function Xe(e,t,n){const i=Be(e);k(i._canInitEmulator,i,"emulator-config-failed"),k(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const r=!!(null==n?void 0:n.disableWarnings),s=Qe(t),{host:o,port:a}=Ze(t),c=null===a?"":`:${a}`;i.config.emulator={url:`${s}//${o}${c}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||tt()}function Qe(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ze(e){const t=Qe(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const e=r[1];return{host:e,port:et(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:et(t)}}}function et(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function tt(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}class nt{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return A("not implemented")}_getIdTokenResponse(e){return A("not implemented")}_linkToIdToken(e,t){return A("not implemented")}_getReauthenticationResolver(e){return A("not implemented")}}async function it(e,t){return F(e,"POST","/v1/accounts:resetPassword",U(e,t))}async function rt(e,t){return F(e,"POST","/v1/accounts:update",t)}async function st(e,t){return F(e,"POST","/v1/accounts:update",U(e,t))}async function ot(e,t){return H(e,"POST","/v1/accounts:signInWithPassword",U(e,t))}async function at(e,t){return F(e,"POST","/v1/accounts:sendOobCode",U(e,t))}async function ct(e,t){return at(e,t)}async function ut(e,t){return at(e,t)}async function dt(e,t){return at(e,t)}async function lt(e,t){return at(e,t)}async function ht(e,t){return H(e,"POST","/v1/accounts:signInWithEmailLink",U(e,t))}async function pt(e,t){return H(e,"POST","/v1/accounts:signInWithEmailLink",U(e,t))}exports.J=nt;class mt extends nt{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new mt(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new mt(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(t=e._getRecaptchaConfig())||void 0===t?void 0:t.emailPasswordEnabled){const t=await Ge(e,n,"signInWithPassword");return ot(e,t)}return ot(e,n).catch(async t=>{if("auth/missing-recaptcha-token"===t.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const t=await Ge(e,n,"signInWithPassword");return ot(e,t)}return Promise.reject(t)});case"emailLink":return ht(e,{email:this._email,oobCode:this._password});default:_(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return rt(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return pt(e,{idToken:t,email:this._email,oobCode:this._password});default:_(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ft(e,t){return H(e,"POST","/v1/accounts:signInWithIdp",U(e,t))}exports.K=mt;const gt="http://localhost";class vt extends nt{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new vt(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):_("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:i,signInMethod:r}=t,s=(0,n.__rest)(t,["providerId","signInMethod"]);if(!i||!r)return null;const o=new vt(i,r);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){return ft(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ft(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ft(e,t)}buildRequest(){const t={requestUri:gt,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),t.postBody=(0,e.querystring)(n)}return t}}async function It(e,t){return F(e,"POST","/v1/accounts:sendVerificationCode",U(e,t))}async function _t(e,t){return H(e,"POST","/v1/accounts:signInWithPhoneNumber",U(e,t))}async function Tt(e,t){const n=await H(e,"POST","/v1/accounts:signInWithPhoneNumber",U(e,t));if(n.temporaryProof)throw z(e,"account-exists-with-different-credential",n);return n}exports.L=vt;const yt={USER_NOT_FOUND:"user-not-found"};async function wt(e,t){return H(e,"POST","/v1/accounts:signInWithPhoneNumber",U(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),yt)}class Et extends nt{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Et({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Et({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return _t(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return Tt(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return wt(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new Et({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}function kt(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function At(t){const n=(0,e.querystringDecode)((0,e.extractQuerystring)(t)).link,i=n?(0,e.querystringDecode)((0,e.extractQuerystring)(n)).deep_link_id:null,r=(0,e.querystringDecode)((0,e.extractQuerystring)(t)).deep_link_id;return(r?(0,e.querystringDecode)((0,e.extractQuerystring)(r)).link:null)||r||i||n||t}exports.M=Et;class Rt{constructor(t){var n,i,r,s,o,a;const c=(0,e.querystringDecode)((0,e.extractQuerystring)(t)),u=null!==(n=c.apiKey)&&void 0!==n?n:null,d=null!==(i=c.oobCode)&&void 0!==i?i:null,l=kt(null!==(r=c.mode)&&void 0!==r?r:null);k(u&&d&&l,"argument-error"),this.apiKey=u,this.operation=l,this.code=d,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=At(e);try{return new Rt(t)}catch(n){return null}}}function Nt(e){return Rt.parseLink(e)}exports.ag=Rt;class St{constructor(){this.providerId=St.PROVIDER_ID}static credential(e,t){return mt._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Rt.parseLink(t);return k(n,"argument-error"),mt._fromEmailAndCode(e,n.code,n.tenantId)}}exports.Q=St,St.PROVIDER_ID="password",St.EMAIL_PASSWORD_SIGN_IN_METHOD="password",St.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class bt{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Ot extends bt{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Ct extends Ot{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return k("providerId"in t&&"signInMethod"in t,"argument-error"),vt._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return k(e.idToken||e.accessToken,"argument-error"),vt._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Ct.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Ct.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:i,pendingToken:r,nonce:s,providerId:o}=e;if(!(n||i||t||r))return null;if(!o)return null;try{return new Ct(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:r})}catch(a){return null}}}exports.X=Ct;class Pt extends Ot{constructor(){super("facebook.com")}static credential(e){return vt._fromParams({providerId:Pt.PROVIDER_ID,signInMethod:Pt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Pt.credentialFromTaggedObject(e)}static credentialFromError(e){return Pt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Pt.credential(e.oauthAccessToken)}catch(t){return null}}}exports.U=Pt,Pt.FACEBOOK_SIGN_IN_METHOD="facebook.com",Pt.PROVIDER_ID="facebook.com";class Dt extends Ot{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return vt._fromParams({providerId:Dt.PROVIDER_ID,signInMethod:Dt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Dt.credentialFromTaggedObject(e)}static credentialFromError(e){return Dt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Dt.credential(t,n)}catch(i){return null}}}exports.V=Dt,Dt.GOOGLE_SIGN_IN_METHOD="google.com",Dt.PROVIDER_ID="google.com";class Lt extends Ot{constructor(){super("github.com")}static credential(e){return vt._fromParams({providerId:Lt.PROVIDER_ID,signInMethod:Lt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Lt.credentialFromTaggedObject(e)}static credentialFromError(e){return Lt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Lt.credential(e.oauthAccessToken)}catch(t){return null}}}exports.W=Lt,Lt.GITHUB_SIGN_IN_METHOD="github.com",Lt.PROVIDER_ID="github.com";const Mt="http://localhost";class xt extends nt{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return ft(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ft(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ft(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i,pendingToken:r}=t;return n&&i&&r&&n===i?new xt(n,r):null}static _create(e,t){return new xt(e,t)}buildRequest(){return{requestUri:Mt,returnSecureToken:!0,pendingToken:this.pendingToken}}}exports.aO=xt;const Ut="saml.";class Ft extends bt{constructor(e){k(e.startsWith(Ut),"argument-error"),super(e)}static credentialFromResult(e){return Ft.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Ft.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=xt.fromJSON(e);return k(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return xt._create(n,t)}catch(i){return null}}}exports.Y=Ft;class Vt extends Ot{constructor(){super("twitter.com")}static credential(e,t){return vt._fromParams({providerId:Vt.PROVIDER_ID,signInMethod:Vt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Vt.credentialFromTaggedObject(e)}static credentialFromError(e){return Vt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Vt.credential(t,n)}catch(i){return null}}}async function Ht(e,t){return H(e,"POST","/v1/accounts:signUp",U(e,t))}exports.Z=Vt,Vt.TWITTER_SIGN_IN_METHOD="twitter.com",Vt.PROVIDER_ID="twitter.com";class qt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const r=await de._fromIdTokenResponse(e,n,i),s=jt(n);return new qt({user:r,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=jt(n);return new qt({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function jt(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function zt(e){var t;const n=Be(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new qt({user:n.currentUser,providerId:null,operationType:"signIn"});const i=await Ht(n,{returnSecureToken:!0}),r=await qt._fromIdTokenResponse(n,"signIn",i,!0);return await n._updateCurrentUser(r.user),r}class Gt extends e.FirebaseError{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Gt.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new Gt(e,t,n,i)}}function Wt(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw Gt._fromErrorAndOperation(e,n,t,i);throw n})}function Kt(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Bt(t,n){const i=(0,e.getModularInstance)(t);await Jt(!0,i,n);const{providerUserInfo:r}=await W(i.auth,{idToken:await i.getIdToken(),deleteProvider:[n]}),s=Kt(r||[]);return i.providerData=i.providerData.filter(e=>s.has(e.providerId)),s.has("phone")||(i.phoneNumber=null),await i.auth._persistUserIfCurrent(i),i}async function $t(e,t,n=!1){const i=await Z(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return qt._forOperation(e,"link",i)}async function Jt(e,t,n){await ie(t);const i=!1===e?"provider-already-linked":"no-such-provider";k(Kt(t.providerData).has(n)===e,t.auth,i)}async function Yt(e,t,n=!1){const{auth:i}=e;try{const s=await Z(e,Wt(i,"reauthenticate",t,e),n);k(s.idToken,i,"internal-error");const o=X(s.idToken);k(o,i,"internal-error");const{sub:a}=o;return k(e.uid===a,i,"user-mismatch"),qt._forOperation(e,"reauthenticate",s)}catch(r){throw"auth/user-not-found"===(null==r?void 0:r.code)&&_(i,"user-mismatch"),r}}async function Xt(e,t,n=!1){const i=await Wt(e,"signIn",t),r=await qt._fromIdTokenResponse(e,"signIn",i);return n||await e._updateCurrentUser(r.user),r}async function Qt(e,t){return Xt(Be(e),t)}async function Zt(t,n){const i=(0,e.getModularInstance)(t);return await Jt(!1,i,n.providerId),$t(i,n)}async function en(t,n){return Yt((0,e.getModularInstance)(t),n)}async function tn(e,t){return H(e,"POST","/v1/accounts:signInWithCustomToken",U(e,t))}async function nn(e,t){const n=Be(e),i=await tn(n,{token:t,returnSecureToken:!0}),r=await qt._fromIdTokenResponse(n,"signIn",i);return await n._updateCurrentUser(r.user),r}class rn{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?sn._fromServerResponse(e,t):"totpInfo"in t?on._fromServerResponse(e,t):_(e,"internal-error")}}class sn extends rn{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new sn(t)}}class on extends rn{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new on(t)}}function an(e,t,n){var i;k((null===(i=n.url)||void 0===i?void 0:i.length)>0,e,"invalid-continue-uri"),k(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(k(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(k(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function cn(e,t,n){var i;const r=Be(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};if(null===(i=r._getRecaptchaConfig())||void 0===i?void 0:i.emailPasswordEnabled){const e=await Ge(r,s,"getOobCode",!0);n&&an(r,e,n),await ut(r,e)}else n&&an(r,s,n),await ut(r,s).catch(async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const e=await Ge(r,s,"getOobCode",!0);n&&an(r,e,n),await ut(r,e)}})}async function un(t,n,i){await it((0,e.getModularInstance)(t),{oobCode:n,newPassword:i})}async function dn(t,n){await st((0,e.getModularInstance)(t),{oobCode:n})}async function ln(t,n){const i=(0,e.getModularInstance)(t),r=await it(i,{oobCode:n}),s=r.requestType;switch(k(s,i,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":k(r.newEmail,i,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":k(r.mfaInfo,i,"internal-error");default:k(r.email,i,"internal-error")}let o=null;return r.mfaInfo&&(o=rn._fromServerResponse(Be(i),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:o},operation:s}}async function hn(t,n){const{data:i}=await ln((0,e.getModularInstance)(t),n);return i.email}async function pn(e,t,n){var i;const r=Be(e),s={returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"};let o;if(null===(i=r._getRecaptchaConfig())||void 0===i?void 0:i.emailPasswordEnabled){const e=await Ge(r,s,"signUpPassword");o=Ht(r,e)}else o=Ht(r,s).catch(async e=>{if("auth/missing-recaptcha-token"===e.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const e=await Ge(r,s,"signUpPassword");return Ht(r,e)}return Promise.reject(e)});const a=await o.catch(e=>Promise.reject(e)),c=await qt._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(c.user),c}function mn(t,n,i){return Qt((0,e.getModularInstance)(t),St.credential(n,i))}async function fn(e,t,n){var i;const r=Be(e),s={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};function o(e,t){k(t.handleCodeInApp,r,"argument-error"),t&&an(r,e,t)}if(null===(i=r._getRecaptchaConfig())||void 0===i?void 0:i.emailPasswordEnabled){const e=await Ge(r,s,"getOobCode",!0);o(e,n),await dt(r,e)}else o(s,n),await dt(r,s).catch(async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log("Email link sign-in is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const e=await Ge(r,s,"getOobCode",!0);o(e,n),await dt(r,e)}})}function gn(e,t){const n=Rt.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}async function vn(t,n,i){const r=(0,e.getModularInstance)(t),s=St.credentialWithLink(n,i||N());return k(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Qt(r,s)}async function In(e,t){return F(e,"POST","/v1/accounts:createAuthUri",U(e,t))}async function _n(t,n){const i={identifier:n,continueUri:S()?N():"http://localhost"},{signinMethods:r}=await In((0,e.getModularInstance)(t),i);return r||[]}async function Tn(t,n){const i=(0,e.getModularInstance)(t),r={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()};n&&an(i.auth,r,n);const{email:s}=await ct(i.auth,r);s!==t.email&&await t.reload()}async function yn(t,n,i){const r=(0,e.getModularInstance)(t),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await t.getIdToken(),newEmail:n};i&&an(r.auth,s,i);const{email:o}=await lt(r.auth,s);o!==t.email&&await t.reload()}async function wn(e,t){return F(e,"POST","/v1/accounts:update",t)}async function En(t,{displayName:n,photoURL:i}){if(void 0===n&&void 0===i)return;const r=(0,e.getModularInstance)(t),s={idToken:await r.getIdToken(),displayName:n,photoUrl:i,returnSecureToken:!0},o=await Z(r,wn(r.auth,s));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function kn(t,n){return Rn((0,e.getModularInstance)(t),n,null)}function An(t,n){return Rn((0,e.getModularInstance)(t),null,n)}async function Rn(e,t,n){const{auth:i}=e,r={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(r.email=t),n&&(r.password=n);const s=await Z(e,rt(i,r));await e._updateTokensIfNecessary(s,!0)}function Nn(e){var t,n;if(!e)return null;const{providerId:i}=e,r=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!i&&(null==e?void 0:e.idToken)){const i=null===(n=null===(t=X(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(i){return new Sn(s,"anonymous"!==i&&"custom"!==i?i:null)}}if(!i)return null;switch(i){case"facebook.com":return new On(s,r);case"github.com":return new Cn(s,r);case"google.com":return new Pn(s,r);case"twitter.com":return new Dn(s,r,e.screenName||null);case"custom":case"anonymous":return new Sn(s,null);default:return new Sn(s,i,r)}}class Sn{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class bn extends Sn{constructor(e,t,n,i){super(e,t,n),this.username=i}}class On extends Sn{constructor(e,t){super(e,"facebook.com",t)}}class Cn extends bn{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Pn extends Sn{constructor(e,t){super(e,"google.com",t)}}class Dn extends bn{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Ln(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:Nn(n)}function Mn(t,n){return(0,e.getModularInstance)(t).setPersistence(n)}function xn(e){return Be(e).initializeRecaptchaConfig()}function Un(t,n,i,r){return(0,e.getModularInstance)(t).onIdTokenChanged(n,i,r)}function Fn(t,n,i){return(0,e.getModularInstance)(t).beforeAuthStateChanged(n,i)}function Vn(t,n,i,r){return(0,e.getModularInstance)(t).onAuthStateChanged(n,i,r)}function Hn(t){(0,e.getModularInstance)(t).useDeviceLanguage()}function qn(t,n){return(0,e.getModularInstance)(t).updateCurrentUser(n)}function jn(t){return(0,e.getModularInstance)(t).signOut()}async function zn(t){return(0,e.getModularInstance)(t).delete()}class Gn{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new Gn("enroll",e,t)}static _fromMfaPendingCredential(e){return new Gn("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return Gn._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return Gn._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Wn{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=Be(e),i=t.customData._serverResponse,r=(i.mfaInfo||[]).map(e=>rn._fromServerResponse(n,e));k(i.mfaPendingCredential,n,"internal-error");const s=Gn._fromMfaPendingCredential(i.mfaPendingCredential);return new Wn(s,r,async e=>{const r=await e._process(n,s);delete i.mfaInfo,delete i.mfaPendingCredential;const o=Object.assign(Object.assign({},i),{idToken:r.idToken,refreshToken:r.refreshToken});switch(t.operationType){case"signIn":const e=await qt._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return k(t.user,n,"internal-error"),qt._forOperation(t.user,t.operationType,o);default:_(n,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function Kn(t,n){var i;const r=(0,e.getModularInstance)(t),s=n;return k(n.customData.operationType,r,"argument-error"),k(null===(i=s.customData._serverResponse)||void 0===i?void 0:i.mfaPendingCredential,r,"argument-error"),Wn._fromError(r,s)}function Bn(e,t){return F(e,"POST","/v2/accounts/mfaEnrollment:start",U(e,t))}function $n(e,t){return F(e,"POST","/v2/accounts/mfaEnrollment:finalize",U(e,t))}function Jn(e,t){return F(e,"POST","/v2/accounts/mfaEnrollment:start",U(e,t))}function Yn(e,t){return F(e,"POST","/v2/accounts/mfaEnrollment:finalize",U(e,t))}function Xn(e,t){return F(e,"POST","/v2/accounts/mfaEnrollment:withdraw",U(e,t))}class Qn{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>rn._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new Qn(e)}async getSession(){return Gn._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e,i=await this.getSession(),r=await Z(this.user,n._process(this.user.auth,i,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await Z(this.user,Xn(this.user.auth,{idToken:n,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(i){throw i}}}const Zn=new WeakMap;function ei(t){const n=(0,e.getModularInstance)(t);return Zn.has(n)||Zn.set(n,Qn._fromUser(n)),Zn.get(n)}const ti="__sak";class ni{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ti,"1"),this.storage.removeItem(ti),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}function ii(){const t=(0,e.getUA)();return _e(t)||Ae(t)}const ri=1e3,si=10;class oi extends ni{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=((e,t)=>this.onStorageEvent(e,t)),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=ii()&&Oe(),this.fallbackToPolling=be(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);Se()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,si):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},ri)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}oi.type="LOCAL";const ai=oi;exports.b=ai;class ci extends ni{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ci.type="SESSION";const ui=ci;function di(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}exports.a=ui;class li{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new li(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:r}=t.data,s=this.handlersMap[i];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(s).map(async e=>e(t.origin,r)),a=await di(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function hi(e="",t=10){let n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}li.receivers=[];class pi{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,s;return new Promise((o,a)=>{const c=hi("",20);i.port1.start();const u=setTimeout(()=>{a(new Error("unsupported_event"))},n);s={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(u),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}function mi(){return window}function fi(e){mi().location.href=e}function gi(){return void 0!==mi().WorkerGlobalScope&&"function"==typeof mi().importScripts}async function vi(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}function Ii(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}function _i(){return gi()?self:null}const Ti="firebaseLocalStorageDb",yi=1,wi="firebaseLocalStorage",Ei="fbase_key";class ki{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Ai(e,t){return e.transaction([wi],t?"readwrite":"readonly").objectStore(wi)}function Ri(){const e=indexedDB.deleteDatabase(Ti);return new ki(e).toPromise()}function Ni(){const e=indexedDB.open(Ti,yi);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(wi,{keyPath:Ei})}catch(i){n(i)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(wi)?t(n):(n.close(),await Ri(),t(await Ni()))})})}async function Si(e,t,n){const i=Ai(e,!0).put({[Ei]:t,value:n});return new ki(i).toPromise()}async function bi(e,t){const n=Ai(e,!1).get(t),i=await new ki(n).toPromise();return void 0===i?null:i.value}function Oi(e,t){const n=Ai(e,!0).delete(t);return new ki(n).toPromise()}const Ci=800,Pi=3;class Di{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Ni(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(n){if(t++>Pi)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return gi()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=li._getInstance(_i()),this.receiver._subscribe("keyChanged",async(e,t)=>{return{keyProcessed:(await this._poll()).includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await vi(),!this.activeServiceWorker)return;this.sender=new pi(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&Ii()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await Ni();return await Si(t,ti,"1"),await Oi(t,ti),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Si(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>bi(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Oi(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=Ai(e,!1).getAll();return new ki(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Ci)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Di.type="LOCAL";const Li=Di;function Mi(e,t){return F(e,"POST","/v2/accounts/mfaSignIn:start",U(e,t))}function xi(e,t){return F(e,"POST","/v2/accounts/mfaSignIn:finalize",U(e,t))}function Ui(e,t){return F(e,"POST","/v2/accounts/mfaSignIn:finalize",U(e,t))}exports.i=Li;const Fi=500,Vi=6e4,Hi=1e12;class qi{constructor(e){this.auth=e,this.counter=Hi,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new ji(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||Hi;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||Hi;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||Hi;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class ji{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=(()=>{this.execute()});const i="string"==typeof e?document.getElementById(e):e;k(i,"argument-error",{appName:t}),this.container=i,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=zi(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()},Vi)},Fi))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function zi(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<e;i++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}const Gi=Ve("rcb"),Wi=new P(3e4,6e4),Ki="https://www.google.com/recaptcha/api.js?";class Bi{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=mi().grecaptcha)||void 0===e?void 0:e.render)}load(t,n=""){return k($i(n),t,"argument-error"),this.shouldResolveImmediately(n)&&Le(mi().grecaptcha)?Promise.resolve(mi().grecaptcha):new Promise((i,r)=>{const s=mi().setTimeout(()=>{r(T(t,"network-request-failed"))},Wi.get());mi()[Gi]=(()=>{mi().clearTimeout(s),delete mi()[Gi];const e=mi().grecaptcha;if(!e||!Le(e))return void r(T(t,"internal-error"));const o=e.render;e.render=((e,t)=>{const n=o(e,t);return this.counter++,n}),this.hostLanguage=n,i(e)}),Fe(`${Ki}?${(0,e.querystring)({onload:Gi,render:"explicit",hl:n})}`).catch(()=>{clearTimeout(s),r(T(t,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=mi().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function $i(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}class Ji{async load(e){return new qi(e)}clearedOneInstance(){}}const Yi="recaptcha",Xi={theme:"light",type:"image"};class Qi{constructor(e,t=Object.assign({},Xi),n){this.parameters=t,this.type=Yi,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Be(n),this.isInvisible="invisible"===this.parameters.size,k("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const i="string"==typeof e?document.getElementById(e):e;k(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Ji:new Bi,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise(n=>{const i=e=>{e&&(this.tokenChangeListeners.delete(i),n(e))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){k(!this.parameters.sitekey,this.auth,"argument-error"),k(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),k("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof e)e(t);else if("string"==typeof e){const n=mi()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){k(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){k(S()&&!gi(),this.auth,"internal-error"),await Zi(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await Pe(this.auth);k(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return k(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function Zi(){let e=null;return new Promise(t=>{"complete"!==document.readyState?(e=(()=>t()),window.addEventListener("load",e)):t()}).catch(t=>{throw e&&window.removeEventListener("load",e),t})}exports.R=Qi;class er{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Et._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function tr(t,n,i){const r=Be(t),s=await rr(r,n,(0,e.getModularInstance)(i));return new er(s,e=>Qt(r,e))}async function nr(t,n,i){const r=(0,e.getModularInstance)(t);await Jt(!1,r,"phone");const s=await rr(r.auth,n,(0,e.getModularInstance)(i));return new er(s,e=>Zt(r,e))}async function ir(t,n,i){const r=(0,e.getModularInstance)(t),s=await rr(r.auth,n,(0,e.getModularInstance)(i));return new er(s,e=>en(r,e))}async function rr(e,t,n){var i;const r=await n.verify();try{let s;if(k("string"==typeof r,e,"argument-error"),k(n.type===Yi,e,"argument-error"),"session"in(s="string"==typeof t?{phoneNumber:t}:t)){const t=s.session;if("phoneNumber"in s){return k("enroll"===t.type,e,"internal-error"),(await Bn(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}})).phoneSessionInfo.sessionInfo}{k("signin"===t.type,e,"internal-error");const n=(null===(i=s.multiFactorHint)||void 0===i?void 0:i.uid)||s.multiFactorUid;return k(n,e,"missing-multi-factor-info"),(await Mi(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:r}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await It(e,{phoneNumber:s.phoneNumber,recaptchaToken:r});return t}}finally{n._reset()}}async function sr(t,n){await $t((0,e.getModularInstance)(t),n)}class or{constructor(e){this.providerId=or.PROVIDER_ID,this.auth=Be(e)}verifyPhoneNumber(t,n){return rr(this.auth,t,(0,e.getModularInstance)(n))}static credential(e,t){return Et._fromVerification(e,t)}static credentialFromResult(e){const t=e;return or.credentialFromTaggedObject(t)}static credentialFromError(e){return or.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Et._fromTokenResponse(t,n):null}}function ar(e,t){return t?he(t):(k(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}exports.P=or,or.PROVIDER_ID="phone",or.PHONE_SIGN_IN_METHOD="phone";class cr extends nt{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ft(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ft(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ft(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ur(e){return Xt(e.auth,new cr(e),e.bypassAuthState)}function dr(e){const{auth:t,user:n}=e;return k(n,t,"internal-error"),Yt(n,new cr(e),e.bypassAuthState)}async function lr(e){const{auth:t,user:n}=e;return k(n,t,"internal-error"),$t(n,new cr(e),e.bypassAuthState)}class hr{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ur;case"linkViaPopup":case"linkViaRedirect":return lr;case"reauthViaPopup":case"reauthViaRedirect":return dr;default:_(this.auth,"internal-error")}}resolve(e){R(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){R(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const pr=new P(2e3,1e4);async function mr(e,t,n){const i=Be(e);w(e,t,bt);const r=ar(i,n);return new vr(i,"signInViaPopup",t,r).executeNotNull()}async function fr(t,n,i){const r=(0,e.getModularInstance)(t);w(r.auth,n,bt);const s=ar(r.auth,i);return new vr(r.auth,"reauthViaPopup",n,s,r).executeNotNull()}async function gr(t,n,i){const r=(0,e.getModularInstance)(t);w(r.auth,n,bt);const s=ar(r.auth,i);return new vr(r.auth,"linkViaPopup",n,s,r).executeNotNull()}class vr extends hr{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,vr.currentPopupAction&&vr.currentPopupAction.cancel(),vr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return k(e,this.auth,"internal-error"),e}async onExecution(){R(1===this.filter.length,"Popup operations only handle one event");const e=hi();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(T(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(T(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,vr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;null!==(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)&&void 0!==n&&n.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(T(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,pr.get())};e()}}vr.currentPopupAction=null;const Ir="pendingRedirect",_r=new Map;class Tr extends hr{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=_r.get(this.auth._key());if(!e){try{const n=await yr(this.resolver,this.auth)?await super.execute():null;e=(()=>Promise.resolve(n))}catch(t){e=(()=>Promise.reject(t))}_r.set(this.auth._key(),e)}return this.bypassAuthState||_r.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function yr(e,t){const n=Rr(t),i=Ar(e);if(!(await i._isAvailable()))return!1;const r="true"===await i._get(n);return await i._remove(n),r}async function wr(e,t){return Ar(e)._set(Rr(t),"true")}function Er(){_r.clear()}function kr(e,t){_r.set(e._key(),t)}function Ar(e){return he(e._redirectPersistence)}function Rr(e){return fe(Ir,e.config.apiKey,e.name)}function Nr(e,t,n){return Sr(e,t,n)}async function Sr(e,t,n){const i=Be(e);w(e,t,bt),await i._initializationPromise;const r=ar(i,n);return await wr(r,i),r._openRedirect(i,t,"signInViaRedirect")}function br(e,t,n){return Or(e,t,n)}async function Or(t,n,i){const r=(0,e.getModularInstance)(t);w(r.auth,n,bt),await r.auth._initializationPromise;const s=ar(r.auth,i);await wr(s,r.auth);const o=await Mr(r);return s._openRedirect(r.auth,n,"reauthViaRedirect",o)}function Cr(e,t,n){return Pr(e,t,n)}async function Pr(t,n,i){const r=(0,e.getModularInstance)(t);w(r.auth,n,bt),await r.auth._initializationPromise;const s=ar(r.auth,i);await Jt(!1,r,n.providerId),await wr(s,r.auth);const o=await Mr(r);return s._openRedirect(r.auth,n,"linkViaRedirect",o)}async function Dr(e,t){return await Be(e)._initializationPromise,Lr(e,t,!1)}async function Lr(e,t,n=!1){const i=Be(e),r=ar(i,t),s=new Tr(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}async function Mr(e){const t=hi(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}const xr=6e5;class Ur{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Hr(e)?t:(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0),t)}sendToConsumer(e,t){var n;if(e.error&&!Vr(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(T(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=xr&&this.cachedEventUids.clear(),this.cachedEventUids.has(Fr(e))}saveEventToCache(e){this.cachedEventUids.add(Fr(e)),this.lastProcessedEventTime=Date.now()}}function Fr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Vr({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}function Hr(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Vr(e);default:return!1}}async function qr(e,t={}){return F(e,"GET","/v1/projects",t)}exports.aB=Ur;const jr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,zr=/^https?/;async function Gr(e){if(e.config.emulator)return;const{authorizedDomains:t}=await qr(e);for(const i of t)try{if(Wr(i))return}catch(n){}_(e,"unauthorized-domain")}function Wr(e){const t=N(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!zr.test(n))return!1;if(jr.test(e))return i===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const Kr=new P(3e4,6e4);function Br(){const e=mi().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function $r(e){return new Promise((t,n)=>{var i,r,s;function o(){Br(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Br(),n(T(e,"network-request-failed"))},timeout:Kr.get()})}if(null===(r=null===(i=mi().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(null===(s=mi().gapi)||void 0===s||!s.load){const t=Ve("iframefcb");return mi()[t]=(()=>{gapi.load?o():n(T(e,"network-request-failed"))}),Fe(`https://apis.google.com/js/api.js?onload=${t}`).catch(e=>n(e))}o()}}).catch(e=>{throw Jr=null,e})}let Jr=null;function Yr(e){return Jr=Jr||$r(e)}const Xr=new P(5e3,15e3),Qr="__/auth/iframe",Zr="emulator/auth/iframe",es={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ts=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ns(n){const i=n.config;k(i.authDomain,n,"auth-domain-config-required");const r=i.emulator?D(i,Zr):`https://${n.config.authDomain}/${Qr}`,s={apiKey:i.apiKey,appName:n.name,v:t.SDK_VERSION},o=ts.get(n.config.apiHost);o&&(s.eid=o);const a=n._getFrameworks();return a.length&&(s.fw=a.join(",")),`${r}?${(0,e.querystring)(s).slice(1)}`}async function is(e){const t=await Yr(e),n=mi().gapi;return k(n,e,"internal-error"),t.open({where:document.body,url:ns(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:es,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});const r=T(e,"network-request-failed"),s=mi().setTimeout(()=>{i(r)},Xr.get());function o(){mi().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{i(r)})}))}const rs={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},ss=500,os=600,as="_blank",cs="http://localhost";class us{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function ds(t,n,i,r=ss,s=os){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},rs),{width:r.toString(),height:s.toString(),top:o,left:a}),d=(0,e.getUA)().toLowerCase();i&&(c=Te(d)?as:i),Ie(d)&&(n=n||cs,u.scrollbars="yes");const l=Object.entries(u).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(Ne(d)&&"_self"!==c)return ls(n||"",c),new us(null);const h=window.open(n||"",c,l);k(h,t,"popup-blocked");try{h.focus()}catch(p){}return new us(h)}function ls(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}exports.aM=us;const hs="__/auth/handler",ps="emulator/auth/handler",ms=encodeURIComponent("fac");async function fs(n,i,r,s,o,a){k(n.config.authDomain,n,"auth-domain-config-required"),k(n.config.apiKey,n,"invalid-api-key");const c={apiKey:n.config.apiKey,appName:n.name,authType:r,redirectUrl:s,v:t.SDK_VERSION,eventId:o};if(i instanceof bt){i.setDefaultLanguage(n.languageCode),c.providerId=i.providerId||"",(0,e.isEmpty)(i.getCustomParameters())||(c.customParameters=JSON.stringify(i.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(i instanceof Ot){const e=i.getScopes().filter(e=>""!==e);e.length>0&&(c.scopes=e.join(","))}n.tenantId&&(c.tid=n.tenantId);const u=c;for(const e of Object.keys(u))void 0===u[e]&&delete u[e];const d=await n._getAppCheckToken(),l=d?`#${ms}=${encodeURIComponent(d)}`:"";return`${gs(n)}?${(0,e.querystring)(u).slice(1)}${l}`}function gs({config:e}){return e.emulator?D(e,ps):`https://${e.authDomain}/${hs}`}const vs="webStorageSupport";class Is{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ui,this._completeRedirectFn=Lr,this._overrideRedirectResult=kr}async _openPopup(e,t,n,i){var r;return R(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()"),ds(e,await fs(e,t,n,N(),i),hi())}async _openRedirect(e,t,n,i){return await this._originValidation(e),fi(await fs(e,t,n,N(),i)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(R(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await is(e),n=new Ur(e);return t.register("authEvent",t=>{return k(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(vs,{type:vs},n=>{var i;const r=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[vs];void 0!==r&&t(!!r),_(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Gr(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return be()||_e()||Ae()}}const _s=Is;exports.k=_s;class Ts{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return A("unexpected MultiFactorSessionType")}}}class ys extends Ts{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new ys(e)}_finalizeEnroll(e,t,n){return $n(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return xi(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class ws{constructor(){}static assertion(e){return ys._fromCredential(e)}}exports.m=ws,ws.FACTOR_ID="phone";class Es{static assertionForEnrollment(e,t){return ks._fromSecret(e,t)}static assertionForSignIn(e,t){return ks._fromEnrollmentId(e,t)}static async generateSecret(e){const t=e;k(void 0!==t.auth,"internal-error");const n=await Jn(t.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return As._fromStartTotpMfaEnrollmentResponse(n,t.auth)}}exports.T=Es,Es.FACTOR_ID="totp";class ks extends Ts{constructor(e,t,n){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=n}static _fromSecret(e,t){return new ks(t,void 0,e)}static _fromEnrollmentId(e,t){return new ks(t,e)}async _finalizeEnroll(e,t,n){return k(void 0!==this.secret,e,"argument-error"),Yn(e,{idToken:t,displayName:n,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){k(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");const n={verificationCode:this.otp};return Ui(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:n})}}class As{constructor(e,t,n,i,r,s,o){this.sessionInfo=s,this.auth=o,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=n,this.codeIntervalSeconds=i,this.enrollmentCompletionDeadline=r}static _fromStartTotpMfaEnrollmentResponse(e,t){return new As(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var n;let i=!1;return(Rs(e)||Rs(t))&&(i=!0),i&&(Rs(e)&&(e=(null===(n=this.auth.currentUser)||void 0===n?void 0:n.email)||"unknownuser"),Rs(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Rs(e){return void 0===e||0===(null==e?void 0:e.length)}exports.n=As;var Ns="@firebase/auth",Ss="0.23.2";class bs{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){k(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Os(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function Cs(e){(0,t._registerComponent)(new r.Component("auth",(t,{options:n})=>{const i=t.getProvider("app").getImmediate(),r=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;k(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});const c={apiKey:o,authDomain:a,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ce(e)},u=new Ke(i,r,s,c);return Ye(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,t._registerComponent)(new r.Component("auth-internal",e=>{return(e=>new bs(e))(Be(e.getProvider("auth").getImmediate()))},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,t.registerVersion)(Ns,Ss,Os(e)),(0,t.registerVersion)(Ns,Ss,"esm2017")}const Ps=300,Ds=(0,e.getExperimentalSetting)("authIdTokenMaxAge")||300;let Ls=null;const Ms=e=>async t=>{const n=t&&await t.getIdTokenResult(),i=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>Ds)return;const r=null==n?void 0:n.token;Ls!==r&&(Ls=r,await fetch(e,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function xs(n=(0,t.getApp)()){const i=(0,t._getProvider)(n,"auth");if(i.isInitialized())return i.getImmediate();const r=Je(n,{popupRedirectResolver:_s,persistence:[Li,ai,ui]}),s=(0,e.getExperimentalSetting)("authTokenSyncURL");if(s){const e=Ms(s);Fn(r,e,()=>e(r.currentUser)),Un(r,t=>e(t))}const o=(0,e.getDefaultEmulatorHost)("auth");return o&&Xe(r,`http://${o}`),r}Cs("Browser");
},{"@firebase/util":"VOc0","@firebase/app":"qn02","tslib":"CvJj","@firebase/logger":"uNCT","@firebase/component":"bXWY"}],"KezB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"ActionCodeOperation",{enumerable:!0,get:function(){return e.A}}),Object.defineProperty(exports,"ActionCodeURL",{enumerable:!0,get:function(){return e.ag}}),Object.defineProperty(exports,"AuthCredential",{enumerable:!0,get:function(){return e.J}}),Object.defineProperty(exports,"AuthErrorCodes",{enumerable:!0,get:function(){return e.G}}),Object.defineProperty(exports,"EmailAuthCredential",{enumerable:!0,get:function(){return e.K}}),Object.defineProperty(exports,"EmailAuthProvider",{enumerable:!0,get:function(){return e.Q}}),Object.defineProperty(exports,"FacebookAuthProvider",{enumerable:!0,get:function(){return e.U}}),Object.defineProperty(exports,"FactorId",{enumerable:!0,get:function(){return e.F}}),Object.defineProperty(exports,"GithubAuthProvider",{enumerable:!0,get:function(){return e.W}}),Object.defineProperty(exports,"GoogleAuthProvider",{enumerable:!0,get:function(){return e.V}}),Object.defineProperty(exports,"OAuthCredential",{enumerable:!0,get:function(){return e.L}}),Object.defineProperty(exports,"OAuthProvider",{enumerable:!0,get:function(){return e.X}}),Object.defineProperty(exports,"OperationType",{enumerable:!0,get:function(){return e.O}}),Object.defineProperty(exports,"PhoneAuthCredential",{enumerable:!0,get:function(){return e.M}}),Object.defineProperty(exports,"PhoneAuthProvider",{enumerable:!0,get:function(){return e.P}}),Object.defineProperty(exports,"PhoneMultiFactorGenerator",{enumerable:!0,get:function(){return e.m}}),Object.defineProperty(exports,"ProviderId",{enumerable:!0,get:function(){return e.p}}),Object.defineProperty(exports,"RecaptchaVerifier",{enumerable:!0,get:function(){return e.R}}),Object.defineProperty(exports,"SAMLAuthProvider",{enumerable:!0,get:function(){return e.Y}}),Object.defineProperty(exports,"SignInMethod",{enumerable:!0,get:function(){return e.S}}),Object.defineProperty(exports,"TotpMultiFactorGenerator",{enumerable:!0,get:function(){return e.T}}),Object.defineProperty(exports,"TotpSecret",{enumerable:!0,get:function(){return e.n}}),Object.defineProperty(exports,"TwitterAuthProvider",{enumerable:!0,get:function(){return e.Z}}),Object.defineProperty(exports,"applyActionCode",{enumerable:!0,get:function(){return e.a5}}),Object.defineProperty(exports,"beforeAuthStateChanged",{enumerable:!0,get:function(){return e.w}}),Object.defineProperty(exports,"browserLocalPersistence",{enumerable:!0,get:function(){return e.b}}),Object.defineProperty(exports,"browserPopupRedirectResolver",{enumerable:!0,get:function(){return e.k}}),Object.defineProperty(exports,"browserSessionPersistence",{enumerable:!0,get:function(){return e.a}}),Object.defineProperty(exports,"checkActionCode",{enumerable:!0,get:function(){return e.a6}}),Object.defineProperty(exports,"confirmPasswordReset",{enumerable:!0,get:function(){return e.a4}}),Object.defineProperty(exports,"connectAuthEmulator",{enumerable:!0,get:function(){return e.I}}),Object.defineProperty(exports,"createUserWithEmailAndPassword",{enumerable:!0,get:function(){return e.a8}}),Object.defineProperty(exports,"debugErrorMap",{enumerable:!0,get:function(){return e.D}}),Object.defineProperty(exports,"deleteUser",{enumerable:!0,get:function(){return e.C}}),Object.defineProperty(exports,"fetchSignInMethodsForEmail",{enumerable:!0,get:function(){return e.ad}}),Object.defineProperty(exports,"getAdditionalUserInfo",{enumerable:!0,get:function(){return e.ao}}),Object.defineProperty(exports,"getAuth",{enumerable:!0,get:function(){return e.o}}),Object.defineProperty(exports,"getIdToken",{enumerable:!0,get:function(){return e.al}}),Object.defineProperty(exports,"getIdTokenResult",{enumerable:!0,get:function(){return e.am}}),Object.defineProperty(exports,"getMultiFactorResolver",{enumerable:!0,get:function(){return e.aq}}),Object.defineProperty(exports,"getRedirectResult",{enumerable:!0,get:function(){return e.j}}),Object.defineProperty(exports,"inMemoryPersistence",{enumerable:!0,get:function(){return e.N}}),Object.defineProperty(exports,"indexedDBLocalPersistence",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(exports,"initializeAuth",{enumerable:!0,get:function(){return e.H}}),Object.defineProperty(exports,"initializeRecaptchaConfig",{enumerable:!0,get:function(){return e.t}}),Object.defineProperty(exports,"isSignInWithEmailLink",{enumerable:!0,get:function(){return e.ab}}),Object.defineProperty(exports,"linkWithCredential",{enumerable:!0,get:function(){return e.a0}}),Object.defineProperty(exports,"linkWithPhoneNumber",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(exports,"linkWithPopup",{enumerable:!0,get:function(){return e.d}}),Object.defineProperty(exports,"linkWithRedirect",{enumerable:!0,get:function(){return e.g}}),Object.defineProperty(exports,"multiFactor",{enumerable:!0,get:function(){return e.ar}}),Object.defineProperty(exports,"onAuthStateChanged",{enumerable:!0,get:function(){return e.x}}),Object.defineProperty(exports,"onIdTokenChanged",{enumerable:!0,get:function(){return e.v}}),Object.defineProperty(exports,"parseActionCodeURL",{enumerable:!0,get:function(){return e.ah}}),Object.defineProperty(exports,"prodErrorMap",{enumerable:!0,get:function(){return e.E}}),Object.defineProperty(exports,"reauthenticateWithCredential",{enumerable:!0,get:function(){return e.a1}}),Object.defineProperty(exports,"reauthenticateWithPhoneNumber",{enumerable:!0,get:function(){return e.r}}),Object.defineProperty(exports,"reauthenticateWithPopup",{enumerable:!0,get:function(){return e.e}}),Object.defineProperty(exports,"reauthenticateWithRedirect",{enumerable:!0,get:function(){return e.h}}),Object.defineProperty(exports,"reload",{enumerable:!0,get:function(){return e.ap}}),Object.defineProperty(exports,"sendEmailVerification",{enumerable:!0,get:function(){return e.ae}}),Object.defineProperty(exports,"sendPasswordResetEmail",{enumerable:!0,get:function(){return e.a3}}),Object.defineProperty(exports,"sendSignInLinkToEmail",{enumerable:!0,get:function(){return e.aa}}),Object.defineProperty(exports,"setPersistence",{enumerable:!0,get:function(){return e.q}}),Object.defineProperty(exports,"signInAnonymously",{enumerable:!0,get:function(){return e._}}),Object.defineProperty(exports,"signInWithCredential",{enumerable:!0,get:function(){return e.$}}),Object.defineProperty(exports,"signInWithCustomToken",{enumerable:!0,get:function(){return e.a2}}),Object.defineProperty(exports,"signInWithEmailAndPassword",{enumerable:!0,get:function(){return e.a9}}),Object.defineProperty(exports,"signInWithEmailLink",{enumerable:!0,get:function(){return e.ac}}),Object.defineProperty(exports,"signInWithPhoneNumber",{enumerable:!0,get:function(){return e.s}}),Object.defineProperty(exports,"signInWithPopup",{enumerable:!0,get:function(){return e.c}}),Object.defineProperty(exports,"signInWithRedirect",{enumerable:!0,get:function(){return e.f}}),Object.defineProperty(exports,"signOut",{enumerable:!0,get:function(){return e.B}}),Object.defineProperty(exports,"unlink",{enumerable:!0,get:function(){return e.an}}),Object.defineProperty(exports,"updateCurrentUser",{enumerable:!0,get:function(){return e.z}}),Object.defineProperty(exports,"updateEmail",{enumerable:!0,get:function(){return e.aj}}),Object.defineProperty(exports,"updatePassword",{enumerable:!0,get:function(){return e.ak}}),Object.defineProperty(exports,"updatePhoneNumber",{enumerable:!0,get:function(){return e.u}}),Object.defineProperty(exports,"updateProfile",{enumerable:!0,get:function(){return e.ai}}),Object.defineProperty(exports,"useDeviceLanguage",{enumerable:!0,get:function(){return e.y}}),Object.defineProperty(exports,"verifyBeforeUpdateEmail",{enumerable:!0,get:function(){return e.af}}),Object.defineProperty(exports,"verifyPasswordResetCode",{enumerable:!0,get:function(){return e.a7}});var e=require("./index-e3d5d3f4.js");require("@firebase/util"),require("@firebase/app"),require("tslib"),require("@firebase/logger"),require("@firebase/component");
},{"./index-e3d5d3f4.js":"zZOs","@firebase/util":"VOc0","@firebase/app":"qn02","tslib":"CvJj","@firebase/logger":"uNCT","@firebase/component":"bXWY"}],"R4bL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@firebase/auth");Object.keys(e).forEach(function(r){"default"!==r&&"__esModule"!==r&&(r in exports&&exports[r]===e[r]||Object.defineProperty(exports,r,{enumerable:!0,get:function(){return e[r]}}))});
},{"@firebase/auth":"KezB"}],"Focm":[function(require,module,exports) {
"use strict";var t=require("firebase/firestore"),e=require("./firebaseConfig"),r=require("firebase/storage"),n=require("firebase/auth");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach(function(e){c(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function c(t,e,r){return(e=u(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t){var e=s(t,"string");return"symbol"===o(e)?e:String(e)}function s(t,e){if("object"!==o(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function l(){l=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(q){s=function(t,e,r){return t[e]=r}}function f(t,e,r,o){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),c=new k(o||[]);return n(a,"_invoke",{value:E(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(q){return{type:"throw",arg:q}}}t.wrap=f;var h={};function v(){}function d(){}function y(){}var m={};s(m,a,function(){return this});var g=Object.getPrototypeOf,b=g&&g(g(P([])));b&&b!==e&&r.call(b,a)&&(m=b);var w=y.prototype=v.prototype=Object.create(m);function x(t){["next","throw","return"].forEach(function(e){s(t,e,function(t){return this._invoke(e,t)})})}function L(t,e){var i;n(this,"_invoke",{value:function(n,a){function c(){return new e(function(i,c){!function n(i,a,c,u){var s=p(t[i],t,a);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==o(f)&&r.call(f,"__await")?e.resolve(f.__await).then(function(t){n("next",t,c,u)},function(t){n("throw",t,c,u)}):e.resolve(f).then(function(t){l.value=t,c(l)},function(t){return n("throw",t,c,u)})}u(s.arg)}(n,a,i,c)})}return i=i?i.then(c,c):c()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return D()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=O(a,r);if(c){if(c===h)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=p(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function O(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,O(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var o=p(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,h;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function P(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return d.prototype=y,n(w,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:d,configurable:!0}),d.displayName=s(y,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,s(t,u,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},x(L.prototype),s(L.prototype,c,function(){return this}),t.AsyncIterator=L,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new L(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},x(w),s(w,u,"Generator"),s(w,a,function(){return this}),s(w,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=P,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}function f(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(s){return void r(s)}c.done?e(u):Promise.resolve(u).then(n,o)}function p(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){f(i,n,o,a,c,"next",t)}function c(t){f(i,n,o,a,c,"throw",t)}a(void 0)})}}var h=document.querySelector("#registerForm"),v=document.querySelector("#emailRegistration"),d=document.querySelector("#passwordRegistration"),y=document.querySelector("#loginForm"),m=document.querySelector("#emailLogin"),g=document.querySelector("#passwordLogin"),b=document.querySelector("#databaseInputForm"),w=document.querySelector("#emailInputDatabase"),x=document.querySelector("#passwordInputDatabase"),L=document.querySelector("#displayDb"),E=document.querySelector("#databaseDeleteForm"),O=document.querySelector("#idDeleteDatabase"),S=document.querySelector("#uploadFileForm"),j=document.querySelector("#uploadFile"),k=(0,n.getAuth)(),P=(0,t.collection)(e.database,"uzytkownicy"),D=function(){var t=p(l().mark(function t(e){var r,o;return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),r=v.value,!((o=d.value).length>=6)){t.next=16;break}return t.prev=4,t.next=7,(0,n.createUserWithEmailAndPassword)(k,r,o);case 7:alert("wszystko dziaa user utworzony"),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(4),t.t0.message.includes("email-already-in-use")&&alert("taki mail istnieje!");case 14:t.next=17;break;case 16:alert("mniej ni 6 znakw");case 17:case"end":return t.stop()}},t,null,[[4,10]])}));return function(e){return t.apply(this,arguments)}}(),q=function(){var t=p(l().mark(function t(e){var r,o,i;return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),r=m.value,o=g.value,t.prev=3,t.next=6,(0,n.signInWithEmailAndPassword)(k,r,o);case 6:i=t.sent,console.log("".concat(i.user.email," zalogowany")),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),console.log(t.t0);case 13:case"end":return t.stop()}},t,null,[[3,10]])}));return function(e){return t.apply(this,arguments)}}(),_=function(){var e=p(l().mark(function e(r){var n,o,i;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),n=w.value,o=x.value,e.prev=3,e.next=6,(0,t.addDoc)(P,{mail:n,password:o});case 6:i=e.sent,console.log(i),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.log(e.t0);case 13:case"end":return e.stop()}},e,null,[[3,10]])}));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=p(l().mark(function e(r){var n;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,(0,t.getDocs)(P);case 3:n=e.sent,console.log(n.docs.map(function(t){return a(a({},t.data()),{},{id:t.id})}));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),N=function(){(0,t.onSnapshot)(P,function(t){console.log(t.docs.map(function(t){return a(a({},t.data()),{},{id:t.id})}))})},G=function(){var r=p(l().mark(function r(n){var o;return l().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n.preventDefault(),o=(0,t.doc)(e.database,"uzytkownicy",O.value),r.prev=2,r.next=5,(0,t.deleteDoc)(o);case 5:r.next=10;break;case 7:r.prev=7,r.t0=r.catch(2),console.log(r.t0);case 10:case"end":return r.stop()}},r,null,[[2,7]])}));return function(t){return r.apply(this,arguments)}}(),z=function(){var t=p(l().mark(function t(n){var o;return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),o=(0,r.ref)(e.storage,"images/"+j.name);try{(0,r.uploadBytesResumable)(o,j.files[0]).on("state_changed",function(t){var e=t.bytesTransferred/t.totalBytes*100;console.log("Upload is "+e+"% done")},function(t){console.log(t)})}catch(i){console.log(i)}case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}();N(),h.addEventListener("submit",D),y.addEventListener("submit",q),b.addEventListener("submit",_),L.addEventListener("submit",F),E.addEventListener("submit",G),S.addEventListener("submit",z);
},{"firebase/firestore":"R6ck","./firebaseConfig":"Sfr6","firebase/storage":"pIUw","firebase/auth":"R4bL"}]},{},["Focm"], null)
//# sourceMappingURL=/ProjektSDA/ProjektSDA.c386d0f5.js.map